<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="true">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Syncrho MES v2.0 - Industry 4.0 Manufacturing Execution System</title>
    <link rel="icon" href="https://i.postimg.cc/B6w5mWry/Design-sem-nome-3.png" type="image/png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="auth.js"></script>
        <script>
            // Registro do Service Worker para Web Push
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('service-worker.js').then(function(reg) {
                        console.log('Service Worker registrado!', reg);
                    }).catch(function(err) {
                        console.warn('Erro ao registrar Service Worker:', err);
                    });
                });
            }

            // Solicitar permissão para notificações
            function solicitarPermissaoNotificacoes() {
                if ('Notification' in window && Notification.permission !== 'granted') {
                    Notification.requestPermission().then(function(permission) {
                        if (permission === 'granted') {
                            alert('Permissão para notificações concedida!');
                        }
                    });
                }
            }
            // Chame esta função após login do gestor ou em um botão/configuração
        </script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'primary-blue': '#0077C2',
              'text-dark': '#1F2937',
              'background-light': '#F9FAFB',
              'accent-1': '#4F46E5',
              'accent-2': '#10B981',
              'status-success': '#16A34A',
              'status-warning': '#F59E0B',
              'status-error': '#DC2626',
            }
          }
        }
      }
    </script>
    <style>
      /* Padrão de grid para header moderno */
      .bg-grid-pattern {
        background-image: 
          linear-gradient(rgba(255,255,255,.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255,255,255,.03) 1px, transparent 1px);
        background-size: 32px 32px;
      }
      
      /* CSS customizado para gráficos responsivos */
      .chart-container {
        position: relative;
        width: 100%;
        height: 100%;
        min-height: 280px;
      }
      
      .chart-container canvas {
        max-width: 100% !important;
        height: auto !important;
      }
      
      canvas {
        box-sizing: border-box;
      }
      
      /* MOBILE - Usar 100% da tela */
      @media (max-width: 767px) {
        .chart-container {
          min-height: 180px;
        }
        
        /* Padding mínimo */
        .bg-white.p-6.md\\:p-8 {
          padding: 0.375rem !important;
        }
        
        /* Gap compacto */
        .gap-4, .gap-6 {
          gap: 0.25rem;
        }
        
        /* Inputs iOS fix */
        input, select, textarea {
          font-size: 16px !important;
        }
        
        /* Grid 13 colunas - scroll horizontal */
        .grid-cols-13 {
          display: block !important;
          overflow-x: auto !important;
          white-space: nowrap !important;
        }
        
        .grid-cols-13 > div {
          display: inline-block !important;
          min-width: 60px !important;
          white-space: normal !important;
        }
        
        #hourly-entries-container {
          max-height: 200px !important;
        }
        
        /* Tabelas scrolláveis */
        table {
          display: block;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }
        
        /* Machine cards - 2 colunas compactas */
        #machine-card-grid {
          grid-template-columns: repeat(2, 1fr) !important;
          gap: 0.25rem !important;
        }
        
        .machine-card {
          padding: 0.25rem !important;
        }
        
        .machine-card .text-lg {
          font-size: 0.75rem !important;
        }
        
        .machine-card .text-sm {
          font-size: 0.625rem !important;
        }
      }
      
      /* Telas muito pequenas - manter 2 colunas */
      @media (max-width: 374px) {
        #machine-card-grid {
          grid-template-columns: repeat(2, 1fr) !important;
        }
        
        .machine-card .text-lg {
          font-size: 0.65rem !important;
        }
      }
      
      /* Modais em mobile */
      @media (max-width: 640px) {
        .w-full.max-w-lg,
        .w-full.max-w-md,
        .w-full.max-w-sm {
          max-width: 98vw !important;
          margin: 0 auto !important;
        }
        
        .bg-white.rounded-lg.shadow-xl.p-6,
        .bg-white.rounded-xl.shadow-2xl.p-6 {
          padding: 0.5rem !important;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        select:focus,
        textarea:focus {
          font-size: 16px !important;
        }
        
        /* Botões com padding adequado */
        button.w-full {
          min-height: 48px;
        }
      }
      
      /* Landscape mode em mobile */
      @media (max-width: 896px) and (orientation: landscape) {
        header {
          padding-top: 0.125rem !important;
          padding-bottom: 0.125rem !important;
          min-height: 40px !important;
        }
        
        .page-content {
          padding: 0.25rem !important;
        }
      }
      
      /* Prevenir zoom automático de inputs em iOS */
      input[type="text"],
      input[type="email"],
      input[type="number"],
      input[type="date"],
      input[type="tel"],
      select,
      textarea {
        font-size: 16px;
      }
      
      /* Timeline de progresso com animações suaves */
      .timeline-progress {
        animation: progressFill 1.5s ease-out;
      }

            .timeline-progress-bar {
                background: linear-gradient(90deg, #ef4444, #f87171);
                box-shadow: 0 6px 18px rgba(239, 68, 68, 0.25);
            }

            .timeline-progress.timeline-complete {
                animation: timelineCompleteBlink 1.2s ease-in-out infinite;
            }

            @keyframes timelineCompleteBlink {
                0%, 100% {
                    opacity: 1;
                    box-shadow: 0 6px 24px rgba(16, 185, 129, 0.45);
                }
                50% {
                    opacity: 0.6;
                    box-shadow: 0 4px 14px rgba(16, 185, 129, 0.25);
                }
            }
      
      @keyframes progressFill {
        from { width: 0%; }
        to { width: var(--progress-width); }
      }
      
      /* Melhoria visual para indicadores de status */
      .status-indicator {
        transition: all 0.3s ease;
      }
      
      .status-indicator.pulsing {
        animation: pulse 2s infinite;
      }
    </style>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS (XLSX) para importação/exportação de Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase App (a versão principal do SDK) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- Firebase Storage -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
</head>
<body class="bg-background-light text-text-dark antialiased">
    <!-- Overlay para sidebar mobile -->
    <div id="sidebar-overlay" class="sidebar-overlay md:hidden"></div>
    
    <!-- Modal de Edição de Ordem -->
    <div id="edit-order-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-lg relative border border-gray-100">
            <button id="close-edit-order-modal" class="absolute top-4 right-4 p-1.5 text-gray-400 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">&times;</button>
            <div class="flex items-center gap-3 mb-6">
                <div class="p-2 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl">
                    <i data-lucide="edit-3" class="w-5 h-5 text-blue-600"></i>
                </div>
                <h2 class="text-lg font-semibold text-gray-800">Editar Ordem de Produção</h2>
            </div>
            <form id="edit-order-form" class="space-y-4">
                <input type="hidden" id="edit-order-id">
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Produto</label>
                    <select id="edit-order-product" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required></select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                    <select id="edit-order-machine" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required></select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Cliente</label>
                    <input type="text" id="edit-order-customer" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Lote</label>
                    <input type="text" id="edit-order-lot" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Qtd Planejada</label>
                        <input type="number" id="edit-order-planned" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" min="0">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Qtd Executada</label>
                        <input type="number" id="edit-order-executed" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" min="0">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Matria-prima (MP)</label>
                    <select id="edit-order-mp" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required>
                        <option value="">Selecione a matria-prima...</option>
                    </select>
                </div>
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-100">
                    <button type="button" id="cancel-edit-order" class="px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">Cancelar</button>
                    <button type="submit" class="px-4 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <div class="flex flex-1 min-h-screen bg-background-light">
        <!-- Sidebar de Navegação -->
    <aside id="sidebar" class="w-64 bg-white flex flex-col no-print border-r border-gray-200 fixed inset-y-0 left-0 z-40 transform -translate-x-full transition-transform duration-300 md:relative md:z-30 md:translate-x-0 md:flex md:w-64 sidebar-expanded" data-state="expanded" aria-hidden="true">
            <div class="h-16 flex items-center justify-center border-b border-gray-200 px-4 relative">
                <img id="sidebar-logo" src="https://i.postimg.cc/5jdHwhF9/hokkaido-logo-110.png" alt="Logo Hokkaido Plastics" class="h-10 transition-all duration-300">
                <!-- Botão toggle para desktop -->
                <button id="sidebar-toggle-btn" class="absolute -right-12 top-6 p-2 bg-white border border-gray-200 rounded-r-lg hover:bg-gray-100 block transition-colors" title="Retrair/Expandir menu">
                    <i data-lucide="chevron-left" class="w-5 h-5 text-gray-600"></i>
                </button>
                <!-- Botão close para mobile -->
                <button id="sidebar-close-btn" class="absolute top-1/2 -translate-y-1/2 right-4 p-2 md:hidden">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-2">
                <a href="#" class="nav-btn group" data-page="planejamento" title="Planejamento">
                    <i data-lucide="clipboard-list" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Planejamento</span>
                    <span class="nav-tooltip">Planejamento</span>
                </a>
                <a href="#" class="nav-btn group" data-page="ordens" title="Ordens">
                    <i data-lucide="package-check" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Ordens</span>
                    <span class="nav-tooltip">Ordens</span>
                </a>
                <a href="#" class="nav-btn active group" data-page="lancamento" title="Lançamento">
                    <i data-lucide="keyboard" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Lançamento</span>
                    <span class="nav-tooltip">Lançamento</span>
                </a>
                <a href="#" class="nav-btn group" data-page="analise" title="Análise">
                    <i data-lucide="area-chart" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Análise</span>
                    <span class="nav-tooltip">Análise</span>
                </a>
                <a href="#" class="nav-btn group" data-page="relatorios" title="Relatórios">
                    <i data-lucide="file-bar-chart" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Relatórios</span>
                    <span class="nav-tooltip">Relatórios</span>
                </a>
                <a href="#" class="nav-btn group" data-page="paradas-longas" title="Paradas Longas">
                    <i data-lucide="calendar-off" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Paradas Longas</span>
                    <span class="nav-tooltip">Paradas Longas</span>
                </a>

            </nav>
        </aside>

        <!-- Conteúdo Principal -->
    <main class="flex-1 flex flex-col">
            <header class="bg-white/95 backdrop-blur border-b border-gray-200 px-3 lg:px-6 py-2 no-print relative min-h-[56px]">
                <button id="sidebar-open-btn" type="button" class="hamburger-btn md:hidden absolute left-3 top-1/2 -translate-y-1/2" aria-label="Abrir menu" aria-expanded="false">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <!-- Título centralizado absolutamente -->
                <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-center">
                    <h1 id="page-title" class="text-lg sm:text-xl font-semibold text-gray-900 leading-tight">Lançamento</h1>
                    <p class="text-xs font-medium text-gray-500 hidden sm:block">Registro operacional em tempo real</p>
                </div>
                
                <!-- Elementos   direita -->
                <div class="flex items-center justify-end gap-2 sm:gap-3 ml-auto">
                    <img src="https://i.postimg.cc/h47TKP4d/logosynchro.png" alt="Logo Hokkaido Synchro" class="hidden sm:block h-8 md:h-10 object-contain drop-shadow-sm">
                    <div id="header-user-card" class="flex flex-row items-center gap-2 rounded-lg border border-gray-200 bg-gray-50 px-2 py-1.5 shadow-sm">
                        <div class="flex items-center gap-2">
                            <div id="header-user-avatar" class="flex h-8 w-8 items-center justify-center rounded-full bg-primary-blue/10 text-primary-blue text-xs font-semibold uppercase">LC</div>
                            <div class="flex flex-col leading-tight text-left hidden sm:flex">
                                <div id="header-user-name" class="text-xs font-semibold text-gray-900">Leandro Camargo</div>
                                <span id="header-user-role-chip" class="inline-flex items-center rounded-full bg-blue-100 px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-blue-700 ring-1 ring-blue-200">Gestor</span>
                            </div>
                        </div>
                        <button id="logout-btn" class="inline-flex items-center justify-center gap-1 rounded-full bg-white px-3 py-1 text-xs font-semibold text-red-600 shadow-sm ring-1 ring-red-200 transition hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <i data-lucide="log-out" class="w-3.5 h-3.5"></i>
                            <span class="hidden sm:inline">Sair</span>
                        </button>
                    </div>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-0">
                <!-- PÁGINA: Planejamento -->
                <div id="planejamento-page" class="page-content hidden space-y-1 p-1">
                    
                    <!-- Header Moderno -->
                    <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-700 rounded-lg shadow-md p-2 lg:p-3 text-white">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-1.5">
                            <div>
                                <h1 class="text-base md:text-lg font-bold flex items-center gap-1.5">
                                    <i data-lucide="clipboard-list" class="w-5 h-5 lg:w-6 lg:h-6"></i>
                                    Planejamento de Produção
                                </h1>
                                <p class="text-indigo-100 mt-0.5 text-xs md:text-sm hidden lg:block">Gerencie o planejamento diário de Produção</p>
                            </div>
                            <div class="flex flex-wrap items-center gap-2">
                                <div class="bg-white/10 backdrop-blur-sm rounded-lg px-3 py-1.5 flex items-center gap-2">
                                    <i data-lucide="calendar" class="w-4 h-4"></i>
                                    <input type="date" id="planning-date-selector" name="date" required 
                                        class="bg-transparent border-none text-white placeholder-white/70 focus:outline-none focus:ring-0 text-xs font-medium">
                                </div>
                                <button type="button" id="planning-refresh-btn" onclick="refreshPlanningData()" 
                                    class="bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white px-3 py-1.5 rounded-lg flex items-center gap-1 transition-all text-xs font-medium">
                                    <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i>
                                    <span class="hidden sm:inline">Atualizar</span>
                                </button>
                                <button type="button" onclick="printPlanningReport()" 
                                    class="bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white px-3 py-1.5 rounded-lg flex items-center gap-1 transition-all text-xs font-medium">
                                    <i data-lucide="printer" class="w-3.5 h-3.5"></i>
                                    <span class="hidden sm:inline">Imprimir</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- KPIs do Planejamento -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-2xl shadow-sm border border-indigo-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-indigo-700">Itens Planejados</p>
                                <div class="p-1.5 bg-indigo-200 rounded-lg">
                                    <i data-lucide="list-todo" class="w-3.5 h-3.5 text-indigo-600"></i>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-indigo-600" id="planning-kpi-items">0</p>
                            <p class="text-xs text-indigo-600 opacity-70 mt-1">itens</p>
                        </div>
                        <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-2xl shadow-sm border border-emerald-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-emerald-700">Máquinas Ativas</p>
                                <div class="p-1.5 bg-emerald-200 rounded-lg">
                                    <i data-lucide="cog" class="w-3.5 h-3.5 text-emerald-600"></i>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-emerald-600" id="planning-kpi-machines">0</p>
                            <p class="text-xs text-emerald-600 opacity-70 mt-1">máquinas</p>
                        </div>
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-blue-700">Produção Total</p>
                                <div class="p-1.5 bg-blue-200 rounded-lg">
                                    <i data-lucide="package" class="w-3.5 h-3.5 text-blue-600"></i>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-blue-600" id="planning-kpi-produced">0</p>
                            <p class="text-xs text-blue-600 opacity-70 mt-1">peças</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl shadow-sm border border-purple-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-purple-700">Produtos Únicos</p>
                                <div class="p-1.5 bg-purple-200 rounded-lg">
                                    <i data-lucide="boxes" class="w-3.5 h-3.5 text-purple-600"></i>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-purple-600" id="planning-kpi-products">0</p>
                            <p class="text-xs text-purple-600 opacity-70 mt-1">produtos</p>
                        </div>
                    </div>

                    <!-- Layout em duas colunas: Formulário compacto + Painel de Lançamento -->
                    <div class="grid grid-cols-1 xl:grid-cols-3 gap-3">
                        
                        <!-- Coluna 1: Formulário de Planejamento Reestruturado -->
                        <div class="xl:col-span-1">
                            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                                <div class="bg-gradient-to-r from-indigo-500 to-purple-500 px-4 py-3">
                                    <h2 class="text-lg font-bold text-white flex items-center gap-2">
                                        <i data-lucide="plus-circle" class="w-5 h-5"></i>
                                        Novo Planejamento
                                    </h2>
                                </div>
                                <form id="planning-form" class="p-5 space-y-5">
                                    
                                    <!-- SEÇÃO 1: Dados da Ordem de Produção (do Excel) -->
                                    <div class="border border-blue-200 rounded-lg overflow-hidden">
                                        <div class="bg-blue-50 px-3 py-2 border-b border-blue-200">
                                            <h3 class="text-xs font-bold text-blue-700 uppercase tracking-wide flex items-center gap-1.5">
                                                <i data-lucide="file-spreadsheet" class="w-3.5 h-3.5"></i>
                                                Dados da OP (Excel)
                                            </h3>
                                        </div>
                                        <div class="p-3 space-y-3 bg-white">
                                            <div>
                                                <label for="planning-order-select" class="block text-[10px] font-semibold text-gray-500 uppercase mb-1">Ordem de Produção</label>
                                                <select id="planning-order-select" name="production_order_id" required 
                                                    class="w-full p-2 text-sm border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                                    <option value="">Selecione a OP...</option>
                                                </select>
                                            </div>
                                            <div id="planning-order-info" class="p-2.5 bg-blue-50 border border-blue-100 rounded-lg text-xs" style="display: none;">
                                                <div class="grid grid-cols-2 gap-2">
                                                    <div>
                                                        <span class="text-blue-500 font-medium">Nº OP:</span>
                                                        <span id="planning-order-number" class="text-blue-800 font-bold ml-1">-</span>
                                                    </div>
                                                    <div>
                                                        <span class="text-blue-500 font-medium">Cliente:</span>
                                                        <span id="planning-order-customer" class="text-blue-800 font-semibold ml-1">-</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label for="planning-lot-size" class="block text-[10px] font-semibold text-gray-500 uppercase mb-1">Tamanho do Lote</label>
                                                    <input type="number" id="planning-lot-size" name="order_lot_size" 
                                                        class="w-full p-2 text-sm border border-gray-200 rounded-lg bg-blue-50/50 text-blue-700 font-semibold text-center" readonly placeholder="Auto">
                                                </div>
                                                <div>
                                                    <label for="planning-machine" class="block text-[10px] font-semibold text-gray-500 uppercase mb-1">Máquina</label>
                                                    <select id="planning-machine" name="machine" required 
                                                        class="w-full p-2 text-sm border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"></select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- SEÇÃO 2: Dados do Produto (do Database) -->
                                    <div class="border border-emerald-200 rounded-lg overflow-hidden">
                                        <div class="bg-emerald-50 px-3 py-2 border-b border-emerald-200">
                                            <h3 class="text-xs font-bold text-emerald-700 uppercase tracking-wide flex items-center gap-1.5">
                                                <i data-lucide="database" class="w-3.5 h-3.5"></i>
                                                Dados do Produto (Cadastro)
                                            </h3>
                                        </div>
                                        <div class="p-3 space-y-3 bg-white">
                                            <div>
                                                <label for="planning-product-cod" class="block text-[10px] font-semibold text-gray-500 uppercase mb-1">Código do Produto</label>
                                                <input type="text" id="planning-product-cod" name="product_cod" required placeholder="Preenchido automaticamente" 
                                                    inputmode="numeric" pattern="[0-9]*" autocomplete="off" list="planning-product-cod-list" 
                                                    class="w-full p-2 text-sm border border-gray-200 rounded-lg bg-emerald-50/50 text-emerald-700 font-semibold text-center" readonly>
                                                <datalist id="planning-product-cod-list"></datalist>
                                            </div>
                                            <div id="product-name-display" class="p-2.5 bg-emerald-50 border border-emerald-100 rounded-lg" style="display: none;">
                                                <p class="text-[10px] text-emerald-500 font-medium uppercase mb-0.5">Nome do Produto</p>
                                                <p id="product-name-text" class="text-xs font-semibold text-emerald-800 leading-tight"></p>
                                            </div>
                                            
                                            <!-- Parâmetros técnicos do produto -->
                                            <div class="grid grid-cols-3 gap-2 pt-1">
                                                <div class="bg-gray-50 rounded-lg p-2 text-center border border-gray-100">
                                                    <label for="budgeted-cycle" class="block text-[9px] text-gray-400 uppercase font-medium">Ciclo (s)</label>
                                                    <input type="number" id="budgeted-cycle" name="budgeted_cycle" required 
                                                        class="w-full text-lg font-bold text-emerald-600 bg-transparent border-0 text-center p-0 focus:ring-0" readonly>
                                                </div>
                                                <div class="bg-gray-50 rounded-lg p-2 text-center border border-gray-100">
                                                    <label for="mold-cavities" class="block text-[9px] text-gray-400 uppercase font-medium">Cavidades</label>
                                                    <input type="number" id="mold-cavities" name="mold_cavities" required 
                                                        class="w-full text-lg font-bold text-emerald-600 bg-transparent border-0 text-center p-0 focus:ring-0" readonly>
                                                </div>
                                                <div class="bg-gray-50 rounded-lg p-2 text-center border border-gray-100">
                                                    <label for="piece-weight" class="block text-[9px] text-gray-400 uppercase font-medium">Peso (g)</label>
                                                    <input type="number" id="piece-weight" name="piece_weight" required step="0.001" 
                                                        class="w-full text-lg font-bold text-emerald-600 bg-transparent border-0 text-center p-0 focus:ring-0" readonly>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- SEÇÃO 3: Matria-Prima e Quantidade Planejada -->
                                    <div class="border border-amber-200 rounded-lg overflow-hidden">
                                        <div class="bg-amber-50 px-3 py-2 border-b border-amber-200">
                                            <h3 class="text-xs font-bold text-amber-700 uppercase tracking-wide flex items-center gap-1.5">
                                                <i data-lucide="layers" class="w-3.5 h-3.5"></i>
                                                Produção
                                            </h3>
                                        </div>
                                        <div class="p-3 space-y-3 bg-white">
                                            <div>
                                                <label for="planning-mp" class="block text-[10px] font-semibold text-gray-500 uppercase mb-1">Matria-prima (MP)</label>
                                                <select id="planning-mp" name="mp" required 
                                                    class="w-full p-2 text-sm border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all">
                                                    <option value="">Selecione a MP...</option>
                                                </select>
                                            </div>
                                            <div class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg p-3 border border-amber-100">
                                                <label for="planned-quantity" class="block text-[10px] font-semibold text-amber-600 uppercase mb-1 text-center">
                                                    Quantidade Planejada (85% Eficiência)
                                                </label>
                                                <input type="number" id="planned-quantity" name="planned_quantity" required 
                                                    class="w-full text-2xl font-bold text-amber-700 bg-transparent border-0 text-center p-0 focus:ring-0" readonly>
                                                <p class="text-[9px] text-amber-500 text-center mt-1">Calculado: (86400s · ciclo) × cavidades × 85%</p>
                                            </div>
                                        </div>
                                    </div>

                                    <button type="submit" id="planning-submit-button" 
                                        class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 transition-all shadow-md hover:shadow-lg">
                                        <i data-lucide="plus-circle" class="w-5 h-5"></i>
                                        <span>Adicionar ao Plano</span>
                                    </button>
                                    <div id="planning-status-message" class="text-sm font-semibold h-5 text-center"></div>
                                </form>
                            </div>
                        </div>

                        <!-- Coluna 2: Painel de Lançamento Ciclo/Cavidades -->
                        <div class="xl:col-span-2">
                            <div class="bg-white rounded-xl shadow-lg overflow-hidden h-full">
                                <div class="bg-gradient-to-r from-emerald-500 to-teal-500 px-5 py-4 flex items-center justify-between">
                                    <h2 class="text-lg font-bold text-white flex items-center gap-2">
                                        <i data-lucide="sliders-horizontal" class="w-5 h-5"></i>
                                        Painel de Lançamento Ciclo/Cavidades
                                    </h2>
                                    <span class="bg-white/20 text-white text-xs font-medium px-3 py-1 rounded-full" id="planning-panel-count">0 itens</span>
                                </div>
                                <div class="p-5">
                                    <div id="leader-launch-panel" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                                    <div id="leader-panel-loading" class="text-center py-16" style="display: none;">
                                        <div class="inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4">
                                            <i data-lucide="loader-2" class="w-8 h-8 animate-spin text-indigo-600"></i>
                                        </div>
                                        <p class="text-gray-500">Carregando planejamento...</p>
                                    </div>
                                    <div id="leader-panel-no-data" class="text-center py-16" style="display: none;">
                                        <div class="inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full mb-4">
                                            <i data-lucide="calendar-x" class="w-8 h-8 text-gray-400"></i>
                                        </div>
                                        <p class="text-gray-500 font-medium">Nenhum item planejado</p>
                                        <p class="text-gray-400 text-sm mt-1">Adicione um planejamento para esta data</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabela de Controle de Ciclo/Cavidade -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-r from-slate-600 to-slate-700 px-5 py-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                            <h2 class="text-lg font-bold text-white flex items-center gap-2">
                                <i data-lucide="list-checks" class="w-5 h-5"></i>
                                Controle de Ciclo/Cavidade por Turno
                            </h2>
                            <div class="flex items-center gap-2">
                                <input type="text" id="planning-table-search" placeholder="Buscar máquina ou produto..." 
                                    class="px-3 py-1.5 text-sm border-0 rounded-lg bg-white/10 text-white placeholder-white/60 focus:ring-2 focus:ring-white/30 focus:bg-white/20 transition-all w-48">
                                <button type="button" onclick="exportPlanningTable()" 
                                    class="bg-white/20 hover:bg-white/30 text-white px-3 py-1.5 rounded-lg flex items-center gap-1 transition-all text-sm">
                                    <i data-lucide="download" class="w-4 h-4"></i>
                                    <span class="hidden sm:inline">Exportar</span>
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th rowspan="2" class="px-3 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider align-middle border-b-2 border-gray-200 bg-gray-100">Máq.</th>
                                        <th rowspan="2" class="px-3 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider align-middle border-b-2 border-gray-200 bg-gray-100">Produto</th>
                                        <th rowspan="2" class="px-3 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider align-middle border-b-2 border-gray-200 bg-gray-100">MP</th>
                                        <th colspan="3" class="px-3 py-2 text-center text-xs font-bold text-gray-600 uppercase tracking-wider border-b border-gray-300 bg-gray-100">Planejado</th>
                                        <th colspan="3" class="px-3 py-2 text-center text-xs font-bold text-blue-700 uppercase tracking-wider border-b border-blue-200 bg-blue-50">1º Turno</th>
                                        <th colspan="3" class="px-3 py-2 text-center text-xs font-bold text-amber-700 uppercase tracking-wider border-b border-amber-200 bg-amber-50">2º Turno</th>
                                        <th colspan="3" class="px-3 py-2 text-center text-xs font-bold text-purple-700 uppercase tracking-wider border-b border-purple-200 bg-purple-50">3º Turno</th>
                                        <th rowspan="2" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider align-middle border-b-2 border-gray-200 bg-emerald-50">Total</th>
                                        <th rowspan="2" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider align-middle border-b-2 border-gray-200 bg-gray-100 no-print">Ações</th>
                                    </tr>
                                    <tr>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-gray-500 uppercase border-b border-gray-200 bg-gray-50">Ciclo</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-gray-500 uppercase border-b border-gray-200 bg-gray-50">Cav.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-gray-500 uppercase border-b border-gray-200 bg-gray-50">Peso</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-blue-600 uppercase border-b border-blue-200 bg-blue-50">Ciclo</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-blue-600 uppercase border-b border-blue-200 bg-blue-50">Cav.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-blue-600 uppercase border-b border-blue-200 bg-blue-50">Qtd.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-amber-600 uppercase border-b border-amber-200 bg-amber-50">Ciclo</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-amber-600 uppercase border-b border-amber-200 bg-amber-50">Cav.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-amber-600 uppercase border-b border-amber-200 bg-amber-50">Qtd.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-purple-600 uppercase border-b border-purple-200 bg-purple-50">Ciclo</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-purple-600 uppercase border-b border-purple-200 bg-purple-50">Cav.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-purple-600 uppercase border-b border-purple-200 bg-purple-50">Qtd.</th>
                                    </tr>
                                </thead>
                                <tbody id="planning-table-body" class="divide-y divide-gray-100 bg-white"></tbody>
                            </table>
                        </div>
                        <div id="planning-table-empty" class="text-center py-12 hidden">
                            <div class="inline-flex items-center justify-center w-14 h-14 bg-gray-100 rounded-full mb-3">
                                <i data-lucide="table" class="w-7 h-7 text-gray-400"></i>
                            </div>
                            <p class="text-gray-500">Nenhum dado para exibir na tabela</p>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: Ordens de Produção -->
                <div id="ordens-page" class="page-content hidden space-y-3 p-2">
                    <!-- KPIs de Resumo das Ordens -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-blue-700">Total de OPs</p>
                                <div class="p-1.5 bg-blue-200 rounded-lg">
                                    <i data-lucide="layers" class="w-3.5 h-3.5 text-blue-600"></i>
                                </div>
                            </div>
                            <p id="orders-kpi-total" class="text-2xl font-bold text-blue-600">0</p>
                            <p class="text-xs text-blue-600 opacity-70 mt-1">ordens</p>
                        </div>
                        <div class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl shadow-sm border border-amber-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-amber-700">Em Andamento</p>
                                <div class="p-1.5 bg-amber-200 rounded-lg">
                                    <i data-lucide="play-circle" class="w-3.5 h-3.5 text-amber-600"></i>
                                </div>
                            </div>
                            <p id="orders-kpi-active" class="text-2xl font-bold text-amber-600">0</p>
                            <p class="text-xs text-amber-600 opacity-70 mt-1">ativas</p>
                        </div>
                        <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-2xl shadow-sm border border-emerald-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-emerald-700">Concluídas</p>
                                <div class="p-1.5 bg-emerald-200 rounded-lg">
                                    <i data-lucide="check-circle-2" class="w-3.5 h-3.5 text-emerald-600"></i>
                                </div>
                            </div>
                            <p id="orders-kpi-completed" class="text-2xl font-bold text-emerald-600">0</p>
                            <p class="text-xs text-emerald-600 opacity-70 mt-1">finalizadas</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl shadow-sm border border-purple-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-purple-700">Progresso Médio</p>
                                <div class="p-1.5 bg-purple-200 rounded-lg">
                                    <i data-lucide="trending-up" class="w-3.5 h-3.5 text-purple-600"></i>
                                </div>
                            </div>
                            <p id="orders-kpi-avg-progress" class="text-2xl font-bold text-purple-600">0%</p>
                            <p class="text-xs text-purple-600 opacity-70 mt-1">do total</p>
                        </div>
                    </div>

                    <!-- Painel Principal -->
                    <div class="bg-white p-4 md:p-5 rounded-2xl shadow-sm border border-gray-100">
                        <!-- Cabeçalho com Título e Ações -->
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-blue-100 rounded-lg">
                                    <i data-lucide="package-check" class="w-5 h-5 text-blue-600"></i>
                                </div>
                                <div>
                                    <h2 class="text-lg font-semibold text-gray-800">Gestão de Ordens de Produção</h2>
                                    <p class="text-xs text-gray-500">Cadastre, importe e gerencie todas as OPs</p>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="openNewOrderModal()" class="inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold rounded-xl shadow-md hover:shadow-lg transition-all text-sm">
                                    <i data-lucide="plus-circle" class="w-4 h-4"></i>
                                    Nova OP
                                </button>
                                <button onclick="openImportOrdersModal()" class="inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 text-white font-semibold rounded-xl shadow-md hover:shadow-lg transition-all text-sm">
                                    <i data-lucide="upload" class="w-4 h-4"></i>
                                    Importar Excel
                                </button>
                            </div>
                        </div>

                        <!-- Filtros -->
                        <div class="bg-gray-50 p-4 rounded-lg mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-12 gap-3">
                                <!-- Busca -->
                                <div class="md:col-span-4">
                                    <div class="relative">
                                        <input type="text" id="orders-search" placeholder="Buscar Nº OP, produto, cliente..." class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-blue focus:border-transparent">
                                    </div>
                                </div>
                                <!-- Status -->
                                <div class="md:col-span-2">
                                    <select id="orders-status-filter" class="w-full py-2.5 px-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-blue focus:border-transparent">
                                        <option value="">Todos os Status</option>
                                        <option value="planejada">📋 Planejada</option>
                                        <option value="ativa">▶️ Ativa</option>
                                        <option value="em_andamento">🔄 Em Andamento</option>
                                        <option value="concluida">✅ Concluída</option>
                                        <option value="cancelada">❌ Cancelada</option>
                                    </select>
                                </div>
                                <!-- Máquina -->
                                <div class="md:col-span-2">
                                    <select id="orders-machine-filter" class="w-full py-2.5 px-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-blue focus:border-transparent">
                                        <option value="">Todas Máquinas</option>
                                    </select>
                                </div>
                                <!-- Ordenação -->
                                <div class="md:col-span-2">
                                    <select id="orders-sort-filter" class="w-full py-2.5 px-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-blue focus:border-transparent">
                                        <option value="recent">Mais recentes</option>
                                        <option value="progress-desc">Maior progresso</option>
                                        <option value="progress-asc">Menor progresso</option>
                                        <option value="lot-desc">Maior lote</option>
                                        <option value="alpha">A-Z (Nº OP)</option>
                                    </select>
                                </div>
                                <!-- Botões -->
                                <div class="md:col-span-2 flex gap-2">
                                    <button id="orders-clear-filters" class="flex-1 py-2.5 px-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition flex items-center justify-center gap-1">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                        Limpar
                                    </button>
                                    <button onclick="refreshOrdersList()" class="flex-1 py-2.5 px-3 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg text-sm font-medium transition flex items-center justify-center gap-1">
                                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                        Atualizar
                                    </button>
                                </div>
                            </div>
                            <!-- Contador e Toggle de View -->
                            <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-200">
                                <span id="orders-count" class="text-sm text-gray-600 font-medium">0 ordens encontradas</span>
                                <div class="flex items-center gap-2 bg-gray-200 rounded-lg p-1">
                                    <button id="orders-view-grid-btn" class="px-3 py-1.5 rounded-md text-sm font-medium bg-white shadow-sm text-primary-blue" title="Cards">
                                        <i data-lucide="grid-3x3" class="w-4 h-4"></i>
                                    </button>
                                    <button id="orders-view-table-btn" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700" title="Tabela">
                                        <i data-lucide="list" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Grid de Cards -->
                        <div id="orders-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                            <!-- Cards serão gerados dinamicamente -->
                        </div>

                        <!-- Tabela (alternativa) -->
                        <div id="orders-table-container" class="hidden overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 border rounded-lg">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wide">Nº OP</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wide">Produto</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wide">Máquina</th>
                                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide">Lote</th>
                                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide">Progresso</th>
                                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide">Status</th>
                                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="orders-table-body" class="divide-y divide-gray-200 bg-white">
                                    <!-- Linhas serão preenchidas dinamicamente -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Empty State -->
                        <div id="orders-empty-state" class="hidden flex-col items-center justify-center py-16">
                            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                                <i data-lucide="inbox" class="w-10 h-10 text-gray-400"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-2">Nenhuma ordem encontrada</h3>
                            <p class="text-sm text-gray-500 mb-4">Cadastre uma nova OP ou importe do Excel</p>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: Relatórios -->
                <div id="relatorios-page" class="page-content hidden p-2 space-y-4">
                    <!-- Cabeçalho com Gradiente -->
                    <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-700 rounded-2xl shadow-lg p-4 md:p-5">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                            <div class="flex items-center gap-4">
                                <div class="p-3 bg-white/20 rounded-xl">
                                    <i data-lucide="file-bar-chart" class="w-7 h-7 text-white"></i>
                                </div>
                                <div class="text-white">
                                    <h2 class="text-xl md:text-2xl font-bold">Central de Relatórios</h2>
                                    <p class="text-indigo-100 text-sm">Visualize e exporte relatórios detalhados de Produção, Paradas e perdas</p>
                                </div>
                            </div>
                            <div class="flex flex-wrap items-center gap-2">
                                <button id="report-export-excel" class="inline-flex items-center gap-2 bg-white/10 hover:bg-white/20 backdrop-blur text-white px-4 py-2.5 rounded-xl font-semibold transition border border-white/20 text-sm">
                                    <i data-lucide="file-spreadsheet" class="w-4 h-4"></i>
                                    Excel
                                </button>
                                <button id="report-export-pdf" class="inline-flex items-center gap-2 bg-white/10 hover:bg-white/20 backdrop-blur text-white px-4 py-2.5 rounded-xl font-semibold transition border border-white/20 text-sm">
                                    <i data-lucide="file-text" class="w-4 h-4"></i>
                                    PDF
                                </button>
                                <button id="report-generate-btn" class="inline-flex items-center gap-2 bg-white text-indigo-600 hover:bg-indigo-50 px-5 py-2.5 rounded-xl font-bold transition shadow-lg text-sm">
                                    <i data-lucide="play" class="w-4 h-4"></i>
                                    Gerar Relatório
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Cards de Tipo de Relatório -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
                        <label class="report-type-card cursor-pointer">
                            <input type="radio" name="report-type-radio" value="producao" class="hidden" checked>
                            <div class="bg-white border-2 border-gray-200 hover:border-blue-400 rounded-2xl p-4 transition-all duration-200 h-full report-type-content hover:shadow-md">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 bg-blue-100 rounded-lg">
                                        <i data-lucide="package" class="w-4 h-4 text-blue-600"></i>
                                    </div>
                                    <span class="font-semibold text-gray-800">Produção</span>
                                </div>
                                <p class="text-xs text-gray-500">Quantidade produzida, metas e eficiência por máquina</p>
                            </div>
                        </label>
                        <label class="report-type-card cursor-pointer">
                            <input type="radio" name="report-type-radio" value="paradas" class="hidden">
                            <div class="bg-white border-2 border-gray-200 hover:border-red-400 rounded-2xl p-4 transition-all duration-200 h-full report-type-content hover:shadow-md">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 bg-red-100 rounded-lg">
                                        <i data-lucide="pause-circle" class="w-4 h-4 text-red-600"></i>
                                    </div>
                                    <span class="font-semibold text-gray-800">Paradas</span>
                                </div>
                                <p class="text-xs text-gray-500">Tempo parado, motivos e impacto na Produção</p>
                            </div>
                        </label>
                        <label class="report-type-card cursor-pointer">
                            <input type="radio" name="report-type-radio" value="perdas" class="hidden">
                            <div class="bg-white border-2 border-gray-200 hover:border-orange-400 rounded-2xl p-4 transition-all duration-200 h-full report-type-content hover:shadow-md">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 bg-orange-100 rounded-lg">
                                        <i data-lucide="alert-triangle" class="w-4 h-4 text-orange-600"></i>
                                    </div>
                                    <span class="font-semibold text-gray-800">Refugos</span>
                                </div>
                                <p class="text-xs text-gray-500">Perdas, refugos e análise de causas</p>
                            </div>
                        </label>
                        <label class="report-type-card cursor-pointer">
                            <input type="radio" name="report-type-radio" value="consolidado" class="hidden">
                            <div class="bg-white border-2 border-gray-200 hover:border-purple-400 rounded-2xl p-4 transition-all duration-200 h-full report-type-content hover:shadow-md">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 bg-purple-100 rounded-lg">
                                        <i data-lucide="layout-dashboard" class="w-4 h-4 text-purple-600"></i>
                                    </div>
                                    <span class="font-semibold text-gray-800">Consolidado</span>
                                </div>
                                <p class="text-xs text-gray-500">Visão geral com todos os indicadores</p>
                            </div>
                        </label>
                    </div>

                    <!-- Filtros Compactos -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4">
                        <div class="flex flex-wrap items-center gap-3">
                            <!-- Período -->
                            <div class="flex items-center gap-2 bg-gray-50 rounded-lg px-3 py-2.5 border border-gray-200">
                                <i data-lucide="calendar" class="w-4 h-4 text-gray-400"></i>
                                <select id="report-period" class="bg-transparent border-0 text-sm font-medium text-gray-700 focus:ring-0 cursor-pointer pr-6">
                                    <option value="today">Hoje</option>
                                    <option value="yesterday">Ontem</option>
                                    <option value="7days" selected>Últimos 7 dias</option>
                                    <option value="30days">Últimos 30 dias</option>
                                    <option value="month">Este mês</option>
                                    <option value="lastmonth">Mês passado</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </div>

                            <!-- Máquina -->
                            <div class="flex items-center gap-2 bg-gray-50 rounded-lg px-3 py-2">
                                <i data-lucide="cpu" class="w-4 h-4 text-gray-400"></i>
                                <select id="report-machine" class="bg-transparent border-0 text-sm font-medium text-gray-700 focus:ring-0 cursor-pointer pr-6">
                                    <option value="all">Todas Máquinas</option>
                                </select>
                            </div>

                            <!-- Turno -->
                            <div class="flex items-center gap-2 bg-gray-50 rounded-lg px-3 py-2">
                                <i data-lucide="clock" class="w-4 h-4 text-gray-400"></i>
                                <select id="report-shift" class="bg-transparent border-0 text-sm font-medium text-gray-700 focus:ring-0 cursor-pointer pr-6">
                                    <option value="all">Todos Turnos</option>
                                    <option value="1">Turno 1 (07:00-15:00)</option>
                                    <option value="2">Turno 2 (15:00-23:20)</option>
                                    <option value="3">Turno 3 (23:00-07:00)</option>
                                </select>
                            </div>

                            <!-- Datas Personalizadas -->
                            <div id="report-custom-dates" class="hidden flex items-center gap-2">
                                <div class="flex items-center gap-2 bg-gray-50 rounded-lg px-3 py-2">
                                    <span class="text-xs text-gray-500">De:</span>
                                    <input type="date" id="report-date-start" class="bg-transparent border-0 text-sm font-medium text-gray-700 focus:ring-0">
                                </div>
                                <div class="flex items-center gap-2 bg-gray-50 rounded-lg px-3 py-2">
                                    <span class="text-xs text-gray-500">Até:</span>
                                    <input type="date" id="report-date-end" class="bg-transparent border-0 text-sm font-medium text-gray-700 focus:ring-0">
                                </div>
                            </div>

                            <!-- Indicador de filtros ativos -->
                            <div class="ml-auto flex items-center gap-2">
                                <span id="report-filter-status" class="text-xs text-gray-400">
                                    <i data-lucide="filter" class="w-3 h-3 inline"></i>
                                    Filtros aplicados
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Select hidden para compatibilidade -->
                    <select id="report-type" class="hidden">
                        <option value="producao">Produção</option>
                        <option value="paradas">Paradas</option>
                        <option value="perdas">Perdas/Refugos</option>
                        <option value="consolidado">Consolidado</option>
                    </select>

                    <!-- KPIs Resumo -->
                    <div id="report-kpis" class="grid grid-cols-2 lg:grid-cols-4 gap-3 hidden">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-blue-700">Total Produzido</p>
                                <div class="p-1.5 bg-blue-200 rounded-lg">
                                    <i data-lucide="package" class="w-3.5 h-3.5 text-blue-600"></i>
                                </div>
                            </div>
                            <p id="report-kpi-produced" class="text-2xl font-bold text-blue-600">0</p>
                            <p class="text-xs text-blue-600 opacity-70 mt-1">peças</p>
                        </div>
                        <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-2xl shadow-sm border border-red-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-red-700">Tempo Parado</p>
                                <div class="p-1.5 bg-red-200 rounded-lg">
                                    <i data-lucide="pause-circle" class="w-3.5 h-3.5 text-red-600"></i>
                                </div>
                            </div>
                            <p id="report-kpi-downtime" class="text-2xl font-bold text-red-600">0h</p>
                            <p class="text-xs text-red-600 opacity-70 mt-1">horas</p>
                        </div>
                        <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl shadow-sm border border-orange-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-orange-700">Total Refugos</p>
                                <div class="p-1.5 bg-orange-200 rounded-lg">
                                    <i data-lucide="alert-triangle" class="w-3.5 h-3.5 text-orange-600"></i>
                                </div>
                            </div>
                            <p id="report-kpi-losses" class="text-2xl font-bold text-orange-600">0</p>
                            <p class="text-xs text-orange-600 opacity-70 mt-1">perdas</p>
                        </div>
                        <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-2xl shadow-sm border border-emerald-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-emerald-700">Eficiência Média</p>
                                <div class="p-1.5 bg-emerald-200 rounded-lg">
                                    <i data-lucide="trending-up" class="w-3.5 h-3.5 text-emerald-600"></i>
                                </div>
                            </div>
                            <p id="report-kpi-efficiency" class="text-2xl font-bold text-emerald-600">0%</p>
                            <p class="text-xs text-emerald-600 opacity-70 mt-1">OEE</p>
                        </div>
                    </div>

                    <!-- Área de Loading -->
                    <div id="report-loading" class="hidden bg-white p-16 rounded-2xl shadow-sm border border-gray-100 text-center">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4">
                            <i data-lucide="loader-2" class="w-8 h-8 text-indigo-600 animate-spin"></i>
                        </div>
                        <p class="text-gray-600 font-medium">Gerando relatório...</p>
                        <p class="text-gray-400 text-sm mt-1">Aguarde enquanto processamos os dados</p>
                    </div>

                    <!-- Mensagem Inicial -->
                    <div id="report-initial" class="bg-white p-12 rounded-2xl shadow-sm border border-gray-100 text-center">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-indigo-100 to-indigo-200 rounded-2xl mb-4">
                            <i data-lucide="file-search" class="w-8 h-8 text-indigo-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Selecione os parâmetros</h3>
                        <p class="text-gray-500 max-w-md mx-auto text-sm">
                            Escolha o tipo de relatório, período e filtros desejados, depois clique em 
                            <span class="font-semibold text-indigo-600">"Gerar Relatório"</span>
                        </p>
                        <div class="mt-6 flex flex-wrap justify-center gap-2">
                            <span class="bg-gradient-to-br from-blue-50 to-blue-100 text-blue-700 px-3 py-1.5 rounded-lg text-xs font-medium border border-blue-200">📦 Produção</span>
                            <span class="bg-gradient-to-br from-red-50 to-red-100 text-red-700 px-3 py-1.5 rounded-lg text-xs font-medium border border-red-200">⏸️ Paradas</span>
                            <span class="bg-gradient-to-br from-orange-50 to-orange-100 text-orange-700 px-3 py-1.5 rounded-lg text-xs font-medium border border-orange-200">⚠️ Refugos</span>
                            <span class="bg-gradient-to-br from-purple-50 to-purple-100 text-purple-700 px-3 py-1.5 rounded-lg text-xs font-medium border border-purple-200">📊 Consolidado</span>
                        </div>
                    </div>

                    <!-- Tabela de Resultados -->
                    <div id="report-results" class="bg-white rounded-2xl shadow-sm border border-gray-100 hidden overflow-hidden">
                        <div class="p-4 border-b border-gray-100 flex items-center justify-between bg-gray-50">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-indigo-100 rounded-lg">
                                    <i data-lucide="table-2" class="w-4 h-4 text-indigo-600"></i>
                                </div>
                                <h3 class="font-semibold text-gray-800" id="report-results-title">Resultados</h3>
                            </div>
                            <span id="report-results-count" class="text-xs font-semibold text-gray-500 bg-white px-3 py-1.5 rounded-full border border-gray-200">0 registros</span>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead id="report-table-head" class="bg-gray-50 border-b border-gray-200">
                                    <!-- Cabeçalho dinmico -->
                                </thead>
                                <tbody id="report-table-body" class="divide-y divide-gray-100">
                                    <!-- Dados dinmicos -->
                                </tbody>
                            </table>
                        </div>
                        <div id="report-pagination" class="p-4 border-t border-gray-100 flex items-center justify-between bg-gray-50">
                            <span id="report-pagination-info" class="text-sm text-gray-500">Mostrando 0 de 0</span>
                            <div class="flex items-center gap-2">
                                <button id="report-prev-page" class="px-3 py-1.5 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition" disabled>
                                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                                </button>
                                <span id="report-page-info" class="text-sm font-medium text-gray-700 px-3">Página 1</span>
                                <button id="report-next-page" class="px-3 py-1.5 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition" disabled>
                                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Mensagem de Sem Dados -->
                    <div id="report-empty" class="hidden bg-white p-12 rounded-2xl shadow-sm border border-gray-100 text-center">
                        <div class="inline-flex items-center justify-center w-20 h-20 bg-gray-100 rounded-full mb-4">
                            <i data-lucide="inbox" class="w-10 h-10 text-gray-400"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Nenhum dado encontrado</h3>
                        <p class="text-gray-500 max-w-md mx-auto text-sm">
                            Não há registros para os filtros selecionados. Tente ajustar o período ou outros parâmetros.
                        </p>
                    </div>

                    <!-- Gráficos do Relatório -->
                    <div id="report-charts" class="grid grid-cols-1 lg:grid-cols-2 gap-4 hidden">
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="p-2 bg-indigo-100 rounded-lg">
                                    <i data-lucide="bar-chart-3" class="w-4 h-4 text-indigo-600"></i>
                                </div>
                                <h4 class="font-semibold text-gray-800">Distribuição por Turno</h4>
                            </div>
                            <div class="h-64">
                                <canvas id="report-chart-shift"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="p-2 bg-purple-100 rounded-lg">
                                    <i data-lucide="pie-chart" class="w-4 h-4 text-purple-600"></i>
                                </div>
                                <h4 class="font-semibold text-gray-800">Distribuição por Motivo</h4>
                            </div>
                            <div class="h-64">
                                <canvas id="report-chart-reason"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 lg:col-span-2 hover:shadow-md transition">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="p-2 bg-green-100 rounded-lg">
                                    <i data-lucide="trending-up" class="w-4 h-4 text-green-600"></i>
                                </div>
                                <h4 class="font-semibold text-gray-800">Evolução Diária</h4>
                            </div>
                            <div class="h-64">
                                <canvas id="report-chart-timeline"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: Paradas Longas -->
                <div id="paradas-longas-page" class="page-content hidden space-y-3 p-2">
                    <div class="bg-white p-5 md:p-6 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                            <div class="flex items-center gap-3">
                                <div class="p-2.5 bg-slate-100 rounded-xl">
                                    <i data-lucide="calendar-off" class="w-6 h-6 text-slate-600"></i>
                                </div>
                                <div>
                                    <h2 class="text-xl font-semibold text-gray-800">Registrar Paradas Longas</h2>
                                    <p class="text-sm text-gray-500">Registre Paradas de fim de semana, manutenção, feriados e outros períodos prolongados.</p>
                                </div>
                            </div>
                            <span class="text-xs font-semibold text-slate-600 bg-slate-100 px-3 py-1.5 rounded-full uppercase tracking-wide">
                                Gerenciar Paradas
                            </span>
                        </div>

                        <form id="extended-downtime-form" class="space-y-5">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="extended-downtime-machine" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquinas *</label>
                                    <select id="extended-downtime-machine" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" multiple size="6" required>
                                        <option value="">Selecione uma ou mais máquinas...</option>
                                    </select>
                                    <p class="mt-1.5 text-xs text-gray-500">Use Ctrl (ou Shift) para selecionar várias máquinas ao mesmo tempo.</p>
                                </div>
                                <div>
                                    <label for="extended-downtime-type" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Tipo de Parada *</label>
                                    <select id="extended-downtime-type" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition cursor-pointer" required>
                                        <option value="">Selecione...</option>
                                        <option value="weekend">Fim de Semana</option>
                                        <option value="scheduled-maintenance">Manutenção Programada</option>
                                        <option value="holiday">Feriado</option>
                                        <option value="shift-off">Turno Desligado</option>
                                        <option value="other">Outro</option>
                                    </select>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="extended-downtime-date-start" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Início *</label>
                                    <input type="date" id="extended-downtime-date-start" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                                </div>
                                <div>
                                    <label for="extended-downtime-date-end" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Fim *</label>
                                    <input type="date" id="extended-downtime-date-end" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="extended-downtime-time-start" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Hora Início</label>
                                    <input type="time" id="extended-downtime-time-start" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                </div>
                                <div>
                                    <label for="extended-downtime-time-end" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Hora Fim</label>
                                    <input type="time" id="extended-downtime-time-end" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                </div>
                            </div>

                            <div>
                                <label for="extended-downtime-reason" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo/Descrição *</label>
                                <select id="extended-downtime-reason" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition cursor-pointer" required>
                                    <option value="">Selecione um motivo...</option>
                                </select>
                            </div>

                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-4">
                                <p class="text-sm text-blue-700 flex items-center gap-2"><i data-lucide="clock" class="w-4 h-4"></i> <strong>Duração estimada:</strong> <span id="extended-downtime-duration">-</span></p>
                            </div>

                            <button type="submit" id="extended-downtime-submit" class="w-full bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-800 hover:to-slate-900 text-white font-semibold py-3 rounded-xl shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2">
                                <i data-lucide="save" class="w-4 h-4"></i>
                                <span>Registrar Parada Longa</span>
                            </button>
                            <div id="extended-downtime-status" class="text-sm font-semibold h-5 text-center"></div>
                        </form>
                    </div>

                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="p-2 bg-gray-100 rounded-lg">
                                <i data-lucide="list-checks" class="w-5 h-5 text-gray-600"></i>
                            </div>
                            <h3 class="font-semibold text-gray-800">Paradas Registradas</h3>
                        </div>
                        <div id="extended-downtime-list-loading" class="hidden text-center py-10">
                            <i data-lucide="loader-2" class="w-8 h-8 animate-spin text-gray-500 mx-auto mb-2"></i>
                            <p class="text-sm text-gray-500">Carregando Paradas...</p>
                        </div>
                        <div id="extended-downtime-list-empty" class="hidden text-center py-10">
                            <i data-lucide="inbox" class="w-10 h-10 text-gray-300 mx-auto mb-2"></i>
                            <p class="text-sm text-gray-500">Nenhuma parada longa registrada.</p>
                        </div>
                        <div id="extended-downtime-list" class="space-y-3"></div>
                    </div>
                </div>

                <!-- PÁGINA: Lançamento -->
                <div id="lancamento-page" class="page-content space-y-3 p-2">
                    
                    <!-- Header do Painel de Controle -->
                    <div class="bg-gradient-to-br from-slate-800 via-slate-900 to-slate-800 p-4 rounded-2xl shadow-xl text-white relative overflow-hidden">
                        <!-- Background decorativo -->
                        <div class="absolute inset-0 bg-grid-pattern opacity-5"></div>
                        <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl"></div>
                        
                        <div class="relative z-10">
                            <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                                        <i data-lucide="factory" class="w-6 h-6"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold tracking-tight">Painel de Controle de Produção</h2>
                                        <p class="text-slate-400 text-sm">Selecione uma máquina para iniciar</p>
                                    </div>
                                </div>
                                
                                <!-- Info do Turno -->
                                <div class="flex items-center gap-4 bg-white/5 backdrop-blur-sm rounded-lg px-4 py-2 border border-white/10">
                                    <div class="text-right">
                                        <p class="text-xs text-slate-400 uppercase tracking-wider">Turno Atual</p>
                                        <p id="current-shift-display" class="text-2xl font-bold text-blue-400">T1</p>
                                    </div>
                                    <div class="w-10 h-10 bg-blue-500/20 rounded-full flex items-center justify-center">
                                        <i data-lucide="clock" class="w-5 h-5 text-blue-400"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Grid de Máquinas -->
                            <div class="mt-4">
                                <select id="machine-selector" class="hidden"></select>
                                <div id="machine-card-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-5 xl:grid-cols-5 gap-2"></div>
                                <p id="machine-card-empty" class="hidden text-sm text-slate-400 text-center py-4">
                                    <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                    Nenhuma máquina planejada para hoje.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Painel Principal (hidden por padrão) -->
                    <div id="production-control-panel" class="hidden space-y-3">
                        
                        <!-- Card da Máquina Selecionada -->
                        <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                            <div class="flex flex-col sm:flex-row">
                                <!-- Info Principal -->
                                <div class="flex-1 p-4 flex items-center gap-4">
                                    <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg" id="machine-icon">
                                        H-01
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h3 class="text-lg font-bold text-gray-900 truncate" id="machine-name">Máquina H-01</h3>
                                        <p class="text-sm text-gray-600 truncate" id="product-name">Produto não selecionado</p>
                                        <p class="text-xs text-gray-400" id="product-mp">Matria-prima não definida</p>
                                    </div>
                                </div>
                                
                                <!-- Status e Tempo -->
                                <div class="flex items-center gap-4 px-4 py-3 bg-gray-50 sm:bg-transparent sm:border-l border-t sm:border-t-0 border-gray-100">
                                    <div class="flex items-center gap-2">
                                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-700">
                                            <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full mr-1.5 animate-pulse"></span>
                                            Em Produção
                                        </span>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-xs text-gray-400">Tempo Ativo</p>
                                        <p class="text-lg font-mono font-bold text-gray-900" id="production-time">00:00:00</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- KPIs em Cards Compactos -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-4 hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-xs font-medium text-blue-700">Produzido</p>
                                    <div class="p-1.5 bg-blue-200 rounded-lg">
                                        <i data-lucide="package" class="w-3.5 h-3.5 text-blue-600"></i>
                                    </div>
                                </div>
                                <p class="text-2xl font-bold text-blue-600" id="produced-today">0</p>
                                <p class="text-xs text-blue-600 opacity-70 mt-1">peças</p>
                            </div>
                            <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-2xl shadow-sm border border-emerald-200 p-4 hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-xs font-medium text-emerald-700">Eficiência</p>
                                    <div class="p-1.5 bg-emerald-200 rounded-lg">
                                        <i data-lucide="trending-up" class="w-3.5 h-3.5 text-emerald-600"></i>
                                    </div>
                                </div>
                                <p class="text-2xl font-bold text-emerald-600" id="efficiency-today">0%</p>
                                <p class="text-xs text-emerald-600 opacity-70 mt-1">OEE</p>
                            </div>
                            <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl shadow-sm border border-orange-200 p-4 hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-xs font-medium text-orange-700">Perdas (kg)</p>
                                    <div class="p-1.5 bg-orange-200 rounded-lg">
                                        <i data-lucide="alert-triangle" class="w-3.5 h-3.5 text-orange-600"></i>
                                    </div>
                                </div>
                                <p class="text-2xl font-bold text-orange-600" id="losses-today">0</p>
                                <p class="text-xs text-orange-600 opacity-70 mt-1">refugos</p>
                            </div>
                            <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-2xl shadow-sm border border-red-200 p-4 hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-xs font-medium text-red-700">Paradas (min)</p>
                                    <div class="p-1.5 bg-red-200 rounded-lg">
                                        <i data-lucide="pause-circle" class="w-3.5 h-3.5 text-red-600"></i>
                                    </div>
                                </div>
                                <p class="text-2xl font-bold text-red-600" id="downtime-today">0</p>
                                <p class="text-xs text-red-600 opacity-70 mt-1">tempo parado</p>
                            </div>
                        </div>

                        <!-- Ações Rápidas - Layout Horizontal -->
                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="p-2 bg-gray-100 rounded-lg">
                                    <i data-lucide="zap" class="w-4 h-4 text-gray-600"></i>
                                </div>
                                <h3 class="font-semibold text-gray-800">Ações Rápidas</h3>
                            </div>
                            
                            <!-- Botões Principais -->
                            <div class="grid grid-cols-3 gap-3 mb-3">
                                <button id="btn-production" class="group relative bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-4 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 active:scale-[0.98]">
                                    <div class="flex flex-col items-center gap-2">
                                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                            <i data-lucide="plus-circle" class="w-5 h-5"></i>
                                        </div>
                                        <span class="font-semibold text-sm">Produção</span>
                                    </div>
                                </button>

                                <button id="btn-losses" class="group relative bg-gradient-to-br from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white p-4 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 active:scale-[0.98]">
                                    <div class="flex flex-col items-center gap-2">
                                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                                        </div>
                                        <span class="font-semibold text-sm">Perdas</span>
                                    </div>
                                </button>

                                <button id="btn-downtime" class="group relative bg-gradient-to-br from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white p-4 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 active:scale-[0.98]">
                                    <div class="flex flex-col items-center gap-2 relative">
                                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                            <i data-lucide="pause" class="w-5 h-5" id="downtime-icon"></i>
                                        </div>
                                        <span class="font-semibold text-sm" id="downtime-text">Parada</span>
                                    </div>
                                    <div id="downtime-timer" class="absolute -top-1 -right-1 bg-white text-red-600 text-xs font-bold px-2 py-0.5 rounded-full shadow hidden">
                                        00:00
                                    </div>
                                    <p id="downtime-subtitle" class="hidden">Registrar início de parada</p>
                                </button>
                            </div>

                            <!-- Ações Secundárias -->
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                                <button id="btn-manual-borra" class="flex items-center justify-center gap-2 px-3 py-2.5 bg-yellow-50 hover:bg-yellow-100 text-yellow-700 rounded-lg border border-yellow-200 transition-colors text-sm font-medium">
                                    <i data-lucide="droplet" class="w-4 h-4"></i>
                                    <span>Borra</span>
                                </button>
                                <button id="btn-rework" class="flex items-center justify-center gap-2 px-3 py-2.5 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg border border-purple-200 transition-colors text-sm font-medium">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                    <span>Retrabalho</span>
                                </button>
                                <button id="btn-manual-downtime" class="flex items-center justify-center gap-2 px-3 py-2.5 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-lg border border-gray-200 transition-colors text-sm font-medium">
                                    <i data-lucide="clock" class="w-4 h-4"></i>
                                    <span>Parada Manual</span>
                                </button>
                                <div id="manual-entries-container" class="hidden contents">
                                    <button id="btn-manual-production" class="flex items-center justify-center gap-2 px-3 py-2.5 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg border border-blue-200 transition-colors text-sm font-medium col-span-2 sm:col-span-1">
                                        <i data-lucide="edit-3" class="w-4 h-4"></i>
                                        <span>Prod. Manual</span>
                                    </button>
                                    <button id="btn-manual-losses" class="flex items-center justify-center gap-2 px-3 py-2.5 bg-orange-50 hover:bg-orange-100 text-orange-700 rounded-lg border border-orange-200 transition-colors text-sm font-medium col-span-2 sm:col-span-1">
                                        <i data-lucide="edit-3" class="w-4 h-4"></i>
                                        <span>Perda Manual</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Gráfico de Produção -->
                        <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-4">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
                                <div>
                                    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wider">Produção por Hora</h3>
                                    <div class="flex items-center gap-4 mt-1 text-xs text-gray-500">
                                        <span class="flex items-center gap-1"><span class="w-2 h-2 bg-blue-500 rounded"></span> Planejado</span>
                                        <span class="flex items-center gap-1"><span class="w-2 h-2 bg-emerald-500 rounded"></span> Executado</span>
                                        <span class="flex items-center gap-1"><span class="w-2 h-2 bg-red-500 rounded"></span> Meta</span>
                                    </div>
                                </div>
                            </div>
                            <div class="relative h-64">
                                <canvas id="hourly-production-chart" class="w-full h-full"></canvas>
                            </div>
                            
                            <!-- Timeline de Progresso -->
                            <div class="mt-4 pt-4 border-t border-gray-100">
                                <div class="flex items-center justify-between text-xs text-gray-500 mb-2">
                                    <span>Progresso da Meta Diária</span>
                                    <span id="timeline-percentage" class="font-semibold text-gray-700">0%</span>
                                </div>
                                <div class="relative">
                                    <div class="w-full bg-gray-100 rounded-full h-2.5 overflow-hidden">
                                        <div id="timeline-progress" class="timeline-progress timeline-progress-bar h-full rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div>
                                    </div>
                                    <div id="timeline-target-indicator" class="absolute top-0 h-2.5 w-0.5 bg-slate-600 rounded transition-all duration-500" style="left: 0%"></div>
                                </div>
                                <div class="flex justify-between text-xs text-gray-400 mt-1">
                                    <span id="timeline-executed">0 peças</span>
                                    <span id="timeline-planned">0 peças</span>
                                </div>
                                
                                <!-- Status de Atualização -->
                                <div class="flex items-center justify-between text-xs mt-3 pt-3 border-t border-gray-50">
                                    <div class="flex items-center gap-2">
                                        <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse" id="timeline-status-indicator"></span>
                                        <span id="timeline-status-text" class="text-gray-500">Atualizado</span>
                                    </div>
                                    <span id="timeline-last-update" class="text-gray-400">--:--</span>
                                </div>

                                <!-- Botões de Finalizar/Ativar Ordem -->
                                <div class="mt-3 flex gap-2">
                                    <button id="finalize-order-btn" class="hidden flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2.5 px-4 rounded-lg shadow-sm flex items-center justify-center gap-2 text-sm transition-colors">
                                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                                        Finalizar Ordem
                                    </button>
                                    <button id="activate-order-btn" class="hidden flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 px-4 rounded-lg shadow-sm flex items-center justify-center gap-2 text-sm transition-colors">
                                        <i data-lucide="play-circle" class="w-4 h-4"></i>
                                        Ativar Ordem
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lançamentos Recentes -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-blue-100 rounded-lg">
                                    <i data-lucide="history" class="w-4 h-4 text-blue-600"></i>
                                </div>
                                <h3 class="font-semibold text-gray-800">Lançamentos Recentes</h3>
                            </div>
                            <div class="flex items-center gap-2 w-full sm:w-auto">
                                <!-- Filtros de tipo -->
                                <div class="flex gap-1 bg-gray-100 rounded-lg p-1 overflow-x-auto flex-1 sm:flex-initial">
                                    <button id="filter-all-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all active bg-white text-blue-600 shadow-sm" data-filter="all">Todos</button>
                                    <button id="filter-production-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all text-gray-600 hover:bg-gray-50" data-filter="production">Produção</button>
                                    <button id="filter-downtime-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all text-gray-600 hover:bg-gray-50" data-filter="downtime">Paradas</button>
                                    <button id="filter-loss-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all text-gray-600 hover:bg-gray-50" data-filter="loss">Perdas</button>
                                    <button id="filter-rework-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all text-gray-600 hover:bg-gray-50" data-filter="rework">Retrabalho</button>
                                    <button id="filter-borra-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all text-gray-600 hover:bg-gray-50" data-filter="borra">Borra</button>
                                </div>
                                <button id="refresh-recent-entries" class="flex items-center gap-1 px-2 py-1 text-xs font-medium text-blue-600 border border-blue-200 rounded-lg hover:bg-blue-50">
                                    <i data-lucide="refresh-cw" class="w-3 h-3"></i>
                                </button>
                            </div>
                        </div>
                        <div id="recent-entries-loading" class="hidden py-8 text-center">
                            <i data-lucide="loader-2" class="w-6 h-6 animate-spin text-blue-500 mx-auto mb-2"></i>
                            <p class="text-xs text-gray-500">Carregando...</p>
                        </div>
                        <div id="recent-entries-empty" class="hidden py-8 text-center">
                            <i data-lucide="inbox" class="w-8 h-8 text-gray-300 mx-auto mb-2"></i>
                            <p class="text-xs text-gray-500">Nenhum lançamento encontrado</p>
                        </div>
                        <div id="recent-entries-list" class="space-y-2 max-h-64 overflow-y-auto"></div>
                    </div>

                    <!-- Estados de Carregamento -->
                    <div id="launch-panel-loading" class="text-center py-16">
                        <div class="inline-flex items-center justify-center w-14 h-14 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl mb-4">
                            <i data-lucide="loader-2" class="w-6 h-6 animate-spin text-blue-500"></i>
                        </div>
                        <p class="text-gray-600 text-sm">Carregando dados de Produção...</p>
                    </div>
                    <div id="launch-panel-no-data" class="text-center py-16 hidden">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl mb-4 border border-gray-200">
                            <i data-lucide="inbox" class="w-8 h-8 text-gray-400"></i>
                        </div>
                        <p class="text-lg font-semibold text-gray-700 mb-1">Nenhum planejamento encontrado</p>
                        <p class="text-sm text-gray-500">Não há itens planejados para hoje.</p>
                    </div>
                </div>
                


                <!-- PÁGINA: Análise -->
                <div id="analise-page" class="page-content hidden">
                    <!-- Container Principal com Design Moderno -->
                    <div class="bg-gradient-to-br from-slate-50 to-gray-100 min-h-screen">
                        
                        <!-- Header da Análise -->
                        <div class="bg-white border-b border-gray-200 sticky top-0 z-20 shadow-sm">
                            <!-- Título e Controles Rápidos -->
                            <div class="px-4 md:px-6 py-4">
                                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                    <div class="flex items-center gap-3">
                                        <div class="p-2.5 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl shadow-lg">
                                            <i data-lucide="bar-chart-2" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <div>
                                            <h1 class="text-xl md:text-2xl font-bold text-gray-900">Central de Análises</h1>
                                            <p class="text-sm text-gray-500">Visualize mtricas e insights da sua Produção</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="hidden md:flex items-center gap-2 bg-gray-100 px-3 py-1.5 rounded-full">
                                            <span class="relative flex h-2.5 w-2.5">
                                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"></span>
                                            </span>
                                            <span class="text-sm text-gray-600 font-medium">Dados em tempo real</span>
                                        </div>
                                        <button id="toggle-analysis-filters" class="p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition md:hidden" title="Filtros">
                                            <i data-lucide="sliders-horizontal" class="w-5 h-5 text-gray-600"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Navegação por Abas - Design Moderno -->
                            <div class="px-4 md:px-6">
                                <nav class="flex gap-1 overflow-x-auto pb-0 scrollbar-hide -mb-px">
                                    <button class="analysis-tab-btn group flex items-center gap-2 py-3 px-4 text-sm font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-300 transition-all whitespace-nowrap active" data-view="overview">
                                        <div class="p-1.5 rounded-lg bg-gray-100 group-hover:bg-blue-100 group-[.active]:bg-blue-100 transition">
                                            <i data-lucide="layout-dashboard" class="w-4 h-4 group-[.active]:text-blue-600"></i>
                                        </div>
                                        <span>Visão Geral</span>
                                    </button>
                                    <button class="analysis-tab-btn group flex items-center gap-2 py-3 px-4 text-sm font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-300 transition-all whitespace-nowrap" data-view="production">
                                        <div class="p-1.5 rounded-lg bg-gray-100 group-hover:bg-green-100 group-[.active]:bg-green-100 transition">
                                            <i data-lucide="factory" class="w-4 h-4 group-[.active]:text-green-600"></i>
                                        </div>
                                        <span>Produção</span>
                                    </button>
                                    <button class="analysis-tab-btn group flex items-center gap-2 py-3 px-4 text-sm font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-300 transition-all whitespace-nowrap" data-view="efficiency">
                                        <div class="p-1.5 rounded-lg bg-gray-100 group-hover:bg-purple-100 group-[.active]:bg-purple-100 transition">
                                            <i data-lucide="gauge" class="w-4 h-4 group-[.active]:text-purple-600"></i>
                                        </div>
                                        <span>Eficiência</span>
                                    </button>
                                    <button class="analysis-tab-btn group flex items-center gap-2 py-3 px-4 text-sm font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-300 transition-all whitespace-nowrap" data-view="losses">
                                        <div class="p-1.5 rounded-lg bg-gray-100 group-hover:bg-red-100 group-[.active]:bg-red-100 transition">
                                            <i data-lucide="alert-triangle" class="w-4 h-4 group-[.active]:text-red-600"></i>
                                        </div>
                                        <span>Perdas</span>
                                    </button>
                                    <button class="analysis-tab-btn group flex items-center gap-2 py-3 px-4 text-sm font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-300 transition-all whitespace-nowrap" data-view="downtime">
                                        <div class="p-1.5 rounded-lg bg-gray-100 group-hover:bg-orange-100 group-[.active]:bg-orange-100 transition">
                                            <i data-lucide="timer-off" class="w-4 h-4 group-[.active]:text-orange-600"></i>
                                        </div>
                                        <span>Paradas</span>
                                    </button>
                                    <button class="analysis-tab-btn group flex items-center gap-2 py-3 px-4 text-sm font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-300 transition-all whitespace-nowrap" data-view="predictive">
                                        <div class="p-1.5 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 transition">
                                            <i data-lucide="brain" class="w-4 h-4 text-white"></i>
                                        </div>
                                        <span class="bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent font-semibold">Analytics IA</span>
                                    </button>
                                </nav>
                            </div>
                        </div>
                        
                        <!-- Filtros Globais - Redesenhados -->
                        <div class="bg-white border-b border-gray-200 shadow-sm">
                            <div class="px-4 md:px-6 py-4">
                                <div class="flex flex-wrap items-end gap-3">
                                    <!-- Período -->
                                    <div class="flex-1 min-w-[140px] max-w-[180px]">
                                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Período</label>
                                        <div class="relative">
                                            <select id="analysis-period" class="w-full appearance-none bg-gray-50 border border-gray-200 rounded-lg py-2.5 pl-3 pr-10 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition cursor-pointer">
                                                <option value="today">Hoje</option>
                                                <option value="yesterday">Ontem</option>
                                                <option value="7days">Últimos 7 dias</option>
                                                <option value="30days">Últimos 30 dias</option>
                                                <option value="month">Este mês</option>
                                                <option value="lastmonth">Mês passado</option>
                                                <option value="custom">Personalizado</option>
                                            </select>
                                            <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                        </div>
                                    </div>
                                    
                                    <!-- Máquina -->
                                    <div class="flex-1 min-w-[140px] max-w-[180px]">
                                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                                        <div class="relative">
                                            <select id="analysis-machine" class="w-full appearance-none bg-gray-50 border border-gray-200 rounded-lg py-2.5 pl-3 pr-10 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition cursor-pointer">
                                                <option value="all">Todas as máquinas</option>
                                            </select>
                                            <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                        </div>
                                    </div>
                                    
                                    <!-- Turno -->
                                    <div class="flex-1 min-w-[120px] max-w-[150px]">
                                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                                        <div class="relative">
                                            <select id="analysis-shift" class="w-full appearance-none bg-gray-50 border border-gray-200 rounded-lg py-2.5 pl-3 pr-10 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition cursor-pointer">
                                                <option value="all">Todos</option>
                                                <option value="1">1º Turno</option>
                                                <option value="2">2º Turno</option>
                                                <option value="3">3º Turno</option>
                                            </select>
                                            <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                        </div>
                                    </div>
                                    
                                    <!-- Botões de Ação -->
                                    <div class="flex items-center gap-2">
                                        <button id="apply-analysis-filters" class="inline-flex items-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md hover:shadow-lg transition-all text-sm">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                            <span class="hidden sm:inline">Aplicar</span>
                                        </button>
                                        <button id="test-charts-btn" class="p-2.5 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg transition" title="Debug gráficos">
                                            <i data-lucide="bug" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Datas Personalizadas -->
                                <div id="custom-date-range" class="mt-4 flex flex-wrap items-end gap-3 hidden">
                                    <div class="min-w-[160px]">
                                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Inicial</label>
                                        <input type="date" id="analysis-start-date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                    </div>
                                    <div class="min-w-[160px]">
                                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Final</label>
                                        <input type="date" id="analysis-end-date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Painel de Informações da Máquina/Produto Selecionado -->
                        <div id="analysis-info-panel" class="hidden mx-4 md:mx-6 mt-4">
                            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl p-4 shadow-lg">
                                <div class="flex items-center gap-4">
                                    <div class="p-3 bg-white/20 backdrop-blur-sm rounded-xl">
                                        <i data-lucide="cpu" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-blue-100 text-xs font-medium uppercase tracking-wider">Analisando</p>
                                        <p id="analysis-info-machine" class="text-xl font-bold text-white">-</p>
                                        <p id="analysis-info-machine-model" class="text-sm text-blue-200">-</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Área de Conteúdo das Views -->
                        <div class="p-4 md:p-6">
                            
                            <!-- ========== VISÇO GERAL ========== -->
                            <div id="overview-view" class="analysis-view">
                                <!-- KPIs Principais - Cards Modernos -->
                                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                    <!-- OEE Card -->
                                    <div class="relative overflow-hidden bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition-shadow">
                                        <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-green-100 to-green-50 rounded-full -mr-8 -mt-8"></div>
                                        <div class="relative">
                                            <div class="flex items-center gap-2 mb-3">
                                                <div class="p-2 bg-green-100 rounded-lg">
                                                    <i data-lucide="target" class="w-4 h-4 text-green-600"></i>
                                                </div>
                                                <span class="text-sm font-medium text-gray-500">OEE Geral</span>
                                            </div>
                                            <p id="overview-oee" class="text-3xl font-bold text-gray-900">---%</p>
                                            <div class="mt-2 flex items-center gap-1">
                                                <span class="text-xs text-gray-400">Meta: 85%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Produção Card -->
                                    <div class="relative overflow-hidden bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition-shadow">
                                        <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-blue-100 to-blue-50 rounded-full -mr-8 -mt-8"></div>
                                        <div class="relative">
                                            <div class="flex items-center gap-2 mb-3">
                                                <div class="p-2 bg-blue-100 rounded-lg">
                                                    <i data-lucide="package" class="w-4 h-4 text-blue-600"></i>
                                                </div>
                                                <span class="text-sm font-medium text-gray-500">Produção Total</span>
                                            </div>
                                            <p id="overview-production" class="text-3xl font-bold text-gray-900">---</p>
                                            <div class="mt-2 flex items-center gap-1">
                                                <span class="text-xs text-gray-400">peças</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Perdas Card -->
                                    <div class="relative overflow-hidden bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition-shadow">
                                        <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-amber-100 to-amber-50 rounded-full -mr-8 -mt-8"></div>
                                        <div class="relative">
                                            <div class="flex items-center gap-2 mb-3">
                                                <div class="p-2 bg-amber-100 rounded-lg">
                                                    <i data-lucide="alert-triangle" class="w-4 h-4 text-amber-600"></i>
                                                </div>
                                                <span class="text-sm font-medium text-gray-500">Total de Perdas</span>
                                            </div>
                                            <p id="overview-losses" class="text-3xl font-bold text-gray-900">---</p>
                                            <div class="mt-2 flex items-center gap-1">
                                                <span class="text-xs text-gray-400">peças</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Paradas Card -->
                                    <div class="relative overflow-hidden bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition-shadow">
                                        <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-red-100 to-red-50 rounded-full -mr-8 -mt-8"></div>
                                        <div class="relative">
                                            <div class="flex items-center gap-2 mb-3">
                                                <div class="p-2 bg-red-100 rounded-lg">
                                                    <i data-lucide="timer-off" class="w-4 h-4 text-red-600"></i>
                                                </div>
                                                <span class="text-sm font-medium text-gray-500">Tempo de Parada</span>
                                            </div>
                                            <p id="overview-downtime" class="text-3xl font-bold text-gray-900">---h</p>
                                            <div class="mt-2 flex items-center gap-1">
                                                <span class="text-xs text-gray-400">horas</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Grid de Gráficos -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <!-- Gráfico de Distribuição OEE -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
                                        <div class="flex items-center justify-between mb-4">
                                            <div class="flex items-center gap-3">
                                                <div class="p-2 bg-purple-100 rounded-lg">
                                                    <i data-lucide="pie-chart" class="w-4 h-4 text-purple-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-semibold text-gray-800">Distribuição OEE</h3>
                                                    <p class="text-xs text-gray-500">Por máquina</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 280px;">
                                            <canvas id="oee-distribution-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>

                                    <!-- Ranking de Performance -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
                                        <div class="flex items-center justify-between mb-4">
                                            <div class="flex items-center gap-3">
                                                <div class="p-2 bg-amber-100 rounded-lg">
                                                    <i data-lucide="trophy" class="w-4 h-4 text-amber-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-semibold text-gray-800">Ranking de Performance</h3>
                                                    <p class="text-xs text-gray-500">Top máquinas</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="machine-ranking" class="space-y-3 max-h-[280px] overflow-y-auto pr-2">
                                            <!-- Conteúdo dinmico -->
                                            <div class="text-center py-8 text-gray-400">
                                                <i data-lucide="loader-2" class="w-8 h-8 mx-auto animate-spin mb-2"></i>
                                                <p class="text-sm">Carregando dados...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ========== ANLISE DE PRODU¡ÇO ========== -->
                            <div id="production-view" class="analysis-view hidden">
                                <!-- Header com Ação -->
                                <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                                    <div>
                                        <h2 class="text-lg font-semibold text-gray-800">Análise de Produção</h2>
                                        <p class="text-sm text-gray-500">Acompanhe o desempenho produtivo em tempo real</p>
                                    </div>
                                </div>

                                <!-- KPIs Principais - Layout Aprimorado -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                    <!-- Total Produzido -->
                                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-3">
                                            <p class="text-sm font-medium text-blue-700">Total Produzido</p>
                                            <div class="p-2 bg-blue-200 rounded-lg">
                                                <i data-lucide="package" class="w-4 h-4 text-blue-600"></i>
                                            </div>
                                        </div>
                                        <p id="total-produced-kpi" class="text-3xl font-bold text-blue-600 mb-1">---</p>
                                        <p id="total-produced-subtext" class="text-xs text-blue-600 opacity-70">peças</p>
                                    </div>

                                    <!-- Meta vs Realizado -->
                                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl shadow-sm border border-green-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-3">
                                            <p class="text-sm font-medium text-green-700">Meta vs Realizado</p>
                                            <div class="p-2 bg-green-200 rounded-lg">
                                                <i data-lucide="target" class="w-4 h-4 text-green-600"></i>
                                            </div>
                                        </div>
                                        <p id="production-target-vs-actual" class="text-3xl font-bold text-green-600 mb-1">---%</p>
                                        <p id="target-vs-actual-subtext" class="text-xs text-green-600 opacity-70">eficiência da meta</p>
                                    </div>

                                    <!-- Taxa de Produção -->
                                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl shadow-sm border border-purple-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-3">
                                            <div>
                                                <p class="text-sm font-medium text-purple-700">Taxa de Produção</p>
                                            </div>
                                            <div class="p-2 bg-purple-200 rounded-lg">
                                                <i data-lucide="zap" class="w-4 h-4 text-purple-600"></i>
                                            </div>
                                        </div>
                                        <p id="production-rate-value" class="text-3xl font-bold text-purple-600 mb-1">--- pcs/h</p>
                                        <p id="production-rate-subtext" class="text-xs text-purple-600 opacity-70">velocidade média</p>
                                    </div>

                                    <!-- Máquina Top -->
                                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl shadow-sm border border-amber-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-3">
                                            <p class="text-sm font-medium text-amber-700">Top Performance</p>
                                            <div class="p-2 bg-amber-200 rounded-lg">
                                                <i data-lucide="crown" class="w-4 h-4 text-amber-600"></i>
                                            </div>
                                        </div>
                                        <p id="top-machine" class="text-3xl font-bold text-amber-600 mb-1">---</p>
                                        <p id="top-machine-subtext" class="text-xs text-amber-600 opacity-70">máquina</p>
                                    </div>
                                </div>

                                <!-- Gráficos Principais - Layout Duplo -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <!-- Produção por Hora -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-blue-100 rounded-lg">
                                                <i data-lucide="clock" class="w-4 h-4 text-blue-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Produção por Hora</h3>
                                                <p class="text-xs text-gray-500">Evolução ao longo do dia</p>
                                            </div>
                                        </div>
                                        <div class="chart-container" style="height: 280px;">
                                            <canvas id="analysis-hourly-production-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>

                                    <!-- Produção por Turno -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-indigo-100 rounded-lg">
                                                <i data-lucide="users" class="w-4 h-4 text-indigo-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Produção por Turno</h3>
                                                <p class="text-xs text-gray-500">Comparativo entre turnos</p>
                                            </div>
                                        </div>
                                        <div class="chart-container" style="height: 280px;">
                                            <canvas id="shift-production-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Histórico de Produção por Máquina - Full Width -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition mb-6">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="p-2 bg-teal-100 rounded-lg">
                                            <i data-lucide="activity" class="w-4 h-4 text-teal-600"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Histórico de Produção por Máquina</h3>
                                            <p class="text-xs text-gray-500">Srie temporal de desempenho</p>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 380px;">
                                        <canvas id="analysis-machine-production-timeline" class="w-full h-full"></canvas>
                                    </div>
                                </div>

                                <!-- Ranking e Insights - Grid Inferior -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <!-- Top 5 Máquinas -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-amber-100 rounded-lg">
                                                <i data-lucide="trophy" class="w-4 h-4 text-amber-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Top 5 Máquinas</h3>
                                                <p class="text-xs text-gray-500">Produção total hoje</p>
                                            </div>
                                        </div>
                                        <div id="machine-ranking-production" class="space-y-2 max-h-[300px] overflow-y-auto pr-2">
                                            <div class="text-center py-8 text-gray-400">
                                                <i data-lucide="loader-2" class="w-6 h-6 mx-auto animate-spin mb-2"></i>
                                                <p class="text-xs">Carregando...</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Principais Mtricas -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-violet-100 rounded-lg">
                                                <i data-lucide="bar-chart-3" class="w-4 h-4 text-violet-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Resumo do Dia</h3>
                                                <p class="text-xs text-gray-500">Indicadores principais</p>
                                            </div>
                                        </div>
                                        <div class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                                            <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200">
                                                <div class="flex items-center gap-2">
                                                    <i data-lucide="package" class="w-4 h-4 text-blue-600"></i>
                                                    <span class="text-sm text-gray-700">Produção Boa</span>
                                                </div>
                                                <span id="summary-good-production" class="font-semibold text-blue-600">---</span>
                                            </div>
                                            <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-200">
                                                <div class="flex items-center gap-2">
                                                    <i data-lucide="alert-triangle" class="w-4 h-4 text-red-600"></i>
                                                    <span class="text-sm text-gray-700">Refugos</span>
                                                </div>
                                                <span id="summary-losses" class="font-semibold text-red-600">---</span>
                                            </div>
                                            <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                                <div class="flex items-center gap-2">
                                                    <i data-lucide="droplet" class="w-4 h-4 text-yellow-600"></i>
                                                    <span class="text-sm text-gray-700">Borra (kg)</span>
                                                </div>
                                                <span id="summary-borra" class="font-semibold text-yellow-600">---</span>
                                            </div>
                                            <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200">
                                                <div class="flex items-center gap-2">
                                                    <i data-lucide="pause-circle" class="w-4 h-4 text-orange-600"></i>
                                                    <span class="text-sm text-gray-700">Parada (min)</span>
                                                </div>
                                                <span id="summary-downtime" class="font-semibold text-orange-600">---</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ========== ANLISE DE EFICIÚ NCIA ========== -->
                            <div id="efficiency-view" class="analysis-view hidden">
                                <!-- Header com Descrição -->
                                <div class="mb-6">
                                    <h2 class="text-lg font-semibold text-gray-800">Análise de Eficiência (OEE)</h2>
                                    <p class="text-sm text-gray-500">Acompanhe disponibilidade, performance e qualidade</p>
                                </div>

                                <!-- Componentes OEE - Gauges Modernos -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                    <!-- Disponibilidade -->
                                    <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-2xl shadow-sm border border-emerald-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-emerald-200 rounded-lg">
                                                <i data-lucide="clock" class="w-4 h-4 text-emerald-600"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-emerald-900">Disponibilidade</h4>
                                                <p class="text-xs text-emerald-700">Tempo máquina Ativa</p>
                                            </div>
                                        </div>
                                        <div class="relative mx-auto" style="max-width: 140px; height: 140px; margin: 10px auto;">
                                            <canvas id="availability-gauge" class="w-full h-full"></canvas>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span id="availability-value" class="text-xl font-bold text-emerald-600">---%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Performance -->
                                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-blue-200 rounded-lg">
                                                <i data-lucide="zap" class="w-4 h-4 text-blue-600"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-blue-900">Performance</h4>
                                                <p class="text-xs text-blue-700">Velocidade Produção</p>
                                            </div>
                                        </div>
                                        <div class="relative mx-auto" style="max-width: 140px; height: 140px; margin: 10px auto;">
                                            <canvas id="performance-gauge" class="w-full h-full"></canvas>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span id="performance-value" class="text-xl font-bold text-blue-600">---%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Qualidade -->
                                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl shadow-sm border border-amber-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-amber-200 rounded-lg">
                                                <i data-lucide="shield-check" class="w-4 h-4 text-amber-600"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-amber-900">Qualidade</h4>
                                                <p class="text-xs text-amber-700">Taxa de conformidade</p>
                                            </div>
                                        </div>
                                        <div class="relative mx-auto" style="max-width: 140px; height: 140px; margin: 10px auto;">
                                            <canvas id="quality-gauge" class="w-full h-full"></canvas>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span id="quality-value" class="text-xl font-bold text-amber-600">---%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- OEE Geral + Ranking -->
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                    <!-- OEE Geral (Grande) -->
                                    <div class="lg:col-span-1 bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl shadow-sm border border-purple-200 p-6 text-center">
                                        <p class="text-sm font-medium text-purple-700 mb-3">OEE Geral</p>
                                        <div class="relative mx-auto" style="max-width: 160px; height: 160px;">
                                            <canvas id="oee-main-gauge" class="w-full h-full"></canvas>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span id="oee-general-value" class="text-3xl font-bold text-purple-600">---%</span>
                                            </div>
                                        </div>
                                        <p class="text-xs text-purple-600 mt-4 font-semibold">Classificação: <span id="oee-classification">-</span></p>
                                    </div>

                                    <!-- Ranking de Máquinas -->
                                    <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-purple-100 rounded-lg">
                                                <i data-lucide="trophy" class="w-4 h-4 text-purple-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Top 5 Máquinas por OEE</h3>
                                                <p class="text-xs text-gray-500">Ranking de eficiência</p>
                                            </div>
                                        </div>
                                        <div id="machine-oee-ranking" class="space-y-2 max-h-[220px] overflow-y-auto pr-2">
                                            <div class="text-center py-4 text-gray-400 text-xs">
                                                <i data-lucide="loader-2" class="w-4 h-4 mx-auto animate-spin mb-1"></i>
                                                Carregando...
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Evolução OEE -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 mb-6 hover:shadow-md transition">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="p-2 bg-purple-100 rounded-lg">
                                            <i data-lucide="trending-up" class="w-4 h-4 text-purple-600"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Evolução dos Componentes OEE</h3>
                                            <p class="text-xs text-gray-500">Histórico ao longo do tempo</p>
                                        </div>
                                    </div>
                                    <div class="relative" style="height: 320px;">
                                        <canvas id="oee-components-timeline" class="w-full h-full"></canvas>
                                    </div>
                                </div>

                                <!-- Mapa de Calor OEE -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="p-2 bg-orange-100 rounded-lg">
                                            <i data-lucide="grid-3x3" class="w-4 h-4 text-orange-600"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Mapa de Calor - OEE</h3>
                                            <p class="text-xs text-gray-500">Desempenho por máquina e turno</p>
                                        </div>
                                    </div>
                                    <div id="oee-heatmap" class="overflow-x-auto">
                                        <!-- Será gerado dinamicamente -->
                                    </div>
                                </div>
                            </div>

                            <!-- ========== ANLISE DE PERDAS ========== -->
                            <div id="losses-view" class="analysis-view hidden">
                                <!-- Header com Ação -->
                                <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                                    <div>
                                        <h2 class="text-lg font-semibold text-gray-800">Análise de Perdas & Borras</h2>
                                        <p class="text-sm text-gray-500">Monitore refugos e perdas de matria-prima</p>
                                    </div>
                                    <button onclick="openModal('quick-losses-modal')" class="inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold rounded-xl shadow-md hover:shadow-lg transition-all">
                                        <i data-lucide="plus" class="w-5 h-5"></i>
                                        Registrar Perda
                                    </button>
                                </div>

                                <!-- KPIs Principais - Grid Superior -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                    <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-2xl shadow-sm border border-red-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-red-700">Total Refugos</p>
                                            <div class="p-1.5 bg-red-200 rounded">
                                                <i data-lucide="alert-triangle" class="w-3 h-3 text-red-600"></i>
                                            </div>
                                        </div>
                                        <p id="total-losses" class="text-2xl font-bold text-red-600">---</p>
                                        <p class="text-xs text-red-600 opacity-70 mt-1">peças</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl shadow-sm border border-orange-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-orange-700">% Refugo/Produção</p>
                                            <div class="p-1.5 bg-orange-200 rounded">
                                                <i data-lucide="percent" class="w-3 h-3 text-orange-600"></i>
                                            </div>
                                        </div>
                                        <p id="losses-percentage" class="text-2xl font-bold text-orange-600">---%</p>
                                        <p class="text-xs text-orange-600 opacity-70 mt-1">da Produção</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-2xl shadow-sm border border-yellow-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-yellow-700">Total Borra</p>
                                            <div class="p-1.5 bg-yellow-200 rounded">
                                                <i data-lucide="droplet" class="w-3 h-3 text-yellow-600"></i>
                                            </div>
                                        </div>
                                        <p id="total-borra" class="text-2xl font-bold text-yellow-600">---</p>
                                        <p class="text-xs text-yellow-600 opacity-70 mt-1">kg</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl shadow-sm border border-purple-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-purple-700">Top Motivo</p>
                                            <div class="p-1.5 bg-purple-200 rounded">
                                                <i data-lucide="target" class="w-3 h-3 text-purple-600"></i>
                                            </div>
                                        </div>
                                        <p id="main-loss-reason" class="text-sm font-bold text-purple-600 truncate">---</p>
                                        <p id="main-loss-material" class="text-xs text-purple-600 opacity-70 mt-1 truncate">MP: ---</p>
                                    </div>
                                </div>

                                <!-- Gráficos Principais - Layout Duplo -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-red-100 rounded-lg">
                                                <i data-lucide="bar-chart-3" class="w-4 h-4 text-red-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Pareto de Refugos por Motivo</h3>
                                                <p class="text-xs text-gray-500">80/20 analysis</p>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 300px;">
                                            <canvas id="losses-pareto-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-orange-100 rounded-lg">
                                                <i data-lucide="cpu" class="w-4 h-4 text-orange-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Refugos por Máquina</h3>
                                                <p class="text-xs text-gray-500">Comparativo máquinas</p>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 300px;">
                                            <canvas id="losses-by-machine-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Gráficos Secundários - Materiais e Borra -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-purple-100 rounded-lg">
                                                <i data-lucide="layers" class="w-4 h-4 text-purple-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Refugos por Tipo de MP</h3>
                                                <p class="text-xs text-gray-500">Análise de materiais</p>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 280px;">
                                            <canvas id="losses-by-material-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-amber-100 rounded-lg">
                                                <i data-lucide="flame" class="w-4 h-4 text-amber-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Borra por Matria-Prima</h3>
                                                <p class="text-xs text-gray-500">Distribuição de borras</p>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 280px;">
                                            <canvas id="borra-by-mp-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tendência de Perdas -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 mb-6 hover:shadow-md transition">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="p-2 bg-teal-100 rounded-lg">
                                            <i data-lucide="trending-up" class="w-4 h-4 text-teal-600"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Tendência de Refugos e Borras</h3>
                                            <p class="text-xs text-gray-500">Evolução temporal</p>
                                        </div>
                                    </div>
                                    <div class="relative" style="height: 320px;">
                                        <canvas id="losses-trend-chart" class="w-full h-full"></canvas>
                                    </div>
                                </div>

                                <!-- Seção Detalhada de Borras -->
                                <div class="bg-gradient-to-br from-amber-50 to-yellow-50 rounded-2xl border border-amber-200 p-5 hover:shadow-md transition">
                                    <div class="flex items-center gap-3 mb-5">
                                        <div class="p-2 bg-amber-200 rounded-lg">
                                            <i data-lucide="zap" class="w-5 h-5 text-amber-700"></i>
                                        </div>
                                        <h3 class="font-semibold text-amber-900 text-base">Análise Detalhada de Borras</h3>
                                    </div>
                                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                                        <!-- Borra por Motivo -->
                                        <div class="bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-amber-100 hover:border-amber-300 transition">
                                            <h4 class="text-xs font-semibold text-amber-700 mb-3 flex items-center gap-2">
                                                <i data-lucide="bar-chart-2" class="w-3 h-3"></i>
                                                Borra por Motivo
                                            </h4>
                                            <div class="relative" style="height: 220px;">
                                                <canvas id="borra-by-reason-chart" class="w-full h-full"></canvas>
                                            </div>
                                        </div>
                                        <!-- Borra por Máquina -->
                                        <div class="bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-amber-100 hover:border-amber-300 transition">
                                            <h4 class="text-xs font-semibold text-amber-700 mb-3 flex items-center gap-2">
                                                <i data-lucide="cpu" class="w-3 h-3"></i>
                                                Borra por Máquina
                                            </h4>
                                            <div class="relative" style="height: 220px;">
                                                <canvas id="borra-by-machine-chart" class="w-full h-full"></canvas>
                                            </div>
                                        </div>
                                        <!-- KPIs de Borra -->
                                        <div class="bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-amber-100 space-y-3">
                                            <div class="p-2 bg-amber-100 rounded text-center">
                                                <p class="text-xs text-amber-700 font-medium">Maior Gerador</p>
                                                <p id="top-borra-machine" class="text-sm font-bold text-amber-900 truncate">---</p>
                                            </div>
                                            <div class="p-2 bg-amber-100 rounded text-center">
                                                <p class="text-xs text-amber-700 font-medium">Principal Motivo</p>
                                                <p id="top-borra-reason" class="text-sm font-bold text-amber-900 truncate">---</p>
                                            </div>
                                            <div class="p-2 bg-amber-100 rounded text-center">
                                                <p class="text-xs text-amber-700 font-medium">MP com Mais Borra</p>
                                                <p id="top-borra-mp" class="text-sm font-bold text-amber-900 truncate">---</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ========== ANLISE DE Paradas ========== -->
                            <div id="downtime-view" class="analysis-view hidden">
                                <!-- Header com Descrição -->
                                <div class="mb-6">
                                    <h2 class="text-lg font-semibold text-gray-800">Análise de Paradas</h2>
                                    <p class="text-sm text-gray-500">Acompanhe interrupções de Produção e impacto no OEE</p>
                                </div>

                                <!-- KPIs Principais - Grid Superior -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                    <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-2xl shadow-sm border border-red-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-red-700">Tempo Total Parado</p>
                                            <div class="p-1.5 bg-red-200 rounded">
                                                <i data-lucide="pause-circle" class="w-3 h-3 text-red-600"></i>
                                            </div>
                                        </div>
                                        <p id="total-downtime" class="text-2xl font-bold text-red-600">---</p>
                                        <p class="text-xs text-red-600 opacity-70 mt-1">horas</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl shadow-sm border border-orange-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-orange-700">Nº de Paradas</p>
                                            <div class="p-1.5 bg-orange-200 rounded">
                                                <i data-lucide="list" class="w-3 h-3 text-orange-600"></i>
                                            </div>
                                        </div>
                                        <p id="downtime-count" class="text-2xl font-bold text-orange-600">---</p>
                                        <p class="text-xs text-orange-600 opacity-70 mt-1">ocorrências</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl shadow-sm border border-amber-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-amber-700">Tempo Mdio</p>
                                            <div class="p-1.5 bg-amber-200 rounded">
                                                <i data-lucide="clock" class="w-3 h-3 text-amber-600"></i>
                                            </div>
                                        </div>
                                        <p id="avg-downtime" class="text-2xl font-bold text-amber-600">---</p>
                                        <p class="text-xs text-amber-600 opacity-70 mt-1">minutos/parada</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-blue-700">MTBF</p>
                                            <div class="p-1.5 bg-blue-200 rounded">
                                                <i data-lucide="activity" class="w-3 h-3 text-blue-600"></i>
                                            </div>
                                        </div>
                                        <p id="mtbf-value" class="text-2xl font-bold text-blue-600">---</p>
                                        <p class="text-xs text-blue-600 opacity-70 mt-1">horas</p>
                                    </div>
                                </div>

                                <!-- Gráficos Principais - Layout Duplo -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-red-100 rounded-lg">
                                                <i data-lucide="alert-circle" class="w-4 h-4 text-red-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Paradas por Motivo</h3>
                                                <p class="text-xs text-gray-500">Análise de causas raiz</p>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 300px;">
                                            <canvas id="downtime-reasons-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-orange-100 rounded-lg">
                                                <i data-lucide="cpu" class="w-4 h-4 text-orange-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Paradas por Máquina</h3>
                                                <p class="text-xs text-gray-500">Equipamentos mais afetados</p>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 300px;">
                                            <canvas id="downtime-by-machine-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Timeline de Paradas -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 mb-6 hover:shadow-md transition">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="p-2 bg-purple-100 rounded-lg">
                                            <i data-lucide="calendar" class="w-4 h-4 text-purple-600"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Timeline de Paradas</h3>
                                            <p class="text-xs text-gray-500">Evolução temporal das ocorrências</p>
                                        </div>
                                    </div>
                                    <div class="relative" style="height: 340px;">
                                        <canvas id="downtime-timeline-chart" class="w-full h-full"></canvas>
                                    </div>
                                </div>

                                <!-- Paradas Longas Programadas -->
                                <div class="bg-gradient-to-br from-slate-50 to-gray-100 rounded-2xl border border-gray-300 p-6 hover:shadow-md transition">
                                    <div class="flex items-center justify-between mb-5">
                                        <div class="flex items-center gap-3">
                                            <div class="p-2.5 bg-slate-200 rounded-lg">
                                                <i data-lucide="calendar-off" class="w-5 h-5 text-slate-700"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Paradas Longas Programadas</h3>
                                                <p class="text-xs text-gray-500">Manutenção planejada e períodos</p>
                                            </div>
                                        </div>
                                        <span id="extended-downtime-total" class="text-xs font-semibold text-gray-700 bg-white px-3 py-1.5 rounded-full shadow-sm">0 registros</span>
                                    </div>
                                    
                                    <!-- Cards de Categorias -->
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-5">
                                        <div class="bg-white rounded-xl p-4 text-center shadow-sm border border-gray-100 hover:border-gray-300 transition">
                                            <p class="text-xs text-gray-600 font-medium mb-2">Fim de Semana</p>
                                            <p id="extended-weekend-hours" class="text-2xl font-bold text-gray-800">0h</p>
                                            <p class="text-xs text-gray-500 mt-1">parada</p>
                                        </div>
                                        <div class="bg-blue-50 rounded-xl p-4 text-center shadow-sm border border-blue-100 hover:border-blue-300 transition">
                                            <p class="text-xs text-blue-700 font-medium mb-2">Manutenção Preventiva</p>
                                            <p id="extended-maintenance-hours" class="text-2xl font-bold text-blue-700">0h</p>
                                            <p class="text-xs text-blue-600 mt-1">planejada</p>
                                        </div>
                                        <div class="bg-amber-50 rounded-xl p-4 text-center shadow-sm border border-amber-100 hover:border-amber-300 transition">
                                            <p class="text-xs text-amber-700 font-medium mb-2">Feriados</p>
                                            <p id="extended-holiday-hours" class="text-2xl font-bold text-amber-700">0h</p>
                                            <p class="text-xs text-amber-600 mt-1">inatividade</p>
                                        </div>
                                        <div class="bg-red-50 rounded-xl p-4 text-center shadow-sm border border-red-100 hover:border-red-300 transition">
                                            <p class="text-xs text-red-700 font-medium mb-2">Outros</p>
                                            <p id="extended-other-hours" class="text-2xl font-bold text-red-700">0h</p>
                                            <p class="text-xs text-red-600 mt-1">não categorizadas</p>
                                        </div>
                                    </div>

                                    <!-- Lista de Paradas Longas -->
                                    <div id="extended-downtime-analysis-list" class="space-y-2 max-h-72 overflow-y-auto pr-2">
                                        <div class="text-center py-8 text-gray-500 text-sm">
                                            <i data-lucide="inbox" class="w-6 h-6 mx-auto mb-2 text-gray-400"></i>
                                            <p>Nenhuma parada longa registrada no período selecionado.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ========== ANALYTICS IA ========== -->
                            <div id="predictive-view" class="analysis-view hidden">
                                <div class="space-y-6">
                                    
                                    <!-- Header Moderno com Glassmorphism -->
                                    <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6 shadow-2xl">
                                        <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"none\" fill-rule=\"evenodd\"%3E%3Cg fill=\"%239C92AC\" fill-opacity=\"0.08\"%3E%3Cpath d=\"M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')]"></div>
                                        <div class="relative flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                            <div class="flex items-center gap-4">
                                                <div class="p-3 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl shadow-lg">
                                                    <i data-lucide="brain" class="w-8 h-8 text-white"></i>
                                                </div>
                                                <div>
                                                    <h2 class="text-2xl font-bold text-white tracking-tight">Analytics IA</h2>
                                                    <p class="text-purple-200 text-sm">Inteligência Artificial para Manufatura Avançada</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-4">
                                                <div class="flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full">
                                                    <span class="relative flex h-3 w-3">
                                                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                                        <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                                                    </span>
                                                    <span class="text-white text-sm font-medium">Sistema Online</span>
                                                </div>
                                                <div class="text-right hidden md:block">
                                                    <p class="text-purple-200 text-xs">Última atualização</p>
                                                    <p id="last-prediction-time" class="text-white font-mono text-sm">--:--</p>
                                                </div>
                                                <button onclick="window.analyticsIA?.refreshData()" class="p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all" title="Atualizar dados">
                                                    <i data-lucide="refresh-cw" class="w-5 h-5 text-white"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Navegação por Tabs Moderna -->
                                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-1.5">
                                        <div class="flex flex-wrap gap-1">
                                            <button onclick="showPredictiveSubtab('dashboard')" 
                                                    class="predictive-subtab-btn flex-1 min-w-[120px] bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2.5 rounded-lg text-sm font-medium transition-all shadow-sm">
                                                <i data-lucide="layout-dashboard" class="w-4 h-4 mr-2 inline"></i>
                                                Dashboard
                                            </button>
                                            <button onclick="showPredictiveSubtab('analytics')" 
                                                    class="predictive-subtab-btn flex-1 min-w-[120px] bg-gray-50 text-gray-600 px-4 py-2.5 rounded-lg text-sm font-medium transition-all hover:bg-gray-100">
                                                <i data-lucide="sparkles" class="w-4 h-4 mr-2 inline"></i>
                                                Preditivo
                                            </button>
                                            <button onclick="showPredictiveSubtab('kpis')" 
                                                    class="predictive-subtab-btn flex-1 min-w-[120px] bg-gray-50 text-gray-600 px-4 py-2.5 rounded-lg text-sm font-medium transition-all hover:bg-gray-100">
                                                <i data-lucide="gauge" class="w-4 h-4 mr-2 inline"></i>
                                                KPIs
                                            </button>
                                            <button onclick="showPredictiveSubtab('oee')" 
                                                    class="predictive-subtab-btn flex-1 min-w-[120px] bg-gray-50 text-gray-600 px-4 py-2.5 rounded-lg text-sm font-medium transition-all hover:bg-gray-100">
                                                <i data-lucide="target" class="w-4 h-4 mr-2 inline"></i>
                                                OEE
                                            </button>
                                            <button onclick="showPredictiveSubtab('pareto')" 
                                                    class="predictive-subtab-btn flex-1 min-w-[120px] bg-gray-50 text-gray-600 px-4 py-2.5 rounded-lg text-sm font-medium transition-all hover:bg-gray-100">
                                                <i data-lucide="bar-chart-3" class="w-4 h-4 mr-2 inline"></i>
                                                Pareto
                                            </button>
                                            <button onclick="showPredictiveSubtab('spc')" 
                                                    class="predictive-subtab-btn flex-1 min-w-[120px] bg-gray-50 text-gray-600 px-4 py-2.5 rounded-lg text-sm font-medium transition-all hover:bg-gray-100">
                                                <i data-lucide="activity" class="w-4 h-4 mr-2 inline"></i>
                                                SPC
                                            </button>
                                            <button onclick="showPredictiveSubtab('ranking')" 
                                                    class="predictive-subtab-btn flex-1 min-w-[120px] bg-gray-50 text-gray-600 px-4 py-2.5 rounded-lg text-sm font-medium transition-all hover:bg-gray-100">
                                                <i data-lucide="trophy" class="w-4 h-4 mr-2 inline"></i>
                                                Ranking
                                            </button>
                                        </div>
                                </div>

                                <!-- ===== SUBTAB: DASHBOARD EXECUTIVO ===== -->
                                <div id="predictive-dashboard-content" class="predictive-subtab-content">
                                    
                                    <!-- Mtricas Principais em Cards Modernos -->
                                    <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                                        <!-- OEE Card -->
                                        <div class="relative overflow-hidden bg-gradient-to-br from-purple-500 to-purple-700 p-5 rounded-2xl shadow-lg">
                                            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white/10 rounded-full"></div>
                                            <div class="relative">
                                                <div class="flex items-center gap-2 mb-3">
                                                    <i data-lucide="gauge" class="w-5 h-5 text-purple-200"></i>
                                                    <span class="text-purple-100 text-sm font-medium">OEE</span>
                                                </div>
                                                <div id="analytics-oee-value" class="text-4xl font-bold text-white mb-1">--</div>
                                                <div class="flex items-center gap-2">
                                                    <span id="analytics-oee-trend" class="text-purple-200 text-xs"></span>
                                                    <span id="analytics-oee-status" class="text-purple-200 text-xs">Carregando...</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Disponibilidade -->
                                        <div class="relative overflow-hidden bg-gradient-to-br from-blue-500 to-blue-700 p-5 rounded-2xl shadow-lg">
                                            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white/10 rounded-full"></div>
                                            <div class="relative">
                                                <div class="flex items-center gap-2 mb-3">
                                                    <i data-lucide="clock" class="w-5 h-5 text-blue-200"></i>
                                                    <span class="text-blue-100 text-sm font-medium">Disponibilidade</span>
                                                </div>
                                                <div id="analytics-availability-value" class="text-4xl font-bold text-white mb-1">--</div>
                                                <div class="flex items-center gap-2">
                                                    <span id="analytics-availability-trend" class="text-blue-200 text-xs"></span>
                                                    <span id="analytics-availability-status" class="text-blue-200 text-xs">Carregando...</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Performance -->
                                        <div class="relative overflow-hidden bg-gradient-to-br from-emerald-500 to-emerald-700 p-5 rounded-2xl shadow-lg">
                                            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white/10 rounded-full"></div>
                                            <div class="relative">
                                                <div class="flex items-center gap-2 mb-3">
                                                    <i data-lucide="zap" class="w-5 h-5 text-emerald-200"></i>
                                                    <span class="text-emerald-100 text-sm font-medium">Performance</span>
                                                </div>
                                                <div id="analytics-performance-value" class="text-4xl font-bold text-white mb-1">--</div>
                                                <div class="flex items-center gap-2">
                                                    <span id="analytics-performance-trend" class="text-emerald-200 text-xs"></span>
                                                    <span id="analytics-performance-status" class="text-emerald-200 text-xs">Carregando...</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Qualidade -->
                                        <div class="relative overflow-hidden bg-gradient-to-br from-teal-500 to-teal-700 p-5 rounded-2xl shadow-lg">
                                            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white/10 rounded-full"></div>
                                            <div class="relative">
                                                <div class="flex items-center gap-2 mb-3">
                                                    <i data-lucide="shield-check" class="w-5 h-5 text-teal-200"></i>
                                                    <span class="text-teal-100 text-sm font-medium">Qualidade</span>
                                                </div>
                                                <div id="analytics-quality-value" class="text-4xl font-bold text-white mb-1">--</div>
                                                <div class="flex items-center gap-2">
                                                    <span id="analytics-quality-trend" class="text-teal-200 text-xs"></span>
                                                    <span id="analytics-quality-status" class="text-teal-200 text-xs">Carregando...</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Factory Score -->
                                        <div class="relative overflow-hidden bg-gradient-to-br from-slate-700 to-slate-900 p-5 rounded-2xl shadow-lg">
                                            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white/10 rounded-full"></div>
                                            <div class="relative">
                                                <div class="flex items-center gap-2 mb-3">
                                                    <i data-lucide="factory" class="w-5 h-5 text-slate-300"></i>
                                                    <span class="text-slate-300 text-sm font-medium">Score Fábrica</span>
                                                </div>
                                                <div id="factory-health-score" class="text-4xl font-bold text-white mb-1">--</div>
                                                <div class="text-slate-400 text-xs">Health Index</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Gráficos e Alertas -->
                                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                        <!-- Gráfico de Tendência OEE -->
                                        <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                                            <div class="flex items-center justify-between mb-4">
                                                <div>
                                                    <h4 class="font-semibold text-gray-800">Tendência OEE</h4>
                                                    <p class="text-xs text-gray-500">Últimos 30 dias</p>
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-purple-50 text-purple-600 text-xs rounded-full">
                                                        <span class="w-2 h-2 bg-purple-500 rounded-full"></span> OEE
                                                    </span>
                                                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-green-50 text-green-600 text-xs rounded-full">
                                                        <span class="w-2 h-2 bg-green-500 rounded-full"></span> Meta
                                                    </span>
                                                </div>
                                            </div>
                                            <div style="position: relative; height: 280px; width: 100%;">
                                                <canvas id="analytics-oee-trend-chart"></canvas>
                                            </div>
                                        </div>
                                        
                                        <!-- Alertas Inteligentes -->
                                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                                            <div class="flex items-center justify-between mb-4">
                                                <div class="flex items-center gap-2">
                                                    <div class="p-2 bg-amber-100 rounded-lg">
                                                        <i data-lucide="bell" class="w-4 h-4 text-amber-600"></i>
                                                    </div>
                                                    <h4 class="font-semibold text-gray-800">Alertas IA</h4>
                                                </div>
                                                <span class="text-xs text-gray-400">Tempo real</span>
                                            </div>
                                            <div id="analytics-smart-alerts" class="space-y-3 max-h-64 overflow-y-auto">
                                                <div class="flex items-center justify-center py-8">
                                                    <div class="text-center">
                                                        <i data-lucide="loader-2" class="w-8 h-8 mx-auto animate-spin text-purple-500 mb-2"></i>
                                                        <p class="text-sm text-gray-500">Analisando dados...</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Resumo Operacional -->
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div class="bg-white rounded-xl p-4 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                            <div class="flex items-center gap-3">
                                                <div class="p-2.5 bg-blue-100 rounded-xl">
                                                    <i data-lucide="package" class="w-5 h-5 text-blue-600"></i>
                                                </div>
                                                <div>
                                                    <p class="text-xs text-gray-500 font-medium">Produção</p>
                                                    <p id="analytics-production-value" class="text-xl font-bold text-gray-800">--</p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white rounded-xl p-4 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                            <div class="flex items-center gap-3">
                                                <div class="p-2.5 bg-red-100 rounded-xl">
                                                    <i data-lucide="timer-off" class="w-5 h-5 text-red-600"></i>
                                                </div>
                                                <div>
                                                    <p class="text-xs text-gray-500 font-medium">Paradas</p>
                                                    <p id="analytics-downtime-value" class="text-xl font-bold text-gray-800">--</p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white rounded-xl p-4 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                            <div class="flex items-center gap-3">
                                                <div class="p-2.5 bg-amber-100 rounded-xl">
                                                    <i data-lucide="alert-triangle" class="w-5 h-5 text-amber-600"></i>
                                                </div>
                                                <div>
                                                    <p class="text-xs text-gray-500 font-medium">Perdas</p>
                                                    <p id="analytics-losses-value" class="text-xl font-bold text-gray-800">--</p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white rounded-xl p-4 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                            <div class="flex items-center gap-3">
                                                <div class="p-2.5 bg-green-100 rounded-xl">
                                                    <i data-lucide="cpu" class="w-5 h-5 text-green-600"></i>
                                                </div>
                                                <div>
                                                    <p class="text-xs text-gray-500 font-medium">Máquinas</p>
                                                    <p id="analytics-machines-value" class="text-xl font-bold text-gray-800">--</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ===== SUBTAB: ANLISES PREDITIVAS ===== -->
                                <div id="predictive-analytics-content" class="predictive-subtab-content hidden">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                        <!-- Previsões -->
                                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                                            <div class="flex items-center gap-3 mb-4">
                                                <div class="p-2 bg-indigo-100 rounded-lg">
                                                    <i data-lucide="trending-up" class="w-5 h-5 text-indigo-600"></i>
                                                </div>
                                                <div>
                                                    <h4 class="font-semibold text-gray-800">Previsões Próximas 8h</h4>
                                                    <p class="text-xs text-gray-500">Baseado em Machine Learning</p>
                                                </div>
                                            </div>
                                            <div style="position: relative; height: 280px; width: 100%;">
                                                <canvas id="predictions-chart"></canvas>
                                            </div>
                                        </div>
                                        
                                        <!-- Alertas Proativos -->
                                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                                            <div class="flex items-center gap-3 mb-4">
                                                <div class="p-2 bg-amber-100 rounded-lg">
                                                    <i data-lucide="shield-alert" class="w-5 h-5 text-amber-600"></i>
                                                </div>
                                                <div>
                                                    <h4 class="font-semibold text-gray-800">Alertas Proativos</h4>
                                                    <p class="text-xs text-gray-500">Prevenção de problemas</p>
                                                </div>
                                            </div>
                                            <div id="proactive-alerts" class="space-y-3 max-h-64 overflow-y-auto">
                                                <div class="p-3 bg-gray-50 rounded-lg text-center text-gray-500 text-sm">
                                                    Carregando alertas...
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- KPIs Preditivos -->
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                                            <div class="flex items-center justify-between mb-4">
                                                <h4 class="font-medium text-gray-600">Prob. Parada</h4>
                                                <i data-lucide="alert-octagon" class="w-5 h-5 text-red-500"></i>
                                            </div>
                                            <div id="breakdown-probability" class="text-4xl font-bold text-red-600 mb-2">--</div>
                                            <p class="text-sm text-gray-500">Próximas 4 horas</p>
                                            <div class="mt-3 bg-red-100 rounded-full h-2">
                                                <div id="breakdown-probability-bar" class="bg-red-500 h-2 rounded-full transition-all" style="width: 0%"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                                            <div class="flex items-center justify-between mb-4">
                                                <h4 class="font-medium text-gray-600">Tendência Qualidade</h4>
                                                <i data-lucide="target" class="w-5 h-5 text-green-500"></i>
                                            </div>
                                            <div id="quality-trend" class="text-4xl font-bold text-green-600 mb-2">--</div>
                                            <p class="text-sm text-gray-500">Previsão turno atual</p>
                                            <div class="mt-3 bg-green-100 rounded-full h-2">
                                                <div id="quality-trend-bar" class="bg-green-500 h-2 rounded-full transition-all" style="width: 0%"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                                            <div class="flex items-center justify-between mb-4">
                                                <h4 class="font-medium text-gray-600">OEE Previsto</h4>
                                                <i data-lucide="gauge" class="w-5 h-5 text-blue-500"></i>
                                            </div>
                                            <div id="predicted-oee" class="text-4xl font-bold text-blue-600 mb-2">--</div>
                                            <p class="text-sm text-gray-500">Fim do turno</p>
                                            <div class="mt-3 bg-blue-100 rounded-full h-2">
                                                <div id="predicted-oee-bar" class="bg-blue-500 h-2 rounded-full transition-all" style="width: 0%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Gráfico de Tendências e Recomendações -->
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                                            <div class="flex items-center gap-3 mb-4">
                                                <div class="p-2 bg-purple-100 rounded-lg">
                                                    <i data-lucide="activity" class="w-5 h-5 text-purple-600"></i>
                                                </div>
                                                <h4 class="font-semibold text-gray-800">Análise de Tendências (7 dias)</h4>
                                            </div>
                                            <div style="position: relative; height: 300px; width: 100%;">
                                                <canvas id="trends-chart"></canvas>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                                            <div class="flex items-center gap-3 mb-4">
                                                <div class="p-2 bg-yellow-100 rounded-lg">
                                                    <i data-lucide="lightbulb" class="w-5 h-5 text-yellow-600"></i>
                                                </div>
                                                <h4 class="font-semibold text-gray-800">Recomendações IA</h4>
                                            </div>
                                            <div id="ai-recommendations" class="space-y-3 max-h-80 overflow-y-auto">
                                                <div class="p-3 bg-gray-50 rounded-lg text-center text-gray-500 text-sm">
                                                    Gerando recomendações...
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- KPIs Avançados -->
                                <div id="predictive-kpis-content" class="predictive-subtab-content hidden">
                                    <div class="bg-gradient-to-r from-slate-50 to-gray-50 p-6 rounded-lg border border-slate-200">
                                        <h3 class="text-lg font-semibold mb-6 flex items-center gap-2">
                                            <i data-lucide="bar-chart-4" class="w-5 h-5 text-slate-600"></i>
                                            KPIs Avançados (30 dias)
                                        </h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                            <!-- MTBF -->
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <div class="flex items-center justify-between mb-3">
                                                    <div class="flex items-center gap-2">
                                                        <i data-lucide="clock" class="w-5 h-5 text-blue-600"></i>
                                                        <h4 class="font-semibold text-sm text-gray-800">MTBF</h4>
                                                    </div>
                                                    <div id="mtbf-trend">
                                                        <i data-lucide="minus" class="w-4 h-4 text-gray-400"></i>
                                                    </div>
                                                </div>
                                                <div class="text-2xl font-bold text-blue-600 mb-1" id="mtbf-value">--</div>
                                                <div id="mtbf-status" class="text-xs text-gray-600">Calculando...</div>
                                                <div class="mt-2 text-xs text-gray-500">
                                                    Meta: °¥ 168h (1 semana)
                                                </div>
                                            </div>

                                            <!-- MTTR -->
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <div class="flex items-center justify-between mb-3">
                                                    <div class="flex items-center gap-2">
                                                        <i data-lucide="tool" class="w-5 h-5 text-orange-600"></i>
                                                        <h4 class="font-semibold text-sm text-gray-800">MTTR</h4>
                                                    </div>
                                                    <div id="mttr-trend">
                                                        <i data-lucide="minus" class="w-4 h-4 text-gray-400"></i>
                                                    </div>
                                                </div>
                                                <div class="text-2xl font-bold text-orange-600 mb-1" id="mttr-value">--</div>
                                                <div id="mttr-status" class="text-xs text-gray-600">Calculando...</div>
                                                <div class="mt-2 text-xs text-gray-500">
                                                    Meta: °¤ 60 min
                                                </div>
                                            </div>

                                            <!-- FPY -->
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <div class="flex items-center justify-between mb-3">
                                                    <div class="flex items-center gap-2">
                                                        <i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
                                                        <h4 class="font-semibold text-sm text-gray-800">FPY</h4>
                                                    </div>
                                                    <div id="fpy-trend">
                                                        <i data-lucide="minus" class="w-4 h-4 text-gray-400"></i>
                                                    </div>
                                                </div>
                                                <div class="text-2xl font-bold text-green-600 mb-1" id="fpy-value">--</div>
                                                <div id="fpy-status" class="text-xs text-gray-600">Calculando...</div>
                                                <div class="mt-2 text-xs text-gray-500">
                                                    Meta: °¥ 95%
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Botão para atualizar KPIs -->
                                        <div class="mt-4 flex justify-end">
                                            <button onclick="window.advancedKPIs.calculateAllKPIs()" class="bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded-lg text-sm flex items-center gap-2">
                                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                                Atualizar KPIs
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Análise Pareto Automática -->
                                <div id="predictive-pareto-content" class="predictive-subtab-content hidden">
                                    <div class="bg-gradient-to-r from-orange-50 to-red-50 p-6 rounded-lg border border-orange-200">
                                    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between mb-6">
                                        <div>
                                            <h3 class="text-lg font-semibold flex items-center gap-2">
                                                <i data-lucide="pie-chart" class="w-5 h-5 text-orange-600"></i>
                                                Análise Pareto Automática
                                            </h3>
                                            <p class="text-xs text-gray-600 mt-1">Período ativo: <span id="pareto-period-label" class="font-semibold text-gray-800">Últimos 30 dias</span></p>
                                        </div>
                                        <div class="flex flex-col gap-2 lg:items-end">
                                            <div class="flex flex-wrap gap-2 items-center">
                                                <input type="date" id="pareto-start-date" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                                <span class="text-sm text-gray-500">at</span>
                                                <input type="date" id="pareto-end-date" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                                <button onclick="window.autoParetoAnalysis.applyCustomRangeFromInputs()" class="bg-white border border-orange-500 text-orange-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-orange-50">
                                                    Aplicar período
                                                </button>
                                            </div>
                                            <div class="flex flex-wrap gap-2 items-center">
                                                <div class="flex gap-1">
                                                    <button data-pareto-range="7" onclick="window.autoParetoAnalysis.applyQuickRange(7)" class="px-3 py-1 rounded-full text-xs border border-gray-300 text-gray-600 bg-white hover:border-orange-500 hover:text-orange-600">7 dias</button>
                                                    <button data-pareto-range="15" onclick="window.autoParetoAnalysis.applyQuickRange(15)" class="px-3 py-1 rounded-full text-xs border border-gray-300 text-gray-600 bg-white hover:border-orange-500 hover:text-orange-600">15 dias</button>
                                                    <button data-pareto-range="30" onclick="window.autoParetoAnalysis.applyQuickRange(30)" class="px-3 py-1 rounded-full text-xs border border-gray-300 text-gray-600 bg-white hover:border-orange-500 hover:text-orange-600">30 dias</button>
                                                </div>
                                                <button onclick="window.autoParetoAnalysis.refreshCurrentRange()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg text-sm flex items-center gap-2">
                                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                                    Atualizar Análise
                                                </button>
                                            </div>
                                            <p id="pareto-range-feedback" class="text-xs text-red-600 hidden">Selecione o período desejado e aplique.</p>
                                        </div>
                                    </div>

                                    <!-- Cards de Resumo -->
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                        <div class="bg-white p-4 rounded-lg shadow border">
                                            <div id="pareto-downtime-summary">
                                                <h4 class="font-semibold text-red-600">Principais Causas de Parada</h4>
                                                <p class="text-gray-500 text-sm">Carregando...</p>
                                            </div>
                                        </div>
                                        <div class="bg-white p-4 rounded-lg shadow border">
                                            <div id="pareto-quality-summary">
                                                <h4 class="font-semibold text-orange-600">Problemas de Qualidade</h4>
                                                <p class="text-gray-500 text-sm">Carregando...</p>
                                            </div>
                                        </div>
                                        <div class="bg-white p-4 rounded-lg shadow border">
                                            <div id="pareto-production-summary">
                                                <h4 class="font-semibold text-blue-600">Ineficiências de Produção</h4>
                                                <p class="text-gray-500 text-sm">Carregando...</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Gráficos Pareto -->
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                        <div class="bg-white p-4 rounded-lg shadow border">
                                            <h4 class="font-semibold mb-3 flex items-center gap-2">
                                                <i data-lucide="clock" class="w-4 h-4 text-red-600"></i>
                                                Pareto de Paradas
                                            </h4>
                                            <div class="chart-container" style="height: 300px;">
                                                <canvas id="downtime-pareto-chart" class="w-full h-full"></canvas>
                                            </div>
                                            <div id="downtime-reason-details" class="mt-4 text-sm text-gray-700 space-y-2">
                                                <p class="text-xs text-gray-500">Principais motivos detalhados serão exibidos aqui após a análise.</p>
                                            </div>
                                        </div>
                                        <div class="bg-white p-4 rounded-lg shadow border">
                                            <h4 class="font-semibold mb-3 flex items-center gap-2">
                                                <i data-lucide="alert-triangle" class="w-4 h-4 text-orange-600"></i>
                                                Pareto de Qualidade
                                            </h4>
                                            <div class="chart-container" style="height: 300px;">
                                                <canvas id="quality-pareto-chart" class="w-full h-full"></canvas>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Insights Automáticos -->
                                    <div class="bg-white p-4 rounded-lg shadow border">
                                        <h4 class="font-semibold mb-4 flex items-center gap-2">
                                            <i data-lucide="zap" class="w-4 h-4 text-purple-600"></i>
                                            Insights Automáticos (Regra 80/20)
                                        </h4>
                                        <div id="pareto-insights-list" class="space-y-3 max-h-96 overflow-y-auto">
                                            <!-- Será gerado dinamicamente -->
                                        </div>
                                    </div>
                                </div>

                                <!-- ===== SUBTAB: OEE AVAN¡ADO ===== -->
                                <div id="predictive-oee-content" class="predictive-subtab-content hidden">
                                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg border border-purple-200">
                                        <div class="flex items-center justify-between mb-6">
                                            <div>
                                                <h3 class="text-lg font-semibold flex items-center gap-2">
                                                    <i data-lucide="target" class="w-5 h-5 text-purple-600"></i>
                                                    OEE Avançado - Decomposição de Perdas
                                                </h3>
                                                <p class="text-xs text-gray-600 mt-1">Análise detalhada dos componentes A × P × Q</p>
                                            </div>
                                            <button onclick="window.analyticsIA?.initializeOEEAnalysis()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm flex items-center gap-2">
                                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                                Atualizar
                                            </button>
                                        </div>

                                        <!-- OEE Waterfall -->
                                        <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 mb-6">
                                            <div class="bg-white p-4 rounded-lg shadow border text-center">
                                                <div class="text-xs text-gray-500 mb-1">Tempo Planejado</div>
                                                <div class="text-2xl font-bold text-gray-800">100%</div>
                                                <div class="w-full bg-gray-800 h-3 rounded mt-2"></div>
                                            </div>
                                            <div class="bg-white p-4 rounded-lg shadow border text-center">
                                                <div class="text-xs text-gray-500 mb-1">Disponibilidade</div>
                                                <div id="oee-adv-availability" class="text-2xl font-bold text-blue-600">--</div>
                                                <div class="w-full bg-gray-200 h-3 rounded mt-2">
                                                    <div id="oee-adv-availability-bar" class="bg-blue-500 h-3 rounded" style="width: 0%"></div>
                                                </div>
                                            </div>
                                            <div class="bg-white p-4 rounded-lg shadow border text-center">
                                                <div class="text-xs text-gray-500 mb-1">Performance</div>
                                                <div id="oee-adv-performance" class="text-2xl font-bold text-green-600">--</div>
                                                <div class="w-full bg-gray-200 h-3 rounded mt-2">
                                                    <div id="oee-adv-performance-bar" class="bg-green-500 h-3 rounded" style="width: 0%"></div>
                                                </div>
                                            </div>
                                            <div class="bg-white p-4 rounded-lg shadow border text-center">
                                                <div class="text-xs text-gray-500 mb-1">Qualidade</div>
                                                <div id="oee-adv-quality" class="text-2xl font-bold text-teal-600">--</div>
                                                <div class="w-full bg-gray-200 h-3 rounded mt-2">
                                                    <div id="oee-adv-quality-bar" class="bg-teal-500 h-3 rounded" style="width: 0%"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Gráficos OEE -->
                                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <h4 class="font-semibold mb-3 flex items-center gap-2">
                                                    <i data-lucide="bar-chart-3" class="w-4 h-4 text-purple-600"></i>
                                                    OEE por Máquina
                                                </h4>
                                                <div style="position: relative; height: 300px; width: 100%;">
                                                    <canvas id="oee-by-machine-chart"></canvas>
                                                </div>
                                            </div>
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <h4 class="font-semibold mb-3 flex items-center gap-2">
                                                    <i data-lucide="clock" class="w-4 h-4 text-orange-600"></i>
                                                    OEE por Turno
                                                </h4>
                                                <div style="position: relative; height: 300px; width: 100%;">
                                                    <canvas id="oee-by-shift-chart"></canvas>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Decomposição de Perdas -->
                                        <div class="bg-white p-4 rounded-lg shadow border">
                                            <h4 class="font-semibold mb-4 flex items-center gap-2">
                                                <i data-lucide="layers" class="w-4 h-4 text-red-600"></i>
                                                Decomposição de Perdas OEE
                                            </h4>
                                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div class="border-l-4 border-blue-500 pl-4">
                                                    <h5 class="font-medium text-blue-700 mb-2">Perdas de Disponibilidade</h5>
                                                    <div id="oee-availability-losses" class="space-y-2 text-sm">
                                                        <p class="text-gray-500">Carregando...</p>
                                                    </div>
                                                </div>
                                                <div class="border-l-4 border-green-500 pl-4">
                                                    <h5 class="font-medium text-green-700 mb-2">Perdas de Performance</h5>
                                                    <div id="oee-performance-losses" class="space-y-2 text-sm">
                                                        <p class="text-gray-500">Carregando...</p>
                                                    </div>
                                                </div>
                                                <div class="border-l-4 border-teal-500 pl-4">
                                                    <h5 class="font-medium text-teal-700 mb-2">Perdas de Qualidade</h5>
                                                    <div id="oee-quality-losses" class="space-y-2 text-sm">
                                                        <p class="text-gray-500">Carregando...</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ===== SUBTAB: BENCHMARK ===== -->
                                <div id="predictive-benchmark-content" class="predictive-subtab-content hidden">
                                    <div class="bg-gradient-to-r from-amber-50 to-yellow-50 p-6 rounded-lg border border-amber-200">
                                        <div class="flex items-center justify-between mb-6">
                                            <div>
                                                <h3 class="text-lg font-semibold flex items-center gap-2">
                                                    <i data-lucide="trophy" class="w-5 h-5 text-amber-600"></i>
                                                    Benchmarking de Máquinas
                                                </h3>
                                                <p class="text-xs text-gray-600 mt-1">Comparativo de performance e identificação de melhores práticas</p>
                                            </div>
                                            <button onclick="window.analyticsIA?.initializeBenchmarking()" class="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg text-sm flex items-center gap-2">
                                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                                Atualizar
                                            </button>
                                        </div>

                                        <!-- Cards de Resumo -->
                                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <i data-lucide="award" class="w-5 h-5 text-yellow-500"></i>
                                                    <span class="text-sm font-medium text-gray-600">Best in Class</span>
                                                </div>
                                                <div id="benchmark-best-machine" class="text-xl font-bold text-gray-800">--</div>
                                                <div id="benchmark-best-oee" class="text-sm text-green-600">--</div>
                                            </div>
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <i data-lucide="bar-chart-2" class="w-5 h-5 text-blue-500"></i>
                                                    <span class="text-sm font-medium text-gray-600">Média Geral</span>
                                                </div>
                                                <div id="benchmark-avg-oee" class="text-xl font-bold text-blue-600">--</div>
                                                <div class="text-sm text-gray-500">OEE mdio</div>
                                            </div>
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <i data-lucide="trending-up" class="w-5 h-5 text-green-500"></i>
                                                    <span class="text-sm font-medium text-gray-600">Potencial</span>
                                                </div>
                                                <div id="benchmark-potential" class="text-xl font-bold text-green-600">--</div>
                                                <div class="text-sm text-gray-500">Ganho possível</div>
                                            </div>
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <i data-lucide="cpu" class="w-5 h-5 text-purple-500"></i>
                                                    <span class="text-sm font-medium text-gray-600">Máquinas</span>
                                                </div>
                                                <div id="benchmark-machine-count" class="text-xl font-bold text-purple-600">--</div>
                                                <div class="text-sm text-gray-500">Analisadas</div>
                                            </div>
                                        </div>

                                        <!-- Ranking de Máquinas -->
                                        <div class="bg-white p-4 rounded-lg shadow border mb-6">
                                            <h4 class="font-semibold mb-4 flex items-center gap-2">
                                                <i data-lucide="list-ordered" class="w-4 h-4 text-amber-600"></i>
                                                Ranking de Máquinas por OEE
                                            </h4>
                                            <div class="overflow-x-auto">
                                                <table class="w-full text-sm">
                                                    <thead class="bg-gray-50">
                                                        <tr>
                                                            <th class="px-4 py-2 text-left font-medium text-gray-600">#</th>
                                                            <th class="px-4 py-2 text-left font-medium text-gray-600">Máquina</th>
                                                            <th class="px-4 py-2 text-left font-medium text-gray-600">OEE</th>
                                                            <th class="px-4 py-2 text-left font-medium text-gray-600">Disponibilidade</th>
                                                            <th class="px-4 py-2 text-left font-medium text-gray-600">Performance</th>
                                                            <th class="px-4 py-2 text-left font-medium text-gray-600">Qualidade</th>
                                                            <th class="px-4 py-2 text-right font-medium text-gray-600">Produção</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="benchmark-ranking-table">
                                                        <tr>
                                                            <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                                                                <i data-lucide="loader-2" class="w-6 h-6 mx-auto animate-spin mb-2"></i>
                                                                Carregando dados...
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Insights e Recomendações -->
                                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <h4 class="font-semibold mb-4 flex items-center gap-2">
                                                    <i data-lucide="lightbulb" class="w-4 h-4 text-yellow-600"></i>
                                                    Melhores Práticas Identificadas
                                                </h4>
                                                <div id="benchmark-best-practices" class="space-y-3">
                                                    <p class="text-gray-500 text-sm">Analisando...</p>
                                                </div>
                                            </div>
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <h4 class="font-semibold mb-4 flex items-center gap-2">
                                                    <i data-lucide="zap" class="w-4 h-4 text-orange-600"></i>
                                                    Oportunidades de Melhoria
                                                </h4>
                                                <div id="benchmark-opportunities" class="space-y-3">
                                                    <p class="text-gray-500 text-sm">Analisando...</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Sistema SPC (Statistical Process Control) -->
                                <div id="predictive-spc-content" class="predictive-subtab-content hidden">
                                    <div class="bg-gradient-to-r from-indigo-50 to-blue-50 p-6 rounded-lg border border-indigo-200">
                                        <div class="flex items-center justify-between mb-6">
                                            <h3 class="text-lg font-semibold flex items-center gap-2">
                                                <i data-lucide="bar-chart-2" class="w-5 h-5 text-indigo-600"></i>
                                                SPC - Controle Estatístico do Processo
                                            </h3>
                                            <div class="flex items-center gap-3">
                                                <div id="spc-process-status" class="px-3 py-1 rounded-full text-sm font-medium text-green-600 bg-green-50">
                                                    Inicializando...
                                                </div>
                                                <button onclick="window.spcController.initialize()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm flex items-center gap-2">
                                                    <i data-lucide="play" class="w-4 h-4"></i>
                                                    Iniciar SPC
                                                </button>
                                            </div>
                                        </div>

                                        <!-- KPIs de Capacidade -->
                                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <div class="flex items-center justify-between mb-2">
                                                    <h5 class="font-semibold text-sm text-gray-800">Cp</h5>
                                                    <i data-lucide="target" class="w-4 h-4 text-blue-600"></i>
                                                </div>
                                                <div id="spc-cp-value" class="text-2xl font-bold text-blue-600">--</div>
                                                <div class="text-xs text-gray-600 mt-1">Capacidade Potencial</div>
                                                <div class="text-xs text-gray-500">Meta: °¥ 1.33</div>
                                            </div>

                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <div class="flex items-center justify-between mb-2">
                                                    <h5 class="font-semibold text-sm text-gray-800">Cpk</h5>
                                                    <i data-lucide="crosshair" class="w-4 h-4 text-green-600"></i>
                                                </div>
                                                <div id="spc-cpk-value" class="text-2xl font-bold text-green-600">--</div>
                                                <div class="text-xs text-gray-600 mt-1">Capacidade Real</div>
                                                <div class="text-xs text-gray-500">Meta: °¥ 1.33</div>
                                            </div>

                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <div class="flex items-center justify-between mb-2">
                                                    <h5 class="font-semibold text-sm text-gray-800">Taxa Defeitos</h5>
                                                    <i data-lucide="alert-triangle" class="w-4 h-4 text-red-600"></i>
                                                </div>
                                                <div id="spc-defect-rate" class="text-2xl font-bold text-red-600">--</div>
                                                <div class="text-xs text-gray-600 mt-1">% Fora de Spec</div>
                                                <div class="text-xs text-gray-500">Meta: < 0.1%</div>
                                            </div>

                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <div class="flex items-center justify-between mb-2">
                                                    <h5 class="font-semibold text-sm text-gray-800">Nível Sigma</h5>
                                                    <i data-lucide="trending-up" class="w-4 h-4 text-purple-600"></i>
                                                </div>
                                                <div id="spc-sigma-level" class="text-2xl font-bold text-purple-600">--</div>
                                                <div class="text-xs text-gray-600 mt-1">Six Sigma Level</div>
                                                <div id="spc-capability-status" class="text-xs font-medium text-gray-500">--</div>
                                            </div>
                                        </div>

                                        <!-- Gráficos de Controle -->
                                        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <h4 class="font-semibold mb-3 flex items-center gap-2">
                                                    <i data-lucide="activity" class="w-4 h-4 text-blue-600"></i>
                                                    Gráfico X (Médias)
                                                </h4>
                                                <div class="chart-container" style="position: relative; height: 300px; width: 100%;">
                                                    <canvas id="spc-xbar-chart"></canvas>
                                                </div>
                                            </div>

                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <h4 class="font-semibold mb-3 flex items-center gap-2">
                                                    <i data-lucide="bar-chart" class="w-4 h-4 text-orange-600"></i>
                                                    Gráfico R (Amplitudes)
                                                </h4>
                                                <div class="chart-container" style="position: relative; height: 300px; width: 100%;">
                                                    <canvas id="spc-r-chart"></canvas>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Histograma e Alertas -->
                                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <h4 class="font-semibold mb-3 flex items-center gap-2">
                                                    <i data-lucide="bar-chart-3" class="w-4 h-4 text-purple-600"></i>
                                                    Distribuição dos Valores
                                                </h4>
                                                <div class="chart-container" style="position: relative; height: 300px; width: 100%;">
                                                    <canvas id="spc-histogram"></canvas>
                                                </div>
                                            </div>

                                            <div class="bg-white p-4 rounded-lg shadow border">
                                                <h4 class="font-semibold mb-3 flex items-center gap-2">
                                                    <i data-lucide="alert-circle" class="w-4 h-4 text-red-600"></i>
                                                    Alertas de Controle
                                                </h4>
                                                <div id="spc-alerts-container" class="space-y-2 max-h-80 overflow-y-auto">
                                                    <div class="text-center text-gray-500 py-8">
                                                        <i data-lucide="shield-check" class="w-8 h-8 mx-auto text-green-500 mb-2"></i>
                                                        <p class="text-sm">Processo sob controle</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Configurações SPC -->
                                        <div class="mt-6 bg-white p-4 rounded-lg shadow border">
                                            <h4 class="font-semibold mb-3 flex items-center gap-2">
                                                <i data-lucide="settings" class="w-4 h-4 text-gray-600"></i>
                                                Configurações do SPC
                                            </h4>
                                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tamanho da Amostra</label>
                                                    <select id="spc-sample-size" class="w-full border-gray-300 rounded-md p-2 text-sm">
                                                        <option value="3">3</option>
                                                        <option value="4">4</option>
                                                        <option value="5" selected>5</option>
                                                        <option value="6">6</option>
                                                        <option value="7">7</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">Intervalo de Atualização</label>
                                                    <select id="spc-update-interval" class="w-full border-gray-300 rounded-md p-2 text-sm">
                                                        <option value="60000">1 minuto</option>
                                                        <option value="300000" selected>5 minutos</option>
                                                        <option value="600000">10 minutos</option>
                                                        <option value="1800000">30 minutos</option>
                                                    </select>
                                                </div>
                                                <div class="flex items-end">
                                                    <button onclick="window.spcController.stopMonitoring()" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm flex items-center justify-center gap-2">
                                                        <i data-lucide="pause" class="w-4 h-4"></i>
                                                        Parar Monitoramento
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ===== SUBTAB: RANKING E BENCHMARK ===== -->
                                <div id="predictive-ranking-content" class="predictive-subtab-content hidden">
                                    <div class="space-y-6">
                                        <!-- Header -->
                                        <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-6 rounded-xl border border-amber-200">
                                            <div class="flex items-center justify-between mb-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="p-2 bg-amber-100 rounded-lg">
                                                        <i data-lucide="trophy" class="w-6 h-6 text-amber-600"></i>
                                                    </div>
                                                    <div>
                                                        <h3 class="text-lg font-semibold text-gray-800">Ranking de Performance</h3>
                                                        <p class="text-sm text-gray-600">Benchmark entre máquinas, turnos e operadores</p>
                                                    </div>
                                                </div>
                                                <button onclick="window.analyticsIA?.refreshRanking()" class="px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white rounded-lg text-sm flex items-center gap-2">
                                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                                    Atualizar
                                                </button>
                                            </div>

                                            <!-- Filtros -->
                                            <div class="flex flex-wrap gap-4">
                                                <div>
                                                    <label class="block text-xs font-medium text-gray-600 mb-1">Tipo de Ranking</label>
                                                    <select id="ranking-type" onchange="window.analyticsIA?.updateRanking()" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                                        <option value="machines">Por Máquina</option>
                                                        <option value="shifts">Por Turno</option>
                                                        <option value="products">Por Produto</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label class="block text-xs font-medium text-gray-600 mb-1">Mtrica</label>
                                                    <select id="ranking-metric" onchange="window.analyticsIA?.updateRanking()" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                                        <option value="oee">OEE</option>
                                                        <option value="availability">Disponibilidade</option>
                                                        <option value="performance">Performance</option>
                                                        <option value="quality">Qualidade</option>
                                                        <option value="production">Produção</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label class="block text-xs font-medium text-gray-600 mb-1">Período</label>
                                                    <select id="ranking-period" onchange="window.analyticsIA?.updateRanking()" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                                        <option value="today">Hoje</option>
                                                        <option value="week" selected>Esta Semana</option>
                                                        <option value="month">Este Mês</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Grid de Rankings -->
                                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                            <!-- Top Performers -->
                                            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                                                <div class="flex items-center gap-2 mb-4">
                                                    <div class="p-2 bg-green-100 rounded-lg">
                                                        <i data-lucide="medal" class="w-5 h-5 text-green-600"></i>
                                                    </div>
                                                    <h4 class="font-semibold text-gray-800">Top Performers</h4>
                                                </div>
                                                <div id="ranking-top-performers" class="space-y-3">
                                                    <div class="flex items-center justify-center py-8">
                                                        <div class="text-center">
                                                            <i data-lucide="loader-2" class="w-8 h-8 mx-auto animate-spin text-amber-500 mb-2"></i>
                                                            <p class="text-sm text-gray-500">Calculando ranking...</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Gráfico de Comparação -->
                                            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                                                <div class="flex items-center gap-2 mb-4">
                                                    <div class="p-2 bg-blue-100 rounded-lg">
                                                        <i data-lucide="bar-chart-horizontal" class="w-5 h-5 text-blue-600"></i>
                                                    </div>
                                                    <h4 class="font-semibold text-gray-800">Comparativo</h4>
                                                </div>
                                                <div style="position: relative; height: 300px; width: 100%;">
                                                    <canvas id="comparison-chart"></canvas>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Tabela Detalhada -->
                                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                                            <div class="flex items-center justify-between mb-4">
                                                <div class="flex items-center gap-2">
                                                    <div class="p-2 bg-purple-100 rounded-lg">
                                                        <i data-lucide="table" class="w-5 h-5 text-purple-600"></i>
                                                    </div>
                                                    <h4 class="font-semibold text-gray-800">Ranking Detalhado</h4>
                                                </div>
                                                <button onclick="window.analyticsIA?.exportRanking()" class="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm flex items-center gap-2">
                                                    <i data-lucide="download" class="w-4 h-4"></i>
                                                    Exportar
                                                </button>
                                            </div>
                                            <div class="overflow-x-auto">
                                                <table class="w-full text-sm">
                                                    <thead>
                                                        <tr class="border-b border-gray-200">
                                                            <th class="text-left py-3 px-4 font-semibold text-gray-600">#</th>
                                                            <th class="text-left py-3 px-4 font-semibold text-gray-600">Nome</th>
                                                            <th class="text-center py-3 px-4 font-semibold text-gray-600">OEE</th>
                                                            <th class="text-center py-3 px-4 font-semibold text-gray-600">Disponibilidade</th>
                                                            <th class="text-center py-3 px-4 font-semibold text-gray-600">Performance</th>
                                                            <th class="text-center py-3 px-4 font-semibold text-gray-600">Qualidade</th>
                                                            <th class="text-center py-3 px-4 font-semibold text-gray-600">Trend</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="ranking-table-body">
                                                        <tr>
                                                            <td colspan="7" class="text-center py-8 text-gray-500">
                                                                <i data-lucide="loader-2" class="w-6 h-6 mx-auto animate-spin mb-2"></i>
                                                                <p>Carregando dados...</p>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Insights -->
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-5 border border-green-200">
                                                <div class="flex items-center gap-2 mb-3">
                                                    <i data-lucide="trending-up" class="w-5 h-5 text-green-600"></i>
                                                    <h5 class="font-semibold text-green-800">Melhor Performance</h5>
                                                </div>
                                                <p id="ranking-best-insight" class="text-sm text-green-700">Analisando...</p>
                                            </div>
                                            <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-5 border border-amber-200">
                                                <div class="flex items-center gap-2 mb-3">
                                                    <i data-lucide="lightbulb" class="w-5 h-5 text-amber-600"></i>
                                                    <h5 class="font-semibold text-amber-800">Oportunidade</h5>
                                                </div>
                                                <p id="ranking-opportunity-insight" class="text-sm text-amber-700">Analisando...</p>
                                            </div>
                                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-5 border border-blue-200">
                                                <div class="flex items-center gap-2 mb-3">
                                                    <i data-lucide="target" class="w-5 h-5 text-blue-600"></i>
                                                    <h5 class="font-semibold text-blue-800">Meta Sugerida</h5>
                                                </div>
                                                <p id="ranking-goal-insight" class="text-sm text-blue-700">Analisando...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div><!-- Fim predictive-view -->
                        
                        </div><!-- Fim área de conteúdo p-4 md:p-6 -->

                        <!-- Loading e No Data States -->
                        <div id="analysis-loading" class="text-center py-20 hidden">
                            <i data-lucide="loader-2" class="w-12 h-12 animate-spin text-primary-blue mx-auto"></i>
                            <p class="mt-4 text-gray-600">Carregando dados de análise...</p>
                        </div>
                        
                        <div id="analysis-no-data" class="text-center py-20 hidden">
                            <i data-lucide="database" class="w-16 h-16 text-gray-400 mx-auto"></i>
                            <p class="mt-4 text-gray-600 text-lg">Nenhum dado encontrado para o período selecionado</p>
                            <p class="text-gray-500">Tente ajustar os filtros ou selecionar um período diferente</p>
                        </div>
                        
                    </div><!-- Fim bg-gradient-to-br container principal -->
                </div><!-- Fim analise-page -->
            </div>
        </main>
    </div>
    
    <!-- Overlay for mobile menu -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden" aria-hidden="true"></div>

    <!-- Modais -->
    
    <!-- Modal de Nova/Editar Ordem de Produção -->
    <div id="order-form-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white/20 rounded-lg">
                            <i data-lucide="plus-circle" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h3 id="order-form-title" class="text-xl font-bold text-white">Nova Ordem de Produção</h3>
                            <p class="text-blue-200 text-sm">Preencha os dados da OP</p>
                        </div>
                    </div>
                    <button onclick="closeOrderFormModal()" class="p-2 hover:bg-white/20 rounded-lg transition">
                        <i data-lucide="x" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
            </div>
            
            <!-- Body -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                <form id="order-form-modal-form" class="space-y-4">
                    <input type="hidden" id="order-form-id">
                    
                    <!-- Seção 1: Dados da OP -->
                    <div class="border border-blue-200 rounded-lg overflow-hidden">
                        <div class="bg-blue-50 px-3 py-2 border-b border-blue-200">
                            <h4 class="text-sm font-semibold text-blue-800 flex items-center gap-2">
                                <i data-lucide="file-text" class="w-4 h-4"></i>
                                Dados da Ordem
                            </h4>
                        </div>
                        <div class="p-3 space-y-3 bg-white">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <!-- Nº da OP -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nº da OP <span class="text-red-500">*</span></label>
                                    <input type="text" id="order-form-number" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: OP-2024-001" required>
                                </div>
                                
                                <!-- Código da Peça -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Código da Peça <span class="text-blue-500">(busca automática)</span></label>
                                    <div class="relative">
                                        <input type="text" id="order-form-part-code" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Digite o código e pressione Enter">
                                        <button type="button" onclick="onPartCodeChange(document.getElementById('order-form-part-code').value)" class="absolute right-2 top-1/2 -translate-y-1/2 p-1 bg-blue-100 hover:bg-blue-200 rounded text-blue-600">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção 2: Dados do Produto (preenchido automaticamente) -->
                    <div class="border border-emerald-200 rounded-lg overflow-hidden">
                        <div class="bg-emerald-50 px-3 py-2 border-b border-emerald-200">
                            <h4 class="text-sm font-semibold text-emerald-800 flex items-center gap-2">
                                <i data-lucide="package" class="w-4 h-4"></i>
                                Dados do Produto
                            </h4>
                        </div>
                        <div class="p-3 space-y-3 bg-white">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <!-- Produto -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Produto</label>
                                    <input type="text" id="order-form-product" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="Preenchido automaticamente" readonly>
                                </div>
                                
                                <!-- Cliente -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cliente</label>
                                    <input type="text" id="order-form-customer" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="Preenchido automaticamente" readonly>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <!-- Cavidades -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cavidades</label>
                                    <input type="number" id="order-form-cavities" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="-" readonly>
                                </div>
                                
                                <!-- Ciclo -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Ciclo (s)</label>
                                    <input type="number" step="0.01" id="order-form-cycle" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="-" readonly>
                                </div>
                                
                                <!-- Peso -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Peso (g)</label>
                                    <input type="number" step="0.01" id="order-form-weight" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="-" readonly>
                                </div>
                                
                                <!-- Meta peças/hora -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Meta pç/h</label>
                                    <input type="number" id="order-form-goal" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="-" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção 3: Dados da Produção -->
                    <div class="border border-amber-200 rounded-lg overflow-hidden">
                        <div class="bg-amber-50 px-3 py-2 border-b border-amber-200">
                            <h4 class="text-sm font-semibold text-amber-800 flex items-center gap-2">
                                <i data-lucide="settings" class="w-4 h-4"></i>
                                Dados da Produção
                            </h4>
                        </div>
                        <div class="p-3 space-y-3 bg-white">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <!-- Tamanho do Lote -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tamanho do Lote <span class="text-red-500">*</span></label>
                                    <input type="number" id="order-form-lot-size" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: 10000" min="1" required>
                                </div>
                                
                                <!-- Nº do Lote -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nº do Lote</label>
                                    <input type="text" id="order-form-batch" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: L001">
                                </div>
                                
                                <!-- Embalagem -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Qtd. Embalagem</label>
                                    <input type="number" id="order-form-packaging" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: 500" min="0">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <!-- Máquina -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Máquina</label>
                                    <select id="order-form-machine" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione uma máquina</option>
                                    </select>
                                </div>
                                
                                <!-- Matéria-Prima -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Matéria-Prima (MP)</label>
                                    <select id="order-form-mp" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione a MP...</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botões -->
                    <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                        <button type="button" onclick="closeOrderFormModal()" class="px-5 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-lg transition">
                            Cancelar
                        </button>
                        <button type="button" onclick="saveOrderForm()" class="px-5 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold rounded-lg shadow-md transition flex items-center gap-2">
                            <i data-lucide="save" class="w-4 h-4"></i>
                            Salvar OP
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal de Importação de Ordens Excel -->
    <div id="import-orders-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white/20 rounded-lg">
                            <i data-lucide="file-spreadsheet" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Importar Ordens de Produção</h3>
                            <p class="text-indigo-200 text-sm">Importar arquivo Excel do ERP</p>
                        </div>
                    </div>
                    <button onclick="closeImportOrdersModal()" class="p-2 hover:bg-white/20 rounded-lg transition">
                        <i data-lucide="x" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
            </div>
            
            <!-- Body -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                <!-- Área de Upload -->
                <div id="import-upload-area" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-indigo-400 hover:bg-indigo-50/50 transition-all cursor-pointer mb-6" onclick="document.getElementById('import-file-input').click()">
                    <input type="file" id="import-file-input" accept=".xlsx,.xls" class="hidden" onchange="handleImportFileSelect(event)">
                    <div class="flex flex-col items-center gap-3">
                        <div class="p-4 bg-indigo-100 rounded-full">
                            <i data-lucide="upload-cloud" class="w-10 h-10 text-indigo-600"></i>
                        </div>
                        <div>
                            <p class="text-lg font-semibold text-gray-700">Arraste o arquivo Excel aqui</p>
                            <p class="text-sm text-gray-500">ou clique para selecionar</p>
                        </div>
                        <p class="text-xs text-gray-400">Formatos aceitos: .xlsx, .xls</p>
                    </div>
                </div>
                
                <!-- Arquivo Selecionado -->
                <div id="import-file-info" class="hidden mb-6">
                    <div class="flex items-center gap-3 p-4 bg-green-50 border border-green-200 rounded-xl">
                        <div class="p-2 bg-green-100 rounded-lg">
                            <i data-lucide="file-check" class="w-5 h-5 text-green-600"></i>
                        </div>
                        <div class="flex-1">
                            <p id="import-file-name" class="font-medium text-green-800">arquivo.xlsx</p>
                            <p id="import-file-size" class="text-sm text-green-600">0 KB</p>
                        </div>
                        <button onclick="clearImportFile()" class="p-2 hover:bg-green-100 rounded-lg transition">
                            <i data-lucide="x" class="w-4 h-4 text-green-600"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Configurações de Importação -->
                <div id="import-config" class="hidden mb-6">
                    <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                        Configurações de Importação
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">Máquina Padrão</label>
                            <select id="import-default-machine" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm">
                                <option value="">Usar do arquivo</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">Status Inicial</label>
                            <select id="import-default-status" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm">
                                <option value="from_file">Usar do arquivo</option>
                                <option value="planejada">Planejada</option>
                                <option value="ativa">Ativa</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="import-skip-existing" checked class="w-4 h-4 text-indigo-600 rounded">
                            <span class="text-sm text-gray-700">Ignorar ordens já existentes (mesmo Nº OP)</span>
                        </label>
                    </div>
                </div>
                
                <!-- Preview dos Dados -->
                <div id="import-preview" class="hidden">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-semibold text-gray-800 flex items-center gap-2">
                            <i data-lucide="eye" class="w-4 h-4"></i>
                            Prvia dos Dados
                        </h4>
                        <span id="import-records-count" class="text-sm text-gray-500">0 registros encontrados</span>
                    </div>
                    <div class="overflow-x-auto border border-gray-200 rounded-xl">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">
                                        <input type="checkbox" id="import-select-all" checked class="w-4 h-4 text-indigo-600 rounded" onchange="toggleAllImportRows(this.checked)">
                                    </th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Nº OP</th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Produto</th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Descrição</th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Máquina</th>
                                    <th class="px-3 py-2 text-center font-semibold text-gray-600">Lote</th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Status</th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Cliente</th>
                                </tr>
                            </thead>
                            <tbody id="import-preview-body" class="divide-y divide-gray-100">
                                <!-- Linhas serão inseridas via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Status de Importação -->
                <div id="import-status" class="hidden">
                    <div class="text-center py-8">
                        <div id="import-progress-container" class="mb-4">
                            <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                                <div id="import-progress-bar" class="bg-indigo-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p id="import-progress-text" class="text-sm text-gray-600">Importando...</p>
                        </div>
                        <div id="import-result" class="hidden">
                            <div id="import-result-icon" class="mb-3"></div>
                            <p id="import-result-text" class="text-lg font-semibold"></p>
                            <p id="import-result-details" class="text-sm text-gray-500 mt-1"></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="px-6 py-4 bg-gray-50 border-t flex justify-between items-center">
                <p class="text-xs text-gray-500">
                    <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
                    Formato compatível: Relatório de Ordens do ERP Sankhya
                </p>
                <div class="flex gap-3">
                    <button onclick="closeImportOrdersModal()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition">
                        Cancelar
                    </button>
                    <button id="import-execute-btn" onclick="executeImportOrders()" disabled class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition flex items-center gap-2">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        Importar Selecionados
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="leader-entry-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-40 flex justify-center items-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg m-4">
            <div class="flex justify-between items-center border-b pb-3 mb-5">
                <h3 id="leader-modal-title" class="text-xl font-bold"></h3>
                <button id="leader-modal-close-btn" class="p-1 rounded-full hover:bg-gray-200"><i data-lucide="x"></i></button>
            </div>
            <form id="leader-entry-form"></form>
        </div>
    </div>

    <div id="production-entry-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-40 flex justify-center items-start p-4 overflow-y-auto">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-5xl m-4 mt-10">
        <div class="flex justify-between items-center border-b pb-3 mb-5">
            <h3 id="production-modal-title" class="text-xl font-bold"></h3>
            <button id="production-modal-close-btn" class="p-1 rounded-full hover:bg-gray-200">
                <i data-lucide="x"></i>
            </button>
        </div>
        <!-- Contexto Máquina/Produto -->
        <div class="modal-context bg-gray-50 border border-gray-200 rounded-md p-2 mb-4 text-xs text-gray-700">
            <div class="flex items-center justify-between gap-3">
                <span>Máquina: <b class="context-machine">-</b></span>
                <span>Produto: <b class="context-product">-</b></span>
            </div>
        </div>
        
        <!-- Informações do Produto -->
        <div class="bg-blue-50 p-3 rounded-lg mb-4">
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                    <span id="product-weight-info" class="font-semibold">Peso da peça: 0g</span>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="use-tara-box" class="mr-2">
                    <label for="use-tara-box" class="font-semibold">Usar Caixa de Tara</label>
                    <input type="number" id="tara-box-weight" step="0.01" value="0" 
                           class="ml-2 w-20 p-1 border rounded" readonly>
                    <span id="tara-box-info" class="ml-2 text-sm text-gray-600">caixa plastica</span>
                </div>
            </div>
        </div>

        <form id="production-entry-form" class="space-y-4">
            <input type="hidden" id="production-entry-plan-id" name="planId">
            <input type="hidden" id="production-entry-turno" name="turno">
            
            <!-- Cabeçalho da tabela de lançamentos por hora -->
            <div class="grid grid-cols-13 gap-2 font-semibold border-b pb-2 text-sm">
                <div class="col-span-2">Hora</div>
                <div class="col-span-3">Peso Bruto (kg)</div>
                <div class="col-span-2">Tara</div>
                <div class="col-span-2">Embalagem Fechada</div>
                <div class="col-span-3">Peças Calculadas</div>
                <div class="col-span-1">Ação</div>
            </div>
            
            <!-- Container para lançamentos por hora -->
            <div id="hourly-entries-container" class="max-h-96 overflow-y-auto border rounded-lg p-2">
                <!-- Os lançamentos serão inseridos aqui via JavaScript -->
            </div>
            
            <!-- Resumo Total -->
            <div class="bg-gray-50 p-4 rounded-lg mt-4">
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <div class="text-sm text-gray-600">Total Peso Líquido</div>
                        <div id="total-peso-liquido" class="text-lg font-bold">0 kg</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-600">Total de Peças</div>
                        <div id="total-pecas" class="text-lg font-bold">0</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-600">Produção Boa</div>
                        <input type="number" id="production-entry-produzido" name="produzido" 
                               min="0" value="0" step="1" inputmode="numeric" class="w-full p-2 border rounded text-center font-bold" onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                    </div>
                </div>
            </div>

            <!-- Campos de refugo -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                <div>
                    <label for="production-entry-refugo" class="block text-sm font-medium">Refugo (kg)</label>
                    <input type="number" id="production-entry-refugo" name="refugo" 
                           min="0" step="0.01" value="0" class="mt-1 w-full p-2 border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="production-entry-borras" class="block text-sm font-medium">Peso das Borras (kg)</label>
                    <input type="number" id="production-entry-borras" name="borras" 
                           min="0" step="0.01" value="0" class="mt-1 w-full p-2 border-gray-300 rounded-md">
                </div>
            </div>
            
            <div>
                <label for="production-entry-perdas" class="block text-sm font-medium">Motivo do Refugo</label>
                <select id="production-entry-perdas" name="perdas" class="mt-1 w-full p-2 border-gray-300 rounded-md"></select>
            </div>
            
            <div class="mt-6 flex justify-end gap-3 pt-4 border-t">
                <button type="button" id="production-modal-cancel-btn" 
                        class="bg-gray-200 hover:bg-gray-300 font-bold py-2 px-6 rounded-lg">
                    Cancelar
                </button>
                <button type="submit" id="production-modal-save-btn" 
                        class="bg-primary-blue hover:bg-blue-800 text-white font-bold py-2 px-6 rounded-lg">
                    Salvar Lançamentos
                </button>
            </div>
            <div id="production-modal-status" class="text-sm font-semibold h-5 text-center mt-2"></div>
        </form>
    </div>
</div>

    <!-- Modal de Lançamento de Produção -->
    <div id="quick-production-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-green-100 to-green-200 rounded-xl">
                        <i data-lucide="package-plus" class="w-5 h-5 text-green-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Lançar Produção</h3>
                </div>
                <button id="quick-production-close" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="quick-production-form" class="space-y-4">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-3 mb-4">
                    <p class="text-sm text-blue-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Informe <strong>quantidade OU peso</strong> - o sistema irá validar e converter automaticamente.
                    </p>
                </div>
                
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Quantidade Produzida <span class="text-gray-400 normal-case">(opcional se informar peso)</span></label>
                    <input type="number" id="quick-production-qty" name="quantity" min="0" step="1" inputmode="numeric" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all" placeholder="Quantidade de peças (números inteiros)" onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                    <p id="quick-production-qty-feedback" class="text-xs text-gray-500 mt-1"></p>
                </div>
                
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Peso Bruto (g) <span class="text-gray-400 normal-case">(opcional se informar quantidade)</span></label>
                    <input type="number" step="1" id="quick-production-weight" name="weight" min="0" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all" placeholder="Peso em gramas ou kg (ex: 1500 ou 1,5)">
                    <p id="quick-production-weight-feedback" class="text-xs text-gray-500 mt-1">Aceita valores em gramas ou kg (Ex: 1,5 kg = 1500g)</p>
                    <p id="quick-production-weight-converted" class="text-xs text-blue-600 mt-1 font-semibold"></p>
                </div>
                
                <div class="rounded-xl border border-gray-200 bg-gradient-to-br from-gray-50 to-gray-100 p-3">
                    <div class="flex flex-col text-sm text-gray-700">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Peso de referência ativo</span>
                        <span id="quick-production-weight-source" class="text-gray-900 mt-1">-</span>
                        <span id="quick-production-weight-history" class="text-xs text-gray-500 hidden"></span>
                    </div>
                </div>
                
                <div>
                    <label class="flex items-center text-sm font-medium text-gray-700">
                        <input type="checkbox" id="quick-production-use-tare" class="mr-2 w-4 h-4 text-green-600 rounded border-gray-300 focus:ring-green-500">
                        Usar tara da caixa plástica
                    </label>
                    <div id="quick-production-tare-info" class="hidden text-sm text-blue-700 bg-gradient-to-br from-blue-50 to-blue-100 p-3 rounded-xl border border-blue-200 mt-2">
                        <strong>Tara cadastrada:</strong> <span id="quick-production-tare-weight">-</span>g
                        <p class="text-xs mt-2">Será descontada automaticamente do peso bruto</p>
                    </div>
                </div>
                
                <div id="quick-production-consistency-alert" class="hidden bg-gradient-to-br from-yellow-50 to-amber-50 border border-yellow-200 rounded-xl p-3">
                    <p class="text-sm text-yellow-800">
                        <i data-lucide="alert-triangle" class="w-4 h-4 inline mr-2"></i>
                        <span id="quick-production-consistency-message"></span>
                    </p>
                </div>
                
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="quick-production-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all" placeholder="Observações opcionais"></textarea>
                </div>
                
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="quick-production-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all" id="quick-production-submit">
                        Registrar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Registro de Perdas -->
    <div id="quick-losses-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-orange-100 to-orange-200 rounded-xl">
                        <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Registrar Perdas</h3>
                </div>
                <button id="quick-losses-close" class="p-2 rounded-full hover:bg-gray-100">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gray-50 border border-gray-200 rounded-md p-2 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="quick-losses-form" class="space-y-4">
                <div class="bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-xl p-3 mb-4">
                    <p class="text-sm text-orange-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Informe <strong>quantidade OU peso</strong> das perdas - apenas um dos campos  necessário.
                    </p>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Quantidade de Perdas <span class="text-gray-400 normal-case">(opcional se informar peso)</span></label>
                    <input type="number" id="quick-losses-qty" name="quantity" min="0" step="1" inputmode="numeric" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Quantidade de peças perdidas" onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Peso das Perdas (kg) <span class="text-gray-400 normal-case">(opcional se informar quantidade)</span></label>
                    <input type="text" id="quick-losses-weight" name="weight" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Ex: 0,980 ou 1.5 ou 1.500,50" inputmode="decimal">
                    <div id="weight-feedback-helper" class="mt-2 text-sm"></div>
                    <p id="quick-losses-weight-converted" class="text-xs text-blue-600 mt-1 font-semibold"></p>
                </div>
                <div>
                    <label class="flex items-center text-sm font-medium text-gray-700">
                        <input type="checkbox" id="quick-losses-use-tare" class="mr-2 w-4 h-4 text-orange-600 rounded border-gray-300 focus:ring-orange-500">
                        Usar tara da caixa plástica
                    </label>
                    <div id="quick-losses-tare-info" class="hidden text-sm text-orange-700 bg-gradient-to-br from-orange-50 to-orange-100 p-3 rounded-xl border border-orange-200 mt-2">
                        Tara da caixa: <span id="quick-losses-tare-weight">-</span>g
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Perda</label>
                    <select id="quick-losses-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                        <option value="">Selecione o motivo...</option>
                        <optgroup label="PROCESSO">
                            <option value="BOLHA">BOLHA</option>
                            <option value="CHUPAGEM">CHUPAGEM</option>
                            <option value="CONTAMINA¡ÇO">CONTAMINA¡ÇO</option>
                            <option value="DEGRADA¡ÇO">DEGRADA¡ÇO</option>
                            <option value="EMPENAMENTO">EMPENAMENTO</option>
                            <option value="FALHA">FALHA</option>
                            <option value="FIAPO">FIAPO</option>
                            <option value="FORA DE COR">FORA DE COR</option>
                            <option value="INCIO/RENICIO">INCIO/RENCIO</option>
                            <option value="JUN¡ÇO">JUN¡ÇO</option>
                            <option value="MANCHAS">MANCHAS</option>
                            <option value="MEDIDA FORA DO ESPECIFICADO">MEDIDA FORA DO ESPECIFICADO</option>
                            <option value="MODO">MODO</option>
                            <option value="PE¡AS PERDIDAS">PE¡AS PERDIDAS</option>
                            <option value="QUEIMA">QUEIMA</option>
                            <option value="REBARBA">REBARBA</option>
                        </optgroup>
                        <optgroup label="FERRAMENTARIA">
                            <option value="DEFORMA¡ÇO">DEFORMA¡ÇO</option>
                            <option value="GALHO PRESO">GALHO PRESO</option>
                            <option value="MARCA D'GUA">MARCA D'GUA</option>
                            <option value="MARCA EXTRATOR">MARCA EXTRATOR</option>
                            <option value="RISCOS">RISCOS</option>
                            <option value="SUJIDADE">SUJIDADE</option>
                        </optgroup>
                        <optgroup label="QUALIDADE">
                            <option value="INSPE¡ÇO DE LINHA">INSPE¡ÇO DE LINHA</option>
                        </optgroup>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="quick-losses-obs" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Observações sobre a perda"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="quick-losses-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="button" id="quick-losses-delete-btn" class="hidden py-2.5 px-4 border border-red-200 text-red-600 rounded-xl hover:bg-red-50 font-medium text-sm transition-colors">
                        Excluir
                    </button>
                    <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Registrar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Parada -->
    <div id="quick-downtime-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-red-100 to-red-200 rounded-xl">
                        <i data-lucide="pause-circle" class="w-5 h-5 text-red-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800" id="downtime-modal-title">Informar Motivo da Parada</h3>
                </div>
                <button id="quick-downtime-close" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="quick-downtime-form" class="space-y-4">
                <div class="bg-gradient-to-br from-yellow-50 to-amber-50 border border-yellow-200 rounded-xl p-3 mb-4">
                    <p class="text-sm text-yellow-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Selecione o motivo da parada que acabou de finalizar.
                    </p>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Parada</label>
                    <select id="quick-downtime-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" required>
                        <option value="">Selecione o motivo...</option>
                        <optgroup label="FERRAMENTARIA">
                            <option value="CORRETIVA DE MOLDE">CORRETIVA DE MOLDE</option>
                            <option value="PREVENTIVA DE MOLDE">PREVENTIVA DE MOLDE</option>
                            <option value="TROCA DE VERSÇO">TROCA DE VERSÇO</option>
                        </optgroup>
                        <optgroup label="PROCESSO">
                            <option value="ABERTURA DE CAVIDADE">ABERTURA DE CAVIDADE</option>
                            <option value="AJUSTE DE PROCESSO">AJUSTE DE PROCESSO</option>
                            <option value="TRY OUT">TRY OUT</option>
                        </optgroup>
                        <optgroup label="COMPRAS">
                            <option value="FALTA DE INSUMO PLANEJADA">FALTA DE INSUMO PLANEJADA</option>
                            <option value="FALTA DE INSUMO NÇO PLANEJADA">FALTA DE INSUMO NÇO PLANEJADA</option>
                        </optgroup>
                        <optgroup label="PREPARA¡ÇO">
                            <option value="AGUARDANDO PREPARA¡ÇO DE MATERIAL">AGUARDANDO PREPARA¡ÇO DE MATERIAL</option>
                        </optgroup>
                        <optgroup label="QUALIDADE">
                            <option value="AGUARDANDO CLIENTE/FORNECEDOR">AGUARDANDO CLIENTE/FORNECEDOR</option>
                            <option value="LIBERA¡ÇO">LIBERA¡ÇO</option>
                        </optgroup>
                        <optgroup label="MANUTEN¡ÇO">
                            <option value="MANUTEN¡ÇO CORRETIVA">MANUTEN¡ÇO CORRETIVA</option>
                            <option value="MANUTEN¡ÇO PREVENTIVA">MANUTEN¡ÇO PREVENTIVA</option>
                        </optgroup>
                        <optgroup label="PRODU¡ÇO">
                            <option value="FALTA DE OPERADOR">FALTA DE OPERADOR</option>
                            <option value="TROCA DE COR">TROCA DE COR</option>
                        </optgroup>
                        <optgroup label="SETUP">
                            <option value="INSTALA¡ÇO DE MOLDE">INSTALA¡ÇO DE MOLDE</option>
                            <option value="RETIRADA DE MOLDE">RETIRADA DE MOLDE</option>
                        </optgroup>
                        <optgroup label="ADMINISTRATIVO">
                            <option value="FALTA DE ENERGIA">FALTA DE ENERGIA</option>
                        </optgroup>
                        <optgroup label="PCP">
                            <option value="SEM PROGRAMA¡ÇO">SEM PROGRAMA¡ÇO</option>
                        </optgroup>
                        <optgroup label="COMERCIAL">
                            <option value="SEM PEDIDO">SEM PEDIDO</option>
                        </optgroup>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="quick-downtime-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" placeholder="Observações sobre a parada"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="quick-downtime-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all" id="downtime-action-btn">
                        Registrar e Retomar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Lançamento Manual de Produção -->
    <div id="manual-production-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl">
                        <i data-lucide="history" class="w-5 h-5 text-blue-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Lançamento Manual de Produção</h3>
                </div>
                <button id="manual-production-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="manual-production-form" class="space-y-4">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-3">
                    <p class="text-sm text-blue-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Utilize este formulário para registrar produções anteriores ou corrigir apontamentos.
                    </p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="manual-production-date" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data da Produção</label>
                        <input type="date" id="manual-production-date" name="date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required>
                    </div>
                    <div>
                        <label for="manual-production-hour" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Horário (opcional)</label>
                        <input type="time" id="manual-production-hour" name="hour" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="manual-production-shift" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                        <select id="manual-production-shift" name="shift" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            <option value="1">1º Turno</option>
                            <option value="2">2º Turno</option>
                            <option value="3">3º Turno</option>
                        </select>
                    </div>
                    <div>
                        <label for="manual-production-qty" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Qtd Produzida</label>
                        <input type="number" id="manual-production-qty" name="quantity" min="1" step="1" inputmode="numeric" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Peças produzidas" onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                    </div>
                </div>
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-3">
                    <p class="text-sm text-blue-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Informe <strong>quantidade OU peso</strong> - apenas um dos campos  necessário.
                    </p>
                </div>
                <div>
                    <label for="manual-production-weight" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Peso (kg) <span class="text-gray-400 normal-case">(opcional)</span></label>
                    <input type="number" step="0.01" id="manual-production-weight" name="weight" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Peso bruto em kg">
                </div>
                <div>
                    <label class="flex items-center text-sm font-medium text-gray-700">
                        <input type="checkbox" id="manual-production-use-tare" class="mr-2 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                        Usar tara da caixa plástica
                    </label>
                    <div id="manual-production-tare-info" class="hidden text-sm text-blue-700 bg-gradient-to-br from-blue-50 to-blue-100 p-3 rounded-xl border border-blue-200 mt-2">
                        Tara da caixa: <span id="manual-production-tare-weight">-</span>g
                    </div>
                </div>
                <div>
                    <label for="manual-production-obs" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="manual-production-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Detalhes adicionais (opcional)"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="manual-production-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">Cancelar</button>
                    <button type="submit" id="manual-production-submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">Registrar Produção</button>
                </div>
            </form>
        </div>
    </div>

        <!-- Modal de Lançamento Manual de Perdas -->
        <div id="manual-losses-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
            <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
                <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-gradient-to-br from-orange-100 to-orange-200 rounded-xl">
                            <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-600"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-800">Lançamento Manual de Perdas</h3>
                    </div>
                    <button id="manual-losses-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                    </button>
                </div>
                <!-- Contexto Máquina/Produto -->
                <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                    <div class="flex items-center justify-between gap-3">
                        <span>Máquina: <b class="context-machine">-</b></span>
                        <span>Produto: <b class="context-product">-</b></span>
                    </div>
                </div>
                <form id="manual-losses-form" class="space-y-4">
                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-xl p-3">
                        <p class="text-sm text-orange-800">
                            <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                            Informe pelo menos a quantidade de peças perdidas OU o peso em borras (kg). Não  necessário preencher ambos os campos.
                        </p>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div>
                            <label for="manual-losses-date" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data da Perda</label>
                            <input type="date" id="manual-losses-date" name="date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                        </div>
                        <div>
                            <label for="manual-losses-hour" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Horário (opcional)</label>
                            <input type="time" id="manual-losses-hour" name="hour" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div>
                            <label for="manual-losses-shift" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                            <select id="manual-losses-shift" name="shift" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all">
                                <option value="1">1º Turno</option>
                                <option value="2">2º Turno</option>
                                <option value="3">3º Turno</option>
                            </select>
                        </div>
                        <div>
                            <label for="manual-losses-qty" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Qtd Perdida (peças)</label>
                            <input type="number" id="manual-losses-qty" name="quantity" min="0" step="1" inputmode="numeric" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Peças refugadas" onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                        </div>
                    </div>
                    <div>
                        <label for="manual-losses-weight" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Borras / Peso Perdido (kg)</label>
                        <input type="number" step="0.01" id="manual-losses-weight" name="weight" min="0" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Peso total em kg">
                    </div>
                    <div>
                        <label for="manual-losses-reason" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Perda</label>
                        <select id="manual-losses-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                            <option value="">Selecione o motivo...</option>
                            <optgroup label="PROCESSO">
                                <option value="BOLHA">BOLHA</option>
                                <option value="CHUPAGEM">CHUPAGEM</option>
                                <option value="CONTAMINA¡ÇO">CONTAMINA¡ÇO</option>
                                <option value="DEGRADA¡ÇO">DEGRADA¡ÇO</option>
                                <option value="EMPENAMENTO">EMPENAMENTO</option>
                                <option value="FALHA">FALHA</option>
                                <option value="FIAPO">FIAPO</option>
                                <option value="FORA DE COR">FORA DE COR</option>
                                <option value="INCIO/RENICIO">INCIO/RENCIO</option>
                                <option value="JUN¡ÇO">JUN¡ÇO</option>
                                <option value="MANCHAS">MANCHAS</option>
                                <option value="MEDIDA FORA DO ESPECIFICADO">MEDIDA FORA DO ESPECIFICADO</option>
                                <option value="MODO">MODO</option>
                                <option value="PE¡AS PERDIDAS">PE¡AS PERDIDAS</option>
                                <option value="QUEIMA">QUEIMA</option>
                                <option value="REBARBA">REBARBA</option>
                            </optgroup>
                            <optgroup label="FERRAMENTARIA">
                                <option value="DEFORMA¡ÇO">DEFORMA¡ÇO</option>
                                <option value="GALHO PRESO">GALHO PRESO</option>
                                <option value="MARCA D'GUA">MARCA D'GUA</option>
                                <option value="MARCA EXTRATOR">MARCA EXTRATOR</option>
                                <option value="RISCOS">RISCOS</option>
                                <option value="SUJIDADE">SUJIDADE</option>
                            </optgroup>
                            <optgroup label="QUALIDADE">
                                <option value="INSPE¡ÇO DE LINHA">INSPE¡ÇO DE LINHA</option>
                            </optgroup>
                        </select>
                    </div>
                    <div>
                        <label for="manual-losses-obs" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                        <textarea id="manual-losses-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Detalhes adicionais (opcional)"></textarea>
                    </div>
                    <div>
                    <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                        <button type="button" id="manual-losses-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">Cancelar</button>
                        <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">Registrar Perda</button>
                    </div>
                </form>
            </div>
        </div>

    <!-- Modal de Lançamento de Borra -->
    <div id="manual-borra-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-yellow-100 to-amber-200 rounded-xl">
                        <i data-lucide="zap" class="w-5 h-5 text-yellow-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Registrar Borra de Produção</h3>
                </div>
                <button id="manual-borra-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="manual-borra-form" class="space-y-4">
                <div class="bg-gradient-to-br from-yellow-50 to-amber-50 border border-yellow-200 rounded-xl p-3">
                    <p class="text-sm text-yellow-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Registre a borra gerada durante o processo de Produção. Este material será contabilizado nas perdas.
                    </p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="manual-borra-date" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data da Geração</label>
                        <input type="date" id="manual-borra-date" name="date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" required>
                    </div>
                    <div>
                        <label for="manual-borra-hour" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Horário (opcional)</label>
                        <input type="time" id="manual-borra-hour" name="hour" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all">
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="manual-borra-shift" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                        <select id="manual-borra-shift" name="shift" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all">
                            <option value="1">1º Turno</option>
                            <option value="2">2º Turno</option>
                            <option value="3">3º Turno</option>
                        </select>
                    </div>
                    <div>
                        <label for="manual-borra-machine" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                        <select id="manual-borra-machine" name="machine" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" required>
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label for="manual-borra-weight" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Peso da Borra (kg) *</label>
                    <input type="number" step="0.01" id="manual-borra-weight" name="weight" min="0.01" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" placeholder="Peso em kg" required>
                </div>
                <div>
                    <label for="manual-borra-mp-type" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Tipo de Matria-Prima *</label>
                    <select id="manual-borra-mp-type" name="mp_type" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" required>
                        <option value="">Selecione o tipo de MP...</option>
                        <option value="PE-NATURAL">PE-NATURAL</option>
                        <option value="PE-PRETO">PE-PRETO</option>
                        <option value="PE-AZUL">PE-AZUL</option>
                        <option value="PE-VERMELHO">PE-VERMELHO</option>
                        <option value="PE-VERDE">PE-VERDE</option>
                        <option value="PE-AMARELO">PE-AMARELO</option>
                        <option value="PP-NATURAL">PP-NATURAL</option>
                        <option value="PP-PRETO">PP-PRETO</option>
                        <option value="PP-COLORIDO">PP-COLORIDO</option>
                        <option value="ABS-NATURAL">ABS-NATURAL</option>
                        <option value="ABS-PRETO">ABS-PRETO</option>
                        <option value="ABS-COLORIDO">ABS-COLORIDO</option>
                    </select>
                </div>
                <div>
                    <label for="manual-borra-reason" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Geração *</label>
                    <select id="manual-borra-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" required>
                        <option value="">Selecione o motivo...</option>
                    </select>
                </div>
                <div>
                    <label for="manual-borra-obs" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="manual-borra-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" placeholder="Detalhes adicionais sobre a geração da borra (opcional)"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="manual-borra-cancel" class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" id="manual-borra-save" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-yellow-500 to-amber-600 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Registrar Borra
                    </button>
                </div>
                <div id="manual-borra-status" class="text-sm font-semibold h-5 text-center mt-2"></div>
            </form>
        </div>
    </div>

    <!-- Modal de Ajuste de Quantidade da OP -->
    <div id="adjust-quantity-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-yellow-100 to-amber-200 rounded-xl">
                        <i data-lucide="edit-3" class="w-5 h-5 text-yellow-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Ajustar Quantidade da OP</h3>
                </div>
                <button id="adjust-quantity-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <form id="adjust-quantity-form" class="space-y-4">
                <div class="bg-gradient-to-br from-yellow-50 to-amber-50 border border-yellow-200 rounded-xl p-3">
                    <p class="text-sm text-yellow-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Ajuste a quantidade da OP conforme necessário. Use valores positivos para aumentar ou negativos para reduzir. O ajuste será registrado para controle.
                    </p>
                </div>
                
                <!-- Informações da OP -->
                <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-3 space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Ordem de Produção:</span>
                        <span id="adjust-op-number" class="text-sm font-bold text-gray-800">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Produto:</span>
                        <span id="adjust-op-product" class="text-sm text-gray-800">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Quantidade Original:</span>
                        <span id="adjust-op-original-qty" class="text-sm font-bold text-blue-600">-</span>
                    </div>
                </div>

                <!-- Ajuste -->
                <div>
                    <label for="adjust-reduction-qty" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                        Valor do Ajuste *
                    </label>
                    <input type="number" 
                           id="adjust-reduction-qty" 
                           name="reduction_qty" 
                           step="1"
                           class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" 
                           placeholder="Ex: +100 ou -50" 
                           required>
                    <div class="mt-1 text-xs text-gray-500">
                        Valor positivo para aumentar, negativo para reduzir (ex: +100, -50)
                    </div>
                </div>

                <!-- Motivo -->
                <div>
                    <label for="adjust-reason" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                        Motivo do Ajuste *
                    </label>
                    <select id="adjust-reason" 
                            name="reason" 
                            class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" 
                            required>
                        <option value="">Selecione o motivo...</option>
                        <option value="AUMENTO_PEDIDO">Aumento de Pedido</option>
                        <option value="REDUCAO_PEDIDO">Redução de Pedido</option>
                        <option value="PERDA_QUALIDADE">Perda por Qualidade</option>
                        <option value="RETRABALHO">Retrabalho Identificado</option>
                        <option value="REFUGO_PROCESSO">Refugo no Processo</option>
                        <option value="AJUSTE_SETUP">Ajuste de Setup</option>
                        <option value="MATERIAL_DEFEITUOSO">Material Defeituoso</option>
                        <option value="ERRO_LANCAMENTO">Erro de Lançamento Anterior</option>
                        <option value="CORRECAO_QUANTIDADE">Correção de Quantidade</option>
                        <option value="OUTROS">Outros</option>
                    </select>
                </div>

                <!-- Observações -->
                <div>
                    <label for="adjust-observations" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                        Observações
                    </label>
                    <textarea id="adjust-observations" 
                              name="observations" 
                              rows="2" 
                              class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" 
                              placeholder="Detalhes adicionais sobre o ajuste (opcional)"></textarea>
                </div>

                <!-- Visualização do Ajuste -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-medium text-blue-700">Nova Quantidade:</span>
                        <span id="adjust-final-qty" class="text-lg font-bold text-blue-800">-</span>
                    </div>
                    <div class="mt-1 text-xs text-blue-600">
                        Quantidade após aplicar o ajuste
                    </div>
                </div>

                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="adjust-quantity-cancel" class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" id="adjust-quantity-save" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-yellow-500 to-amber-600 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Aplicar Ajuste
                    </button>
                </div>
                <div id="adjust-quantity-status" class="text-sm font-semibold h-5 text-center mt-2"></div>
            </form>
        </div>
    </div>

    <!-- Modal: Extended Downtime (Paradas Longas) -->
    <!-- Modal de Lançamento Manual de Parada Passada -->
    <div id="manual-downtime-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-orange-100 to-orange-200 rounded-xl">
                        <i data-lucide="clock" class="w-5 h-5 text-orange-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Lançamento Manual de Parada</h3>
                </div>
                <button id="manual-downtime-close" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="manual-downtime-form" class="space-y-4">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-3 mb-4">
                    <p class="text-sm text-blue-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Use este formulário para registrar Paradas que não foram apontadas no momento.
                    </p>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data de Início</label>
                        <input type="date" id="manual-downtime-date-start" name="dateStart" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data de Fim</label>
                        <input type="date" id="manual-downtime-date-end" name="dateEnd" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Horário de Início</label>
                        <input type="time" id="manual-downtime-start" name="startTime" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Horário de Fim</label>
                        <input type="time" id="manual-downtime-end" name="endTime" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Parada</label>
                    <select id="manual-downtime-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                        <option value="">Selecione o motivo...</option>
                        <optgroup label="FERRAMENTARIA">
                            <option value="CORRETIVA DE MOLDE">CORRETIVA DE MOLDE</option>
                            <option value="PREVENTIVA DE MOLDE">PREVENTIVA DE MOLDE</option>
                            <option value="TROCA DE VERSÇO">TROCA DE VERSÇO</option>
                        </optgroup>
                        <optgroup label="PROCESSO">
                            <option value="ABERTURA DE CAVIDADE">ABERTURA DE CAVIDADE</option>
                            <option value="AJUSTE DE PROCESSO">AJUSTE DE PROCESSO</option>
                            <option value="TRY OUT">TRY OUT</option>
                        </optgroup>
                        <optgroup label="COMPRAS">
                            <option value="FALTA DE INSUMO PLANEJADA">FALTA DE INSUMO PLANEJADA</option>
                            <option value="FALTA DE INSUMO NÇO PLANEJADA">FALTA DE INSUMO NÇO PLANEJADA</option>
                        </optgroup>
                        <optgroup label="PREPARA¡ÇO">
                            <option value="AGUARDANDO PREPARA¡ÇO DE MATERIAL">AGUARDANDO PREPARA¡ÇO DE MATERIAL</option>
                        </optgroup>
                        <optgroup label="QUALIDADE">
                            <option value="AGUARDANDO CLIENTE/FORNECEDOR">AGUARDANDO CLIENTE/FORNECEDOR</option>
                            <option value="LIBERA¡ÇO">LIBERA¡ÇO</option>
                        </optgroup>
                        <optgroup label="MANUTEN¡ÇO">
                            <option value="MANUTEN¡ÇO CORRETIVA">MANUTEN¡ÇO CORRETIVA</option>
                            <option value="MANUTEN¡ÇO PREVENTIVA">MANUTEN¡ÇO PREVENTIVA</option>
                        </optgroup>
                        <optgroup label="PRODU¡ÇO">
                            <option value="FALTA DE OPERADOR">FALTA DE OPERADOR</option>
                            <option value="TROCA DE COR">TROCA DE COR</option>
                        </optgroup>
                        <optgroup label="SETUP">
                            <option value="INSTALA¡ÇO DE MOLDE">INSTALA¡ÇO DE MOLDE</option>
                            <option value="RETIRADA DE MOLDE">RETIRADA DE MOLDE</option>
                        </optgroup>
                        <optgroup label="ADMINISTRATIVO">
                            <option value="FALTA DE ENERGIA">FALTA DE ENERGIA</option>
                        </optgroup>
                        <optgroup label="PCP">
                            <option value="SEM PROGRAMA¡ÇO">SEM PROGRAMA¡ÇO</option>
                        </optgroup>
                        <optgroup label="COMERCIAL">
                            <option value="SEM PEDIDO">SEM PEDIDO</option>
                        </optgroup>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="manual-downtime-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Observações sobre a parada"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="manual-downtime-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Registrar Parada
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
         <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-sm m-4 text-center border border-gray-100">
             <div class="flex justify-center mb-4">
                 <div class="p-3 bg-gradient-to-br from-red-100 to-red-200 rounded-2xl">
                     <i data-lucide="alert-triangle" class="w-8 h-8 text-red-600"></i>
                 </div>
             </div>
             <h3 class="text-lg font-semibold text-gray-800">Confirmar Exclusão</h3>
             <p id="confirm-modal-text" class="text-sm text-gray-500 my-3">Tem a certeza de que deseja excluir este item? Esta ação não pode ser desfeita.</p>
             <div class="mt-6 flex justify-center gap-3">
                 <button id="confirm-modal-cancel-btn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2.5 px-4 rounded-xl text-sm transition-colors">Cancelar</button>
                 <button id="confirm-modal-ok-btn" class="bg-gradient-to-r from-red-600 to-red-700 hover:shadow-lg text-white font-semibold py-2.5 px-4 rounded-xl text-sm shadow-md transition-all">Excluir</button>
             </div>
         </div>
    </div>

    <!-- Modal de Retrabalho -->
    <div id="quick-rework-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl">
                        <i data-lucide="wrench" class="w-5 h-5 text-purple-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Registrar Retrabalho</h3>
                </div>
                <button id="quick-rework-close" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="quick-rework-form" class="space-y-4">
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-xl p-3 mb-4">
                    <p class="text-sm text-purple-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Registre peças que necessitaram de retrabalho/reprocessamento.
                    </p>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Quantidade de Peças para Retrabalho</label>
                    <input type="number" id="quick-rework-qty" name="quantity" min="1" step="1" inputmode="numeric" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" placeholder="Número de peças" required onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Peso (kg, opcional)</label>
                    <input type="number" step="0.01" id="quick-rework-weight" name="weight" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" placeholder="Peso em kg">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo do Retrabalho</label>
                    <select id="quick-rework-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" required>
                        <option value="">Selecione o motivo...</option>
                        <optgroup label="PROCESSO">
                            <option value="BOLHA">BOLHA</option>
                            <option value="CHUPAGEM">CHUPAGEM</option>
                            <option value="CONTAMINA¡ÇO">CONTAMINA¡ÇO</option>
                            <option value="DEGRADA¡ÇO">DEGRADA¡ÇO</option>
                            <option value="EMPENAMENTO">EMPENAMENTO</option>
                            <option value="FALHA">FALHA</option>
                            <option value="FIAPO">FIAPO</option>
                            <option value="FORA DE COR">FORA DE COR</option>
                            <option value="INCIO/RENICIO">INCIO/RENCIO</option>
                            <option value="JUN¡ÇO">JUN¡ÇO</option>
                            <option value="MANCHAS">MANCHAS</option>
                            <option value="MEDIDA FORA DO ESPECIFICADO">MEDIDA FORA DO ESPECIFICADO</option>
                            <option value="MODO">MODO</option>
                            <option value="PE¡AS PERDIDAS">PE¡AS PERDIDAS</option>
                            <option value="QUEIMA">QUEIMA</option>
                            <option value="REBARBA">REBARBA</option>
                        </optgroup>
                        <optgroup label="FERRAMENTARIA">
                            <option value="DEFORMA¡ÇO">DEFORMA¡ÇO</option>
                            <option value="GALHO PRESO">GALHO PRESO</option>
                            <option value="MARCA D'GUA">MARCA D'GUA</option>
                            <option value="MARCA EXTRATOR">MARCA EXTRATOR</option>
                            <option value="RISCOS">RISCOS</option>
                            <option value="SUJIDADE">SUJIDADE</option>
                        </optgroup>
                        <optgroup label="QUALIDADE">
                            <option value="INSPE¡ÇO DE LINHA">INSPE¡ÇO DE LINHA</option>
                        </optgroup>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="quick-rework-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" placeholder="Detalhes do retrabalho (opcional)"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="quick-rework-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Registrar Retrabalho
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="materia-prima-database.js"></script>
    <script src="database.js"></script>
    <script src="traceability-system.js"></script>
    <script src="predictive-analytics.js"></script>
    <script src="advanced-kpis.js"></script>
    <script src="auto-pareto-analysis.js"></script>
    <script src="spc-controller.js"></script>
    <script src="analytics-ia-core.js"></script>
    <script src="script.js?v=20251201-fix2"></script>
    <script src="reports-module.js?v=20251201-v5"></script>
    
    <!-- Script de inicialização -->
    <script>
    (function() {
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[INIT] Sistema carregado!');
        });
    })();
    </script>
</body>
</html>
