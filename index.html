<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0">
    <meta name="apple-mobile-web-app-capable" content="true">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Syncrho MES v2.0 - Industry 4.0 Manufacturing Execution System</title>
    <link rel="icon" href="https://i.postimg.cc/6p0zczpL/Gemini_Generated_Image_d13fecd13fecd13f.png" type="image/png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="auth.js"></script>
        <script>
            // Registro do Service Worker para Web Push
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('service-worker.js').then(function(reg) {
                        console.log('Service Worker registrado!', reg);
                    }).catch(function(err) {
                        console.warn('Erro ao registrar Service Worker:', err);
                    });
                });
            }

            // Solicitar permissão para notificações
            function solicitarPermissaoNotificacoes() {
                if ('Notification' in window && Notification.permission !== 'granted') {
                    Notification.requestPermission().then(function(permission) {
                        if (permission === 'granted') {
                            alert('Permissão para notificações concedida!');
                        }
                    });
                }
            }
            // Chame esta função após login do gestor ou em um botão/configuração
        </script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'primary-blue': '#0077C2',
              'text-dark': '#1F2937',
              'background-light': '#F9FAFB',
              'accent-1': '#4F46E5',
              'accent-2': '#10B981',
              'status-success': '#16A34A',
              'status-warning': '#F59E0B',
              'status-error': '#DC2626',
            }
          }
        }
      }
    </script>
    <style>
      /* Padrão de grid para header moderno */
      .bg-grid-pattern {
        background-image: 
          linear-gradient(rgba(255,255,255,.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255,255,255,.03) 1px, transparent 1px);
        background-size: 32px 32px;
      }
      
      /* CSS customizado para gráficos responsivos */
      .chart-container {
        position: relative;
        width: 100%;
      }
      
      .chart-container canvas {
        max-width: 100% !important;
      }
      
      canvas {
        box-sizing: border-box;
      }
      
      /* MOBILE — regras pontuais que NÃO conflitam com style.css */
      @media (max-width: 767px) {
        /* Grid 13 colunas - scroll horizontal (lançamento por hora) */
        .grid-cols-13 {
          display: block !important;
          overflow-x: auto !important;
          white-space: nowrap !important;
        }
        .grid-cols-13 > div {
          display: inline-block !important;
          min-width: 60px !important;
          white-space: normal !important;
        }
        #hourly-entries-container {
          max-height: 200px !important;
        }
        /* Tabelas scrolláveis */
        table {
          display: block;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }
      }
      
      /* Modais em mobile */
      @media (max-width: 640px) {
        .w-full.max-w-lg,
        .w-full.max-w-md,
        .w-full.max-w-sm {
          max-width: 98vw !important;
          margin: 0 auto !important;
        }
        .bg-white.rounded-lg.shadow-xl.p-6,
        .bg-white.rounded-xl.shadow-2xl.p-6 {
          padding: 0.75rem !important;
        }
        button.w-full {
          min-height: 48px;
        }
      }
      
      /* Landscape mode em mobile */
      @media (max-width: 896px) and (orientation: landscape) {
        header {
          padding-top: 0.125rem !important;
          padding-bottom: 0.125rem !important;
          min-height: 40px !important;
        }
      }
      
      /* Prevenir zoom automático de inputs em iOS */
      input[type="text"],
      input[type="email"],
      input[type="number"],
      input[type="date"],
      input[type="tel"],
      select,
      textarea {
        font-size: 16px;
      }
      
      /* Timeline de progresso com animações suaves */
      .timeline-progress {
        animation: progressFill 1.5s ease-out;
      }

            .timeline-progress-bar {
                background: linear-gradient(90deg, #ef4444, #f87171);
                box-shadow: 0 6px 18px rgba(239, 68, 68, 0.25);
            }

            .timeline-progress.timeline-complete {
                animation: timelineCompleteBlink 1.2s ease-in-out infinite;
            }

            @keyframes timelineCompleteBlink {
                0%, 100% {
                    opacity: 1;
                    box-shadow: 0 6px 24px rgba(16, 185, 129, 0.45);
                }
                50% {
                    opacity: 0.6;
                    box-shadow: 0 4px 14px rgba(16, 185, 129, 0.25);
                }
            }
      
      @keyframes progressFill {
        from { width: 0%; }
        to { width: var(--progress-width); }
      }
      
      /* Melhoria visual para indicadores de status */
      .status-indicator {
        transition: all 0.3s ease;
      }
      
      .status-indicator.pulsing {
        animation: pulse 2s infinite;
      }
    </style>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS (XLSX) para importação/exportação de Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- html2pdf.js para exportação de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase App (a versão principal do SDK) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- Firebase Storage -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
</head>
<body class="bg-background-light text-text-dark antialiased">
    <!-- Overlay para sidebar mobile -->
    <div id="sidebar-overlay" class="sidebar-overlay hidden md:hidden" aria-hidden="true"></div>
    
    <!-- Modal de Edição de Ordem -->
    <div id="edit-order-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-lg relative border border-gray-100">
            <button id="close-edit-order-modal" class="absolute top-4 right-4 p-1.5 text-gray-400 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">&times;</button>
            <div class="flex items-center gap-3 mb-6">
                <div class="p-2 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl">
                    <i data-lucide="edit-3" class="w-5 h-5 text-blue-600"></i>
                </div>
                <h2 class="text-lg font-semibold text-gray-800">Editar Ordem de Produção</h2>
            </div>
            <form id="edit-order-form" class="space-y-4">
                <input type="hidden" id="edit-order-id">
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Produto</label>
                    <select id="edit-order-product" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required></select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                    <select id="edit-order-machine" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required></select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Cliente</label>
                    <input type="text" id="edit-order-customer" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Lote</label>
                    <input type="text" id="edit-order-lot" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Qtd Planejada</label>
                        <input type="number" id="edit-order-planned" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" min="0">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Qtd Executada</label>
                        <input type="number" id="edit-order-executed" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" min="0">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Matéria-prima (MP)</label>
                    <select id="edit-order-mp" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required>
                        <option value="">Selecione a matéria-prima...</option>
                    </select>
                </div>
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-100">
                    <button type="button" id="cancel-edit-order" class="px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">Cancelar</button>
                    <button type="submit" class="px-4 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <div class="flex flex-1 min-h-screen bg-background-light">
        <!-- Sidebar de Navegação -->
    <aside id="sidebar" class="w-64 bg-white flex flex-col no-print border-r border-gray-200 fixed inset-y-0 left-0 z-40 transform -translate-x-full transition-transform duration-300 md:relative md:z-30 md:translate-x-0 md:flex md:w-64 sidebar-expanded" data-state="expanded" aria-hidden="true">
            <div class="h-16 flex items-center justify-center border-b border-gray-200 px-4 relative">
                <img id="sidebar-logo" src="https://i.postimg.cc/6p0zczpL/Gemini_Generated_Image_d13fecd13fecd13f.png" alt="Logo Hokkaido Plastics" class="h-10 transition-all duration-300">
                <!-- Botão toggle para desktop -->
                <button id="sidebar-toggle-btn" class="absolute -right-12 top-6 p-2 bg-white border border-gray-200 rounded-r-lg hover:bg-gray-100 block transition-colors" title="Retrair/Expandir menu">
                    <i data-lucide="chevron-left" class="w-5 h-5 text-gray-600"></i>
                </button>
                <!-- Botão close para mobile -->
                <button id="sidebar-close-btn" class="absolute top-1/2 -translate-y-1/2 right-4 p-2 md:hidden">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
                <a href="#" class="nav-btn group" data-page="planejamento" title="Planejamento">
                    <i data-lucide="clipboard-list" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Planejamento</span>
                    <span class="nav-tooltip">Planejamento</span>
                </a>
                <a href="#" class="nav-btn group" data-page="ordens" title="Ordens">
                    <i data-lucide="package-check" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Ordens</span>
                    <span class="nav-tooltip">Ordens</span>
                </a>
                <a href="#" class="nav-btn active group" data-page="lancamento" title="Lançamento">
                    <i data-lucide="keyboard" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Lançamento</span>
                    <span class="nav-tooltip">Lançamento</span>
                </a>
                <a href="#" class="nav-btn group" data-page="analise" title="Análise">
                    <i data-lucide="area-chart" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Análise</span>
                    <span class="nav-tooltip">Análise</span>
                </a>
                <a href="#" class="nav-btn group" data-page="pmp" title="PMP - Gestão de Materiais">
                    <i data-lucide="recycle" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">PMP</span>
                    <span class="nav-tooltip">PMP</span>
                </a>
                <!-- Aba Relatórios removida - Otimização 02/12/2025 -->
                <!-- Aba Paradas Longas removida - Unificação 02/2026 -->
                <a href="#" class="nav-btn group" data-page="acompanhamento" title="Acompanhamento de Turno">
                    <i data-lucide="clipboard-check" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Acompanhamento</span>
                    <span class="nav-tooltip">Acompanhamento</span>
                </a>
                <a href="#" class="nav-btn group" data-page="historico-sistema" title="Histórico do Sistema">
                    <i data-lucide="history" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Histórico</span>
                    <span class="nav-tooltip">Histórico</span>
                </a>
                <a href="#" class="nav-btn group" data-page="relatorios" title="Relatórios e Análises">
                    <i data-lucide="file-bar-chart" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Relatórios</span>
                    <span class="nav-tooltip">Relatórios</span>
                </a>
                <a href="#" class="nav-btn group" data-page="admin-dados" title="Administração de Dados">
                    <i data-lucide="database" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Admin Dados</span>
                    <span class="nav-tooltip">Admin Dados</span>
                </a>
                <a href="#" class="nav-btn group" data-page="lideranca-producao" title="Liderança Produção">
                    <i data-lucide="users" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Liderança</span>
                    <span class="nav-tooltip">Liderança Produção</span>
                </a>
                <a href="#" class="nav-btn group" data-page="setup-maquinas" title="Setup de Máquinas">
                    <i data-lucide="wrench" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Setup</span>
                    <span class="nav-tooltip">Setup de Máquinas</span>
                </a>
                <a href="#" class="nav-btn group" data-page="ferramentaria" title="Ferramentaria">
                    <i data-lucide="settings-2" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">Ferramentaria</span>
                    <span class="nav-tooltip">Controle de Moldes</span>
                </a>
                <a href="#" class="nav-btn group" data-page="pcp" title="PCP - Planejamento e Controle">
                    <i data-lucide="sliders" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text transition-opacity duration-300">PCP</span>
                    <span class="nav-tooltip">PCP - Planejamento e Controle</span>
                </a>
                <a href="dashboard-tv.html" target="_blank" rel="noopener" id="nav-dashboard-tv" class="nav-btn group" title="Dashboard TV">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 flex-shrink-0"><rect width="20" height="15" x="2" y="7" rx="2" ry="2"/><polyline points="17 2 12 7 7 2"/></svg><span class="nav-text transition-opacity duration-300">Dashboard TV</span>
                    <span class="nav-tooltip">Dashboard TV</span>
                </a>
                <!-- Abas Qualidade e Processo removidas - Otimização 02/12/2025 -->

            </nav>
        </aside>

        <!-- Conteúdo Principal -->
    <main class="flex-1 flex flex-col">
            <header class="bg-white/95 backdrop-blur border-b border-gray-200 px-3 lg:px-6 py-2 no-print relative min-h-[56px]">
                <button id="sidebar-open-btn" type="button" class="hamburger-btn md:hidden absolute left-3 top-1/2 -translate-y-1/2" aria-label="Abrir menu" aria-expanded="false">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <!-- Título centralizado absolutamente -->
                <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-center">
                    <h1 id="page-title" class="text-lg sm:text-xl font-semibold text-gray-900 leading-tight">Lançamento</h1>
                    <p class="text-xs font-medium text-gray-500 hidden sm:block">Registro operacional em tempo real</p>
                </div>
                
                <!-- Elementos   direita -->
                <div class="flex items-center justify-end gap-2 sm:gap-3 ml-auto">
                   
                    
                    <!-- Logo Lean -->
                    <img src="https://i.postimg.cc/bNrChs97/Gemini-Generated-Image-hli5dqhli5dqhli5-removebg-preview.png" alt="Lean" class="h-12 w-auto" title="Lean">
                    
                    <!-- Card do Usuário -->
                    <div id="header-user-card" class="flex flex-row items-center gap-2 rounded-lg border border-gray-200 bg-gray-50 px-2 py-1.5 shadow-sm">
                        <div class="flex items-center gap-2">
                            <div id="header-user-avatar" class="flex h-8 w-8 items-center justify-center rounded-full bg-primary-blue/10 text-primary-blue text-xs font-semibold uppercase">LC</div>
                            <div class="flex flex-col leading-tight text-left hidden sm:flex">
                                <div id="header-user-name" class="text-xs font-semibold text-gray-900">Leandro Camargo</div>
                                <span id="header-user-role-chip" class="inline-flex items-center rounded-full bg-blue-100 px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-blue-700 ring-1 ring-blue-200">Gestor</span>
                            </div>
                        </div>
                        <button id="logout-btn" class="inline-flex items-center justify-center gap-1 rounded-full bg-white px-3 py-1 text-xs font-semibold text-red-600 shadow-sm ring-1 ring-red-200 transition hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-400">
                            <i data-lucide="log-out" class="w-3.5 h-3.5"></i>
                            <span class="hidden sm:inline">Sair</span>
                        </button>
                    </div>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-0">
                <!-- PÁGINA: Planejamento -->
                <div id="planejamento-page" class="page-content hidden space-y-1 p-1">
                    
                    <!-- Header Moderno -->
                    <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-700 rounded-lg shadow-md p-2 lg:p-3 text-white">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-1.5">
                            <div>
                                <h1 class="text-base md:text-lg font-bold flex items-center gap-1.5">
                                    <i data-lucide="clipboard-list" class="w-5 h-5 lg:w-6 lg:h-6"></i>
                                    Planejamento de Produção
                                </h1>
                                <p class="text-indigo-100 mt-0.5 text-xs md:text-sm hidden lg:block">Gerencie o planejamento diário de Produção</p>
                            </div>
                            <div class="flex flex-wrap items-center gap-2">
                                <div class="bg-white/10 backdrop-blur-sm rounded-lg px-3 py-1.5 flex items-center gap-2">
                                    <i data-lucide="calendar" class="w-4 h-4"></i>
                                    <input type="date" id="planning-date-selector" name="date" required 
                                        class="bg-transparent border-none text-white placeholder-white/70 focus:outline-none focus:ring-0 text-xs font-medium">
                                </div>
                                <button type="button" id="planning-refresh-btn" onclick="refreshPlanningData()" 
                                    class="bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white px-3 py-1.5 rounded-lg flex items-center gap-1 transition-all text-xs font-medium">
                                    <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i>
                                    <span class="hidden sm:inline">Atualizar</span>
                                </button>
                                <button type="button" onclick="printPlanningReport()" 
                                    class="bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white px-3 py-1.5 rounded-lg flex items-center gap-1 transition-all text-xs font-medium">
                                    <i data-lucide="printer" class="w-3.5 h-3.5"></i>
                                    <span class="hidden sm:inline">Imprimir</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- KPIs do Planejamento -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-2xl shadow-sm border border-indigo-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-indigo-700">Itens Planejados</p>
                                <div class="p-1.5 bg-indigo-200 rounded-lg">
                                    <i data-lucide="list-todo" class="w-3.5 h-3.5 text-indigo-600"></i>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-indigo-600" id="planning-kpi-items">0</p>
                            <p class="text-xs text-indigo-600 opacity-70 mt-1">itens</p>
                        </div>
                        <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-2xl shadow-sm border border-emerald-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-emerald-700">Máquinas Ativas</p>
                                <div class="p-1.5 bg-emerald-200 rounded-lg">
                                    <i data-lucide="cog" class="w-3.5 h-3.5 text-emerald-600"></i>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-emerald-600" id="planning-kpi-machines">0</p>
                            <p class="text-xs text-emerald-600 opacity-70 mt-1">máquinas</p>
                        </div>
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-blue-700">Produção Total</p>
                                <div class="p-1.5 bg-blue-200 rounded-lg">
                                    <i data-lucide="package" class="w-3.5 h-3.5 text-blue-600"></i>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-blue-600" id="planning-kpi-produced">0</p>
                            <p class="text-xs text-blue-600 opacity-70 mt-1">peças</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl shadow-sm border border-purple-200 p-4 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-purple-700">Produtos Únicos</p>
                                <div class="p-1.5 bg-purple-200 rounded-lg">
                                    <i data-lucide="boxes" class="w-3.5 h-3.5 text-purple-600"></i>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-purple-600" id="planning-kpi-products">0</p>
                            <p class="text-xs text-purple-600 opacity-70 mt-1">produtos</p>
                        </div>
                    </div>

                    <!-- Layout em duas colunas: Formulário compacto + Painel de Lançamento -->
                    <div class="grid grid-cols-1 xl:grid-cols-3 gap-3">
                        
                        <!-- Coluna 1: Formulário de Planejamento Reestruturado -->
                        <div class="xl:col-span-1">
                            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                                <div class="bg-gradient-to-r from-indigo-500 to-purple-500 px-4 py-3">
                                    <h2 class="text-lg font-bold text-white flex items-center gap-2">
                                        <i data-lucide="plus-circle" class="w-5 h-5"></i>
                                        Novo Planejamento
                                    </h2>
                                </div>
                                <form id="planning-form" class="p-5 space-y-5">
                                    
                                    <!-- SEÇÃO 1: Dados da Ordem de Produção (do Excel) -->
                                    <div class="border border-blue-200 rounded-lg overflow-visible">
                                        <div class="bg-blue-50 px-3 py-2 border-b border-blue-200 rounded-t-lg">
                                            <h3 class="text-xs font-bold text-blue-700 uppercase tracking-wide flex items-center gap-1.5">
                                                <i data-lucide="file-spreadsheet" class="w-3.5 h-3.5"></i>
                                                Dados da OP (Excel)
                                            </h3>
                                        </div>
                                        <div class="p-3 space-y-3 bg-white rounded-b-lg">
                                            <div class="relative">
                                                <label for="planning-order-search" class="block text-[10px] font-semibold text-gray-500 uppercase mb-1">Buscar Ordem de Produção</label>
                                                <div class="relative">
                                                    <input type="text" id="planning-order-search" name="production_order_search" 
                                                        class="w-full p-2 text-sm border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                                                        placeholder="Digite o número da OP..." autocomplete="off">
                                                    <div id="planning-order-search-loading" class="hidden absolute right-3 top-1/2 -translate-y-1/2">
                                                        <i data-lucide="loader-2" class="w-4 h-4 text-blue-500 animate-spin"></i>
                                                    </div>
                                                </div>
                                                <input type="hidden" id="planning-order-select" name="production_order_id">
                                                <div id="planning-order-results" class="hidden absolute left-0 right-0 mt-1 max-h-48 overflow-y-auto border border-gray-200 rounded-lg shadow-lg bg-white z-[100]"></div>
                                            </div>
                                            <div id="planning-order-info" class="p-2.5 bg-blue-50 border border-blue-100 rounded-lg text-xs" style="display: none;">
                                                <div class="grid grid-cols-2 gap-2">
                                                    <div>
                                                        <span class="text-blue-500 font-medium">Nº OP:</span>
                                                        <span id="planning-order-number" class="text-blue-800 font-bold ml-1">-</span>
                                                    </div>
                                                    <div>
                                                        <span class="text-blue-500 font-medium">Cliente:</span>
                                                        <span id="planning-order-customer" class="text-blue-800 font-semibold ml-1">-</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label for="planning-lot-size" class="block text-[10px] font-semibold text-gray-500 uppercase mb-1">Tamanho do Lote</label>
                                                    <input type="number" id="planning-lot-size" name="order_lot_size" 
                                                        class="w-full p-2 text-sm border border-gray-200 rounded-lg bg-blue-50/50 text-blue-700 font-semibold text-center" readonly placeholder="Auto">
                                                </div>
                                                <div>
                                                    <label for="planning-machine" class="block text-[10px] font-semibold text-gray-500 uppercase mb-1">Máquina</label>
                                                    <select id="planning-machine" name="machine" required 
                                                        class="w-full p-2 text-sm border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"></select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- SEÇÃO 2: Dados do Produto (do Database) -->
                                    <div class="border border-emerald-200 rounded-lg overflow-hidden">
                                        <div class="bg-emerald-50 px-3 py-2 border-b border-emerald-200">
                                            <h3 class="text-xs font-bold text-emerald-700 uppercase tracking-wide flex items-center gap-1.5">
                                                <i data-lucide="database" class="w-3.5 h-3.5"></i>
                                                Dados do Produto (Cadastro)
                                            </h3>
                                        </div>
                                        <div class="p-3 space-y-3 bg-white">
                                            <div>
                                                <label for="planning-product-cod" class="block text-[10px] font-semibold text-gray-500 uppercase mb-1">Código do Produto</label>
                                                <input type="text" id="planning-product-cod" name="product_cod" required placeholder="Preenchido automaticamente" 
                                                    inputmode="numeric" pattern="[0-9]*" autocomplete="off" list="planning-product-cod-list" 
                                                    class="w-full p-2 text-sm border border-gray-200 rounded-lg bg-emerald-50/50 text-emerald-700 font-semibold text-center" readonly>
                                                <datalist id="planning-product-cod-list"></datalist>
                                            </div>
                                            <div id="product-name-display" class="p-2.5 bg-emerald-50 border border-emerald-100 rounded-lg" style="display: none;">
                                                <p class="text-[10px] text-emerald-500 font-medium uppercase mb-0.5">Nome do Produto</p>
                                                <p id="product-name-text" class="text-xs font-semibold text-emerald-800 leading-tight"></p>
                                            </div>
                                            
                                            <!-- Parâmetros técnicos do produto -->
                                            <div class="grid grid-cols-3 gap-2 pt-1">
                                                <div class="bg-gray-50 rounded-lg p-2 text-center border border-gray-100">
                                                    <label for="budgeted-cycle" class="block text-[9px] text-gray-400 uppercase font-medium">Ciclo (s)</label>
                                                    <input type="number" id="budgeted-cycle" name="budgeted_cycle" required 
                                                        class="w-full text-lg font-bold text-emerald-600 bg-transparent border-0 text-center p-0 focus:ring-0" readonly>
                                                </div>
                                                <div class="bg-gray-50 rounded-lg p-2 text-center border border-gray-100">
                                                    <label for="mold-cavities" class="block text-[9px] text-gray-400 uppercase font-medium">Cavidades</label>
                                                    <input type="number" id="mold-cavities" name="mold_cavities" required 
                                                        class="w-full text-lg font-bold text-emerald-600 bg-transparent border-0 text-center p-0 focus:ring-0" readonly>
                                                </div>
                                                <div class="bg-gray-50 rounded-lg p-2 text-center border border-gray-100">
                                                    <label for="piece-weight" class="block text-[9px] text-gray-400 uppercase font-medium">Peso (g)</label>
                                                    <input type="number" id="piece-weight" name="piece_weight" required step="0.001" 
                                                        class="w-full text-lg font-bold text-emerald-600 bg-transparent border-0 text-center p-0 focus:ring-0" readonly>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- SEÇÃO 3: Matéria-Prima e Quantidade Planejada -->
                                    <div class="border border-amber-200 rounded-lg overflow-hidden">
                                        <div class="bg-amber-50 px-3 py-2 border-b border-amber-200">
                                            <h3 class="text-xs font-bold text-amber-700 uppercase tracking-wide flex items-center gap-1.5">
                                                <i data-lucide="layers" class="w-3.5 h-3.5"></i>
                                                Produção
                                            </h3>
                                        </div>
                                        <div class="p-3 space-y-3 bg-white">
                                            <div>
                                                <label for="planning-mp" class="block text-[10px] font-semibold text-gray-500 uppercase mb-1">Matéria-prima (MP)</label>
                                                <select id="planning-mp" name="mp" required 
                                                    class="w-full p-2 text-sm border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all">
                                                    <option value="">Selecione a MP...</option>
                                                </select>
                                            </div>
                                            <div class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg p-3 border border-amber-100">
                                                <label for="planned-quantity" class="block text-[10px] font-semibold text-amber-600 uppercase mb-1 text-center">
                                                    Quantidade Planejada (85% Eficiência)
                                                </label>
                                                <input type="number" id="planned-quantity" name="planned_quantity" required 
                                                    class="w-full text-2xl font-bold text-amber-700 bg-transparent border-0 text-center p-0 focus:ring-0" readonly>
                                                <p class="text-[9px] text-amber-500 text-center mt-1">Calculado: (86400s ÷ ciclo) × cavidades × 85%</p>
                                            </div>
                                            
                                            <!-- NOVA SEÇÃO: Distribuição por Turno -->
                                            <div id="shift-distribution-section" class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-3 border border-indigo-200 mt-3" style="display: none;">
                                                <div class="flex items-center justify-between mb-2">
                                                    <label class="text-[10px] font-semibold text-indigo-600 uppercase flex items-center gap-1">
                                                        <i data-lucide="clock" class="w-3 h-3"></i>
                                                        Distribuição por Turno
                                                    </label>
                                                    <button type="button" id="customize-shifts-btn" 
                                                        class="text-[9px] bg-indigo-500 hover:bg-indigo-600 text-white px-2 py-0.5 rounded transition-all flex items-center gap-1">
                                                        <i data-lucide="settings-2" class="w-3 h-3"></i>
                                                        Customizar
                                                    </button>
                                                </div>
                                                <div class="grid grid-cols-3 gap-2">
                                                    <div class="bg-blue-100/50 rounded-lg p-2 text-center border border-blue-200">
                                                        <div class="text-[8px] text-blue-500 font-semibold uppercase">T1 (06:30-15:00)</div>
                                                        <div id="shift-t1-qty" class="text-sm font-bold text-blue-700">0</div>
                                                        <div class="text-[8px] text-blue-400">35% (~8.5h)</div>
                                                        <input type="hidden" id="planned-qty-t1" name="planned_qty_t1" value="0">
                                                    </div>
                                                    <div class="bg-amber-100/50 rounded-lg p-2 text-center border border-amber-200">
                                                        <div class="text-[8px] text-amber-500 font-semibold uppercase">T2 (15:00-23:20)</div>
                                                        <div id="shift-t2-qty" class="text-sm font-bold text-amber-700">0</div>
                                                        <div class="text-[8px] text-amber-400">35% (~8.3h)</div>
                                                        <input type="hidden" id="planned-qty-t2" name="planned_qty_t2" value="0">
                                                    </div>
                                                    <div class="bg-purple-100/50 rounded-lg p-2 text-center border border-purple-200">
                                                        <div class="text-[8px] text-purple-500 font-semibold uppercase">T3 (23:20-06:29)</div>
                                                        <div id="shift-t3-qty" class="text-sm font-bold text-purple-700">0</div>
                                                        <div class="text-[8px] text-purple-400">30% (~7.2h)</div>
                                                        <input type="hidden" id="planned-qty-t3" name="planned_qty_t3" value="0">
                                                    </div>
                                                </div>
                                                <!-- Campos ocultos para ciclo/cavidades por turno -->
                                                <input type="hidden" id="cycle-t1" name="cycle_t1" value="">
                                                <input type="hidden" id="cycle-t2" name="cycle_t2" value="">
                                                <input type="hidden" id="cycle-t3" name="cycle_t3" value="">
                                                <input type="hidden" id="cavities-t1" name="cavities_t1" value="">
                                                <input type="hidden" id="cavities-t2" name="cavities_t2" value="">
                                                <input type="hidden" id="cavities-t3" name="cavities_t3" value="">
                                            </div>
                                        </div>
                                    </div>

                                    <button type="submit" id="planning-submit-button" 
                                        class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 transition-all shadow-md hover:shadow-lg">
                                        <i data-lucide="plus-circle" class="w-5 h-5"></i>
                                        <span>Adicionar ao Plano</span>
                                    </button>
                                    <div id="planning-status-message" class="text-sm font-semibold h-5 text-center"></div>
                                </form>
                            </div>
                        </div>

                        <!-- Coluna 2: Painel de Lançamento Ciclo/Cavidades -->
                        <div class="xl:col-span-2">
                            <div class="bg-white rounded-xl shadow-lg overflow-hidden h-full">
                                <div class="bg-gradient-to-r from-emerald-500 to-teal-500 px-5 py-4 flex items-center justify-between">
                                    <h2 class="text-lg font-bold text-white flex items-center gap-2">
                                        <i data-lucide="sliders-horizontal" class="w-5 h-5"></i>
                                        Painel de Lançamento Ciclo/Cavidades
                                    </h2>
                                    <span class="bg-white/20 text-white text-xs font-medium px-3 py-1 rounded-full" id="planning-panel-count">0 itens</span>
                                </div>
                                <div class="p-5">
                                    <div id="leader-launch-panel" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                                    <div id="leader-panel-loading" class="text-center py-16" style="display: none;">
                                        <div class="inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4">
                                            <i data-lucide="loader-2" class="w-8 h-8 animate-spin text-indigo-600"></i>
                                        </div>
                                        <p class="text-gray-500">Carregando planejamento...</p>
                                    </div>
                                    <div id="leader-panel-no-data" class="text-center py-16" style="display: none;">
                                        <div class="inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full mb-4">
                                            <i data-lucide="calendar-x" class="w-8 h-8 text-gray-400"></i>
                                        </div>
                                        <p class="text-gray-500 font-medium">Nenhum item planejado</p>
                                        <p class="text-gray-400 text-sm mt-1">Adicione um planejamento para esta data</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabela de Controle de Ciclo/Cavidade -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-r from-slate-600 to-slate-700 px-5 py-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                            <h2 class="text-lg font-bold text-white flex items-center gap-2">
                                <i data-lucide="list-checks" class="w-5 h-5"></i>
                                Controle de Ciclo/Cavidade por Turno
                            </h2>
                            <div class="flex items-center gap-2">
                                <input type="text" id="planning-table-search" placeholder="Buscar máquina ou produto..." 
                                    class="px-3 py-1.5 text-sm border-0 rounded-lg bg-white/10 text-white placeholder-white/60 focus:ring-2 focus:ring-white/30 focus:bg-white/20 transition-all w-48">
                                <button type="button" onclick="printPlanningTable()" 
                                    class="bg-white/20 hover:bg-white/30 text-white px-3 py-1.5 rounded-lg flex items-center gap-1 transition-all text-sm">
                                    <i data-lucide="printer" class="w-4 h-4"></i>
                                    <span class="hidden sm:inline">Imprimir</span>
                                </button>
                                <button type="button" onclick="exportPlanningTable()" 
                                    class="bg-white/20 hover:bg-white/30 text-white px-3 py-1.5 rounded-lg flex items-center gap-1 transition-all text-sm">
                                    <i data-lucide="download" class="w-4 h-4"></i>
                                    <span class="hidden sm:inline">Exportar</span>
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th rowspan="2" class="px-3 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider align-middle border-b-2 border-gray-200 bg-gray-100">Máq.</th>
                                        <th rowspan="2" class="px-3 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider align-middle border-b-2 border-gray-200 bg-gray-100">Produto</th>
                                        <th rowspan="2" class="px-3 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider align-middle border-b-2 border-gray-200 bg-gray-100">MP</th>
                                        <th colspan="3" class="px-3 py-2 text-center text-xs font-bold text-gray-600 uppercase tracking-wider border-b border-gray-300 bg-gray-100">Planejado</th>
                                        <th colspan="3" class="px-3 py-2 text-center text-xs font-bold text-blue-700 uppercase tracking-wider border-b border-blue-200 bg-blue-50">1º Turno</th>
                                        <th colspan="3" class="px-3 py-2 text-center text-xs font-bold text-amber-700 uppercase tracking-wider border-b border-amber-200 bg-amber-50">2º Turno</th>
                                        <th colspan="3" class="px-3 py-2 text-center text-xs font-bold text-purple-700 uppercase tracking-wider border-b border-purple-200 bg-purple-50">3º Turno</th>
                                        <th rowspan="2" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider align-middle border-b-2 border-gray-200 bg-emerald-50">Total</th>
                                        <th rowspan="2" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider align-middle border-b-2 border-gray-200 bg-gray-100 no-print">Ações</th>
                                    </tr>
                                    <tr>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-gray-500 uppercase border-b border-gray-200 bg-gray-50">Ciclo</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-gray-500 uppercase border-b border-gray-200 bg-gray-50">Cav.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-gray-500 uppercase border-b border-gray-200 bg-gray-50">Peso</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-blue-600 uppercase border-b border-blue-200 bg-blue-50">Ciclo</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-blue-600 uppercase border-b border-blue-200 bg-blue-50">Cav.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-blue-600 uppercase border-b border-blue-200 bg-blue-50">Qtd.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-amber-600 uppercase border-b border-amber-200 bg-amber-50">Ciclo</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-amber-600 uppercase border-b border-amber-200 bg-amber-50">Cav.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-amber-600 uppercase border-b border-amber-200 bg-amber-50">Qtd.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-purple-600 uppercase border-b border-purple-200 bg-purple-50">Ciclo</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-purple-600 uppercase border-b border-purple-200 bg-purple-50">Cav.</th>
                                        <th class="px-2 py-2 text-center text-[10px] font-semibold text-purple-600 uppercase border-b border-purple-200 bg-purple-50">Qtd.</th>
                                    </tr>
                                </thead>
                                <tbody id="planning-table-body" class="divide-y divide-gray-100 bg-white"></tbody>
                            </table>
                        </div>
                        <div id="planning-table-empty" class="text-center py-12 hidden">
                            <div class="inline-flex items-center justify-center w-14 h-14 bg-gray-100 rounded-full mb-3">
                                <i data-lucide="table" class="w-7 h-7 text-gray-400"></i>
                            </div>
                            <p class="text-gray-500">Nenhum dado para exibir na tabela</p>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: Ordens de Produção -->
                <div id="ordens-page" class="page-content hidden space-y-3 p-2">
                    <!-- KPIs de Resumo das Ordens - Reestruturado -->
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-3 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-1">
                                <p class="text-xs font-medium text-blue-700">Total OPs</p>
                                <i data-lucide="layers" class="w-4 h-4 text-blue-500"></i>
                            </div>
                            <p id="orders-kpi-total" class="text-xl font-bold text-blue-600">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl shadow-sm border border-amber-200 p-3 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-1">
                                <p class="text-xs font-medium text-amber-700">Ativas</p>
                                <i data-lucide="play-circle" class="w-4 h-4 text-amber-500"></i>
                            </div>
                            <p id="orders-kpi-active" class="text-xl font-bold text-amber-600">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl shadow-sm border border-orange-200 p-3 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-1">
                                <p class="text-xs font-medium text-orange-700">Suspensas</p>
                                <i data-lucide="pause-circle" class="w-4 h-4 text-orange-500"></i>
                            </div>
                            <p id="orders-kpi-suspended" class="text-xl font-bold text-orange-600">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-2xl shadow-sm border border-emerald-200 p-3 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-1">
                                <p class="text-xs font-medium text-emerald-700">Concluídas</p>
                                <i data-lucide="check-circle-2" class="w-4 h-4 text-emerald-500"></i>
                            </div>
                            <p id="orders-kpi-completed" class="text-xl font-bold text-emerald-600">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl shadow-sm border border-green-200 p-3 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-1">
                                <p class="text-xs font-medium text-green-700">Produção Total</p>
                                <i data-lucide="package" class="w-4 h-4 text-green-500"></i>
                            </div>
                            <p id="orders-kpi-total-produced" class="text-xl font-bold text-green-600">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-2xl shadow-sm border border-red-200 p-3 hover:shadow-md transition">
                            <div class="flex items-center justify-between mb-1">
                                <p class="text-xs font-medium text-red-700">Perdas Total</p>
                                <i data-lucide="alert-triangle" class="w-4 h-4 text-red-500"></i>
                            </div>
                            <p id="orders-kpi-total-losses" class="text-xl font-bold text-red-600">0</p>
                        </div>
                    </div>

                    <!-- Painel Principal -->
                    <div class="bg-white p-4 md:p-5 rounded-2xl shadow-sm border border-gray-100">
                        <!-- Cabeçalho com Título e Ações -->
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-blue-100 rounded-lg">
                                    <i data-lucide="package-check" class="w-5 h-5 text-blue-600"></i>
                                </div>
                                <div>
                                    <h2 class="text-lg font-semibold text-gray-800">Gestão de Ordens de Produção</h2>
                                    <p class="text-xs text-gray-500">Gerencie, rastreie e acompanhe todas as OPs</p>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="openImportOrdersModal()" class="inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 text-white font-semibold rounded-xl shadow-md hover:shadow-lg transition-all text-sm">
                                    <i data-lucide="upload" class="w-4 h-4"></i>
                                    Importar Excel
                                </button>
                                <button id="btn-new-product" onclick="openNewProductModal()" class="inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 text-white font-semibold rounded-xl shadow-md hover:shadow-lg transition-all text-sm">
                                    <i data-lucide="package-plus" class="w-4 h-4"></i>
                                    Novo Produto
                                </button>
                                <button onclick="recalculateAllOrdersTotals()" class="inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-700 hover:to-cyan-800 text-white font-semibold rounded-xl shadow-md hover:shadow-lg transition-all text-sm" title="Recalcular totais de todas as ordens">
                                    <i data-lucide="calculator" class="w-4 h-4"></i>
                                    Recalcular
                                </button>
                            </div>
                        </div>

                        <!-- Filtros -->
                        <div class="bg-gray-50 p-4 rounded-lg mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-12 gap-3">
                                <!-- Busca -->
                                <div class="md:col-span-4">
                                    <div class="relative">
                                        <input type="text" id="orders-search" placeholder="Buscar Nº OP, produto, cliente..." class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-blue focus:border-transparent">
                                    </div>
                                </div>
                                <!-- Status -->
                                <div class="md:col-span-2">
                                    <select id="orders-status-filter" class="w-full py-2.5 px-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-blue focus:border-transparent">
                                        <option value="">Todos os Status</option>
                                        <option value="planejada">📋 Planejada</option>
                                        <option value="ativa">▶️ Ativa</option>
                                        <option value="em_andamento">🔄 Em Andamento</option>
                                        <option value="suspensa">⏸️ Suspensa</option>
                                        <option value="concluida">✅ Concluída</option>
                                        <option value="cancelada">❌ Cancelada</option>
                                    </select>
                                </div>
                                <!-- Máquina -->
                                <div class="md:col-span-2">
                                    <select id="orders-machine-filter" class="w-full py-2.5 px-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-blue focus:border-transparent">
                                        <option value="">Todas Máquinas</option>
                                    </select>
                                </div>
                                <!-- Ordenação -->
                                <div class="md:col-span-2">
                                    <select id="orders-sort-filter" class="w-full py-2.5 px-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-blue focus:border-transparent">
                                        <option value="recent">Mais recentes</option>
                                        <option value="progress-desc">Maior progresso</option>
                                        <option value="progress-asc">Menor progresso</option>
                                        <option value="lot-desc">Maior lote</option>
                                        <option value="alpha">A-Z (Nº OP)</option>
                                    </select>
                                </div>
                                <!-- Botões -->
                                <div class="md:col-span-2 flex gap-2">
                                    <button id="orders-clear-filters" class="flex-1 py-2.5 px-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition flex items-center justify-center gap-1">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                        Limpar
                                    </button>
                                    <button onclick="refreshOrdersList()" class="flex-1 py-2.5 px-3 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg text-sm font-medium transition flex items-center justify-center gap-1">
                                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                        Atualizar
                                    </button>
                                </div>
                            </div>
                            <!-- Contador e Toggle de View -->
                            <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-200">
                                <span id="orders-count" class="text-sm text-gray-600 font-medium">0 ordens encontradas</span>
                                <div class="flex items-center gap-2 bg-gray-200 rounded-lg p-1">
                                    <button id="orders-view-grid-btn" class="px-3 py-1.5 rounded-md text-sm font-medium bg-white shadow-sm text-primary-blue" title="Cards">
                                        <i data-lucide="grid-3x3" class="w-4 h-4"></i>
                                    </button>
                                    <button id="orders-view-table-btn" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700" title="Tabela">
                                        <i data-lucide="list" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Grid de Cards -->
                        <div id="orders-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                            <!-- Cards serão gerados dinamicamente -->
                        </div>

                        <!-- Tabela (alternativa) -->
                        <div id="orders-table-container" class="hidden overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 border rounded-lg">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wide">Nº OP</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wide">Produto</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wide">Máquina</th>
                                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide">Planejado</th>
                                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide">Produzido</th>
                                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide">Perdas</th>
                                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide">Progresso</th>
                                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide">Status</th>
                                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="orders-table-body" class="divide-y divide-gray-200 bg-white">
                                    <!-- Linhas serão preenchidas dinamicamente -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Empty State -->
                        <div id="orders-empty-state" class="hidden flex-col items-center justify-center py-16">
                            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                                <i data-lucide="inbox" class="w-10 h-10 text-gray-400"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-2">Nenhuma ordem encontrada</h3>
                            <p class="text-sm text-gray-500 mb-4">Importe ordens via Excel ou aguarde o PCP</p>
                        </div>
                    </div>
                </div>

                <!-- Modal de Rastreabilidade da Ordem -->
                <div id="order-traceability-modal" class="fixed inset-0 z-50 hidden overflow-y-auto">
                    <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center">
                        <div class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm transition-opacity" onclick="closeModal('order-traceability-modal')"></div>
                        <div class="relative bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-auto overflow-hidden transform transition-all">
                            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="p-2 bg-white/20 rounded-lg">
                                            <i data-lucide="file-search" class="w-5 h-5 text-white"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-bold text-white">Rastreabilidade da Ordem</h3>
                                            <p id="order-trace-number" class="text-blue-100 text-sm">OP #</p>
                                        </div>
                                    </div>
                                    <button onclick="closeModal('order-traceability-modal')" class="text-white/80 hover:text-white p-1">
                                        <i data-lucide="x" class="w-6 h-6"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="p-6">
                                <!-- Resumo da Ordem -->
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                    <div class="bg-blue-50 rounded-xl p-4 text-center">
                                        <p class="text-xs text-blue-600 font-medium mb-1">Planejado</p>
                                        <p id="order-trace-planned" class="text-2xl font-bold text-blue-700">0</p>
                                    </div>
                                    <div class="bg-green-50 rounded-xl p-4 text-center">
                                        <p class="text-xs text-green-600 font-medium mb-1">Produzido</p>
                                        <p id="order-trace-produced" class="text-2xl font-bold text-green-700">0</p>
                                    </div>
                                    <div class="bg-red-50 rounded-xl p-4 text-center">
                                        <p class="text-xs text-red-600 font-medium mb-1">Perdas/Refugo</p>
                                        <p id="order-trace-losses" class="text-2xl font-bold text-red-700">0</p>
                                    </div>
                                    <div class="bg-purple-50 rounded-xl p-4 text-center">
                                        <p class="text-xs text-purple-600 font-medium mb-1">Progresso</p>
                                        <p id="order-trace-progress" class="text-2xl font-bold text-purple-700">0%</p>
                                    </div>
                                </div>
                                <!-- Histórico de Lançamentos -->
                                <div class="border rounded-xl overflow-hidden">
                                    <div class="bg-gray-50 px-4 py-3 border-b flex items-center justify-between">
                                        <h4 class="font-semibold text-gray-700">Histórico de Lançamentos</h4>
                                        <span id="order-trace-entries-count" class="text-sm text-gray-500">0 registros</span>
                                    </div>
                                    <div id="order-trace-entries" class="max-h-64 overflow-y-auto">
                                        <!-- Lançamentos serão carregados aqui -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Paradas Longas removida - Unificação 02/2026 -->


                <!-- PÁGINA: Acompanhamento de Turno -->
                <div id="acompanhamento-page" class="page-content hidden space-y-3 p-2">
                    <div class="bg-white p-5 md:p-6 rounded-2xl shadow-sm border border-gray-100">
                        
                        <!-- Tabs para alternar entre Produção, Perdas e Paradas -->
                        <div class="flex gap-2 mb-6 border-b border-gray-200">
                            <button class="acompanhamento-tab-btn px-6 py-3 text-sm font-semibold rounded-t-xl transition-all border-b-2 border-blue-600 bg-blue-50 text-blue-700" data-acompanhamento-tab="producao">
                                <i data-lucide="package" class="w-4 h-4 inline mr-2"></i>
                                Produção (CEDOC/MES)
                            </button>
                            <button class="acompanhamento-tab-btn px-6 py-3 text-sm font-semibold rounded-t-xl transition-all border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50" data-acompanhamento-tab="perdas">
                                <i data-lucide="alert-triangle" class="w-4 h-4 inline mr-2"></i>
                                Perdas (Perdas/OP)
                            </button>
                            <button class="acompanhamento-tab-btn px-6 py-3 text-sm font-semibold rounded-t-xl transition-all border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50" data-acompanhamento-tab="paradas">
                                <i data-lucide="pause-circle" class="w-4 h-4 inline mr-2"></i>
                                Paradas (Timeline)
                            </button>
                        </div>

                        <!-- ========== ABA: PRODUÇÃO CEDOC/MES ========== -->
                        <div id="acompanhamento-tab-producao" class="acompanhamento-tab-content">
                            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                                <div class="flex items-center gap-3">
                                    <div class="p-2.5 bg-blue-100 rounded-xl">
                                        <i data-lucide="clipboard-check" class="w-6 h-6 text-blue-600"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-semibold text-gray-800">Acompanhamento de Turno</h2>
                                        <p class="text-sm text-gray-500">Validação CEDOC vs Hokkaido Mes</p>
                                    </div>
                                </div>
                                <div id="acompanhamento-status" class="text-xs font-semibold text-blue-600 bg-blue-100 px-3 py-1.5 rounded-full">
                                    🔄 Conectando...
                                </div>
                            </div>

                            <!-- Filtros -->
                            <div class="flex flex-wrap items-end gap-4 mb-6 p-4 bg-gray-50 rounded-xl border border-gray-200">
                                <div class="flex-1 min-w-[150px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="calendar" class="w-3 h-3 inline mr-1"></i> Data
                                    </label>
                                    <input type="date" id="acompanhamento-data" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                </div>
                                <button id="acompanhamento-carregar" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                                    <i data-lucide="search" class="w-4 h-4"></i>
                                    Carregar Dados
                                </button>
                            </div>

                            <!-- Card Resumo -->
                            <div id="acompanhamento-resumo" class="hidden mb-6">
                                <div class="bg-gradient-to-br from-red-50 to-red-100 border border-red-200 rounded-xl p-4 flex items-center gap-4">
                                    <div class="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center shadow-lg">
                                        <i data-lucide="alert-triangle" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-red-600 font-semibold uppercase tracking-wider">Máquinas com Diferença</p>
                                        <p id="acompanhamento-maquinas-diff" class="text-3xl font-bold text-red-700">0</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Tabela -->
                            <div class="overflow-x-auto rounded-xl border border-gray-200">
                                <table class="w-full" id="acompanhamento-tabela">
                                    <thead>
                                        <tr class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
                                            <th rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider border-r border-blue-500">Máquina</th>
                                            <th colspan="3" class="px-4 py-2 text-center text-xs font-semibold uppercase tracking-wider border-r border-blue-500 bg-blue-700">T1 (07h-15h)</th>
                                            <th colspan="3" class="px-4 py-2 text-center text-xs font-semibold uppercase tracking-wider border-r border-blue-500 bg-purple-700">T2 (15h-23h)</th>
                                            <th colspan="3" class="px-4 py-2 text-center text-xs font-semibold uppercase tracking-wider bg-orange-600">T3 (23h-07h)</th>
                                        </tr>
                                        <tr class="bg-gray-100 text-gray-700">
                                            <th class="px-2 py-2 text-center text-xs font-semibold">CEDOC</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">Hokkaido Mes</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold border-r border-gray-300">Dif.</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">CEDOC</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">Hokkaido Mes</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold border-r border-gray-300">Dif.</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">CEDOC</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">Hokkaido Mes</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">Dif.</th>
                                        </tr>
                                    </thead>
                                    <tbody id="acompanhamento-tbody" class="divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="10" class="px-4 py-10 text-center text-gray-400">
                                                <i data-lucide="database" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                                                <p>Selecione a data e clique em <strong>"Carregar Dados"</strong></p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Ações -->
                            <div class="flex justify-end gap-3 mt-6">
                                <button id="acompanhamento-imprimir" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2.5 px-5 rounded-lg transition-all flex items-center gap-2 border border-gray-200">
                                    <i data-lucide="printer" class="w-4 h-4"></i>
                                    Imprimir
                                </button>
                                <button id="acompanhamento-limpar" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    Limpar CEDOC
                                </button>
                                <button id="acompanhamento-salvar" class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                                    <i data-lucide="save" class="w-4 h-4"></i>
                                    Salvar
                                </button>
                            </div>
                        </div>

                        <!-- ========== ABA: PERDAS/OP ========== -->
                        <div id="acompanhamento-tab-perdas" class="acompanhamento-tab-content hidden">
                            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                                <div class="flex items-center gap-3">
                                    <div class="p-2.5 bg-red-100 rounded-xl">
                                        <i data-lucide="trash" class="w-6 h-6 text-red-600"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-semibold text-gray-800">Acompanhamento de Perdas</h2>
                                        <p class="text-sm text-gray-500">Validação Perdas vs OP (Ordem de Produção)</p>
                                    </div>
                                </div>
                                <div id="acompanhamento-perdas-status" class="text-xs font-semibold text-red-600 bg-red-100 px-3 py-1.5 rounded-full">
                                    🔄 Conectando...
                                </div>
                            </div>

                            <!-- Filtros Perdas -->
                            <div class="flex flex-wrap items-end gap-4 mb-6 p-4 bg-red-50 rounded-xl border border-red-200">
                                <div class="flex-1 min-w-[150px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="calendar" class="w-3 h-3 inline mr-1"></i> Data
                                    </label>
                                    <input type="date" id="acompanhamento-perdas-data" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                                </div>
                                <button id="acompanhamento-perdas-carregar" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                                    <i data-lucide="search" class="w-4 h-4"></i>
                                    Carregar Dados
                                </button>
                            </div>

                            <!-- Card Resumo Perdas -->
                            <div id="acompanhamento-perdas-resumo" class="hidden mb-6">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-gradient-to-br from-red-50 to-red-100 border border-red-200 rounded-xl p-4 flex items-center gap-4">
                                        <div class="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center shadow-lg">
                                            <i data-lucide="alert-circle" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-red-600 font-semibold uppercase tracking-wider">Máquinas c/ Diferença</p>
                                            <p id="acompanhamento-perdas-maquinas-diff" class="text-3xl font-bold text-red-700">0</p>
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-xl p-4 flex items-center gap-4">
                                        <div class="w-12 h-12 bg-orange-500 rounded-xl flex items-center justify-center shadow-lg">
                                            <i data-lucide="scale" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-orange-600 font-semibold uppercase tracking-wider">Total OP (kg)</p>
                                            <p id="acompanhamento-perdas-total-op" class="text-3xl font-bold text-orange-700">0</p>
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-xl p-4 flex items-center gap-4">
                                        <div class="w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center shadow-lg">
                                            <i data-lucide="database" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-purple-600 font-semibold uppercase tracking-wider">Total MES (kg)</p>
                                            <p id="acompanhamento-perdas-total-mes" class="text-3xl font-bold text-purple-700">0</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tabela Perdas -->
                            <div class="overflow-x-auto rounded-xl border border-gray-200">
                                <table class="w-full" id="acompanhamento-perdas-tabela">
                                    <thead>
                                        <tr class="bg-gradient-to-r from-red-600 to-red-700 text-white">
                                            <th rowspan="2" class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider border-r border-red-500">Máquina</th>
                                            <th colspan="3" class="px-4 py-2 text-center text-xs font-semibold uppercase tracking-wider border-r border-red-500 bg-red-700">T1 (07h-15h)</th>
                                            <th colspan="3" class="px-4 py-2 text-center text-xs font-semibold uppercase tracking-wider border-r border-red-500 bg-purple-700">T2 (15h-23h)</th>
                                            <th colspan="3" class="px-4 py-2 text-center text-xs font-semibold uppercase tracking-wider bg-orange-600">T3 (23h-07h)</th>
                                        </tr>
                                        <tr class="bg-gray-100 text-gray-700">
                                            <th class="px-2 py-2 text-center text-xs font-semibold">OP (kg)</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">MES (kg)</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold border-r border-gray-300">Dif.</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">OP (kg)</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">MES (kg)</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold border-r border-gray-300">Dif.</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">OP (kg)</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">MES (kg)</th>
                                            <th class="px-2 py-2 text-center text-xs font-semibold">Dif.</th>
                                        </tr>
                                    </thead>
                                    <tbody id="acompanhamento-perdas-tbody" class="divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="10" class="px-4 py-10 text-center text-gray-400">
                                                <i data-lucide="trash" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                                                <p>Selecione a data e clique em <strong>"Carregar Dados"</strong></p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Ações Perdas -->
                            <div class="flex justify-end gap-3 mt-6">
                                <button id="acompanhamento-perdas-imprimir" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2.5 px-5 rounded-lg transition-all flex items-center gap-2 border border-gray-200">
                                    <i data-lucide="printer" class="w-4 h-4"></i>
                                    Imprimir
                                </button>
                                <button id="acompanhamento-perdas-limpar" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    Limpar OP
                                </button>
                                <button id="acompanhamento-perdas-salvar" class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                                    <i data-lucide="save" class="w-4 h-4"></i>
                                    Salvar
                                </button>
                            </div>
                        </div>

                        <!-- ========== ABA: PARADAS (TIMELINE) ========== -->
                        <div id="acompanhamento-tab-paradas" class="acompanhamento-tab-content hidden">
                            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                                <div class="flex items-center gap-3">
                                    <div class="p-2.5 bg-amber-100 rounded-xl">
                                        <i data-lucide="pause-circle" class="w-6 h-6 text-amber-600"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-semibold text-gray-800">Timeline de Paradas</h2>
                                        <p class="text-sm text-gray-500">Visualização de paradas vs produção por máquina</p>
                                    </div>
                                </div>
                                <div id="acompanhamento-paradas-status" class="text-xs font-semibold text-amber-600 bg-amber-100 px-3 py-1.5 rounded-full">
                                    🔄 Conectando...
                                </div>
                            </div>

                            <!-- Filtros Paradas -->
                            <div class="flex flex-wrap items-end gap-4 mb-6 p-4 bg-amber-50 rounded-xl border border-amber-200">
                                <div class="flex-1 min-w-[150px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="calendar" class="w-3 h-3 inline mr-1"></i> Data
                                    </label>
                                    <input type="date" id="acompanhamento-paradas-data" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition">
                                </div>
                                <div class="min-w-[120px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="clock" class="w-3 h-3 inline mr-1"></i> Turno
                                    </label>
                                    <select id="acompanhamento-paradas-turno" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition">
                                        <option value="all">Todos</option>
                                        <option value="1">T1 (07h-15h)</option>
                                        <option value="2">T2 (15h-23h)</option>
                                        <option value="3">T3 (23h-07h)</option>
                                    </select>
                                </div>
                                <button id="acompanhamento-paradas-carregar" class="bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                                    <i data-lucide="search" class="w-4 h-4"></i>
                                    Carregar Timeline
                                </button>
                            </div>

                            <!-- Legenda -->
                            <div class="flex flex-wrap gap-4 mb-6 p-3 bg-gray-50 rounded-lg border border-gray-200">
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-4 bg-green-500 rounded"></div>
                                    <span class="text-xs text-gray-600 font-medium">Produzindo</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-4 bg-red-500 rounded"></div>
                                    <span class="text-xs text-gray-600 font-medium">Parada</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-4 bg-yellow-500 rounded"></div>
                                    <span class="text-xs text-gray-600 font-medium">Setup</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-4 bg-gray-300 rounded"></div>
                                    <span class="text-xs text-gray-600 font-medium">Sem dados</span>
                                </div>
                            </div>

                            <!-- Card Resumo Paradas -->
                            <div id="acompanhamento-paradas-resumo" class="hidden mb-6">
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div class="bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-xl p-4 flex items-center gap-4">
                                        <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center shadow-lg">
                                            <i data-lucide="play" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-green-600 font-semibold uppercase tracking-wider">Tempo Produzindo</p>
                                            <p id="acompanhamento-paradas-tempo-prod" class="text-2xl font-bold text-green-700">0h</p>
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-br from-red-50 to-red-100 border border-red-200 rounded-xl p-4 flex items-center gap-4">
                                        <div class="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center shadow-lg">
                                            <i data-lucide="pause" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-red-600 font-semibold uppercase tracking-wider">Tempo Parado</p>
                                            <p id="acompanhamento-paradas-tempo-parado" class="text-2xl font-bold text-red-700">0h</p>
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 border border-amber-200 rounded-xl p-4 flex items-center gap-4">
                                        <div class="w-12 h-12 bg-amber-500 rounded-xl flex items-center justify-center shadow-lg">
                                            <i data-lucide="alert-circle" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-amber-600 font-semibold uppercase tracking-wider">Total Paradas</p>
                                            <p id="acompanhamento-paradas-total" class="text-2xl font-bold text-amber-700">0</p>
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-4 flex items-center gap-4">
                                        <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center shadow-lg">
                                            <i data-lucide="percent" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-blue-600 font-semibold uppercase tracking-wider">Disponibilidade</p>
                                            <p id="acompanhamento-paradas-disponibilidade" class="text-2xl font-bold text-blue-700">0%</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Escala de Tempo -->
                            <div class="mb-2 px-2">
                                <div class="flex items-center">
                                    <div class="w-24 flex-shrink-0"></div>
                                    <div id="paradas-escala-tempo" class="flex-1 flex justify-between text-xs text-gray-500 font-medium">
                                        <!-- Será preenchido dinamicamente -->
                                    </div>
                                </div>
                            </div>

                            <!-- Container Timeline das Máquinas -->
                            <div id="acompanhamento-paradas-timeline" class="space-y-2 max-h-[600px] overflow-y-auto pr-2">
                                <div class="text-center py-10 text-gray-400">
                                    <i data-lucide="clock" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                                    <p>Selecione a data e clique em <strong>"Carregar Timeline"</strong></p>
                                </div>
                            </div>

                            <!-- Ações Paradas -->
                            <div class="flex justify-end gap-3 mt-6">
                                <button id="acompanhamento-paradas-imprimir" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2.5 px-5 rounded-lg transition-all flex items-center gap-2 border border-gray-200">
                                    <i data-lucide="printer" class="w-4 h-4"></i>
                                    Imprimir
                                </button>
                                <button id="acompanhamento-paradas-exportar" class="bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i>
                                    Exportar
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- PÁGINA: Histórico do Sistema -->
                <div id="historico-sistema-page" class="page-content hidden space-y-4 p-2">
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-slate-700 to-slate-800 px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-white/10 rounded-xl">
                                        <i data-lucide="history" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-white">Histórico do Sistema</h2>
                                        <p class="text-slate-300 text-sm">Registro de todas as ações realizadas</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button id="historico-teste" class="bg-green-500/80 hover:bg-green-500 text-white px-3 py-2 rounded-lg transition flex items-center gap-2 text-sm">
                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                        Gerar Teste
                                    </button>
                                    <button id="historico-refresh" class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg transition flex items-center gap-2">
                                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                        Atualizar
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Filtros -->
                        <div class="p-4 bg-gray-50 border-b border-gray-200">
                            <div class="flex flex-wrap items-end gap-4">
                                <!-- Seleção rápida de data -->
                                <div class="flex-1 min-w-[200px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="calendar" class="w-3 h-3 inline mr-1"></i> Data
                                    </label>
                                    <div class="flex gap-2">
                                        <button id="historico-hoje" class="flex-1 px-3 py-2.5 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition">
                                            Hoje
                                        </button>
                                        <button id="historico-ontem" class="flex-1 px-3 py-2.5 bg-white border border-gray-200 rounded-lg text-sm font-medium hover:bg-gray-50 transition">
                                            Ontem
                                        </button>
                                        <input type="date" id="historico-data-especifica" class="flex-1 p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-slate-500">
                                    </div>
                                </div>
                                <div class="flex-1 min-w-[150px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="filter" class="w-3 h-3 inline mr-1"></i> Tipo de Ação
                                    </label>
                                    <select id="historico-tipo-acao" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-slate-500">
                                        <option value="">Todas as ações</option>
                                        <option value="producao">📦 Lançamento de Produção</option>
                                        <option value="perda">⚠️ Lançamento de Perda</option>
                                        <option value="parada">⏸️ Registro de Parada</option>
                                        <option value="retrabalho">🔄 Retrabalho</option>
                                        <option value="ordem">📋 Ordens de Produção</option>
                                        <option value="planejamento">📅 Planejamento</option>
                                        <option value="qualidade">✓ Qualidade</option>
                                        <option value="acompanhamento">📊 Acompanhamento</option>
                                        <option value="exclusao">🗑️ Exclusão</option>
                                        <option value="edicao">✏️ Edição</option>
                                        <option value="login">🔐 Login</option>
                                        <option value="logout">🚪 Logout</option>
                                    </select>
                                </div>
                                <div class="flex-1 min-w-[150px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="user" class="w-3 h-3 inline mr-1"></i> Usuário
                                    </label>
                                    <input type="text" id="historico-usuario" placeholder="Filtrar por usuário..." class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-slate-500">
                                </div>
                                <div class="flex-1 min-w-[150px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="cpu" class="w-3 h-3 inline mr-1"></i> Máquina
                                    </label>
                                    <input type="text" id="historico-maquina" placeholder="Filtrar por máquina..." class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-slate-500">
                                </div>
                            </div>
                        </div>

                        <!-- Estatísticas Rápidas -->
                        <div class="p-4 grid grid-cols-2 md:grid-cols-5 gap-3" id="historico-stats">
                            <div class="bg-blue-50 rounded-xl p-3 text-center border border-blue-100">
                                <p class="text-2xl font-bold text-blue-600" id="historico-total">0</p>
                                <p class="text-xs text-blue-700">Total de Ações</p>
                            </div>
                            <div class="bg-green-50 rounded-xl p-3 text-center border border-green-100">
                                <p class="text-2xl font-bold text-green-600" id="historico-producao-count">0</p>
                                <p class="text-xs text-green-700">Produções</p>
                            </div>
                            <div class="bg-orange-50 rounded-xl p-3 text-center border border-orange-100">
                                <p class="text-2xl font-bold text-orange-600" id="historico-paradas-count">0</p>
                                <p class="text-xs text-orange-700">Paradas</p>
                            </div>
                            <div class="bg-purple-50 rounded-xl p-3 text-center border border-purple-100">
                                <p class="text-2xl font-bold text-purple-600" id="historico-ordens-count">0</p>
                                <p class="text-xs text-purple-700">Ordens</p>
                            </div>
                            <div class="bg-red-50 rounded-xl p-3 text-center border border-red-100">
                                <p class="text-2xl font-bold text-red-600" id="historico-exclusoes-count">0</p>
                                <p class="text-xs text-red-700">Exclusões</p>
                            </div>
                        </div>

                        <!-- Tabela de Histórico -->
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="bg-gray-100 text-gray-700">
                                        <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">Data/Hora</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">Tipo</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">Descrição</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">Máquina</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">Usuário</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">Detalhes</th>
                                    </tr>
                                </thead>
                                <tbody id="historico-tbody" class="divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="6" class="px-4 py-10 text-center text-gray-400">
                                            <i data-lucide="history" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                                            <p>Clique em <strong>"Buscar"</strong> para carregar o histórico</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Paginação -->
                        <div class="p-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between">
                            <p class="text-sm text-gray-600" id="historico-info">Mostrando 0 registros</p>
                            <div class="flex gap-2">
                                <button id="historico-prev" class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm hover:bg-gray-50 disabled:opacity-50" disabled>
                                    <i data-lucide="chevron-left" class="w-4 h-4 inline"></i> Anterior
                                </button>
                                <button id="historico-next" class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm hover:bg-gray-50 disabled:opacity-50" disabled>
                                    Próximo <i data-lucide="chevron-right" class="w-4 h-4 inline"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: Administração de Dados (apenas gestores/admins) -->
                <div id="admin-dados-page" class="page-content hidden space-y-4 p-2">
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-red-700 to-red-800 px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-white/10 rounded-xl">
                                        <i data-lucide="database" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-white">Administração de Dados</h2>
                                        <p class="text-red-200 text-sm">Correção e ajuste de registros do sistema</p>
                                    </div>
                                </div>
                                <span class="bg-red-500/30 px-3 py-1 rounded-full text-xs font-bold text-white uppercase tracking-wider">
                                    🔒 Admin Only
                                </span>
                            </div>
                        </div>

                        <!-- Abas internas -->
                        <div class="border-b border-gray-200">
                            <nav class="flex gap-1 px-4 pt-2 overflow-x-auto">
                                <button class="admin-tab-btn active px-4 py-2 text-sm font-semibold rounded-t-lg transition bg-blue-500 text-white whitespace-nowrap" data-admin-tab="producao">
                                    <i data-lucide="bar-chart-2" class="w-4 h-4 inline mr-1"></i> Produção
                                </button>
                                <button class="admin-tab-btn px-4 py-2 text-sm font-semibold rounded-t-lg transition bg-gray-100 text-gray-600 hover:bg-gray-200 whitespace-nowrap" data-admin-tab="perdas">
                                    <i data-lucide="trash-2" class="w-4 h-4 inline mr-1"></i> Perdas
                                </button>
                                <button class="admin-tab-btn px-4 py-2 text-sm font-semibold rounded-t-lg transition bg-gray-100 text-gray-600 hover:bg-gray-200 whitespace-nowrap" data-admin-tab="planejamento">
                                    <i data-lucide="calendar-check" class="w-4 h-4 inline mr-1"></i> Planejamento
                                </button>
                                <button class="admin-tab-btn px-4 py-2 text-sm font-semibold rounded-t-lg transition bg-gray-100 text-gray-600 hover:bg-gray-200 whitespace-nowrap" data-admin-tab="ordens">
                                    <i data-lucide="package" class="w-4 h-4 inline mr-1"></i> Ordens de Produção
                                </button>
                                <button class="admin-tab-btn px-4 py-2 text-sm font-semibold rounded-t-lg transition bg-gray-100 text-gray-600 hover:bg-gray-200 whitespace-nowrap" data-admin-tab="paradas">
                                    <i data-lucide="pause-circle" class="w-4 h-4 inline mr-1"></i> Paradas
                                </button>
                            </nav>
                        </div>

                        <!-- Conteúdo das abas -->
                        <div class="p-4">
                            <!-- Aba: Produção (agora primeira) -->
                            <div id="admin-tab-producao" class="admin-tab-content">
                                <div class="mb-6">
                                    <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
                                        <i data-lucide="edit-3" class="w-5 h-5 text-blue-600"></i>
                                        Editar Lançamentos de Produção
                                    </h3>
                                    <p class="text-sm text-gray-600 mb-4">Busque, visualize, edite ou exclua lançamentos de produção diretamente no banco de dados.</p>
                                    
                                    <div class="flex flex-wrap items-end gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data</label>
                                            <input type="date" id="admin-producao-data" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                                            <select id="admin-producao-maquina" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                                <option value="">Todas</option>
                                            </select>
                                        </div>
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                                            <select id="admin-producao-turno" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                                <option value="">Todos</option>
                                                <option value="1">1º Turno</option>
                                                <option value="2">2º Turno</option>
                                                <option value="3">3º Turno</option>
                                            </select>
                                        </div>
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Cód. Produto</label>
                                            <input type="text" id="admin-producao-cod-produto" placeholder="Ex: 10001234" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <button id="admin-btn-buscar-producao" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                            Buscar
                                        </button>
                                    </div>
                                </div>

                                <!-- Estatísticas da busca -->
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3 mb-4">
                                    <div class="bg-blue-50 rounded-lg p-2 md:p-3 text-center border border-blue-100">
                                        <div id="admin-prod-total" class="text-lg md:text-xl font-bold text-blue-600">0</div>
                                        <div class="text-xs text-blue-700">Total Registros</div>
                                    </div>
                                    <div class="bg-green-50 rounded-lg p-2 md:p-3 text-center border border-green-100">
                                        <div id="admin-prod-pecas" class="text-lg md:text-xl font-bold text-green-600">0</div>
                                        <div class="text-xs text-green-700">Total Peças</div>
                                    </div>
                                    <div class="bg-amber-50 rounded-lg p-2 md:p-3 text-center border border-amber-100">
                                        <div id="admin-prod-peso" class="text-lg md:text-xl font-bold text-amber-600">0</div>
                                        <div class="text-xs text-amber-700">Peso Total (kg)</div>
                                    </div>
                                    <div class="bg-red-50 rounded-lg p-2 md:p-3 text-center border border-red-100">
                                        <div id="admin-prod-refugo" class="text-lg md:text-xl font-bold text-red-600">0</div>
                                        <div class="text-xs text-red-700">Refugo (kg)</div>
                                    </div>
                                </div>

                                <!-- Lista de registros -->
                                <div id="admin-producao-lista" class="space-y-2 max-h-[50vh] md:max-h-[400px] overflow-y-auto border rounded-lg p-2 bg-gray-50">
                                    <div class="text-center py-8 text-gray-400">
                                        <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                        <p>Selecione filtros e clique em "Buscar"</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Aba: Perdas (NOVA) -->
                            <div id="admin-tab-perdas" class="admin-tab-content hidden">
                                <div class="mb-6">
                                    <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
                                        <i data-lucide="trash-2" class="w-5 h-5 text-red-600"></i>
                                        Editar Lançamentos de Perdas
                                    </h3>
                                    <p class="text-sm text-gray-600 mb-4">Busque, visualize, edite ou exclua perdas registradas pelos usuários na aba Lançamento (refugo, borra, setup, sucata, etc).</p>
                                    
                                    <div class="flex flex-wrap items-end gap-4 p-4 bg-red-50 rounded-lg border border-red-200">
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data</label>
                                            <input type="date" id="admin-perdas-data" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                        </div>
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                                            <select id="admin-perdas-maquina" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                                <option value="">Todas</option>
                                            </select>
                                        </div>
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                                            <select id="admin-perdas-turno" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                                <option value="">Todos</option>
                                                <option value="1">1º Turno</option>
                                                <option value="2">2º Turno</option>
                                                <option value="3">3º Turno</option>
                                            </select>
                                        </div>
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Tipo</label>
                                            <select id="admin-perdas-tipo" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                                <option value="">Todos</option>
                                                <option value="borra">Borra</option>
                                                <option value="refugo">Refugo</option>
                                                <option value="sucata">Sucata</option>
                                            </select>
                                        </div>
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Cód. Produto</label>
                                            <input type="text" id="admin-perdas-cod-produto" placeholder="Ex: 10001234" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                        </div>
                                        <button id="admin-btn-buscar-perdas" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                            Buscar
                                        </button>
                                    </div>
                                </div>

                                <!-- Estatísticas da busca -->
                                <div class="grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-3 mb-4">
                                    <div class="bg-blue-50 rounded-lg p-2 md:p-3 text-center border border-blue-100">
                                        <div id="admin-perdas-total" class="text-lg md:text-xl font-bold text-blue-600">0</div>
                                        <div class="text-xs text-blue-700">Total Registros</div>
                                    </div>
                                    <div class="bg-red-50 rounded-lg p-2 md:p-3 text-center border border-red-100">
                                        <div id="admin-perdas-peso" class="text-lg md:text-xl font-bold text-red-600">0</div>
                                        <div class="text-xs text-red-700">Peso Total (kg)</div>
                                    </div>
                                    <div class="bg-amber-50 rounded-lg p-2 md:p-3 text-center border border-amber-100">
                                        <div id="admin-perdas-borra" class="text-lg md:text-xl font-bold text-amber-600">0</div>
                                        <div class="text-xs text-amber-700">Borras (kg)</div>
                                    </div>
                                    <div class="bg-orange-50 rounded-lg p-2 md:p-3 text-center border border-orange-100">
                                        <div id="admin-perdas-refugo" class="text-lg md:text-xl font-bold text-orange-600">0</div>
                                        <div class="text-xs text-orange-700">Refugo (kg)</div>
                                    </div>
                                    <div class="bg-purple-50 rounded-lg p-2 md:p-3 text-center border border-purple-100">
                                        <div id="admin-perdas-sucata" class="text-lg md:text-xl font-bold text-purple-600">0</div>
                                        <div class="text-xs text-purple-700">Sucata (kg)</div>
                                    </div>
                                </div>

                                <!-- Lista de registros de perdas -->
                                <div id="admin-perdas-lista" class="space-y-2 max-h-[50vh] md:max-h-[400px] overflow-y-auto border rounded-lg p-2 bg-gray-50">
                                    <div class="text-center py-8 text-gray-400">
                                        <i data-lucide="trash-2" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                        <p>Selecione filtros e clique em "Buscar"</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Aba: Planejamento (NOVA) -->
                            <div id="admin-tab-planejamento" class="admin-tab-content hidden">
                                <div class="mb-6">
                                    <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
                                        <i data-lucide="calendar-check" class="w-5 h-5 text-emerald-600"></i>
                                        Editar Planejamento de Produção
                                    </h3>
                                    <p class="text-sm text-gray-600 mb-4">Edite quantidades planejadas, ciclo real e cavidades ativas por turno.</p>
                                    
                                    <div class="flex flex-wrap items-end gap-4 p-4 bg-emerald-50 rounded-lg border border-emerald-200">
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data</label>
                                            <input type="date" id="admin-planejamento-data" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500">
                                        </div>
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                                            <select id="admin-planejamento-maquina" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500">
                                                <option value="">Todas</option>
                                            </select>
                                        </div>
                                        <div class="flex-1 min-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Cód. Produto</label>
                                            <input type="text" id="admin-planejamento-cod-produto" placeholder="Ex: 10001234" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500">
                                        </div>
                                        <button id="admin-btn-buscar-planejamento" class="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                            Buscar
                                        </button>
                                    </div>
                                </div>

                                <!-- Lista de planejamentos -->
                                <div id="admin-planejamento-lista" class="space-y-3 max-h-[450px] overflow-y-auto">
                                    <div class="text-center py-8 text-gray-400">
                                        <i data-lucide="calendar" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                        <p>Selecione uma data e clique em "Buscar"</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Aba: Ordens de Produção -->
                            <div id="admin-tab-ordens" class="admin-tab-content hidden">
                                <!-- Busca Simples -->
                                <div class="bg-white rounded-xl border border-gray-200 p-4 mb-4">
                                    <div class="flex flex-wrap items-end gap-3">
                                        <div class="flex-1 min-w-[250px]">
                                            <label class="block text-xs font-semibold text-gray-600 mb-1">Buscar Ordem de Produção</label>
                                            <div class="relative">
                                                <input type="text" id="admin-ordem-busca" placeholder="Digite o Nº da OP..." 
                                                    class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-300 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:bg-white transition">
                                                <i data-lucide="search" class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                                            </div>
                                        </div>
                                        <button id="admin-btn-buscar-op" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold transition flex items-center gap-2">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                            Buscar
                                        </button>
                                    </div>
                                </div>

                                <!-- Card da Ordem (aparece após busca) -->
                                <div id="admin-ordem-card" class="hidden">
                                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl border border-blue-200 overflow-hidden">
                                        <!-- Header -->
                                        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-5 py-4">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                                                        <i data-lucide="package" class="w-6 h-6 text-white"></i>
                                                    </div>
                                                    <div>
                                                        <h3 class="text-xl font-bold text-white">OP <span id="admin-op-numero">-</span></h3>
                                                        <p id="admin-op-produto" class="text-blue-100 text-sm truncate max-w-xs">Produto</p>
                                                    </div>
                                                </div>
                                                <div class="text-right">
                                                    <span id="admin-op-status" class="inline-block px-3 py-1 bg-white/20 text-white text-sm font-semibold rounded-full">Status</span>
                                                    <p id="admin-op-maquina" class="text-blue-100 text-sm mt-1">Máquina</p>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Indicadores (mesmo estilo dos cards de máquina) -->
                                        <div class="p-5">
                                            <div class="grid grid-cols-3 gap-4 mb-5">
                                                <div class="bg-white rounded-xl p-4 text-center shadow-sm border border-blue-100">
                                                    <div class="text-xs text-gray-500 uppercase font-semibold mb-1">Planejado (Lote)</div>
                                                    <div id="admin-op-planejado" class="text-2xl font-bold text-blue-600">0</div>
                                                </div>
                                                <div class="bg-white rounded-xl p-4 text-center shadow-sm border border-green-100">
                                                    <div class="text-xs text-gray-500 uppercase font-semibold mb-1">Executado</div>
                                                    <div id="admin-op-executado" class="text-2xl font-bold text-green-600">0</div>
                                                </div>
                                                <div class="bg-white rounded-xl p-4 text-center shadow-sm border border-amber-100">
                                                    <div class="text-xs text-gray-500 uppercase font-semibold mb-1">Faltante</div>
                                                    <div id="admin-op-faltante" class="text-2xl font-bold text-amber-600">0</div>
                                                </div>
                                            </div>

                                            <!-- Barra de Progresso -->
                                            <div class="mb-5">
                                                <div class="flex items-center justify-between text-sm mb-2">
                                                    <span class="text-gray-600 font-medium">Progresso da OP</span>
                                                    <span id="admin-op-progresso-pct" class="font-bold text-blue-600">0%</span>
                                                </div>
                                                <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                                                    <div id="admin-op-progresso-bar" class="h-4 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 transition-all duration-500" style="width: 0%"></div>
                                                </div>
                                            </div>

                                            <!-- Editor de Quantidade -->
                                            <div class="bg-amber-50 rounded-xl p-4 border border-amber-200">
                                                <h4 class="font-semibold text-amber-800 mb-3 flex items-center gap-2">
                                                    <i data-lucide="edit-3" class="w-4 h-4"></i>
                                                    Ajustar Quantidade Executada
                                                </h4>
                                                <div class="flex items-center gap-3">
                                                    <div class="flex-1">
                                                        <label class="block text-xs text-amber-700 font-medium mb-1">Nova quantidade (física real):</label>
                                                        <input type="number" id="admin-op-nova-qtd" min="0" placeholder="Digite a quantidade correta..."
                                                            class="w-full px-4 py-3 text-lg font-semibold bg-white border-2 border-amber-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
                                                    </div>
                                                    <button id="admin-btn-salvar-op" class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-semibold transition flex items-center gap-2 self-end">
                                                        <i data-lucide="save" class="w-5 h-5"></i>
                                                        Salvar
                                                    </button>
                                                </div>
                                                
                                                <!-- Preview da alteração -->
                                                <div id="admin-op-preview" class="hidden mt-4 p-3 bg-white rounded-lg border border-amber-200">
                                                    <div class="flex items-center justify-center gap-4">
                                                        <div class="text-center">
                                                            <div class="text-xs text-gray-500">Atual</div>
                                                            <div id="admin-op-preview-atual" class="text-xl font-bold text-gray-600">0</div>
                                                        </div>
                                                        <div class="text-2xl text-amber-500">→</div>
                                                        <div class="text-center">
                                                            <div class="text-xs text-gray-500">Novo</div>
                                                            <div id="admin-op-preview-novo" class="text-xl font-bold text-green-600">0</div>
                                                        </div>
                                                        <div class="text-center ml-2 px-3 py-1 rounded-lg bg-gray-100">
                                                            <div class="text-xs text-gray-500">Diferença</div>
                                                            <div id="admin-op-preview-diff" class="text-lg font-bold">0</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Estado vazio -->
                                <div id="admin-ordem-empty" class="text-center py-12 text-gray-400">
                                    <i data-lucide="search" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                                    <p class="text-lg">Digite o número da OP para buscar</p>
                                    <p class="text-sm">As informações exibidas serão as mesmas dos cards de máquina</p>
                                </div>

                                <!-- Log de alterações -->
                                <div class="mt-4 bg-gray-900 rounded-xl overflow-hidden">
                                    <div class="bg-gray-800 px-4 py-2 flex items-center justify-between">
                                        <span class="text-white text-sm font-medium">📋 Histórico de Alterações</span>
                                        <button onclick="document.getElementById('admin-ordem-log').innerHTML=''" class="text-xs text-gray-400 hover:text-white transition">Limpar</button>
                                    </div>
                                    <div id="admin-ordem-log" class="h-32 overflow-y-auto p-3 font-mono text-xs"></div>
                                </div>
                            </div>

                            <!-- Aba: Gestão de Paradas -->
                            <div id="admin-tab-paradas" class="admin-tab-content hidden">
                                <!-- Filtros -->
                                <div class="bg-gray-50 rounded-xl p-4 mb-4 border border-gray-200">
                                    <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                        <i data-lucide="filter" class="w-4 h-4"></i>
                                        Filtros de Busca
                                    </h4>
                                    <div class="flex flex-wrap items-end gap-3">
                                        <!-- Período -->
                                        <div class="flex-1 min-w-[140px] max-w-[180px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Período</label>
                                            <select id="admin-paradas-periodo" class="w-full appearance-none bg-white border border-gray-200 rounded-lg py-2 pl-3 pr-8 text-sm focus:ring-2 focus:ring-blue-500 transition cursor-pointer">
                                                <option value="today">Hoje</option>
                                                <option value="yesterday">Ontem</option>
                                                <option value="7days" selected>Últimos 7 dias</option>
                                                <option value="30days">Últimos 30 dias</option>
                                                <option value="custom">Personalizado</option>
                                            </select>
                                        </div>
                                        <!-- Data Início -->
                                        <div class="min-w-[130px] hidden" id="admin-paradas-custom-dates">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Início</label>
                                            <input type="date" id="admin-paradas-data-inicio" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 transition">
                                        </div>
                                        <!-- Data Fim -->
                                        <div class="min-w-[130px] hidden" id="admin-paradas-custom-dates-fim">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Fim</label>
                                            <input type="date" id="admin-paradas-data-fim" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 transition">
                                        </div>
                                        <!-- Máquina -->
                                        <div class="flex-1 min-w-[140px] max-w-[160px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                                            <select id="admin-paradas-maquina" class="w-full appearance-none bg-white border border-gray-200 rounded-lg py-2 pl-3 pr-8 text-sm focus:ring-2 focus:ring-blue-500 transition cursor-pointer">
                                                <option value="">Todas</option>
                                            </select>
                                        </div>
                                        <!-- Status -->
                                        <div class="flex-1 min-w-[120px] max-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Status</label>
                                            <select id="admin-paradas-status" class="w-full appearance-none bg-white border border-gray-200 rounded-lg py-2 pl-3 pr-8 text-sm focus:ring-2 focus:ring-blue-500 transition cursor-pointer">
                                                <option value="">Todos</option>
                                                <option value="active">Ativas</option>
                                                <option value="finished">Finalizadas</option>
                                            </select>
                                        </div>
                                        <!-- Cód. Produto -->
                                        <div class="flex-1 min-w-[140px] max-w-[160px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Cód. Produto</label>
                                            <input type="text" id="admin-paradas-cod-produto" placeholder="Ex: 10001234" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 transition">
                                        </div>
                                        <!-- Botão Buscar -->
                                        <button id="admin-paradas-buscar" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                            Buscar
                                        </button>
                                    </div>
                                </div>

                                <!-- Estatísticas -->
                                <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-4">
                                    <div class="bg-blue-50 rounded-xl p-3 text-center border border-blue-100">
                                        <div id="admin-paradas-stat-total" class="text-2xl font-bold text-blue-600">0</div>
                                        <div class="text-xs text-blue-700">Total</div>
                                    </div>
                                    <div class="bg-red-50 rounded-xl p-3 text-center border border-red-100">
                                        <div id="admin-paradas-stat-ativas" class="text-2xl font-bold text-red-600">0</div>
                                        <div class="text-xs text-red-700">Ativas</div>
                                    </div>
                                    <div class="bg-green-50 rounded-xl p-3 text-center border border-green-100">
                                        <div id="admin-paradas-stat-finalizadas" class="text-2xl font-bold text-green-600">0</div>
                                        <div class="text-xs text-green-700">Finalizadas</div>
                                    </div>
                                    <div class="bg-orange-50 rounded-xl p-3 text-center border border-orange-100">
                                        <div id="admin-paradas-stat-tempo" class="text-2xl font-bold text-orange-600">0h</div>
                                        <div class="text-xs text-orange-700">Tempo Total</div>
                                    </div>
                                    <div class="bg-purple-50 rounded-xl p-3 text-center border border-purple-100">
                                        <div id="admin-paradas-stat-medio" class="text-2xl font-bold text-purple-600">0min</div>
                                        <div class="text-xs text-purple-700">Tempo Médio</div>
                                    </div>
                                </div>

                                <!-- Ações em Lote -->
                                <div class="flex flex-wrap items-center gap-3 mb-4 p-3 bg-amber-50 rounded-lg border border-amber-200">
                                    <span class="text-sm font-medium text-amber-800">Ações:</span>
                                    <button id="admin-paradas-exportar" class="bg-amber-500 hover:bg-amber-600 text-white px-3 py-1.5 rounded-lg text-sm font-medium transition flex items-center gap-1.5">
                                        <i data-lucide="download" class="w-3.5 h-3.5"></i>
                                        Exportar CSV
                                    </button>
                                    <button id="admin-paradas-corrigir-lote" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1.5 rounded-lg text-sm font-medium transition flex items-center gap-1.5">
                                        <i data-lucide="check-check" class="w-3.5 h-3.5"></i>
                                        Corrigir Selecionados
                                    </button>
                                    <span class="text-xs text-amber-700 ml-2">
                                        <span id="admin-paradas-selecionados">0</span> selecionado(s)
                                    </span>
                                </div>

                                <!-- Tabela de Paradas -->
                                <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm" id="admin-paradas-tabela">
                                            <thead class="bg-gray-100 text-gray-700">
                                                <tr>
                                                    <th class="px-3 py-3 text-left w-10">
                                                        <input type="checkbox" id="admin-paradas-check-all" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                                    </th>
                                                    <th class="px-3 py-3 text-left font-semibold">Data</th>
                                                    <th class="px-3 py-3 text-left font-semibold">Máquina</th>
                                                    <th class="px-3 py-3 text-left font-semibold">Motivo</th>
                                                    <th class="px-3 py-3 text-center font-semibold">Início</th>
                                                    <th class="px-3 py-3 text-center font-semibold">Fim</th>
                                                    <th class="px-3 py-3 text-center font-semibold">Duração</th>
                                                    <th class="px-3 py-3 text-center font-semibold">Status</th>
                                                    <th class="px-3 py-3 text-center font-semibold">Ações</th>
                                                </tr>
                                            </thead>
                                            <tbody id="admin-paradas-tbody" class="divide-y divide-gray-100">
                                                <tr>
                                                    <td colspan="9" class="text-center py-12 text-gray-400">
                                                        <i data-lucide="pause-circle" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                                        <p>Clique em "Buscar" para carregar as paradas</p>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <!-- Paginação -->
                                    <div id="admin-paradas-paginacao" class="flex flex-col sm:flex-row items-center justify-between gap-3 p-4 border-t border-gray-200 bg-gray-50">
                                        <div class="text-sm text-gray-600">
                                            Mostrando <span id="admin-paradas-pag-inicio" class="font-semibold">0</span> - <span id="admin-paradas-pag-fim" class="font-semibold">0</span> de <span id="admin-paradas-pag-total" class="font-semibold">0</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button id="admin-paradas-pag-anterior" class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition disabled:opacity-40 disabled:cursor-not-allowed" disabled>
                                                <i data-lucide="chevron-left" class="w-4 h-4"></i>
                                            </button>
                                            <span class="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm font-semibold">
                                                Página <span id="admin-paradas-pag-atual">1</span> de <span id="admin-paradas-pag-total-paginas">1</span>
                                            </span>
                                            <button id="admin-paradas-pag-proxima" class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition disabled:opacity-40 disabled:cursor-not-allowed" disabled>
                                                <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Modal de Edição -->
                                <div id="admin-paradas-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
                                    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">
                                        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4">
                                            <div class="flex items-center justify-between">
                                                <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                                    <i data-lucide="edit-3" class="w-5 h-5"></i>
                                                    Editar Parada
                                                </h3>
                                                <button id="admin-paradas-modal-close" class="text-white/80 hover:text-white transition">
                                                    <i data-lucide="x" class="w-5 h-5"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <form id="admin-paradas-form" class="p-6 space-y-4">
                                            <input type="hidden" id="admin-paradas-edit-id">
                                            
                                            <div class="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-xs font-semibold text-gray-500 uppercase mb-1.5">Máquina</label>
                                                    <input type="text" id="admin-paradas-edit-maquina" class="w-full bg-gray-100 border border-gray-200 rounded-lg py-2 px-3 text-sm" readonly>
                                                </div>
                                                <div>
                                                    <label class="block text-xs font-semibold text-gray-500 uppercase mb-1.5">Data</label>
                                                    <input type="date" id="admin-paradas-edit-data" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500">
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-xs font-semibold text-gray-500 uppercase mb-1.5">Motivo da Parada</label>
                                                <select id="admin-paradas-edit-motivo" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500">
                                                    <option value="">Selecione o motivo</option>
                                                </select>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-xs font-semibold text-gray-500 uppercase mb-1.5">Motivo Personalizado</label>
                                                <input type="text" id="admin-paradas-edit-motivo-custom" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500" placeholder="Descreva o motivo específico...">
                                            </div>
                                            
                                            <div class="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-xs font-semibold text-gray-500 uppercase mb-1.5">Hora Início</label>
                                                    <input type="time" id="admin-paradas-edit-inicio" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500">
                                                </div>
                                                <div>
                                                    <label class="block text-xs font-semibold text-gray-500 uppercase mb-1.5">Hora Fim</label>
                                                    <input type="time" id="admin-paradas-edit-fim" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500">
                                                </div>
                                            </div>
                                            
                                            <div class="bg-blue-50 rounded-lg p-3 border border-blue-100">
                                                <div class="flex items-center justify-between">
                                                    <span class="text-sm text-blue-700">Duração calculada:</span>
                                                    <span id="admin-paradas-edit-duracao" class="text-lg font-bold text-blue-600">0 min</span>
                                                </div>
                                            </div>
                                            
                                            <div class="flex gap-3 pt-2">
                                                <button type="button" id="admin-paradas-modal-cancel" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2.5 rounded-lg font-semibold transition">
                                                    Cancelar
                                                </button>
                                                <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2.5 rounded-lg font-semibold transition flex items-center justify-center gap-2">
                                                    <i data-lucide="save" class="w-4 h-4"></i>
                                                    Salvar Alterações
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: Setup de Máquinas -->
                <div id="setup-maquinas-page" class="page-content hidden space-y-4 p-2">
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-orange-600 to-amber-600 px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-white/10 rounded-xl">
                                        <i data-lucide="wrench" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-white">Setup de Máquinas</h2>
                                        <p class="text-orange-100 text-sm">Registro de atividades de setup e troca de moldes</p>
                                    </div>
                                </div>
                                <button id="btn-novo-setup" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition flex items-center gap-2 font-semibold">
                                    <i data-lucide="plus-circle" class="w-4 h-4"></i>
                                    Novo Setup
                                </button>
                            </div>
                        </div>

                        <!-- Filtros -->
                        <div class="border-b border-gray-200 p-4 bg-gray-50">
                            <div class="flex flex-wrap items-end gap-3">
                                <!-- Período -->
                                <div class="flex-1 min-w-[140px] max-w-[180px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="calendar" class="w-3 h-3 inline mr-1"></i> Período
                                    </label>
                                    <div class="relative">
                                        <select id="setup-periodo" class="w-full appearance-none bg-white border border-gray-200 rounded-lg py-2.5 pl-3 pr-10 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition cursor-pointer">
                                            <option value="today">Hoje</option>
                                            <option value="yesterday">Ontem</option>
                                            <option value="7days" selected>Últimos 7 dias</option>
                                            <option value="30days">Últimos 30 dias</option>
                                            <option value="month">Este mês</option>
                                            <option value="lastmonth">Mês passado</option>
                                            <option value="custom">Personalizado</option>
                                        </select>
                                        <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                    </div>
                                </div>
                                
                                <!-- Máquina -->
                                <div class="flex-1 min-w-[140px] max-w-[180px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="cpu" class="w-3 h-3 inline mr-1"></i> Máquina
                                    </label>
                                    <div class="relative">
                                        <select id="setup-filtro-maquina" class="w-full appearance-none bg-white border border-gray-200 rounded-lg py-2.5 pl-3 pr-10 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition cursor-pointer">
                                            <option value="">Todas as máquinas</option>
                                        </select>
                                        <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                    </div>
                                </div>
                                
                                <!-- Turno -->
                                <div class="flex-1 min-w-[120px] max-w-[150px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="clock" class="w-3 h-3 inline mr-1"></i> Turno
                                    </label>
                                    <div class="relative">
                                        <select id="setup-filtro-turno" class="w-full appearance-none bg-white border border-gray-200 rounded-lg py-2.5 pl-3 pr-10 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition cursor-pointer">
                                            <option value="">Todos</option>
                                            <option value="1">1º Turno (06h-14h)</option>
                                            <option value="2">2º Turno (14h-22h)</option>
                                            <option value="3">3º Turno (22h-06h)</option>
                                        </select>
                                        <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                    </div>
                                </div>
                                
                                <!-- Tipo -->
                                <div class="flex-1 min-w-[120px] max-w-[150px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="tag" class="w-3 h-3 inline mr-1"></i> Tipo
                                    </label>
                                    <div class="relative">
                                        <select id="setup-filtro-tipo" class="w-full appearance-none bg-white border border-gray-200 rounded-lg py-2.5 pl-3 pr-10 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition cursor-pointer">
                                            <option value="">Todos os tipos</option>
                                            <option value="planejado">Planejado</option>
                                            <option value="nao_planejado">Não Planejado</option>
                                        </select>
                                        <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                    </div>
                                </div>
                                
                                <!-- Botão Buscar -->
                                <button id="btn-buscar-setups" class="inline-flex items-center gap-2 bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-700 hover:to-amber-700 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md hover:shadow-lg transition-all text-sm">
                                    <i data-lucide="search" class="w-4 h-4"></i>
                                    <span class="hidden sm:inline">Buscar</span>
                                </button>
                            </div>
                            
                            <!-- Datas Personalizadas -->
                            <div id="setup-custom-date-range" class="mt-4 flex flex-wrap items-end gap-3 hidden">
                                <div class="min-w-[160px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Inicial</label>
                                    <input type="date" id="setup-data-inicio" class="w-full bg-white border border-gray-200 rounded-lg py-2.5 px-3 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition">
                                </div>
                                <div class="min-w-[160px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Final</label>
                                    <input type="date" id="setup-data-fim" class="w-full bg-white border border-gray-200 rounded-lg py-2.5 px-3 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition">
                                </div>
                            </div>
                        </div>

                        <!-- Estatísticas -->
                        <div class="p-4 grid grid-cols-2 md:grid-cols-5 gap-3">
                            <div class="bg-orange-50 rounded-xl p-3 text-center border border-orange-100">
                                <p class="text-2xl font-bold text-orange-600" id="setup-total">0</p>
                                <p class="text-xs text-orange-700">Total de Setups</p>
                            </div>
                            <div class="bg-green-50 rounded-xl p-3 text-center border border-green-100">
                                <p class="text-2xl font-bold text-green-600" id="setup-planejados">0</p>
                                <p class="text-xs text-green-700">Planejados</p>
                            </div>
                            <div class="bg-red-50 rounded-xl p-3 text-center border border-red-100">
                                <p class="text-2xl font-bold text-red-600" id="setup-nao-planejados">0</p>
                                <p class="text-xs text-red-700">Não Planejados</p>
                            </div>
                            <div class="bg-blue-50 rounded-xl p-3 text-center border border-blue-100">
                                <p class="text-2xl font-bold text-blue-600" id="setup-tempo-medio">0min</p>
                                <p class="text-xs text-blue-700">Tempo Médio</p>
                            </div>
                            <div class="bg-purple-50 rounded-xl p-3 text-center border border-purple-100">
                                <p class="text-2xl font-bold text-purple-600" id="setup-tempo-total">0h</p>
                                <p class="text-xs text-purple-700">Tempo Total</p>
                            </div>
                        </div>

                        <!-- Seção de Gráficos -->
                        <div class="p-4 border-t border-gray-100">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                                    <i data-lucide="bar-chart-3" class="w-5 h-5 text-orange-600"></i>
                                    Análise Visual de Setups
                                </h3>
                                <button id="toggle-setup-charts" class="text-sm text-orange-600 hover:text-orange-700 font-medium flex items-center gap-1 transition">
                                    <i data-lucide="chevron-up" class="w-4 h-4" id="setup-charts-toggle-icon"></i>
                                    <span id="setup-charts-toggle-text">Ocultar Gráficos</span>
                                </button>
                            </div>
                            
                            <div id="setup-charts-container">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                                    <!-- Gráfico 1: Distribuição por Tipo -->
                                    <div class="bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 p-4 shadow-sm">
                                        <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                            <i data-lucide="pie-chart" class="w-4 h-4 text-orange-500"></i>
                                            Distribuição por Tipo
                                        </h4>
                                        <div class="relative h-64 flex items-center justify-center">
                                            <canvas id="setup-chart-tipo"></canvas>
                                        </div>
                                    </div>

                                    <!-- Gráfico 2: Setups por Máquina -->
                                    <div class="bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 p-4 shadow-sm">
                                        <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                            <i data-lucide="bar-chart-2" class="w-4 h-4 text-blue-500"></i>
                                            Quantidade por Máquina
                                        </h4>
                                        <div class="relative h-64">
                                            <canvas id="setup-chart-maquina"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <!-- Gráfico 3: Tempo por Máquina -->
                                    <div class="bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 p-4 shadow-sm">
                                        <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                            <i data-lucide="clock" class="w-4 h-4 text-amber-500"></i>
                                            Tempo Total por Máquina (minutos)
                                        </h4>
                                        <div class="relative h-64">
                                            <canvas id="setup-chart-tempo-maquina"></canvas>
                                        </div>
                                    </div>

                                    <!-- Gráfico 4: Evolução Diária -->
                                    <div class="bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 p-4 shadow-sm">
                                        <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                            <i data-lucide="trending-up" class="w-4 h-4 text-green-500"></i>
                                            Evolução Diária de Setups
                                        </h4>
                                        <div class="relative h-64">
                                            <canvas id="setup-chart-diario"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Gráfico 5: Distribuição de Tempo -->
                                <div class="mt-4 bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 p-4 shadow-sm">
                                    <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                        <i data-lucide="timer" class="w-4 h-4 text-purple-500"></i>
                                        Distribuição de Tempo de Setup
                                    </h4>
                                    <div class="relative h-64">
                                        <canvas id="setup-chart-distribuicao-tempo"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabela de Setups -->
                        <div class="p-4 border-t border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                <i data-lucide="table" class="w-5 h-5 text-orange-600"></i>
                                Registros de Setup
                            </h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm" id="setup-tabela">
                                    <thead class="bg-gray-100 text-gray-700">
                                        <tr>
                                            <th class="px-4 py-3 text-left font-semibold rounded-tl-lg">Data</th>
                                            <th class="px-4 py-3 text-left font-semibold">Máquina</th>
                                            <th class="px-4 py-3 text-left font-semibold">Descrição do Molde</th>
                                            <th class="px-4 py-3 text-center font-semibold">Tipo</th>
                                            <th class="px-4 py-3 text-center font-semibold">Início</th>
                                            <th class="px-4 py-3 text-center font-semibold">Fim</th>
                                            <th class="px-4 py-3 text-center font-semibold">Duração</th>
                                            <th class="px-4 py-3 text-left font-semibold">Observação</th>
                                            <th class="px-4 py-3 text-center font-semibold rounded-tr-lg">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="setup-tabela-body" class="divide-y divide-gray-100">
                                        <tr>
                                            <td colspan="9" class="text-center py-12 text-gray-400">
                                                <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                                <p>Nenhum registro de setup encontrado</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Paginação -->
                            <div id="setup-paginacao" class="flex flex-col sm:flex-row items-center justify-between gap-3 mt-4 pt-4 border-t border-gray-200">
                                <div class="text-sm text-gray-600">
                                    Mostrando <span id="setup-pag-inicio" class="font-semibold">0</span> - <span id="setup-pag-fim" class="font-semibold">0</span> de <span id="setup-pag-total" class="font-semibold">0</span> registros
                                </div>
                                <div class="flex items-center gap-2">
                                    <button id="setup-pag-primeira" class="p-2 text-gray-500 hover:text-orange-600 hover:bg-orange-50 rounded-lg transition disabled:opacity-40 disabled:cursor-not-allowed" title="Primeira página">
                                        <i data-lucide="chevrons-left" class="w-4 h-4"></i>
                                    </button>
                                    <button id="setup-pag-anterior" class="p-2 text-gray-500 hover:text-orange-600 hover:bg-orange-50 rounded-lg transition disabled:opacity-40 disabled:cursor-not-allowed" title="Página anterior">
                                        <i data-lucide="chevron-left" class="w-4 h-4"></i>
                                    </button>
                                    <span class="px-3 py-1.5 bg-orange-100 text-orange-700 rounded-lg text-sm font-semibold">
                                        Página <span id="setup-pag-atual">1</span> de <span id="setup-pag-total-paginas">1</span>
                                    </span>
                                    <button id="setup-pag-proxima" class="p-2 text-gray-500 hover:text-orange-600 hover:bg-orange-50 rounded-lg transition disabled:opacity-40 disabled:cursor-not-allowed" title="Próxima página">
                                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                    </button>
                                    <button id="setup-pag-ultima" class="p-2 text-gray-500 hover:text-orange-600 hover:bg-orange-50 rounded-lg transition disabled:opacity-40 disabled:cursor-not-allowed" title="Última página">
                                        <i data-lucide="chevrons-right" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: Ferramentaria - Controle de Moldes -->
                <div id="ferramentaria-page" class="page-content hidden space-y-4 p-2">
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-slate-700 to-zinc-800 px-6 py-4">
                            <div class="flex items-center justify-between flex-wrap gap-3">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-white/10 rounded-xl">
                                        <i data-lucide="settings-2" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-white">Ferramentaria</h2>
                                        <p class="text-slate-300 text-sm">Controle de moldes e manutenção preventiva</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button id="btn-registrar-manutencao" class="bg-green-500/80 hover:bg-green-500 text-white px-4 py-2 rounded-lg transition flex items-center gap-2 font-semibold">
                                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                                        Registrar Manutenção
                                    </button>
                                    <button id="btn-novo-molde" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition flex items-center gap-2 font-semibold">
                                        <i data-lucide="plus-circle" class="w-4 h-4"></i>
                                        Novo Molde
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Filtros -->
                        <div class="border-b border-gray-200 p-4 bg-gray-50">
                            <div class="flex flex-wrap items-end gap-4">
                                <div class="flex-1 min-w-[150px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="building-2" class="w-3 h-3 inline mr-1"></i> Cliente
                                    </label>
                                    <select id="ferram-filtro-cliente" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-slate-500">
                                        <option value="">Todos os clientes</option>
                                    </select>
                                </div>
                                <div class="flex-1 min-w-[150px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="alert-triangle" class="w-3 h-3 inline mr-1"></i> Status
                                    </label>
                                    <select id="ferram-filtro-status" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-slate-500">
                                        <option value="">Todos</option>
                                        <option value="critico">Crítico (≥90%)</option>
                                        <option value="atencao">Atenção (≥70%)</option>
                                        <option value="ok">Normal (&lt;70%)</option>
                                    </select>
                                </div>
                                <div class="flex-1 min-w-[200px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="search" class="w-3 h-3 inline mr-1"></i> Buscar Molde
                                    </label>
                                    <input type="text" id="ferram-busca-molde" placeholder="Digite o nome do molde..." class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-slate-500">
                                </div>
                                <button id="btn-buscar-moldes" class="bg-slate-700 hover:bg-slate-800 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center gap-2">
                                    <i data-lucide="filter" class="w-4 h-4"></i>
                                    Filtrar
                                </button>
                            </div>
                        </div>

                        <!-- Estatísticas -->
                        <div class="p-4 grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div class="bg-slate-50 rounded-xl p-3 text-center border border-slate-200">
                                <p class="text-2xl font-bold text-slate-700" id="ferram-total-moldes">0</p>
                                <p class="text-xs text-slate-600">Total de Moldes</p>
                            </div>
                            <div class="bg-red-50 rounded-xl p-3 text-center border border-red-200">
                                <p class="text-2xl font-bold text-red-600" id="ferram-moldes-criticos">0</p>
                                <p class="text-xs text-red-700">Críticos (≥90%)</p>
                            </div>
                            <div class="bg-yellow-50 rounded-xl p-3 text-center border border-yellow-200">
                                <p class="text-2xl font-bold text-yellow-600" id="ferram-moldes-atencao">0</p>
                                <p class="text-xs text-yellow-700">Atenção (≥70%)</p>
                            </div>
                            <div class="bg-green-50 rounded-xl p-3 text-center border border-green-200">
                                <p class="text-2xl font-bold text-green-600" id="ferram-moldes-ok">0</p>
                                <p class="text-xs text-green-700">Normais (&lt;70%)</p>
                            </div>
                        </div>

                        <!-- Tabela de Moldes -->
                        <div class="p-4">
                            <div class="overflow-x-auto rounded-xl border border-gray-200">
                                <table class="w-full text-sm">
                                    <thead class="bg-gray-100 text-gray-700">
                                        <tr>
                                            <th class="px-4 py-3 text-left font-semibold rounded-tl-lg">Cliente</th>
                                            <th class="px-4 py-3 text-left font-semibold">Molde</th>
                                            <th class="px-4 py-3 text-center font-semibold">Batidas Atuais</th>
                                            <th class="px-4 py-3 text-center font-semibold">Limite Preventiva</th>
                                            <th class="px-4 py-3 text-center font-semibold">Progresso</th>
                                            <th class="px-4 py-3 text-center font-semibold">Status</th>
                                            <th class="px-4 py-3 text-center font-semibold">Última Manutenção</th>
                                            <th class="px-4 py-3 text-center font-semibold rounded-tr-lg">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ferram-tabela-body" class="divide-y divide-gray-100">
                                        <tr>
                                            <td colspan="8" class="text-center py-12 text-gray-400">
                                                <i data-lucide="loader-2" class="w-12 h-12 mx-auto mb-2 opacity-50 animate-spin"></i>
                                                <p>Carregando moldes...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Histórico de Manutenções -->
                        <div class="p-4 border-t border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                <i data-lucide="history" class="w-5 h-5 text-slate-600"></i>
                                Últimas Manutenções Registradas
                            </h3>
                            <div id="ferram-historico" class="space-y-2 max-h-64 overflow-y-auto">
                                <div class="text-center py-6 text-gray-400">
                                    <i data-lucide="clipboard-list" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                    <p class="text-sm">Nenhuma manutenção registrada</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: PCP - Planejamento e Controle da Produção -->
                <div id="pcp-page" class="page-content hidden p-2">
                    <!-- ====== PCP HEADER GLOBAL + SUB-ABAS ====== -->
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-4">
                        <div class="bg-gradient-to-r from-indigo-700 to-purple-800 px-6 py-4">
                            <div class="flex items-center justify-between flex-wrap gap-3">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-white/10 rounded-xl">
                                        <i data-lucide="sliders" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-white">PCP - Planejamento e Controle da Produção</h2>
                                        <p class="text-indigo-200 text-sm">Gerencie produção, ordens e agendamento de máquinas</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Sub-abas -->
                        <div class="flex border-b border-gray-200 bg-gray-50 overflow-x-auto">
                            <button class="pcp-subtab-btn flex items-center gap-2 px-5 py-3 text-sm font-semibold border-b-2 transition-all whitespace-nowrap border-indigo-600 text-indigo-700 bg-white" data-subtab="pcp-dashboard">
                                <i data-lucide="monitor" class="w-4 h-4"></i>
                                Dashboard de Produção
                            </button>
                            <button class="pcp-subtab-btn flex items-center gap-2 px-5 py-3 text-sm font-semibold border-b-2 transition-all whitespace-nowrap border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-100" data-subtab="pcp-fila">
                                <i data-lucide="list-ordered" class="w-4 h-4"></i>
                                Fila de Ordens
                            </button>
                            <button class="pcp-subtab-btn flex items-center gap-2 px-5 py-3 text-sm font-semibold border-b-2 transition-all whitespace-nowrap border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-100" data-subtab="pcp-agendamento">
                                <i data-lucide="calendar-range" class="w-4 h-4"></i>
                                Agendamento Semanal
                            </button>
                        </div>
                    </div>

                    <!-- ====== SUB-ABA 1: DASHBOARD DE PRODUÇÃO ====== -->
                    <div id="pcp-subtab-pcp-dashboard" class="pcp-subtab-content space-y-4">
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <!-- Header Dashboard -->
                        <div class="bg-gradient-to-r from-slate-700 to-slate-800 px-6 py-3">
                            <div class="flex items-center justify-between flex-wrap gap-3">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="monitor" class="w-5 h-5 text-white"></i>
                                    <span class="text-white font-semibold">Visão em tempo real do status das máquinas</span>
                                </div>
                                <div class="flex gap-2 items-center flex-wrap">
                                    <div class="bg-white/10 backdrop-blur-sm rounded-lg px-3 py-1.5 flex items-center gap-2">
                                        <i data-lucide="calendar" class="w-4 h-4 text-white"></i>
                                        <input type="date" id="pcp-date-selector" 
                                            class="bg-transparent border-none text-white placeholder-white/70 focus:outline-none focus:ring-0 text-xs font-medium">
                                    </div>
                                    <div class="bg-white/10 backdrop-blur-sm rounded-lg px-3 py-1.5 flex items-center gap-2">
                                        <i data-lucide="clock" class="w-4 h-4 text-white"></i>
                                        <select id="pcp-shift-selector" class="bg-transparent border-none text-white focus:outline-none focus:ring-0 text-xs font-medium cursor-pointer">
                                            <option value="current" class="text-gray-900">Turno Atual</option>
                                            <option value="all" class="text-gray-900">Todos os Turnos</option>
                                            <option value="1" class="text-gray-900">Turno 1 (06:30-15:00)</option>
                                            <option value="2" class="text-gray-900">Turno 2 (15:00-23:30)</option>
                                            <option value="3" class="text-gray-900">Turno 3 (23:30-06:30)</option>
                                        </select>
                                    </div>
                                    <button id="btn-pcp-priority" class="bg-amber-500/80 hover:bg-amber-500 text-white px-4 py-2 rounded-lg transition flex items-center gap-2 font-semibold">
                                        <i data-lucide="star" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Prioridade</span>
                                    </button>
                                    <button id="btn-pcp-refresh" class="bg-indigo-500/80 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg transition flex items-center gap-2 font-semibold">
                                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Atualizar</span>
                                    </button>
                                    <button id="btn-pcp-export-excel" class="bg-green-600/80 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition flex items-center gap-2 font-semibold">
                                        <i data-lucide="file-spreadsheet" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Exportar Excel</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- KPIs Resumo -->
                        <div class="grid grid-cols-3 gap-3 p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b">
                            <div class="bg-white rounded-xl p-3 shadow-sm border border-gray-100">
                                <div class="flex items-center gap-2">
                                    <div class="p-1.5 bg-blue-100 rounded-lg">
                                        <i data-lucide="settings-2" class="w-4 h-4 text-blue-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500">Máquinas Planejadas</p>
                                        <p class="text-lg font-bold text-blue-600" id="pcp-kpi-machines">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl p-3 shadow-sm border border-gray-100">
                                <div class="flex items-center gap-2">
                                    <div class="p-1.5 bg-green-100 rounded-lg">
                                        <i data-lucide="play-circle" class="w-4 h-4 text-green-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500">Produzindo</p>
                                        <p class="text-lg font-bold text-green-600" id="pcp-kpi-producing">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl p-3 shadow-sm border border-gray-100">
                                <div class="flex items-center gap-2">
                                    <div class="p-1.5 bg-red-100 rounded-lg">
                                        <i data-lucide="alert-circle" class="w-4 h-4 text-red-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500">Paradas</p>
                                        <p class="text-lg font-bold text-red-600" id="pcp-kpi-stopped">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabela Dashboard -->
                        <div class="p-4">
                            <!-- Loading -->
                            <div id="pcp-loading" class="flex items-center justify-center py-12">
                                <div class="flex flex-col items-center gap-3">
                                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                                    <p class="text-sm text-gray-500">Carregando dados...</p>
                                </div>
                            </div>

                            <!-- Tabela -->
                            <div id="pcp-table-container" class="hidden overflow-x-auto">
                                <table class="w-full text-sm border-collapse" id="pcp-table">
                                    <thead class="bg-slate-700 text-white sticky top-0">
                                        <tr>
                                            <th class="px-2 py-2 text-center font-semibold whitespace-nowrap border border-slate-600">Máquina</th>
                                            <th class="px-2 py-2 text-center font-semibold whitespace-nowrap border border-slate-600">Prioridade</th>
                                            <th class="px-2 py-2 text-center font-semibold whitespace-nowrap border border-slate-600">Cavidade</th>
                                            <th class="px-2 py-2 text-center font-semibold whitespace-nowrap border border-slate-600">Ciclo (s)</th>
                                            <th class="px-2 py-2 text-center font-semibold whitespace-nowrap border border-slate-600">Status</th>
                                            <th class="px-2 py-2 text-left font-semibold whitespace-nowrap border border-slate-600">Cliente</th>
                                            <th class="px-2 py-2 text-left font-semibold whitespace-nowrap border border-slate-600">Produto</th>
                                            <th class="px-2 py-2 text-left font-semibold whitespace-nowrap border border-slate-600">Motivo Parada</th>
                                            <th class="px-2 py-2 text-center font-semibold whitespace-nowrap border border-slate-600">Fila</th>
                                            <th class="px-2 py-2 text-left font-semibold whitespace-nowrap border border-slate-600" style="min-width:160px">Observação</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pcp-table-body">
                                        <!-- Linhas serão inseridas via JavaScript -->
                                    </tbody>
                                </table>
                            </div>

                            <!-- Estado Vazio -->
                            <div id="pcp-empty-state" class="hidden py-12 text-center">
                                <div class="inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full mb-4">
                                    <i data-lucide="inbox" class="w-8 h-8 text-gray-400"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-2">Nenhum planejamento encontrado</h3>
                                <p class="text-sm text-gray-500">Não há planejamento cadastrado para a data selecionada.</p>
                            </div>
                        </div>
                    </div>
                    </div>
                    <!-- ====== FIM SUB-ABA 1 ====== -->

                    <!-- ====== SUB-ABA 2: FILA DE ORDENS ====== -->
                    <div id="pcp-subtab-pcp-fila" class="pcp-subtab-content hidden space-y-4">
                    <!-- SEÇÃO: Fila de Ordens de Produção por Máquina -->
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="bg-gradient-to-r from-cyan-700 to-blue-800 px-6 py-4">
                            <div class="flex items-center justify-between flex-wrap gap-3">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-white/10 rounded-xl">
                                        <i data-lucide="list-ordered" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-white">Fila de Ordens por Máquina</h2>
                                        <p class="text-cyan-200 text-sm">Ordens de produção importadas (Excel) organizadas por máquina</p>
                                    </div>
                                </div>
                                <div class="flex gap-2 items-center flex-wrap">
                                    <div class="relative">
                                        <input type="text" id="queue-machine-filter" placeholder="Filtrar máquina..." 
                                            class="bg-white/10 border border-white/20 text-white placeholder-white/50 rounded-lg px-3 py-1.5 text-xs w-36 focus:ring-2 focus:ring-white/30 focus:bg-white/20">
                                    </div>
                                    <select id="queue-status-filter" class="bg-white/10 border border-white/20 text-white rounded-lg px-3 py-1.5 text-xs focus:ring-2 focus:ring-white/30">
                                        <option value="" class="text-gray-900">Todos Status</option>
                                        <option value="planejada" class="text-gray-900">Planejada</option>
                                        <option value="ativa" class="text-gray-900">Ativa</option>
                                        <option value="em_andamento" class="text-gray-900">Em Andamento</option>
                                        <option value="suspensa" class="text-gray-900">Suspensa</option>
                                    </select>
                                    <button type="button" id="queue-expand-all" 
                                        class="bg-white/10 hover:bg-white/20 text-white/80 px-2.5 py-2 rounded-lg flex items-center gap-1 transition text-xs" title="Expandir Todos">
                                        <i data-lucide="chevrons-down" class="w-4 h-4"></i>
                                    </button>
                                    <button type="button" id="queue-collapse-all" 
                                        class="bg-white/10 hover:bg-white/20 text-white/80 px-2.5 py-2 rounded-lg flex items-center gap-1 transition text-xs" title="Recolher Todos">
                                        <i data-lucide="chevrons-up" class="w-4 h-4"></i>
                                    </button>
                                    <button type="button" id="refresh-machine-queue" 
                                        class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition font-semibold text-sm">
                                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Atualizar</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- KPIs da Fila -->
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b">
                            <div class="bg-white rounded-xl p-3 shadow-sm border border-gray-100">
                                <div class="flex items-center gap-2">
                                    <div class="p-1.5 bg-blue-100 rounded-lg"><i data-lucide="layers" class="w-4 h-4 text-blue-600"></i></div>
                                    <div>
                                        <p class="text-[10px] text-gray-500 uppercase">Total OPs</p>
                                        <p class="text-lg font-bold text-blue-600" id="queue-kpi-total">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl p-3 shadow-sm border border-gray-100">
                                <div class="flex items-center gap-2">
                                    <div class="p-1.5 bg-indigo-100 rounded-lg"><i data-lucide="server" class="w-4 h-4 text-indigo-600"></i></div>
                                    <div>
                                        <p class="text-[10px] text-gray-500 uppercase">Máquinas</p>
                                        <p class="text-lg font-bold text-indigo-600" id="queue-kpi-machines">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl p-3 shadow-sm border border-gray-100">
                                <div class="flex items-center gap-2">
                                    <div class="p-1.5 bg-amber-100 rounded-lg"><i data-lucide="play-circle" class="w-4 h-4 text-amber-600"></i></div>
                                    <div>
                                        <p class="text-[10px] text-gray-500 uppercase">Ativas</p>
                                        <p class="text-lg font-bold text-amber-600" id="queue-kpi-active">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl p-3 shadow-sm border border-gray-100">
                                <div class="flex items-center gap-2">
                                    <div class="p-1.5 bg-emerald-100 rounded-lg"><i data-lucide="check-circle-2" class="w-4 h-4 text-emerald-600"></i></div>
                                    <div>
                                        <p class="text-[10px] text-gray-500 uppercase">Concluídas</p>
                                        <p class="text-lg font-bold text-emerald-600" id="queue-kpi-completed">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Container da Fila -->
                        <div id="machine-queue-container" class="p-4">
                            <div class="text-center py-12">
                                <i data-lucide="list-ordered" class="w-12 h-12 text-gray-300 mx-auto mb-3"></i>
                                <p class="text-gray-500 font-medium">Carregando fila de ordens...</p>
                                <p class="text-gray-400 text-sm mt-1">As ordens importadas via Excel serão organizadas por máquina</p>
                            </div>
                        </div>
                    </div>
                    </div>
                    <!-- ====== FIM SUB-ABA 2 ====== -->

                    <!-- ====== SUB-ABA 3: AGENDAMENTO SEMANAL ====== -->
                    <div id="pcp-subtab-pcp-agendamento" class="pcp-subtab-content hidden space-y-4">
                    <!-- ====== AGENDAMENTO SEMANAL DE MÁQUINAS ====== -->
                    <div id="schedule-section" class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-teal-600 to-cyan-700 px-6 py-4">
                            <div class="flex items-center justify-between flex-wrap gap-3">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-white/10 rounded-xl">
                                        <i data-lucide="calendar-range" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-white">Agendamento Semanal de Máquinas</h2>
                                        <p class="text-teal-100 text-sm">Defina quais máquinas operam em cada dia da semana</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Conteúdo do Agendamento (visível quando sub-aba ativa) -->
                        <div id="schedule-content">
                            <!-- Navegação de Semana + Ações -->
                            <div class="p-4 bg-gradient-to-r from-slate-50 to-gray-50 border-b">
                                <div class="flex items-center justify-between flex-wrap gap-3">
                                    <!-- Navegação Semana -->
                                    <div class="flex items-center gap-3">
                                        <button id="btn-schedule-prev-week" class="p-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition" title="Semana anterior">
                                            <i data-lucide="chevron-left" class="w-5 h-5 text-gray-600"></i>
                                        </button>
                                        <div class="text-center min-w-[200px]">
                                            <p class="text-sm font-bold text-gray-800" id="schedule-week-label">Semana</p>
                                            <p class="text-xs text-gray-500" id="schedule-week-range">--/--/---- a --/--/----</p>
                                        </div>
                                        <button id="btn-schedule-next-week" class="p-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition" title="Próxima semana">
                                            <i data-lucide="chevron-right" class="w-5 h-5 text-gray-600"></i>
                                        </button>
                                        <button id="btn-schedule-today" class="bg-teal-100 text-teal-700 px-3 py-2 rounded-lg text-xs font-semibold hover:bg-teal-200 transition">
                                            Semana Atual
                                        </button>
                                    </div>

                                    <!-- Ações Rápidas -->
                                    <div class="flex gap-2 flex-wrap">
                                        <button id="btn-schedule-copy-prev" class="bg-indigo-100 text-indigo-700 px-3 py-2 rounded-lg text-xs font-semibold hover:bg-indigo-200 transition flex items-center gap-1">
                                            <i data-lucide="copy" class="w-3.5 h-3.5"></i>
                                            Copiar Semana Anterior
                                        </button>
                                        <button id="btn-schedule-select-all" class="bg-emerald-100 text-emerald-700 px-3 py-2 rounded-lg text-xs font-semibold hover:bg-emerald-200 transition flex items-center gap-1">
                                            <i data-lucide="check-square" class="w-3.5 h-3.5"></i>
                                            Marcar Tudo
                                        </button>
                                        <button id="btn-schedule-clear-all" class="bg-red-100 text-red-700 px-3 py-2 rounded-lg text-xs font-semibold hover:bg-red-200 transition flex items-center gap-1">
                                            <i data-lucide="x-square" class="w-3.5 h-3.5"></i>
                                            Limpar Tudo
                                        </button>
                                        <button id="btn-schedule-save" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg text-xs font-bold transition flex items-center gap-1 shadow-md">
                                            <i data-lucide="save" class="w-3.5 h-3.5"></i>
                                            Salvar Semana
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- KPIs Resumo do Agendamento -->
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 p-4 border-b bg-white">
                                <div class="bg-teal-50 rounded-xl p-3 border border-teal-100">
                                    <div class="flex items-center gap-2">
                                        <div class="p-1.5 bg-teal-100 rounded-lg"><i data-lucide="settings-2" class="w-4 h-4 text-teal-600"></i></div>
                                        <div>
                                            <p class="text-[10px] text-teal-600 uppercase font-semibold">Total Máquinas</p>
                                            <p class="text-lg font-bold text-teal-700" id="schedule-kpi-total">26</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-emerald-50 rounded-xl p-3 border border-emerald-100">
                                    <div class="flex items-center gap-2">
                                        <div class="p-1.5 bg-emerald-100 rounded-lg"><i data-lucide="play-circle" class="w-4 h-4 text-emerald-600"></i></div>
                                        <div>
                                            <p class="text-[10px] text-emerald-600 uppercase font-semibold">Agendadas Hoje</p>
                                            <p class="text-lg font-bold text-emerald-700" id="schedule-kpi-today">0</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-amber-50 rounded-xl p-3 border border-amber-100">
                                    <div class="flex items-center gap-2">
                                        <div class="p-1.5 bg-amber-100 rounded-lg"><i data-lucide="bar-chart-3" class="w-4 h-4 text-amber-600"></i></div>
                                        <div>
                                            <p class="text-[10px] text-amber-600 uppercase font-semibold">Média Semana</p>
                                            <p class="text-lg font-bold text-amber-700" id="schedule-kpi-avg">0</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-blue-50 rounded-xl p-3 border border-blue-100">
                                    <div class="flex items-center gap-2">
                                        <div class="p-1.5 bg-blue-100 rounded-lg"><i data-lucide="percent" class="w-4 h-4 text-blue-600"></i></div>
                                        <div>
                                            <p class="text-[10px] text-blue-600 uppercase font-semibold">Utilização</p>
                                            <p class="text-lg font-bold text-blue-700" id="schedule-kpi-usage">0%</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tabela do Agendamento Semanal -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm" id="schedule-grid-table">
                                    <thead>
                                        <tr class="bg-gray-100 border-b">
                                            <th class="text-left px-3 py-2.5 text-xs font-bold text-gray-600 uppercase sticky left-0 bg-gray-100 z-10 min-w-[140px]">
                                                Máquina
                                            </th>
                                            <th class="text-center px-2 py-2.5 text-xs font-bold uppercase min-w-[90px]" id="schedule-th-seg">
                                                <span class="text-gray-600">Seg</span>
                                                <br><span class="text-[10px] text-gray-400 font-normal schedule-day-date" data-day="0"></span>
                                                <br>
                                                <button class="schedule-col-toggle text-[10px] text-teal-600 hover:text-teal-800 font-semibold mt-0.5" data-day="0" title="Marcar/Desmarcar coluna">
                                                    ✓ Todos
                                                </button>
                                            </th>
                                            <th class="text-center px-2 py-2.5 text-xs font-bold uppercase min-w-[90px]" id="schedule-th-ter">
                                                <span class="text-gray-600">Ter</span>
                                                <br><span class="text-[10px] text-gray-400 font-normal schedule-day-date" data-day="1"></span>
                                                <br>
                                                <button class="schedule-col-toggle text-[10px] text-teal-600 hover:text-teal-800 font-semibold mt-0.5" data-day="1" title="Marcar/Desmarcar coluna">
                                                    ✓ Todos
                                                </button>
                                            </th>
                                            <th class="text-center px-2 py-2.5 text-xs font-bold uppercase min-w-[90px]" id="schedule-th-qua">
                                                <span class="text-gray-600">Qua</span>
                                                <br><span class="text-[10px] text-gray-400 font-normal schedule-day-date" data-day="2"></span>
                                                <br>
                                                <button class="schedule-col-toggle text-[10px] text-teal-600 hover:text-teal-800 font-semibold mt-0.5" data-day="2" title="Marcar/Desmarcar coluna">
                                                    ✓ Todos
                                                </button>
                                            </th>
                                            <th class="text-center px-2 py-2.5 text-xs font-bold uppercase min-w-[90px]" id="schedule-th-qui">
                                                <span class="text-gray-600">Qui</span>
                                                <br><span class="text-[10px] text-gray-400 font-normal schedule-day-date" data-day="3"></span>
                                                <br>
                                                <button class="schedule-col-toggle text-[10px] text-teal-600 hover:text-teal-800 font-semibold mt-0.5" data-day="3" title="Marcar/Desmarcar coluna">
                                                    ✓ Todos
                                                </button>
                                            </th>
                                            <th class="text-center px-2 py-2.5 text-xs font-bold uppercase min-w-[90px]" id="schedule-th-sex">
                                                <span class="text-gray-600">Sex</span>
                                                <br><span class="text-[10px] text-gray-400 font-normal schedule-day-date" data-day="4"></span>
                                                <br>
                                                <button class="schedule-col-toggle text-[10px] text-teal-600 hover:text-teal-800 font-semibold mt-0.5" data-day="4" title="Marcar/Desmarcar coluna">
                                                    ✓ Todos
                                                </button>
                                            </th>
                                            <th class="text-center px-2 py-2.5 text-xs font-bold uppercase min-w-[90px] bg-blue-50" id="schedule-th-sab">
                                                <span class="text-blue-600">Sáb</span>
                                                <br><span class="text-[10px] text-blue-400 font-normal schedule-day-date" data-day="5"></span>
                                                <br>
                                                <button class="schedule-col-toggle text-[10px] text-blue-600 hover:text-blue-800 font-semibold mt-0.5" data-day="5" title="Marcar/Desmarcar coluna">
                                                    ✓ Todos
                                                </button>
                                            </th>
                                            <th class="text-center px-2 py-2.5 text-xs font-bold uppercase min-w-[90px] bg-red-50" id="schedule-th-dom">
                                                <span class="text-red-500">Dom</span>
                                                <br><span class="text-[10px] text-red-400 font-normal schedule-day-date" data-day="6"></span>
                                                <br>
                                                <button class="schedule-col-toggle text-[10px] text-red-500 hover:text-red-700 font-semibold mt-0.5" data-day="6" title="Marcar/Desmarcar coluna">
                                                    ✓ Todos
                                                </button>
                                            </th>
                                            <th class="text-center px-2 py-2.5 text-xs font-bold text-gray-600 uppercase min-w-[60px]">
                                                Total
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="schedule-grid-body">
                                        <!-- Gerado via JavaScript -->
                                    </tbody>
                                    <tfoot>
                                        <tr class="bg-gray-100 border-t-2 border-gray-300 font-bold">
                                            <td class="px-3 py-2.5 text-xs text-gray-700 sticky left-0 bg-gray-100 z-10">
                                                TOTAL POR DIA
                                            </td>
                                            <td class="text-center px-2 py-2.5 text-sm text-teal-700" id="schedule-total-seg">0</td>
                                            <td class="text-center px-2 py-2.5 text-sm text-teal-700" id="schedule-total-ter">0</td>
                                            <td class="text-center px-2 py-2.5 text-sm text-teal-700" id="schedule-total-qua">0</td>
                                            <td class="text-center px-2 py-2.5 text-sm text-teal-700" id="schedule-total-qui">0</td>
                                            <td class="text-center px-2 py-2.5 text-sm text-teal-700" id="schedule-total-sex">0</td>
                                            <td class="text-center px-2 py-2.5 text-sm text-blue-700 bg-blue-50" id="schedule-total-sab">0</td>
                                            <td class="text-center px-2 py-2.5 text-sm text-red-600 bg-red-50" id="schedule-total-dom">0</td>
                                            <td class="text-center px-2 py-2.5 text-sm text-gray-700" id="schedule-total-week">0</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>

                            <!-- Status de Salvamento -->
                            <div class="p-3 bg-gray-50 border-t flex items-center justify-between">
                                <p class="text-xs text-gray-500" id="schedule-last-saved">
                                    <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
                                    Nenhum agendamento salvo para esta semana
                                </p>
                                <p class="text-xs font-semibold hidden" id="schedule-save-status"></p>
                            </div>
                        </div>
                    </div>
                    <!-- ====== FIM AGENDAMENTO SEMANAL ====== -->
                    </div>
                    <!-- ====== FIM SUB-ABA 3 ====== -->

                    <!-- Modal Prioridade de Máquinas -->
                    <div id="modal-pcp-priority" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
                            <div class="bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="p-2 bg-white/20 rounded-lg">
                                            <i data-lucide="star" class="w-5 h-5 text-white"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-bold text-white">Prioridade de Máquinas</h3>
                                            <p class="text-amber-100 text-xs">Defina a prioridade de 0 a 5</p>
                                        </div>
                                    </div>
                                    <button id="btn-close-priority-modal" class="text-white/80 hover:text-white transition">
                                        <i data-lucide="x" class="w-6 h-6"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="p-6 space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        <i data-lucide="settings-2" class="w-4 h-4 inline mr-1"></i> Selecione a Máquina
                                    </label>
                                    <select id="pcp-priority-machine" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
                                        <option value="">-- Selecione uma máquina --</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        <i data-lucide="trending-up" class="w-4 h-4 inline mr-1"></i> Prioridade
                                    </label>
                                    <div class="grid grid-cols-6 gap-2">
                                        <button class="priority-btn p-3 rounded-lg border-2 border-gray-200 hover:border-red-400 text-center font-bold transition" data-priority="0">
                                            <span class="text-lg text-red-600">0</span>
                                            <p class="text-[10px] text-red-500">Urgente</p>
                                        </button>
                                        <button class="priority-btn p-3 rounded-lg border-2 border-gray-200 hover:border-orange-400 text-center font-bold transition" data-priority="1">
                                            <span class="text-lg text-orange-600">1</span>
                                            <p class="text-[10px] text-orange-500">Alta</p>
                                        </button>
                                        <button class="priority-btn p-3 rounded-lg border-2 border-gray-200 hover:border-amber-400 text-center font-bold transition" data-priority="2">
                                            <span class="text-lg text-amber-600">2</span>
                                            <p class="text-[10px] text-amber-500">Méd-Alta</p>
                                        </button>
                                        <button class="priority-btn p-3 rounded-lg border-2 border-gray-200 hover:border-yellow-400 text-center font-bold transition" data-priority="3">
                                            <span class="text-lg text-yellow-600">3</span>
                                            <p class="text-[10px] text-yellow-600">Média</p>
                                        </button>
                                        <button class="priority-btn p-3 rounded-lg border-2 border-gray-200 hover:border-lime-400 text-center font-bold transition" data-priority="4">
                                            <span class="text-lg text-lime-600">4</span>
                                            <p class="text-[10px] text-lime-600">Baixa</p>
                                        </button>
                                        <button class="priority-btn p-3 rounded-lg border-2 border-gray-200 hover:border-gray-400 text-center font-bold transition" data-priority="5">
                                            <span class="text-lg text-gray-500">5</span>
                                            <p class="text-[10px] text-gray-400">Mínima</p>
                                        </button>
                                    </div>
                                    <input type="hidden" id="pcp-priority-value" value="">
                                </div>
                                <div class="bg-amber-50 border border-amber-200 rounded-lg p-3">
                                    <p class="text-xs text-amber-700">
                                        <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
                                        <strong>Dica:</strong> Prioridade 0 = Urgência máxima (vermelho). Prioridade 5 = Mínima (cinza).
                                    </p>
                                </div>
                            </div>
                            <div class="border-t border-gray-200 px-6 py-4 bg-gray-50 flex justify-end gap-3">
                                <button id="btn-cancel-priority" class="px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition">
                                    Cancelar
                                </button>
                                <button id="btn-save-priority" class="bg-amber-500 hover:bg-amber-600 text-white px-6 py-2 rounded-lg font-semibold transition flex items-center gap-2">
                                    <i data-lucide="save" class="w-4 h-4"></i>
                                    Salvar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: Relatórios (Somente Visualização) -->
                <div id="relatorios-page" class="page-content hidden space-y-4 p-2">
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-indigo-600 to-blue-700 px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-white/10 rounded-xl">
                                        <i data-lucide="file-bar-chart" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-white">Relatórios</h2>
                                        <p class="text-blue-200 text-sm">Visualização e análise de dados</p>
                                    </div>
                                </div>
                                <span class="bg-blue-500/30 px-3 py-1 rounded-full text-xs font-bold text-white uppercase tracking-wider">
                                    📊 Somente Leitura
                                </span>
                            </div>
                        </div>

                        <!-- Abas internas -->
                        <div class="border-b border-gray-200">
                            <nav class="flex gap-1 px-4 pt-2 overflow-x-auto">
                                <button class="rel-tab-btn active px-4 py-2 text-sm font-semibold rounded-t-lg transition bg-blue-500 text-white whitespace-nowrap" data-rel-tab="producao">
                                    <i data-lucide="bar-chart-2" class="w-4 h-4 inline mr-1"></i> Produção
                                </button>
                                <button class="rel-tab-btn px-4 py-2 text-sm font-semibold rounded-t-lg transition bg-gray-100 text-gray-600 hover:bg-gray-200 whitespace-nowrap" data-rel-tab="perdas">
                                    <i data-lucide="trash-2" class="w-4 h-4 inline mr-1"></i> Perdas
                                </button>
                                <button class="rel-tab-btn px-4 py-2 text-sm font-semibold rounded-t-lg transition bg-gray-100 text-gray-600 hover:bg-gray-200 whitespace-nowrap" data-rel-tab="paradas">
                                    <i data-lucide="pause-circle" class="w-4 h-4 inline mr-1"></i> Paradas
                                </button>
                            </nav>
                        </div>

                        <!-- Conteúdo das abas -->
                        <div class="p-4">
                            <!-- Aba: Produção -->
                            <div id="rel-tab-producao" class="rel-tab-content">
                                <div class="mb-6">
                                    <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
                                        <i data-lucide="eye" class="w-5 h-5 text-blue-600"></i>
                                        Relatório de Produção
                                    </h3>
                                    <p class="text-sm text-gray-600 mb-4">Consulte e analise os lançamentos de produção.</p>
                                    
                                    <div class="flex flex-wrap items-end gap-3 p-4 bg-blue-50 rounded-lg border border-blue-200">
                                        <!-- Período -->
                                        <div class="flex-1 min-w-[140px] max-w-[180px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Período</label>
                                            <select id="rel-producao-periodo" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                                <option value="today" selected>Hoje</option>
                                                <option value="yesterday">Ontem</option>
                                                <option value="7days">Últimos 7 dias</option>
                                                <option value="30days">Últimos 30 dias</option>
                                                <option value="custom">Personalizado</option>
                                            </select>
                                        </div>
                                        <!-- Data Início -->
                                        <div class="min-w-[130px] hidden" id="rel-producao-custom-dates">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Início</label>
                                            <input type="date" id="rel-producao-data-inicio" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <!-- Data Fim -->
                                        <div class="min-w-[130px] hidden" id="rel-producao-custom-dates-fim">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Fim</label>
                                            <input type="date" id="rel-producao-data-fim" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div class="flex-1 min-w-[130px] max-w-[160px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                                            <select id="rel-producao-maquina" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                                <option value="">Todas</option>
                                            </select>
                                        </div>
                                        <div class="flex-1 min-w-[80px] max-w-[100px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                                            <select id="rel-producao-turno" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                                <option value="">Todos</option>
                                                <option value="1">1º Turno</option>
                                                <option value="2">2º Turno</option>
                                                <option value="3">3º Turno</option>
                                            </select>
                                        </div>
                                        <div class="flex-1 min-w-[120px] max-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Cód. Produto</label>
                                            <input type="text" id="rel-producao-cod-produto" placeholder="Ex: 10001234" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div class="flex-1 min-w-[120px] max-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Ordem (OP)</label>
                                            <input type="text" id="rel-producao-op" placeholder="Ex: 123456" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <button id="rel-btn-buscar-producao" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                            Buscar
                                        </button>
                                        <button id="rel-btn-exportar-producao" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="download" class="w-4 h-4"></i>
                                            Exportar CSV
                                        </button>
                                        <button id="rel-btn-exportar-producao-tabela" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="table" class="w-4 h-4"></i>
                                            Exportar Tabela
                                        </button>
                                    </div>
                                </div>

                                <!-- Estatísticas da busca -->
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3 mb-4">
                                    <div class="bg-blue-50 rounded-lg p-2 md:p-3 text-center border border-blue-100">
                                        <div id="rel-prod-total" class="text-lg md:text-xl font-bold text-blue-600">0</div>
                                        <div class="text-xs text-blue-700">Total Registros</div>
                                    </div>
                                    <div class="bg-green-50 rounded-lg p-2 md:p-3 text-center border border-green-100">
                                        <div id="rel-prod-pecas" class="text-lg md:text-xl font-bold text-green-600">0</div>
                                        <div class="text-xs text-green-700">Total Peças</div>
                                    </div>
                                    <div class="bg-amber-50 rounded-lg p-2 md:p-3 text-center border border-amber-100">
                                        <div id="rel-prod-peso" class="text-lg md:text-xl font-bold text-amber-600">0</div>
                                        <div class="text-xs text-amber-700">Peso Total (kg)</div>
                                    </div>
                                    <div class="bg-red-50 rounded-lg p-2 md:p-3 text-center border border-red-100">
                                        <div id="rel-prod-refugo" class="text-lg md:text-xl font-bold text-red-600">0</div>
                                        <div class="text-xs text-red-700">Refugo (kg)</div>
                                    </div>
                                </div>

                                <!-- Lista de registros de produção -->
                                <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                                    <div class="overflow-x-auto max-h-[50vh] md:max-h-[500px]">
                                        <table class="w-full text-sm" id="rel-producao-tabela">
                                            <thead class="bg-gray-100 text-gray-700 sticky top-0">
                                                <tr>
                                                    <th class="px-3 py-2 text-left font-semibold">Data</th>
                                                    <th class="px-3 py-2 text-left font-semibold">Máquina</th>
                                                    <th class="px-3 py-2 text-left font-semibold">Turno</th>
                                                    <th class="px-3 py-2 text-left font-semibold">OP</th>
                                                    <th class="px-3 py-2 text-left font-semibold">Código</th>
                                                    <th class="px-3 py-2 text-left font-semibold">Produto</th>
                                                    <th class="px-3 py-2 text-right font-semibold">Qtd</th>
                                                    <th class="px-3 py-2 text-right font-semibold">Refugo (kg)</th>
                                                    <th class="px-3 py-2 text-center font-semibold">Cód Usuário</th>
                                                </tr>
                                            </thead>
                                            <tbody id="rel-producao-tbody" class="divide-y divide-gray-100">
                                                <tr>
                                                    <td colspan="9" class="text-center py-8 text-gray-400">
                                                        <i data-lucide="bar-chart-2" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                                        <p>Selecione filtros e clique em "Buscar"</p>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Aba: Perdas -->
                            <div id="rel-tab-perdas" class="rel-tab-content hidden">
                                <div class="mb-6">
                                    <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
                                        <i data-lucide="eye" class="w-5 h-5 text-red-600"></i>
                                        Relatório de Perdas
                                    </h3>
                                    <p class="text-sm text-gray-600 mb-4">Consulte e analise refugos, borras e sucatas.</p>
                                    
                                    <div class="flex flex-wrap items-end gap-3 p-4 bg-red-50 rounded-lg border border-red-200">
                                        <!-- Período -->
                                        <div class="flex-1 min-w-[140px] max-w-[180px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Período</label>
                                            <select id="rel-perdas-periodo" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                                <option value="today" selected>Hoje</option>
                                                <option value="yesterday">Ontem</option>
                                                <option value="7days">Últimos 7 dias</option>
                                                <option value="30days">Últimos 30 dias</option>
                                                <option value="custom">Personalizado</option>
                                            </select>
                                        </div>
                                        <!-- Data Início -->
                                        <div class="min-w-[130px] hidden" id="rel-perdas-custom-dates">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Início</label>
                                            <input type="date" id="rel-perdas-data-inicio" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                        </div>
                                        <!-- Data Fim -->
                                        <div class="min-w-[130px] hidden" id="rel-perdas-custom-dates-fim">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Fim</label>
                                            <input type="date" id="rel-perdas-data-fim" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                        </div>
                                        <div class="flex-1 min-w-[130px] max-w-[160px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                                            <select id="rel-perdas-maquina" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                                <option value="">Todas</option>
                                            </select>
                                        </div>
                                        <div class="flex-1 min-w-[80px] max-w-[100px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                                            <select id="rel-perdas-turno" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                                <option value="">Todos</option>
                                                <option value="1">1º Turno</option>
                                                <option value="2">2º Turno</option>
                                                <option value="3">3º Turno</option>
                                            </select>
                                        </div>
                                        <div class="flex-1 min-w-[100px] max-w-[120px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Tipo</label>
                                            <select id="rel-perdas-tipo" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                                <option value="">Todos</option>
                                                <option value="refugo">Refugo</option>
                                                <option value="borra">Borra</option>
                                                <option value="sucata">Sucata</option>
                                            </select>
                                        </div>
                                        <div class="flex-1 min-w-[110px] max-w-[140px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Cód. Produto</label>
                                            <input type="text" id="rel-perdas-cod-produto" placeholder="Ex: 10001234" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                        </div>
                                        <div class="flex-1 min-w-[110px] max-w-[140px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Ordem (OP)</label>
                                            <input type="text" id="rel-perdas-op" placeholder="Ex: 123456" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                        </div>
                                        <button id="rel-btn-buscar-perdas" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                            Buscar
                                        </button>
                                        <button id="rel-btn-exportar-perdas" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="download" class="w-4 h-4"></i>
                                            Exportar CSV
                                        </button>
                                        <button id="rel-btn-exportar-perdas-tabela" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="table" class="w-4 h-4"></i>
                                            Exportar Tabela
                                        </button>
                                    </div>
                                </div>

                                <!-- Estatísticas da busca -->
                                <div class="grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-3 mb-4">
                                    <div class="bg-blue-50 rounded-lg p-2 md:p-3 text-center border border-blue-100">
                                        <div id="rel-perdas-total" class="text-lg md:text-xl font-bold text-blue-600">0</div>
                                        <div class="text-xs text-blue-700">Total Registros</div>
                                    </div>
                                    <div class="bg-red-50 rounded-lg p-2 md:p-3 text-center border border-red-100">
                                        <div id="rel-perdas-peso" class="text-lg md:text-xl font-bold text-red-600">0</div>
                                        <div class="text-xs text-red-700">Peso Total (kg)</div>
                                    </div>
                                    <div class="bg-amber-50 rounded-lg p-2 md:p-3 text-center border border-amber-100">
                                        <div id="rel-perdas-borra" class="text-lg md:text-xl font-bold text-amber-600">0</div>
                                        <div class="text-xs text-amber-700">Borras (kg)</div>
                                    </div>
                                    <div class="bg-orange-50 rounded-lg p-2 md:p-3 text-center border border-orange-100">
                                        <div id="rel-perdas-refugo" class="text-lg md:text-xl font-bold text-orange-600">0</div>
                                        <div class="text-xs text-orange-700">Refugo (kg)</div>
                                    </div>
                                    <div class="bg-purple-50 rounded-lg p-2 md:p-3 text-center border border-purple-100">
                                        <div id="rel-perdas-sucata" class="text-lg md:text-xl font-bold text-purple-600">0</div>
                                        <div class="text-xs text-purple-700">Sucata (kg)</div>
                                    </div>
                                </div>

                                <!-- Lista de registros de perdas -->
                                <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                                    <div class="overflow-x-auto max-h-[50vh] md:max-h-[500px]">
                                        <table class="w-full text-sm" id="rel-perdas-tabela">
                                            <thead class="bg-gray-100 text-gray-700 sticky top-0">
                                                <tr>
                                                    <th class="px-3 py-2 text-left font-semibold">Data</th>
                                                    <th class="px-3 py-2 text-left font-semibold">Máquina</th>
                                                    <th class="px-3 py-2 text-left font-semibold">Turno</th>
                                                    <th class="px-3 py-2 text-left font-semibold">OP</th>
                                                    <th class="px-3 py-2 text-left font-semibold">Código</th>
                                                    <th class="px-3 py-2 text-left font-semibold">Produto</th>
                                                    <th class="px-3 py-2 text-right font-semibold">Perdas (kg)</th>
                                                    <th class="px-3 py-2 text-left font-semibold">Motivo</th>
                                                    <th class="px-3 py-2 text-center font-semibold">Cód Usuário</th>
                                                </tr>
                                            </thead>
                                            <tbody id="rel-perdas-tbody" class="divide-y divide-gray-100">
                                                <tr>
                                                    <td colspan="9" class="text-center py-8 text-gray-400">
                                                        <i data-lucide="trash-2" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                                        <p>Selecione filtros e clique em "Buscar"</p>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Aba: Paradas -->
                            <div id="rel-tab-paradas" class="rel-tab-content hidden">
                                <!-- Filtros -->
                                <div class="bg-gray-50 rounded-xl p-4 mb-4 border border-gray-200">
                                    <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                        <i data-lucide="filter" class="w-4 h-4"></i>
                                        Filtros de Busca
                                    </h4>
                                    <div class="flex flex-wrap items-end gap-3">
                                        <!-- Período -->
                                        <div class="flex-1 min-w-[140px] max-w-[180px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Período</label>
                                            <select id="rel-paradas-periodo" class="w-full appearance-none bg-white border border-gray-200 rounded-lg py-2 pl-3 pr-8 text-sm focus:ring-2 focus:ring-blue-500 transition cursor-pointer">
                                                <option value="today" selected>Hoje</option>
                                                <option value="yesterday">Ontem</option>
                                                <option value="7days">Últimos 7 dias</option>
                                                <option value="30days">Últimos 30 dias</option>
                                                <option value="custom">Personalizado</option>
                                            </select>
                                        </div>
                                        <!-- Data Início -->
                                        <div class="min-w-[130px] hidden" id="rel-paradas-custom-dates">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Início</label>
                                            <input type="date" id="rel-paradas-data-inicio" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 transition">
                                        </div>
                                        <!-- Data Fim -->
                                        <div class="min-w-[130px] hidden" id="rel-paradas-custom-dates-fim">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Fim</label>
                                            <input type="date" id="rel-paradas-data-fim" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 transition">
                                        </div>
                                        <!-- Máquina -->
                                        <div class="flex-1 min-w-[140px] max-w-[160px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                                            <select id="rel-paradas-maquina" class="w-full appearance-none bg-white border border-gray-200 rounded-lg py-2 pl-3 pr-8 text-sm focus:ring-2 focus:ring-blue-500 transition cursor-pointer">
                                                <option value="">Todas</option>
                                            </select>
                                        </div>
                                        <!-- Status -->
                                        <div class="flex-1 min-w-[120px] max-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Status</label>
                                            <select id="rel-paradas-status" class="w-full appearance-none bg-white border border-gray-200 rounded-lg py-2 pl-3 pr-8 text-sm focus:ring-2 focus:ring-blue-500 transition cursor-pointer">
                                                <option value="">Todos</option>
                                                <option value="active">Ativas</option>
                                                <option value="finished">Finalizadas</option>
                                            </select>
                                        </div>
                                        <!-- Cód. Produto -->
                                        <div class="flex-1 min-w-[120px] max-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Cód. Produto</label>
                                            <input type="text" id="rel-paradas-cod-produto" placeholder="Ex: 10001234" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 transition">
                                        </div>
                                        <!-- Ordem (OP) -->
                                        <div class="flex-1 min-w-[120px] max-w-[150px]">
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Ordem (OP)</label>
                                            <input type="text" id="rel-paradas-op" placeholder="Ex: 123456" class="w-full bg-white border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 transition">
                                        </div>
                                        <!-- Botão Buscar -->
                                        <button id="rel-paradas-buscar" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                            Buscar
                                        </button>
                                        <button id="rel-btn-exportar-paradas" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="download" class="w-4 h-4"></i>
                                            Exportar CSV
                                        </button>
                                        <button id="rel-btn-exportar-paradas-tabela" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2">
                                            <i data-lucide="table" class="w-4 h-4"></i>
                                            Exportar Tabela
                                        </button>
                                    </div>
                                </div>

                                <!-- Estatísticas -->
                                <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-4">
                                    <div class="bg-blue-50 rounded-xl p-3 text-center border border-blue-100">
                                        <div id="rel-paradas-stat-total" class="text-2xl font-bold text-blue-600">0</div>
                                        <div class="text-xs text-blue-700">Total</div>
                                    </div>
                                    <div class="bg-red-50 rounded-xl p-3 text-center border border-red-100">
                                        <div id="rel-paradas-stat-ativas" class="text-2xl font-bold text-red-600">0</div>
                                        <div class="text-xs text-red-700">Ativas</div>
                                    </div>
                                    <div class="bg-green-50 rounded-xl p-3 text-center border border-green-100">
                                        <div id="rel-paradas-stat-finalizadas" class="text-2xl font-bold text-green-600">0</div>
                                        <div class="text-xs text-green-700">Finalizadas</div>
                                    </div>
                                    <div class="bg-orange-50 rounded-xl p-3 text-center border border-orange-100">
                                        <div id="rel-paradas-stat-tempo" class="text-2xl font-bold text-orange-600">0h</div>
                                        <div class="text-xs text-orange-700">Tempo Total</div>
                                    </div>
                                    <div class="bg-purple-50 rounded-xl p-3 text-center border border-purple-100">
                                        <div id="rel-paradas-stat-medio" class="text-2xl font-bold text-purple-600">0min</div>
                                        <div class="text-xs text-purple-700">Tempo Médio</div>
                                    </div>
                                </div>

                                <!-- Tabela de Paradas (Somente Leitura) -->
                                <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm" id="rel-paradas-tabela">
                                            <thead class="bg-gray-100 text-gray-700">
                                                <tr>
                                                    <th class="px-3 py-3 text-left font-semibold">Data</th>
                                                    <th class="px-3 py-3 text-left font-semibold">Máquina</th>
                                                    <th class="px-3 py-3 text-left font-semibold">Produto</th>
                                                    <th class="px-3 py-3 text-left font-semibold">Motivo</th>
                                                    <th class="px-3 py-3 text-center font-semibold">Início</th>
                                                    <th class="px-3 py-3 text-center font-semibold">Fim</th>
                                                    <th class="px-3 py-3 text-center font-semibold">Duração</th>
                                                    <th class="px-3 py-3 text-center font-semibold">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="rel-paradas-tbody" class="divide-y divide-gray-100">
                                                <tr>
                                                    <td colspan="8" class="text-center py-12 text-gray-400">
                                                        <i data-lucide="pause-circle" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                                        <p>Clique em "Buscar" para carregar as paradas</p>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <!-- Paginação -->
                                    <div id="rel-paradas-paginacao" class="flex flex-col sm:flex-row items-center justify-between gap-3 p-4 border-t border-gray-200 bg-gray-50">
                                        <div class="text-sm text-gray-600">
                                            Mostrando <span id="rel-paradas-pag-inicio" class="font-semibold">0</span> - <span id="rel-paradas-pag-fim" class="font-semibold">0</span> de <span id="rel-paradas-pag-total" class="font-semibold">0</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button id="rel-paradas-pag-anterior" class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition disabled:opacity-40 disabled:cursor-not-allowed" disabled>
                                                <i data-lucide="chevron-left" class="w-4 h-4"></i>
                                            </button>
                                            <span class="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm font-semibold">
                                                Página <span id="rel-paradas-pag-atual">1</span> de <span id="rel-paradas-pag-total-paginas">1</span>
                                            </span>
                                            <button id="rel-paradas-pag-proxima" class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition disabled:opacity-40 disabled:cursor-not-allowed" disabled>
                                                <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: Liderança Produção -->
                <div id="lideranca-producao-page" class="page-content hidden space-y-4 p-2">
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-violet-700 to-purple-800 px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-white/10 rounded-xl">
                                        <i data-lucide="users" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-white">Liderança Produção</h2>
                                        <p class="text-purple-200 text-sm">Gestão de equipe e controle de absenteísmo</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabs de Navegação -->
                        <div class="border-b border-gray-200 bg-gray-50">
                            <nav class="flex space-x-1 px-4 pt-2" aria-label="Tabs">
                                <button id="tab-escala" onclick="switchLiderancaTab('escala')" class="lideranca-tab px-4 py-2.5 text-sm font-semibold rounded-t-lg border-b-2 border-violet-600 text-violet-600 bg-white -mb-px">
                                    <i data-lucide="calendar-days" class="w-4 h-4 inline mr-1"></i>
                                    Escala de Operadores
                                </button>
                                <button id="tab-absenteismo" onclick="switchLiderancaTab('absenteismo')" class="lideranca-tab px-4 py-2.5 text-sm font-medium rounded-t-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100">
                                    <i data-lucide="user-x" class="w-4 h-4 inline mr-1"></i>
                                    Absenteísmo
                                </button>
                            </nav>
                        </div>

                        <!-- ========================= -->
                        <!-- CONTEÚDO ABA: ESCALA -->
                        <!-- ========================= -->
                        <div id="content-escala" class="lideranca-content">
                            <!-- Botão Nova Escala -->
                            <div class="p-4 bg-gray-50 border-b border-gray-200 flex justify-end">
                                <button id="btn-nova-escala" class="bg-violet-600 hover:bg-violet-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2 font-semibold">
                                    <i data-lucide="plus-circle" class="w-4 h-4"></i>
                                    Nova Escala
                                </button>
                            </div>

                            <!-- Filtros de data e turno -->
                        <div class="border-b border-gray-200 p-4 bg-gray-50">
                            <div class="flex flex-wrap items-end gap-4">
                                <div class="flex-1 min-w-[200px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="calendar" class="w-3 h-3 inline mr-1"></i> Data da Escala
                                    </label>
                                    <input type="date" id="escala-data" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-violet-500">
                                </div>
                                <div class="flex-1 min-w-[150px]">
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                                        <i data-lucide="clock" class="w-3 h-3 inline mr-1"></i> Turno
                                    </label>
                                    <select id="escala-turno" class="w-full p-2.5 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-violet-500">
                                        <option value="">Todos os turnos</option>
                                        <option value="1">1º Turno</option>
                                        <option value="2">2º Turno</option>
                                        <option value="3">3º Turno</option>
                                    </select>
                                </div>
                                <button id="btn-buscar-escalas" class="bg-violet-600 hover:bg-violet-700 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center gap-2">
                                    <i data-lucide="search" class="w-4 h-4"></i>
                                    Buscar
                                </button>
                            </div>
                        </div>

                        <!-- Estatísticas Rápidas -->
                        <div class="p-4 grid grid-cols-2 gap-3">
                            <div class="bg-violet-50 rounded-xl p-3 text-center border border-violet-100">
                                <p class="text-2xl font-bold text-violet-600" id="escala-total-operadores">0</p>
                                <p class="text-xs text-violet-700">Operadores Escalados</p>
                            </div>
                            <div class="bg-blue-50 rounded-xl p-3 text-center border border-blue-100">
                                <p class="text-2xl font-bold text-blue-600" id="escala-total-maquinas">0</p>
                                <p class="text-xs text-blue-700">Máquinas Cobertas</p>
                            </div>
                        </div>

                        <!-- Fluxograma/Grid de Escala -->
                        <div class="p-4">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                <i data-lucide="users" class="w-5 h-5 text-violet-600"></i>
                                Operadores Escalados por Turno
                            </h3>
                            <div id="escala-fluxograma" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                                <!-- Cards de operadores serão renderizados aqui -->
                                <div class="text-center py-12 text-gray-400 col-span-full">
                                    <i data-lucide="calendar-search" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                    <p>Selecione uma data para visualizar a escala</p>
                                </div>
                            </div>
                        </div>

                        <!-- Lista de Operadores por Turno -->
                        <div class="p-4 border-t border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                <i data-lucide="list" class="w-5 h-5 text-violet-600"></i>
                                Lista de Escalas Cadastradas
                            </h3>
                            <div id="escala-lista" class="space-y-2 max-h-96 overflow-y-auto">
                                <div class="text-center py-8 text-gray-400">
                                    <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                    <p>Nenhuma escala cadastrada para esta data</p>
                                </div>
                            </div>
                        </div>
                        </div><!-- Fim content-escala -->

                        <!-- ========================= -->
                        <!-- CONTEÚDO ABA: ABSENTEÍSMO -->
                        <!-- ========================= -->
                        <div id="content-absenteismo" class="lideranca-content hidden">
                            <!-- Sub-tabs Absenteísmo -->
                            <div class="border-b border-gray-200 bg-gray-50 px-4 pt-2">
                                <nav class="flex space-x-2" aria-label="Sub-tabs">
                                    <button id="subtab-registro" onclick="switchAbsenteismoSubTab('registro')" class="absenteismo-subtab px-3 py-2 text-sm font-medium rounded-t-lg border-b-2 border-orange-500 text-orange-600 bg-white -mb-px">
                                        <i data-lucide="file-plus" class="w-4 h-4 inline mr-1"></i>
                                        Registrar Ausência
                                    </button>
                                    <button id="subtab-historico" onclick="switchAbsenteismoSubTab('historico')" class="absenteismo-subtab px-3 py-2 text-sm font-medium rounded-t-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100">
                                        <i data-lucide="history" class="w-4 h-4 inline mr-1"></i>
                                        Histórico
                                    </button>
                                    <button id="subtab-dashboard" onclick="switchAbsenteismoSubTab('dashboard')" class="absenteismo-subtab px-3 py-2 text-sm font-medium rounded-t-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100">
                                        <i data-lucide="bar-chart-3" class="w-4 h-4 inline mr-1"></i>
                                        Dashboard
                                    </button>
                                </nav>
                            </div>

                            <!-- SUB-TAB: Registrar Ausência -->
                            <div id="subcontent-registro" class="absenteismo-subcontent p-4">
                                <div class="max-w-2xl mx-auto">
                                    <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-6 border border-orange-200">
                                        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                            <div class="p-2 bg-orange-100 rounded-lg">
                                                <i data-lucide="user-x" class="w-5 h-5 text-orange-600"></i>
                                            </div>
                                            Registrar Nova Ausência
                                        </h3>
                                        
                                        <form id="form-absenteismo" class="space-y-4">
                                            <!-- Código do Operador -->
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-semibold text-gray-700 mb-1">
                                                        <i data-lucide="hash" class="w-4 h-4 inline mr-1"></i>
                                                        Código do Operador *
                                                    </label>
                                                    <input type="number" id="abs-cod-operador" required placeholder="Ex: 65"
                                                           class="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-semibold text-gray-700 mb-1">
                                                        <i data-lucide="user" class="w-4 h-4 inline mr-1"></i>
                                                        Nome do Operador
                                                    </label>
                                                    <input type="text" id="abs-nome-operador" readonly placeholder="Preencha o código..."
                                                           class="w-full p-2.5 border border-gray-200 rounded-lg bg-gray-100 text-gray-700">
                                                    <p id="abs-operador-erro" class="text-xs text-red-500 mt-1 hidden">
                                                        <i data-lucide="alert-circle" class="w-3 h-3 inline"></i> Operador não encontrado
                                                    </p>
                                                </div>
                                            </div>

                                            <!-- Data e Turno -->
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-semibold text-gray-700 mb-1">
                                                        <i data-lucide="calendar" class="w-4 h-4 inline mr-1"></i>
                                                        Data da Ausência *
                                                    </label>
                                                    <input type="date" id="abs-data" required
                                                           class="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-semibold text-gray-700 mb-1">
                                                        <i data-lucide="clock" class="w-4 h-4 inline mr-1"></i>
                                                        Turno *
                                                    </label>
                                                    <select id="abs-turno" required
                                                            class="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                                                        <option value="">Selecione o turno</option>
                                                        <option value="1">1º Turno (06:30 - 14:59)</option>
                                                        <option value="2">2º Turno (15:00 - 23:19)</option>
                                                        <option value="3">3º Turno (23:20 - 06:29)</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <!-- Tipo de Ausência -->
                                            <div>
                                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                                    <i data-lucide="tag" class="w-4 h-4 inline mr-1"></i>
                                                    Tipo de Ausência *
                                                </label>
                                                <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                                                    <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-red-50 hover:border-red-300 transition has-[:checked]:bg-red-100 has-[:checked]:border-red-500">
                                                        <input type="radio" name="abs-tipo" value="falta_nao_justificada" required class="text-red-600 focus:ring-red-500">
                                                        <span class="text-sm font-medium">Falta não justificada</span>
                                                    </label>
                                                    <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 hover:border-yellow-300 transition has-[:checked]:bg-yellow-100 has-[:checked]:border-yellow-500">
                                                        <input type="radio" name="abs-tipo" value="atestado" class="text-yellow-600 focus:ring-yellow-500">
                                                        <span class="text-sm font-medium">Atestado Médico</span>
                                                    </label>

                                                    <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-purple-50 hover:border-purple-300 transition has-[:checked]:bg-purple-100 has-[:checked]:border-purple-500">
                                                        <input type="radio" name="abs-tipo" value="folga_aniversario" class="text-purple-600 focus:ring-purple-500">
                                                        <span class="text-sm font-medium">Folga Aniversário</span>
                                                    </label>
                                                    <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-emerald-50 hover:border-emerald-300 transition has-[:checked]:bg-emerald-100 has-[:checked]:border-emerald-500">
                                                        <input type="radio" name="abs-tipo" value="ferias" class="text-emerald-600 focus:ring-emerald-500">
                                                        <span class="text-sm font-medium">Férias</span>
                                                    </label>
                                                    <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-orange-50 hover:border-orange-300 transition has-[:checked]:bg-orange-100 has-[:checked]:border-orange-500">
                                                        <input type="radio" name="abs-tipo" value="atraso" class="text-orange-600 focus:ring-orange-500">
                                                        <span class="text-sm font-medium">Atraso</span>
                                                    </label>
                                                    <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-sky-50 hover:border-sky-300 transition has-[:checked]:bg-sky-100 has-[:checked]:border-sky-500">
                                                        <input type="radio" name="abs-tipo" value="hokkaido_day" class="text-sky-600 focus:ring-sky-500">
                                                        <span class="text-sm font-medium">Dia Hokkaido</span>
                                                    </label>
                                                    <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 hover:border-gray-400 transition has-[:checked]:bg-gray-200 has-[:checked]:border-gray-500">
                                                        <input type="radio" name="abs-tipo" value="outros" class="text-gray-600 focus:ring-gray-500">
                                                        <span class="text-sm font-medium">Outros</span>
                                                    </label>
                                                </div>
                                            </div>

                                            <!-- Período de Férias (condicional) -->
                                            <div id="abs-ferias-container" class="hidden">
                                                <div class="bg-emerald-50 rounded-lg p-4 border border-emerald-200">
                                                    <label class="block text-sm font-semibold text-emerald-700 mb-3">
                                                        <i data-lucide="calendar-range" class="w-4 h-4 inline mr-1"></i>
                                                        Período de Férias
                                                    </label>
                                                    <div class="grid grid-cols-2 gap-4">
                                                        <div>
                                                            <label class="block text-xs text-gray-600 mb-1">Data Início</label>
                                                            <input type="date" id="abs-ferias-inicio" 
                                                                   class="w-full p-2.5 border border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                                        </div>
                                                        <div>
                                                            <label class="block text-xs text-gray-600 mb-1">Data Fim</label>
                                                            <input type="date" id="abs-ferias-fim" 
                                                                   class="w-full p-2.5 border border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                                        </div>
                                                    </div>
                                                    <p class="text-xs text-emerald-600 mt-2">
                                                        <i data-lucide="info" class="w-3 h-3 inline"></i>
                                                        Serão criados registros para todos os dias úteis do período
                                                    </p>
                                                </div>
                                            </div>

                                            <!-- Tempo do Atraso (condicional) -->
                                            <div id="abs-atraso-container" class="hidden">
                                                <label class="block text-sm font-semibold text-gray-700 mb-1">
                                                    <i data-lucide="timer" class="w-4 h-4 inline mr-1"></i>
                                                    Tempo de Atraso (minutos)
                                                </label>
                                                <input type="number" id="abs-tempo-atraso" min="1" max="480" placeholder="Ex: 30"
                                                       class="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                                            </div>

                                            <!-- Observações -->
                                            <div>
                                                <label class="block text-sm font-semibold text-gray-700 mb-1">
                                                    <i data-lucide="message-square" class="w-4 h-4 inline mr-1"></i>
                                                    Observações
                                                </label>
                                                <textarea id="abs-observacoes" rows="3" placeholder="Informações adicionais sobre a ausência..."
                                                          class="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 resize-none"></textarea>
                                            </div>

                                            <!-- Botões -->
                                            <div class="flex gap-3 pt-2">
                                                <button type="submit" class="flex-1 bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-4 rounded-lg transition flex items-center justify-center gap-2">
                                                    <i data-lucide="save" class="w-5 h-5"></i>
                                                    Registrar Ausência
                                                </button>
                                                <button type="reset" class="px-6 py-3 border border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-100 transition">
                                                    Limpar
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- SUB-TAB: Histórico -->
                            <div id="subcontent-historico" class="absenteismo-subcontent hidden p-4">
                                <!-- Filtros -->
                                <div class="bg-gray-50 rounded-lg p-4 mb-4 border border-gray-200">
                                    <div class="grid grid-cols-1 md:grid-cols-5 gap-3 items-end">
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-600 mb-1">Data Início</label>
                                            <input type="date" id="abs-hist-data-inicio" class="w-full p-2 border border-gray-300 rounded text-sm">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-600 mb-1">Data Fim</label>
                                            <input type="date" id="abs-hist-data-fim" class="w-full p-2 border border-gray-300 rounded text-sm">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-600 mb-1">Tipo</label>
                                            <select id="abs-hist-tipo" class="w-full p-2 border border-gray-300 rounded text-sm">
                                                <option value="">Todos os tipos</option>
                                                <option value="falta_nao_justificada">Falta não justificada</option>
                                                <option value="atestado">Atestado Médico</option>
                                                <option value="folga_aniversario">Folga Aniversário</option>
                                                <option value="ferias">Férias</option>
                                                <option value="atraso">Atraso</option>
                                                <option value="hokkaido_day">Dia Hokkaido</option>
                                                <option value="outros">Outros</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-600 mb-1">Cód. Operador</label>
                                            <input type="number" id="abs-hist-cod" placeholder="Código" class="w-full p-2 border border-gray-300 rounded text-sm">
                                        </div>
                                        <button onclick="buscarHistoricoAbsenteismo()" class="bg-violet-600 hover:bg-violet-700 text-white px-4 py-2 rounded font-semibold transition flex items-center justify-center gap-2">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                            Buscar
                                        </button>
                                    </div>
                                </div>

                                <!-- Estatísticas do Período -->
                                <div class="grid grid-cols-2 md:grid-cols-8 gap-3 mb-4">
                                    <div class="bg-red-50 rounded-lg p-3 text-center border border-red-100">
                                        <p class="text-xl font-bold text-red-600" id="abs-stat-falta">0</p>
                                        <p class="text-xs text-red-700">Faltas</p>
                                    </div>
                                    <div class="bg-yellow-50 rounded-lg p-3 text-center border border-yellow-100">
                                        <p class="text-xl font-bold text-yellow-600" id="abs-stat-atestado">0</p>
                                        <p class="text-xs text-yellow-700">Atestados</p>
                                    </div>

                                    <div class="bg-purple-50 rounded-lg p-3 text-center border border-purple-100">
                                        <p class="text-xl font-bold text-purple-600" id="abs-stat-aniversario">0</p>
                                        <p class="text-xs text-purple-700">Aniversário</p>
                                    </div>
                                    <div class="bg-emerald-50 rounded-lg p-3 text-center border border-emerald-100">
                                        <p class="text-xl font-bold text-emerald-600" id="abs-stat-ferias">0</p>
                                        <p class="text-xs text-emerald-700">Férias</p>
                                    </div>
                                    <div class="bg-orange-50 rounded-lg p-3 text-center border border-orange-100">
                                        <p class="text-xl font-bold text-orange-600" id="abs-stat-atraso">0</p>
                                        <p class="text-xs text-orange-700">Atrasos</p>
                                    </div>
                                    <div class="bg-sky-50 rounded-lg p-3 text-center border border-sky-100">
                                        <p class="text-xl font-bold text-sky-600" id="abs-stat-hokkaido">0</p>
                                        <p class="text-xs text-sky-700">Dia Hokkaido</p>
                                    </div>
                                    <div class="bg-gray-100 rounded-lg p-3 text-center border border-gray-200">
                                        <p class="text-xl font-bold text-gray-700" id="abs-stat-total">0</p>
                                        <p class="text-xs text-gray-600">Total</p>
                                    </div>
                                </div>

                                <!-- Lista de Registros -->
                                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                                    <div class="max-h-96 overflow-y-auto">
                                        <table class="w-full text-sm">
                                            <thead class="bg-gray-50 sticky top-0">
                                                <tr>
                                                    <th class="text-left p-3 font-semibold text-gray-700">Data</th>
                                                    <th class="text-left p-3 font-semibold text-gray-700">Operador</th>
                                                    <th class="text-left p-3 font-semibold text-gray-700">Turno</th>
                                                    <th class="text-left p-3 font-semibold text-gray-700">Tipo</th>
                                                    <th class="text-left p-3 font-semibold text-gray-700">Observações</th>
                                                    <th class="text-center p-3 font-semibold text-gray-700">Ações</th>
                                                </tr>
                                            </thead>
                                            <tbody id="abs-historico-lista">
                                                <tr>
                                                    <td colspan="6" class="text-center py-12 text-gray-400">
                                                        <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                                        <p>Selecione o período para visualizar o histórico</p>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- SUB-TAB: Dashboard -->
                            <div id="subcontent-dashboard" class="absenteismo-subcontent hidden p-4">
                                <!-- Filtros do Dashboard -->
                                <div class="bg-gray-50 rounded-lg p-4 mb-4 border border-gray-200">
                                    <div class="grid grid-cols-2 md:grid-cols-6 gap-3 items-end">
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-600 mb-1">Período</label>
                                            <select id="abs-dash-periodo" class="w-full p-2 border border-gray-300 rounded text-sm" onchange="togglePeriodoPersonalizado()">
                                                <option value="7">Últimos 7 dias</option>
                                                <option value="30" selected>Últimos 30 dias</option>
                                                <option value="90">Últimos 90 dias</option>
                                                <option value="365">Último ano</option>
                                                <option value="custom">Personalizado</option>
                                            </select>
                                        </div>
                                        <div id="abs-dash-custom-inicio-container" class="hidden">
                                            <label class="block text-xs font-semibold text-gray-600 mb-1">Data Início</label>
                                            <input type="date" id="abs-dash-custom-inicio" class="w-full p-2 border border-gray-300 rounded text-sm">
                                        </div>
                                        <div id="abs-dash-custom-fim-container" class="hidden">
                                            <label class="block text-xs font-semibold text-gray-600 mb-1">Data Fim</label>
                                            <input type="date" id="abs-dash-custom-fim" class="w-full p-2 border border-gray-300 rounded text-sm">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-600 mb-1">Turno</label>
                                            <select id="abs-dash-turno" class="w-full p-2 border border-gray-300 rounded text-sm">
                                                <option value="">Todos os turnos</option>
                                                <option value="1">1º Turno</option>
                                                <option value="2">2º Turno</option>
                                                <option value="3">3º Turno</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-600 mb-1">Tipo</label>
                                            <select id="abs-dash-tipo" class="w-full p-2 border border-gray-300 rounded text-sm">
                                                <option value="">Todos os tipos</option>
                                                <option value="falta_nao_justificada">Falta não justificada</option>
                                                <option value="atestado">Atestado Médico</option>
                                                <option value="folga_aniversario">Folga Aniversário</option>
                                                <option value="ferias">Férias</option>
                                                <option value="atraso">Atraso</option>
                                                <option value="hokkaido_day">Dia Hokkaido</option>
                                                <option value="outros">Outros</option>
                                            </select>
                                        </div>
                                        <button onclick="atualizarDashboardAbsenteismo()" class="bg-violet-600 hover:bg-violet-700 text-white px-4 py-2 rounded font-semibold transition flex items-center gap-2">
                                            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                            Atualizar
                                        </button>
                                    </div>
                                </div>

                                <!-- Cards de Resumo -->
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                    <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white shadow-lg">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-red-100 text-sm">Taxa de Absenteísmo</p>
                                                <p class="text-3xl font-bold" id="abs-dash-taxa">0%</p>
                                            </div>
                                            <i data-lucide="trending-down" class="w-10 h-10 text-red-200"></i>
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 text-white shadow-lg">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-orange-100 text-sm">Total de Ocorrências</p>
                                                <p class="text-3xl font-bold" id="abs-dash-total">0</p>
                                            </div>
                                            <i data-lucide="user-x" class="w-10 h-10 text-orange-200"></i>
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-blue-100 text-sm">Colaboradores Afetados</p>
                                                <p class="text-3xl font-bold" id="abs-dash-colaboradores">0</p>
                                            </div>
                                            <i data-lucide="users" class="w-10 h-10 text-blue-200"></i>
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-green-100 text-sm">Média Diária</p>
                                                <p class="text-3xl font-bold" id="abs-dash-media">0</p>
                                            </div>
                                            <i data-lucide="calculator" class="w-10 h-10 text-green-200"></i>
                                        </div>
                                    </div>
                                </div>

                                <!-- Gráficos -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <!-- Gráfico por Tipo -->
                                    <div class="bg-white rounded-xl border border-gray-200 p-4 shadow-sm">
                                        <h4 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                            <i data-lucide="pie-chart" class="w-5 h-5 text-violet-600"></i>
                                            Distribuição por Tipo
                                        </h4>
                                        <div class="h-64">
                                            <canvas id="abs-chart-tipo"></canvas>
                                        </div>
                                    </div>

                                    <!-- Gráfico Evolução Temporal -->
                                    <div class="bg-white rounded-xl border border-gray-200 p-4 shadow-sm">
                                        <h4 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                            <i data-lucide="line-chart" class="w-5 h-5 text-violet-600"></i>
                                            Evolução no Período
                                        </h4>
                                        <div class="h-64">
                                            <canvas id="abs-chart-evolucao"></canvas>
                                        </div>
                                    </div>

                                    <!-- Gráfico por Turno -->
                                    <div class="bg-white rounded-xl border border-gray-200 p-4 shadow-sm">
                                        <h4 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                            <i data-lucide="bar-chart" class="w-5 h-5 text-violet-600"></i>
                                            Absenteísmo por Turno
                                        </h4>
                                        <div class="h-64">
                                            <canvas id="abs-chart-turno"></canvas>
                                        </div>
                                    </div>

                                    <!-- Top Operadores com mais ausências -->
                                    <div class="bg-white rounded-xl border border-gray-200 p-4 shadow-sm">
                                        <h4 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                            <i data-lucide="list-ordered" class="w-5 h-5 text-violet-600"></i>
                                            Top 10 - Operadores com Mais Ausências
                                            <span class="text-xs text-gray-400 font-normal">(exceto férias)</span>
                                        </h4>
                                        <div class="max-h-64 overflow-y-auto">
                                            <table class="w-full text-sm" id="abs-top-operadores">
                                                <thead class="bg-gray-50 sticky top-0">
                                                    <tr>
                                                        <th class="text-left p-2 font-medium text-gray-600">#</th>
                                                        <th class="text-left p-2 font-medium text-gray-600">Operador</th>
                                                        <th class="text-center p-2 font-medium text-gray-600">Ausências</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr><td colspan="3" class="text-center py-8 text-gray-400">Carregando...</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- Gráfico por Dia da Semana -->
                                <div class="mt-6 bg-white rounded-xl border border-gray-200 p-4 shadow-sm">
                                    <h4 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                        <i data-lucide="calendar-days" class="w-5 h-5 text-violet-600"></i>
                                        Absenteísmo por Dia da Semana
                                    </h4>
                                    <div class="h-64">
                                        <canvas id="abs-chart-diasemana"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div><!-- Fim content-absenteismo -->

                    </div>
                </div>

                <!-- PÁGINA: PMP - Gestão de Materiais -->
                <div id="pmp-page" class="page-content hidden space-y-4 p-2">
                    <!-- Header -->
                    <div class="bg-gradient-to-br from-emerald-700 via-emerald-800 to-teal-800 p-6 rounded-2xl shadow-xl text-white relative overflow-hidden">
                        <div class="absolute inset-0 bg-grid-pattern opacity-5"></div>
                        <div class="absolute top-0 right-0 w-64 h-64 bg-emerald-500/10 rounded-full blur-3xl"></div>
                        
                        <div class="relative z-10 flex items-center gap-4">
                            <div class="w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center">
                                <i data-lucide="recycle" class="w-7 h-7"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-bold tracking-tight">PMP - Gestão de Materiais</h2>
                                <p class="text-emerald-200 text-sm">Controle de Borras, Moído e Matéria Prima</p>
                            </div>
                        </div>
                    </div>

                    <!-- Cards de Ações -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        <!-- Card Lançamento de Borra -->
                        <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                            <div class="bg-gradient-to-r from-yellow-500 to-amber-500 px-5 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-white/20 rounded-lg">
                                        <i data-lucide="droplet" class="w-5 h-5 text-white"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-white">Lançamento de Borra</h3>
                                        <p class="text-yellow-100 text-sm">Registre borras e perdas de material</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-5 space-y-4">
                                <div class="bg-amber-50 border border-amber-200 rounded-lg p-3">
                                    <p class="text-sm text-amber-800">
                                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                                        Informe o código do operador, a máquina e a quantidade em Kg para registrar a borra.
                                    </p>
                                </div>
                                <button id="btn-pmp-borra" class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-yellow-500 to-amber-500 hover:from-yellow-600 hover:to-amber-600 text-white font-semibold py-3 px-4 rounded-lg transition-all shadow-md hover:shadow-lg">
                                    <i data-lucide="plus-circle" class="w-5 h-5"></i>
                                    Lançar Borra
                                </button>
                            </div>
                        </div>

                        <!-- Card Lançamento de Sucata -->
                        <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                            <div class="bg-gradient-to-r from-red-500 to-rose-500 px-5 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-white/20 rounded-lg">
                                        <i data-lucide="trash-2" class="w-5 h-5 text-white"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-white">Lançamento de Sucata</h3>
                                        <p class="text-red-100 text-sm">Registre galhos, peças e moído descartados</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-5 space-y-4">
                                <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                    <p class="text-sm text-red-800">
                                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                                        Informe o tipo de sucata (galhos, peças ou moído), a máquina e a quantidade em Kg.
                                    </p>
                                </div>
                                <button id="btn-pmp-sucata" class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-red-500 to-rose-500 hover:from-red-600 hover:to-rose-600 text-white font-semibold py-3 px-4 rounded-lg transition-all shadow-md hover:shadow-lg">
                                    <i data-lucide="plus-circle" class="w-5 h-5"></i>
                                    Lançar Sucata
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Histórico de Lançamentos PMP -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                        <div class="bg-gradient-to-r from-gray-100 to-gray-200 px-5 py-4 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="history" class="w-5 h-5 text-gray-600"></i>
                                    <h3 class="text-lg font-semibold text-gray-800">Histórico de Lançamentos (Borra e Sucata)</h3>
                                </div>
                                <div class="flex items-center gap-2">
                                    <input type="date" id="pmp-filter-date" class="px-3 py-1.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-amber-500">
                                    <button id="btn-pmp-filter" class="px-3 py-1.5 bg-amber-500 hover:bg-amber-600 text-white rounded-lg text-sm font-medium transition-colors">
                                        <i data-lucide="search" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="p-5">
                            <div id="pmp-history-list" class="space-y-2 max-h-96 overflow-y-auto">
                                <div class="text-center py-8 text-gray-400">
                                    <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                    <p>Selecione uma data para ver os lançamentos</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: Lançamento -->
                <div id="lancamento-page" class="page-content space-y-3 p-2">

                    <!-- Header do Painel de Controle -->
                    <div class="bg-gradient-to-br from-slate-800 via-slate-900 to-slate-800 p-4 rounded-2xl shadow-xl text-white relative overflow-hidden">
                        <!-- Background decorativo -->
                        <div class="absolute inset-0 bg-grid-pattern opacity-5"></div>
                        <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl"></div>
                        
                        <div class="relative z-10">
                            <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                                        <i data-lucide="factory" class="w-6 h-6"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold tracking-tight">Painel de Controle de Produção</h2>
                                        <p class="text-slate-400 text-sm">Selecione uma máquina para iniciar</p>
                                    </div>
                                </div>
                                
                                <!-- Info do Turno -->
                                <div class="flex items-center gap-4 bg-white/5 backdrop-blur-sm rounded-lg px-4 py-2 border border-white/10">
                                    <div class="text-right">
                                        <p class="text-xs text-slate-400 uppercase tracking-wider">Turno Atual</p>
                                        <p id="current-shift-display" class="text-2xl font-bold text-blue-400">T1</p>
                                    </div>
                                    <div class="w-10 h-10 bg-blue-500/20 rounded-full flex items-center justify-center">
                                        <i data-lucide="clock" class="w-5 h-5 text-blue-400"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Grid de Máquinas -->
                            <div class="mt-4">
                                <!-- NOVO: Barra de Status das Máquinas (estilo Excel) -->
                                <div id="machine-status-bar" class="mb-3 p-2 bg-slate-800/50 rounded-lg border border-slate-700">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider">Status das Máquinas</span>
                                        <div class="flex items-center gap-3 text-xs">
                                            <span class="flex items-center gap-1">
                                                <span class="w-3 h-3 bg-emerald-500 rounded-sm"></span>
                                                <span class="text-slate-400">Produzindo</span>
                                            </span>
                                            <span class="flex items-center gap-1">
                                                <span class="w-3 h-3 bg-red-500 rounded-sm"></span>
                                                <span class="text-slate-400">Parada</span>
                                            </span>
                                            <span class="flex items-center gap-1">
                                                <span class="w-3 h-3 bg-slate-600 rounded-sm"></span>
                                                <span class="text-slate-400">Sem OP</span>
                                            </span>
                                        </div>
                                    </div>
                                    <div id="machine-status-cells" class="flex flex-wrap gap-1">
                                        <!-- Células serão preenchidas via JavaScript -->
                                    </div>
                                </div>

                                <!-- Botão Registrar Parada Sem OP -->
                                <div class="mb-3 flex justify-end">
                                    <button id="btn-standalone-downtime" onclick="openStandaloneDowntimeModal()" class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white text-sm font-semibold rounded-xl shadow-md hover:shadow-lg transition-all">
                                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                        Registrar Parada (Sem OP)
                                    </button>
                                </div>
                                
                                <select id="machine-selector" class="hidden"></select>
                                <div id="machine-card-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-5 xl:grid-cols-5 gap-2"></div>
                                <p id="machine-card-empty" class="hidden text-sm text-slate-400 text-center py-4">
                                    <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                    Nenhuma máquina planejada para hoje.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Painel Principal (hidden por padrão) -->
                    <div id="production-control-panel" class="hidden space-y-3">
                        
                        <!-- Card da Máquina Selecionada -->
                        <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                            <div class="flex flex-col sm:flex-row">
                                <!-- Info Principal -->
                                <div class="flex-1 p-4 flex items-center gap-4">
                                    <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg" id="machine-icon">
                                        H-01
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h3 class="text-lg font-bold text-gray-900 truncate" id="machine-name">Máquina H-01</h3>
                                        <p class="text-sm text-gray-600 truncate" id="product-name">Produto não selecionado</p>
                                        <p class="text-xs text-gray-400" id="product-mp">Matéria-prima não definida</p>
                                    </div>
                                </div>
                                
                                <!-- Status e Tempo -->
                                <div class="flex items-center gap-4 px-4 py-3 bg-gray-50 sm:bg-transparent sm:border-l border-t sm:border-t-0 border-gray-100">
                                    <div class="flex items-center gap-2">
                                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-700">
                                            <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full mr-1.5 animate-pulse"></span>
                                            Em Produção
                                        </span>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-xs text-gray-400">Tempo Ativo</p>
                                        <p class="text-lg font-mono font-bold text-gray-900" id="production-time">00:00:00</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- KPIs em Cards Compactos -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-3 hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-xs font-medium text-blue-700">Produzido</p>
                                    <div class="p-1.5 bg-blue-200 rounded-lg">
                                        <i data-lucide="package" class="w-3.5 h-3.5 text-blue-600"></i>
                                    </div>
                                </div>
                                <!-- Produção por turno -->
                                <div class="flex justify-between text-sm mb-2 pb-2 border-b border-blue-200">
                                    <div class="text-center">
                                        <span class="block text-blue-500 font-medium text-xs">T1</span>
                                        <span class="font-bold text-blue-700 text-base" id="produced-t1">0</span>
                                    </div>
                                    <div class="text-center">
                                        <span class="block text-purple-500 font-medium text-xs">T2</span>
                                        <span class="font-bold text-purple-700 text-base" id="produced-t2">0</span>
                                    </div>
                                    <div class="text-center">
                                        <span class="block text-orange-500 font-medium text-xs">T3</span>
                                        <span class="font-bold text-orange-700 text-base" id="produced-t3">0</span>
                                    </div>
                                </div>
                                <!-- Total -->
                                <div class="text-center">
                                    <p class="text-xl font-bold text-blue-600" id="produced-today">0</p>
                                    <p class="text-xs text-blue-600 opacity-70">total</p>
                                </div>
                            </div>
                            <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-2xl shadow-sm border border-emerald-200 p-4 hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-xs font-medium text-emerald-700">Eficiência</p>
                                    <div class="p-1.5 bg-emerald-200 rounded-lg">
                                        <i data-lucide="trending-up" class="w-3.5 h-3.5 text-emerald-600"></i>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <p class="text-2xl font-bold text-emerald-600" id="efficiency-today">0%</p>
                                    <p class="text-xs text-emerald-600 opacity-70 mt-1">OEE</p>
                                </div>
                            </div>
                            <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl shadow-sm border border-orange-200 p-4 hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-xs font-medium text-orange-700">Perdas (kg)</p>
                                    <div class="p-1.5 bg-orange-200 rounded-lg">
                                        <i data-lucide="alert-triangle" class="w-3.5 h-3.5 text-orange-600"></i>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <p class="text-2xl font-bold text-orange-600" id="losses-today">0</p>
                                    <p class="text-xs text-orange-600 opacity-70 mt-1">refugos</p>
                                </div>
                            </div>
                            <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-2xl shadow-sm border border-red-200 p-4 hover:shadow-md transition">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-xs font-medium text-red-700">Paradas (min)</p>
                                    <div class="p-1.5 bg-red-200 rounded-lg">
                                        <i data-lucide="pause-circle" class="w-3.5 h-3.5 text-red-600"></i>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <p class="text-2xl font-bold text-red-600" id="downtime-today">0</p>
                                    <p class="text-xs text-red-600 opacity-70 mt-1">tempo parado</p>
                                </div>
                            </div>
                        </div>

                        <!-- Ações Rápidas - Layout Horizontal -->
                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="p-2 bg-gray-100 rounded-lg">
                                    <i data-lucide="zap" class="w-4 h-4 text-gray-600"></i>
                                </div>
                                <h3 class="font-semibold text-gray-800">Ações Rápidas</h3>
                            </div>
                            
                            <!-- Botões Principais -->
                            <div class="grid grid-cols-3 gap-3 mb-3">
                                <button id="btn-production" class="group relative bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-4 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 active:scale-[0.98]">
                                    <div class="flex flex-col items-center gap-2">
                                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                            <i data-lucide="plus-circle" class="w-5 h-5"></i>
                                        </div>
                                        <span class="font-semibold text-sm">Produção</span>
                                    </div>
                                </button>

                                <button id="btn-losses" class="group relative bg-gradient-to-br from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white p-4 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 active:scale-[0.98]">
                                    <div class="flex flex-col items-center gap-2">
                                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                                        </div>
                                        <span class="font-semibold text-sm">Perdas</span>
                                    </div>
                                </button>

                                <button id="btn-downtime" class="group relative bg-gradient-to-br from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white p-4 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 active:scale-[0.98]">
                                    <div class="flex flex-col items-center gap-2 relative">
                                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                            <i data-lucide="pause" class="w-5 h-5" id="downtime-icon"></i>
                                        </div>
                                        <span class="font-semibold text-sm" id="downtime-text">Parada</span>
                                    </div>
                                    <div id="downtime-timer" class="absolute -top-1 -right-1 bg-white text-red-600 text-xs font-bold px-2 py-0.5 rounded-full shadow hidden">
                                        00:00
                                    </div>
                                    <p id="downtime-subtitle" class="hidden">Registrar início de parada</p>
                                </button>
                            </div>

                            <!-- Ações Secundárias -->
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                                <button id="btn-rework" class="flex items-center justify-center gap-2 px-3 py-2.5 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg border border-purple-200 transition-colors text-sm font-medium">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                    <span>Retrabalho</span>
                                </button>
                                <button id="btn-manual-downtime" class="flex items-center justify-center gap-2 px-3 py-2.5 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-lg border border-gray-200 transition-colors text-sm font-medium">
                                    <i data-lucide="clock" class="w-4 h-4"></i>
                                    <span>Parada Manual</span>
                                </button>
                                <div id="manual-entries-container" class="hidden contents">
                                    <button id="btn-manual-production" class="flex items-center justify-center gap-2 px-3 py-2.5 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg border border-blue-200 transition-colors text-sm font-medium col-span-2 sm:col-span-1">
                                        <i data-lucide="edit-3" class="w-4 h-4"></i>
                                        <span>Prod. Manual</span>
                                    </button>
                                    <button id="btn-manual-losses" class="flex items-center justify-center gap-2 px-3 py-2.5 bg-orange-50 hover:bg-orange-100 text-orange-700 rounded-lg border border-orange-200 transition-colors text-sm font-medium col-span-2 sm:col-span-1">
                                        <i data-lucide="edit-3" class="w-4 h-4"></i>
                                        <span>Perda Manual</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Gráfico de Produção -->
                        <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-4">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
                                <div>
                                    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wider">Produção por Hora</h3>
                                    <div class="flex items-center gap-4 mt-1 text-xs text-gray-500">
                                        <span class="flex items-center gap-1"><span class="w-2 h-2 bg-blue-500 rounded"></span> Planejado</span>
                                        <span class="flex items-center gap-1"><span class="w-2 h-2 bg-emerald-500 rounded"></span> Executado</span>
                                        <span class="flex items-center gap-1"><span class="w-2 h-2 bg-red-500 rounded"></span> Meta</span>
                                    </div>
                                </div>
                            </div>
                            <div class="relative h-64">
                                <canvas id="hourly-production-chart" class="w-full h-full"></canvas>
                            </div>
                            
                            <!-- Timeline de Progresso -->
                            <div class="mt-4 pt-4 border-t border-gray-100">
                                <div class="flex items-center justify-between text-xs text-gray-500 mb-2">
                                    <span>Progresso da Meta Diária</span>
                                    <span id="timeline-percentage" class="font-semibold text-gray-700">0%</span>
                                </div>
                                <div class="relative">
                                    <div class="w-full bg-gray-100 rounded-full h-2.5 overflow-hidden">
                                        <div id="timeline-progress" class="timeline-progress timeline-progress-bar h-full rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div>
                                    </div>
                                    <div id="timeline-target-indicator" class="absolute top-0 h-2.5 w-0.5 bg-slate-600 rounded transition-all duration-500" style="left: 0%"></div>
                                </div>
                                <div class="flex justify-between text-xs text-gray-400 mt-1">
                                    <span id="timeline-executed">0 peças</span>
                                    <span id="timeline-planned">0 peças</span>
                                </div>
                                
                                <!-- Status de Atualização -->
                                <div class="flex items-center justify-between text-xs mt-3 pt-3 border-t border-gray-50">
                                    <div class="flex items-center gap-2">
                                        <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse" id="timeline-status-indicator"></span>
                                        <span id="timeline-status-text" class="text-gray-500">Atualizado</span>
                                    </div>
                                    <span id="timeline-last-update" class="text-gray-400">--:--</span>
                                </div>

                                <!-- Botões de Finalizar/Ativar Ordem -->
                                <div class="mt-3 flex gap-2">
                                    <button id="finalize-order-btn" class="hidden flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2.5 px-4 rounded-lg shadow-sm flex items-center justify-center gap-2 text-sm transition-colors">
                                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                                        Finalizar Ordem
                                    </button>
                                    <button id="activate-order-btn" class="hidden flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 px-4 rounded-lg shadow-sm flex items-center justify-center gap-2 text-sm transition-colors">
                                        <i data-lucide="play-circle" class="w-4 h-4"></i>
                                        Ativar Ordem
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lançamentos Recentes -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-blue-100 rounded-lg">
                                    <i data-lucide="history" class="w-4 h-4 text-blue-600"></i>
                                </div>
                                <h3 class="font-semibold text-gray-800">Lançamentos</h3>
                            </div>
                            <div class="flex flex-wrap items-center gap-2 w-full sm:w-auto">
                                <!-- Seletor de Máquina para Histórico -->
                                <select id="entries-machine-filter" 
                                        class="px-2 py-1 text-xs border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        title="Filtrar por máquina">
                                    <option value="">Máquina atual</option>
                                </select>
                                <!-- Seletor de Data para Histórico -->
                                <div class="flex items-center gap-1">
                                    <input type="date" id="entries-date-filter" 
                                           class="px-2 py-1 text-xs border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           title="Filtrar por data">
                                    <button id="entries-date-today" class="px-2 py-1 text-xs font-medium text-blue-600 border border-blue-200 rounded-lg hover:bg-blue-50" title="Voltar para hoje">
                                        Hoje
                                    </button>
                                </div>
                                <button id="refresh-recent-entries" class="flex items-center gap-1 px-2 py-1 text-xs font-medium text-blue-600 border border-blue-200 rounded-lg hover:bg-blue-50">
                                    <i data-lucide="refresh-cw" class="w-3 h-3"></i>
                                </button>
                            </div>
                        </div>
                        <!-- Filtros de tipo -->
                        <div class="flex gap-1 bg-gray-100 rounded-lg p-1 overflow-x-auto mb-3">
                            <button id="filter-all-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all active bg-white text-blue-600 shadow-sm" data-filter="all">Todos</button>
                            <button id="filter-production-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all text-gray-600 hover:bg-gray-50" data-filter="production">Produção</button>
                            <button id="filter-downtime-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all text-gray-600 hover:bg-gray-50" data-filter="downtime">Paradas</button>
                            <button id="filter-loss-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all text-gray-600 hover:bg-gray-50" data-filter="loss">Perdas</button>
                            <button id="filter-rework-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all text-gray-600 hover:bg-gray-50" data-filter="rework">Retrabalho</button>
                            <button id="filter-borra-entries" class="filter-entry-btn px-2 py-1 text-xs font-medium rounded whitespace-nowrap transition-all text-gray-600 hover:bg-gray-50" data-filter="borra">Borra</button>
                        </div>
                        <!-- Indicador de filtro ativo -->
                        <div id="entries-filter-indicator" class="hidden mb-3 px-3 py-2 bg-amber-50 border border-amber-200 rounded-lg">
                            <div class="flex items-center justify-between">
                                <span class="text-xs text-amber-700">
                                    <i data-lucide="filter" class="w-3 h-3 inline mr-1"></i>
                                    <span id="entries-filter-display">Filtro ativo</span>
                                </span>
                                <button id="entries-clear-all-filters" class="text-xs text-amber-600 hover:text-amber-800 font-medium">
                                    Limpar filtros
                                </button>
                            </div>
                        </div>
                        <div id="recent-entries-loading" class="hidden py-8 text-center">
                            <i data-lucide="loader-2" class="w-6 h-6 animate-spin text-blue-500 mx-auto mb-2"></i>
                            <p class="text-xs text-gray-500">Carregando...</p>
                        </div>
                        <div id="recent-entries-empty" class="hidden py-8 text-center">
                            <i data-lucide="inbox" class="w-8 h-8 text-gray-300 mx-auto mb-2"></i>
                            <p class="text-xs text-gray-500">Nenhum lançamento encontrado</p>
                        </div>
                        <div id="recent-entries-list" class="space-y-2 max-h-64 overflow-y-auto"></div>
                    </div>

                    <!-- Estados de Carregamento -->
                    <div id="launch-panel-loading" class="text-center py-16">
                        <div class="inline-flex items-center justify-center w-14 h-14 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl mb-4">
                            <i data-lucide="loader-2" class="w-6 h-6 animate-spin text-blue-500"></i>
                        </div>
                        <p class="text-gray-600 text-sm">Carregando dados de Produção...</p>
                    </div>
                    <div id="launch-panel-no-data" class="text-center py-16 hidden">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl mb-4 border border-gray-200">
                            <i data-lucide="inbox" class="w-8 h-8 text-gray-400"></i>
                        </div>
                        <p class="text-lg font-semibold text-gray-700 mb-1">Nenhum planejamento encontrado</p>
                        <p class="text-sm text-gray-500">Não há itens planejados para hoje.</p>
                    </div>
                </div>
                
                <!-- Páginas Qualidade e Processo removidas - Otimização 02/12/2025 -->

                <!-- PÁGINA: Análise -->
                <div id="analise-page" class="page-content hidden">
                    <!-- Container Principal com Design Moderno -->
                    <div class="bg-gradient-to-br from-slate-50 to-gray-100 min-h-screen">
                        
                        <!-- Header da Análise -->
                        <div class="bg-white border-b border-gray-200 sticky top-0 z-20 shadow-sm">
                            <!-- Título e Controles Rápidos -->
                            <div class="px-4 md:px-6 py-4">
                                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                    <div class="flex items-center gap-3">
                                        <div class="p-2.5 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl shadow-lg">
                                            <i data-lucide="bar-chart-2" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <div>
                                            <h1 class="text-xl md:text-2xl font-bold text-gray-900">Central de Análises</h1>
                                            <p class="text-sm text-gray-500">Visualize mtricas e insights da sua Produção</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="hidden md:flex items-center gap-2 bg-gray-100 px-3 py-1.5 rounded-full">
                                            <span class="relative flex h-2.5 w-2.5">
                                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"></span>
                                            </span>
                                            <span class="text-sm text-gray-600 font-medium">Dados em tempo real</span>
                                        </div>
                                        <button id="toggle-analysis-filters" class="p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition md:hidden" title="Filtros">
                                            <i data-lucide="sliders-horizontal" class="w-5 h-5 text-gray-600"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Navegação por Abas - Design Moderno -->
                            <div class="px-4 md:px-6">
                                <nav class="flex gap-1 overflow-x-auto pb-0 scrollbar-hide -mb-px">
                                    <button class="analysis-tab-btn group flex items-center gap-2 py-3 px-4 text-sm font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-300 transition-all whitespace-nowrap active" data-view="overview">
                                        <div class="p-1.5 rounded-lg bg-gray-100 group-hover:bg-blue-100 group-[.active]:bg-blue-100 transition">
                                            <i data-lucide="layout-dashboard" class="w-4 h-4 group-[.active]:text-blue-600"></i>
                                        </div>
                                        <span>Visão Geral</span>
                                    </button>
                                    <button class="analysis-tab-btn group flex items-center gap-2 py-3 px-4 text-sm font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-300 transition-all whitespace-nowrap" data-view="production">
                                        <div class="p-1.5 rounded-lg bg-gray-100 group-hover:bg-green-100 group-[.active]:bg-green-100 transition">
                                            <i data-lucide="factory" class="w-4 h-4 group-[.active]:text-green-600"></i>
                                        </div>
                                        <span>Produção</span>
                                    </button>
                                    <button class="analysis-tab-btn group flex items-center gap-2 py-3 px-4 text-sm font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-300 transition-all whitespace-nowrap" data-view="efficiency">
                                        <div class="p-1.5 rounded-lg bg-gray-100 group-hover:bg-purple-100 group-[.active]:bg-purple-100 transition">
                                            <i data-lucide="gauge" class="w-4 h-4 group-[.active]:text-purple-600"></i>
                                        </div>
                                        <span>Eficiência</span>
                                    </button>
                                    <button class="analysis-tab-btn group flex items-center gap-2 py-3 px-4 text-sm font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-300 transition-all whitespace-nowrap" data-view="losses">
                                        <div class="p-1.5 rounded-lg bg-gray-100 group-hover:bg-red-100 group-[.active]:bg-red-100 transition">
                                            <i data-lucide="alert-triangle" class="w-4 h-4 group-[.active]:text-red-600"></i>
                                        </div>
                                        <span>Perdas</span>
                                    </button>
                                    <button class="analysis-tab-btn group flex items-center gap-2 py-3 px-4 text-sm font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-300 transition-all whitespace-nowrap" data-view="downtime">
                                        <div class="p-1.5 rounded-lg bg-gray-100 group-hover:bg-orange-100 group-[.active]:bg-orange-100 transition">
                                            <i data-lucide="timer-off" class="w-4 h-4 group-[.active]:text-orange-600"></i>
                                        </div>
                                        <span>Paradas</span>
                                    </button>
                                    <!-- Subaba Relatórios removida - Otimização 02/2026 -->
                                    <!-- Subaba Analytics IA removida - Otimização 02/12/2025 -->
                                </nav>
                            </div>
                        </div>
                        
                        <!-- Filtros Globais - Redesenhados -->
                        <div class="bg-white border-b border-gray-200 shadow-sm">
                            <div class="px-4 md:px-6 py-4">
                                <div class="flex flex-wrap items-end gap-3">
                                    <!-- Período -->
                                    <div class="flex-1 min-w-[140px] max-w-[180px]">
                                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Período</label>
                                        <div class="relative">
                                            <select id="analysis-period" class="w-full appearance-none bg-gray-50 border border-gray-200 rounded-lg py-2.5 pl-3 pr-10 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition cursor-pointer">
                                                <option value="today">Hoje</option>
                                                <option value="yesterday">Ontem</option>
                                                <option value="7days">Últimos 7 dias</option>
                                                <option value="30days">Últimos 30 dias</option>
                                                <option value="month">Este mês</option>
                                                <option value="lastmonth">Mês passado</option>
                                                <option value="custom">Personalizado</option>
                                            </select>
                                            <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                        </div>
                                    </div>
                                    
                                    <!-- Máquina -->
                                    <div class="flex-1 min-w-[140px] max-w-[180px]">
                                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                                        <div class="relative">
                                            <select id="analysis-machine" class="w-full appearance-none bg-gray-50 border border-gray-200 rounded-lg py-2.5 pl-3 pr-10 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition cursor-pointer">
                                                <option value="all">Todas as máquinas</option>
                                            </select>
                                            <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                        </div>
                                    </div>
                                    
                                    <!-- Turno -->
                                    <div class="flex-1 min-w-[120px] max-w-[150px]">
                                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                                        <div class="relative">
                                            <select id="analysis-shift" class="w-full appearance-none bg-gray-50 border border-gray-200 rounded-lg py-2.5 pl-3 pr-10 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition cursor-pointer">
                                                <option value="all">Todos</option>
                                                <option value="1">1º Turno</option>
                                                <option value="2">2º Turno</option>
                                                <option value="3">3º Turno</option>
                                            </select>
                                            <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                        </div>
                                    </div>
                                    
                                    <!-- Botões de Ação -->
                                    <div class="flex items-center gap-2">
                                        <button id="apply-analysis-filters" class="inline-flex items-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md hover:shadow-lg transition-all text-sm">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                            <span class="hidden sm:inline">Aplicar</span>
                                        </button>
                                        <button id="test-charts-btn" class="p-2.5 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg transition" title="Debug gráficos">
                                            <i data-lucide="bug" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Datas Personalizadas -->
                                <div id="custom-date-range" class="mt-4 flex flex-wrap items-end gap-3 hidden">
                                    <div class="min-w-[160px]">
                                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Inicial</label>
                                        <input type="date" id="analysis-start-date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                    </div>
                                    <div class="min-w-[160px]">
                                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data Final</label>
                                        <input type="date" id="analysis-end-date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Painel de Informações da Máquina/Produto Selecionado -->
                        <div id="analysis-info-panel" class="hidden mx-4 md:mx-6 mt-4">
                            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl p-4 shadow-lg">
                                <div class="flex items-center gap-4">
                                    <div class="p-3 bg-white/20 backdrop-blur-sm rounded-xl">
                                        <i data-lucide="cpu" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-blue-100 text-xs font-medium uppercase tracking-wider">Analisando</p>
                                        <p id="analysis-info-machine" class="text-xl font-bold text-white">-</p>
                                        <p id="analysis-info-machine-model" class="text-sm text-blue-200">-</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Área de Conteúdo das Views -->
                        <div class="p-4 md:p-6">
                            
                            <!-- ========== VISÇO GERAL ========== -->
                            <div id="overview-view" class="analysis-view">
                                <!-- KPIs Principais - Cards Modernos -->
                                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                    <!-- OEE Card -->
                                    <div class="relative overflow-hidden bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition-shadow">
                                        <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-green-100 to-green-50 rounded-full -mr-8 -mt-8"></div>
                                        <div class="relative">
                                            <div class="flex items-center gap-2 mb-3">
                                                <div class="p-2 bg-green-100 rounded-lg">
                                                    <i data-lucide="target" class="w-4 h-4 text-green-600"></i>
                                                </div>
                                                <span class="text-sm font-medium text-gray-500">OEE Geral</span>
                                            </div>
                                            <p id="overview-oee" class="text-3xl font-bold text-gray-900">---%</p>
                                            <div class="mt-2 flex items-center gap-1">
                                                <span class="text-xs text-gray-400">Meta: 85%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Produção Card -->
                                    <div class="relative overflow-hidden bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition-shadow">
                                        <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-blue-100 to-blue-50 rounded-full -mr-8 -mt-8"></div>
                                        <div class="relative">
                                            <div class="flex items-center gap-2 mb-3">
                                                <div class="p-2 bg-blue-100 rounded-lg">
                                                    <i data-lucide="package" class="w-4 h-4 text-blue-600"></i>
                                                </div>
                                                <span class="text-sm font-medium text-gray-500">Produção Total</span>
                                            </div>
                                            <p id="overview-production" class="text-3xl font-bold text-gray-900">---</p>
                                            <div class="mt-2 flex items-center gap-1">
                                                <span class="text-xs text-gray-400">peças</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Perdas Card -->
                                    <div class="relative overflow-hidden bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition-shadow">
                                        <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-amber-100 to-amber-50 rounded-full -mr-8 -mt-8"></div>
                                        <div class="relative">
                                            <div class="flex items-center gap-2 mb-3">
                                                <div class="p-2 bg-amber-100 rounded-lg">
                                                    <i data-lucide="alert-triangle" class="w-4 h-4 text-amber-600"></i>
                                                </div>
                                                <span class="text-sm font-medium text-gray-500">Total de Perdas</span>
                                            </div>
                                            <p id="overview-losses" class="text-3xl font-bold text-gray-900">---</p>
                                            <div class="mt-2 flex items-center gap-1">
                                                <span class="text-xs text-gray-400">peças</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Paradas Card -->
                                    <div class="relative overflow-hidden bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition-shadow">
                                        <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-red-100 to-red-50 rounded-full -mr-8 -mt-8"></div>
                                        <div class="relative">
                                            <div class="flex items-center gap-2 mb-3">
                                                <div class="p-2 bg-red-100 rounded-lg">
                                                    <i data-lucide="timer-off" class="w-4 h-4 text-red-600"></i>
                                                </div>
                                                <span class="text-sm font-medium text-gray-500">Tempo de Parada</span>
                                            </div>
                                            <p id="overview-downtime" class="text-3xl font-bold text-gray-900">---h</p>
                                            <div class="mt-2 flex items-center gap-1">
                                                <span class="text-xs text-gray-400">horas</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Grid de Gráficos -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <!-- Gráfico de Distribuição OEE -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
                                        <div class="flex items-center justify-between mb-4">
                                            <div class="flex items-center gap-3">
                                                <div class="p-2 bg-purple-100 rounded-lg">
                                                    <i data-lucide="pie-chart" class="w-4 h-4 text-purple-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-semibold text-gray-800">Distribuição OEE</h3>
                                                    <p class="text-xs text-gray-500">Por máquina</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 280px;">
                                            <canvas id="oee-distribution-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>

                                    <!-- Ranking de Performance -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
                                        <div class="flex items-center justify-between mb-4">
                                            <div class="flex items-center gap-3">
                                                <div class="p-2 bg-amber-100 rounded-lg">
                                                    <i data-lucide="trophy" class="w-4 h-4 text-amber-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-semibold text-gray-800">Ranking de Performance</h3>
                                                    <p class="text-xs text-gray-500">Top máquinas</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="machine-ranking" class="space-y-3 max-h-[280px] overflow-y-auto pr-2">
                                            <!-- Conteúdo dinmico -->
                                            <div class="text-center py-8 text-gray-400">
                                                <i data-lucide="loader-2" class="w-8 h-8 mx-auto animate-spin mb-2"></i>
                                                <p class="text-sm">Carregando dados...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ========== ANLISE DE PRODU¡ÇO ========== -->
                            <div id="production-view" class="analysis-view hidden">
                                <!-- Header com Ação -->
                                <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                                    <div>
                                        <h2 class="text-lg font-semibold text-gray-800">Análise de Produção</h2>
                                        <p class="text-sm text-gray-500">Acompanhe o desempenho produtivo em tempo real</p>
                                    </div>
                                </div>

                                <!-- KPIs Principais - Layout Aprimorado -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <!-- REALIZADO -->
                                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl shadow-sm border border-green-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-3">
                                            <p class="text-sm font-medium text-green-700">REALIZADO</p>
                                            <div class="p-2 bg-green-200 rounded-lg">
                                                <i data-lucide="check-circle" class="w-4 h-4 text-green-600"></i>
                                            </div>
                                        </div>
                                        <p id="actual-production-kpi" class="text-3xl font-bold text-green-600 mb-1">---</p>
                                        <p id="actual-production-subtext" class="text-xs text-green-600 opacity-70">peças produzidas</p>
                                    </div>

                                    <!-- META x REALIZADO -->
                                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl shadow-sm border border-amber-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-3">
                                            <p class="text-sm font-medium text-amber-700">META x REALIZADO</p>
                                            <div class="p-2 bg-amber-200 rounded-lg">
                                                <i data-lucide="target" class="w-4 h-4 text-amber-600"></i>
                                            </div>
                                        </div>
                                        <p id="production-target-vs-actual" class="text-3xl font-bold text-amber-600 mb-1">---%</p>
                                        <p id="target-vs-actual-subtext" class="text-xs text-amber-600 opacity-70">eficiência da meta</p>
                                    </div>
                                </div>

                                <!-- Gráficos Principais - Layout Duplo -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <!-- Produção por Hora -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-blue-100 rounded-lg">
                                                <i data-lucide="clock" class="w-4 h-4 text-blue-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Produção por Hora</h3>
                                                <p class="text-xs text-gray-500">Evolução ao longo do dia</p>
                                            </div>
                                        </div>
                                        <div class="chart-container" style="height: 280px;">
                                            <canvas id="analysis-hourly-production-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>

                                    <!-- Produção por Turno -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-indigo-100 rounded-lg">
                                                <i data-lucide="users" class="w-4 h-4 text-indigo-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Produção por Turno</h3>
                                                <p class="text-xs text-gray-500">Comparativo entre turnos</p>
                                            </div>
                                        </div>
                                        <div class="chart-container" style="height: 280px;">
                                            <canvas id="shift-production-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Histórico de Produção por Máquina - Full Width -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition mb-6">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="p-2 bg-teal-100 rounded-lg">
                                            <i data-lucide="activity" class="w-4 h-4 text-teal-600"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Histórico de Produção por Máquina</h3>
                                            <p class="text-xs text-gray-500">Srie temporal de desempenho</p>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 380px;">
                                        <canvas id="analysis-machine-production-timeline" class="w-full h-full"></canvas>
                                    </div>
                                </div>

                                <!-- Gráfico Ciclo/Cavidades -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition mb-6">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="p-2 bg-cyan-100 rounded-lg">
                                            <i data-lucide="settings-2" class="w-4 h-4 text-cyan-600"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Ciclo / Cavidades</h3>
                                            <p class="text-xs text-gray-500">Comparativo planejado vs real por turno</p>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="cycle-cavity-chart" class="w-full h-full"></canvas>
                                    </div>
                                </div>

                                <!-- Ranking e Insights - Grid Inferior -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <!-- Top 5 Máquinas -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-amber-100 rounded-lg">
                                                <i data-lucide="trophy" class="w-4 h-4 text-amber-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Top 5 Máquinas</h3>
                                                <p class="text-xs text-gray-500">Produção total hoje</p>
                                            </div>
                                        </div>
                                        <div id="machine-ranking-production" class="space-y-2 max-h-[300px] overflow-y-auto pr-2">
                                            <div class="text-center py-8 text-gray-400">
                                                <i data-lucide="loader-2" class="w-6 h-6 mx-auto animate-spin mb-2"></i>
                                                <p class="text-xs">Carregando...</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Principais Mtricas -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-violet-100 rounded-lg">
                                                <i data-lucide="bar-chart-3" class="w-4 h-4 text-violet-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Resumo do Dia</h3>
                                                <p class="text-xs text-gray-500">Indicadores principais</p>
                                            </div>
                                        </div>
                                        <div class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                                            <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200">
                                                <div class="flex items-center gap-2">
                                                    <i data-lucide="package" class="w-4 h-4 text-blue-600"></i>
                                                    <span class="text-sm text-gray-700">Produção Boa</span>
                                                </div>
                                                <span id="summary-good-production" class="font-semibold text-blue-600">---</span>
                                            </div>
                                            <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-200">
                                                <div class="flex items-center gap-2">
                                                    <i data-lucide="alert-triangle" class="w-4 h-4 text-red-600"></i>
                                                    <span class="text-sm text-gray-700">Refugos</span>
                                                </div>
                                                <span id="summary-losses" class="font-semibold text-red-600">---</span>
                                            </div>
                                            <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                                <div class="flex items-center gap-2">
                                                    <i data-lucide="droplet" class="w-4 h-4 text-yellow-600"></i>
                                                    <span class="text-sm text-gray-700">Borra (kg)</span>
                                                </div>
                                                <span id="summary-borra" class="font-semibold text-yellow-600">---</span>
                                            </div>
                                            <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200">
                                                <div class="flex items-center gap-2">
                                                    <i data-lucide="pause-circle" class="w-4 h-4 text-orange-600"></i>
                                                    <span class="text-sm text-gray-700">Parada (min)</span>
                                                </div>
                                                <span id="summary-downtime" class="font-semibold text-orange-600">---</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ========== ANLISE DE EFICIÚ NCIA ========== -->
                            <div id="efficiency-view" class="analysis-view hidden">
                                <!-- Header com Descrição -->
                                <div class="mb-6">
                                    <h2 class="text-lg font-semibold text-gray-800">Análise de Eficiência (OEE)</h2>
                                    <p class="text-sm text-gray-500">Acompanhe disponibilidade, performance e qualidade</p>
                                </div>

                                <!-- Componentes OEE - Gauges Modernos -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                    <!-- Disponibilidade -->
                                    <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-2xl shadow-sm border border-emerald-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-emerald-200 rounded-lg">
                                                <i data-lucide="clock" class="w-4 h-4 text-emerald-600"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-emerald-900">Disponibilidade</h4>
                                                <p class="text-xs text-emerald-700">Tempo máquina Ativa</p>
                                            </div>
                                        </div>
                                        <div class="relative mx-auto" style="max-width: 140px; height: 140px; margin: 10px auto;">
                                            <canvas id="availability-gauge" class="w-full h-full"></canvas>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span id="availability-value" class="text-xl font-bold text-emerald-600">---%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Performance -->
                                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-blue-200 rounded-lg">
                                                <i data-lucide="zap" class="w-4 h-4 text-blue-600"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-blue-900">Performance</h4>
                                                <p class="text-xs text-blue-700">Velocidade Produção</p>
                                            </div>
                                        </div>
                                        <div class="relative mx-auto" style="max-width: 140px; height: 140px; margin: 10px auto;">
                                            <canvas id="performance-gauge" class="w-full h-full"></canvas>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span id="performance-value" class="text-xl font-bold text-blue-600">---%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Qualidade -->
                                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl shadow-sm border border-amber-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-amber-200 rounded-lg">
                                                <i data-lucide="shield-check" class="w-4 h-4 text-amber-600"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-amber-900">Qualidade</h4>
                                                <p class="text-xs text-amber-700">Taxa de conformidade</p>
                                            </div>
                                        </div>
                                        <div class="relative mx-auto" style="max-width: 140px; height: 140px; margin: 10px auto;">
                                            <canvas id="quality-gauge" class="w-full h-full"></canvas>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span id="quality-value" class="text-xl font-bold text-amber-600">---%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- OEE Geral + Ranking -->
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                    <!-- OEE Geral (Grande) -->
                                    <div class="lg:col-span-1 bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl shadow-sm border border-purple-200 p-6 text-center">
                                        <p class="text-sm font-medium text-purple-700 mb-3">OEE Geral</p>
                                        <div class="relative mx-auto" style="max-width: 160px; height: 160px;">
                                            <canvas id="oee-main-gauge" class="w-full h-full"></canvas>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span id="oee-general-value" class="text-3xl font-bold text-purple-600">---%</span>
                                            </div>
                                        </div>
                                        <p class="text-xs text-purple-600 mt-4 font-semibold">Classificação: <span id="oee-classification">-</span></p>
                                    </div>

                                    <!-- Ranking de Máquinas -->
                                    <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-purple-100 rounded-lg">
                                                <i data-lucide="trophy" class="w-4 h-4 text-purple-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Top 5 Máquinas por OEE</h3>
                                                <p class="text-xs text-gray-500">Ranking de eficiência</p>
                                            </div>
                                        </div>
                                        <div id="machine-oee-ranking" class="space-y-2 max-h-[220px] overflow-y-auto pr-2">
                                            <div class="text-center py-4 text-gray-400 text-xs">
                                                <i data-lucide="loader-2" class="w-4 h-4 mx-auto animate-spin mb-1"></i>
                                                Carregando...
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Evolução OEE -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 mb-6 hover:shadow-md transition">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="p-2 bg-purple-100 rounded-lg">
                                            <i data-lucide="trending-up" class="w-4 h-4 text-purple-600"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Evolução dos Componentes OEE</h3>
                                            <p class="text-xs text-gray-500">Histórico ao longo do tempo</p>
                                        </div>
                                    </div>
                                    <div class="relative" style="height: 320px;">
                                        <canvas id="oee-components-timeline" class="w-full h-full"></canvas>
                                    </div>
                                </div>

                                <!-- Mapa de Calor OEE -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="p-2 bg-orange-100 rounded-lg">
                                            <i data-lucide="grid-3x3" class="w-4 h-4 text-orange-600"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Mapa de Calor - OEE</h3>
                                            <p class="text-xs text-gray-500">Desempenho por máquina e turno</p>
                                        </div>
                                    </div>
                                    <div id="oee-heatmap" class="overflow-x-auto">
                                        <!-- Será gerado dinamicamente -->
                                    </div>
                                </div>
                            </div>

                            <!-- ========== ANLISE DE PERDAS ========== -->
                            <div id="losses-view" class="analysis-view hidden">
                                <!-- Header com Ação -->
                                <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                                    <div>
                                        <h2 class="text-lg font-semibold text-gray-800">Análise de Perdas & Borras</h2>
                                        <p class="text-sm text-gray-500">Monitore refugos e perdas de matéria-prima</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button onclick="generateLossesReport()" class="inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white font-semibold rounded-xl shadow-md hover:shadow-lg transition-all">
                                            <i data-lucide="file-text" class="w-5 h-5"></i>
                                            Relatório Detalhado
                                        </button>
                                        <button onclick="openModal('quick-losses-modal')" class="inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold rounded-xl shadow-md hover:shadow-lg transition-all">
                                            <i data-lucide="plus" class="w-5 h-5"></i>
                                            Registrar Perda
                                        </button>
                                    </div>
                                </div>

                                <!-- Filtros de Rastreabilidade -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-6">
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="p-1.5 bg-red-100 rounded-lg">
                                            <i data-lucide="filter" class="w-4 h-4 text-red-600"></i>
                                        </div>
                                        <h3 class="text-sm font-semibold text-gray-700">Filtros de Rastreabilidade</h3>
                                        <button onclick="clearLossesFilters()" class="ml-auto text-xs text-gray-500 hover:text-red-600 transition flex items-center gap-1">
                                            <i data-lucide="x-circle" class="w-3 h-3"></i>
                                            Limpar filtros
                                        </button>
                                    </div>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                                        <!-- Filtro por OP -->
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Ordem (OP)</label>
                                            <input type="text" id="losses-filter-op" placeholder="Buscar por OP..." class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                                        </div>
                                        <!-- Filtro por Produto -->
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Produto (Cód.)</label>
                                            <input type="text" id="losses-filter-product" placeholder="Código do produto..." class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                                        </div>
                                        <!-- Filtro por Motivo -->
                                        <div>
                                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Motivo</label>
                                            <select id="losses-filter-reason" class="w-full appearance-none bg-gray-50 border border-gray-200 rounded-lg py-2 pl-3 pr-8 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition cursor-pointer">
                                                <option value="all">Todos os motivos</option>
                                            </select>
                                        </div>
                                        <!-- Botão Filtrar -->
                                        <div class="flex items-end">
                                            <button onclick="applyLossesFilters()" class="w-full inline-flex items-center justify-center gap-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:shadow-lg transition-all text-sm">
                                                <i data-lucide="search" class="w-4 h-4"></i>
                                                Filtrar
                                            </button>
                                        </div>
                                    </div>
                                    <!-- Tags de filtros ativos -->
                                    <div id="losses-active-filters" class="hidden mt-3 flex flex-wrap items-center gap-2">
                                        <span class="text-xs text-gray-500">Filtros ativos:</span>
                                    </div>
                                </div>

                                <!-- KPIs Principais - Grid Superior -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                    <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-2xl shadow-sm border border-red-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-red-700">Total Refugos</p>
                                            <div class="p-1.5 bg-red-200 rounded">
                                                <i data-lucide="alert-triangle" class="w-3 h-3 text-red-600"></i>
                                            </div>
                                        </div>
                                        <p id="total-losses" class="text-2xl font-bold text-red-600">---</p>
                                        <p class="text-xs text-red-600 opacity-70 mt-1">peças</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl shadow-sm border border-orange-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-orange-700">% Refugo/Produção</p>
                                            <div class="p-1.5 bg-orange-200 rounded">
                                                <i data-lucide="percent" class="w-3 h-3 text-orange-600"></i>
                                            </div>
                                        </div>
                                        <p id="losses-percentage" class="text-2xl font-bold text-orange-600">---%</p>
                                        <p class="text-xs text-orange-600 opacity-70 mt-1">da Produção</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-2xl shadow-sm border border-yellow-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-yellow-700">Total Borra</p>
                                            <div class="p-1.5 bg-yellow-200 rounded">
                                                <i data-lucide="droplet" class="w-3 h-3 text-yellow-600"></i>
                                            </div>
                                        </div>
                                        <p id="total-borra" class="text-2xl font-bold text-yellow-600">---</p>
                                        <p class="text-xs text-yellow-600 opacity-70 mt-1">kg</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl shadow-sm border border-purple-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-purple-700">Top Motivo</p>
                                            <div class="p-1.5 bg-purple-200 rounded">
                                                <i data-lucide="target" class="w-3 h-3 text-purple-600"></i>
                                            </div>
                                        </div>
                                        <p id="main-loss-reason" class="text-sm font-bold text-purple-600 truncate">---</p>
                                        <p id="main-loss-material" class="text-xs text-purple-600 opacity-70 mt-1 truncate">MP: ---</p>
                                    </div>
                                </div>

                                <!-- Gráficos Principais - Layout Duplo -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-red-100 rounded-lg">
                                                <i data-lucide="bar-chart-3" class="w-4 h-4 text-red-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Pareto de Refugos por Motivo</h3>
                                                <p class="text-xs text-gray-500">80/20 analysis</p>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 300px;">
                                            <canvas id="losses-pareto-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-4">
                                            <div class="flex items-center gap-3">
                                                <div class="p-2 bg-orange-100 rounded-lg">
                                                    <i data-lucide="cpu" class="w-4 h-4 text-orange-600"></i>
                                                </div>
                                                <div>
                                                    <h3 id="losses-machine-product-title" class="font-semibold text-gray-800">Refugos por Máquina</h3>
                                                    <p id="losses-machine-product-subtitle" class="text-xs text-gray-500">Comparativo máquinas</p>
                                                </div>
                                            </div>
                                            <!-- Toggle Máquina/Produto -->
                                            <div class="flex items-center bg-gray-100 rounded-lg p-1" id="losses-chart-toggle">
                                                <button class="px-3 py-1 text-xs font-medium rounded-md transition-all bg-white shadow text-gray-800" data-losses-chart="machine" onclick="toggleLossesChart('machine')">Máquina</button>
                                                <button class="px-3 py-1 text-xs font-medium rounded-md transition-all text-gray-500 hover:text-gray-700" data-losses-chart="product" onclick="toggleLossesChart('product')">Produto</button>
                                            </div>
                                        </div>
                                        <div id="losses-machine-chart-wrapper" class="relative" style="height: 300px;">
                                            <canvas id="losses-by-machine-chart" class="w-full h-full"></canvas>
                                        </div>
                                        <div id="losses-product-chart-wrapper" class="relative hidden" style="height: 300px;">
                                            <canvas id="losses-by-product-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Gráficos Secundários - Materiais e Borra -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-purple-100 rounded-lg">
                                                <i data-lucide="layers" class="w-4 h-4 text-purple-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Refugos por Tipo de MP</h3>
                                                <p class="text-xs text-gray-500">Análise de materiais</p>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 280px;">
                                            <canvas id="losses-by-material-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>

                                    <!-- Gráfico de Perdas Diárias -->
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-blue-100 rounded-lg">
                                                <i data-lucide="calendar-days" class="w-4 h-4 text-blue-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Perdas Diárias</h3>
                                                <p class="text-xs text-gray-500">Evolução por dia (kg)</p>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 280px;">
                                            <canvas id="losses-daily-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                </div>



                                <!-- Seção Detalhada de Borras -->
                                <div class="bg-gradient-to-br from-amber-50 to-yellow-50 rounded-2xl border border-amber-200 p-5 hover:shadow-md transition">
                                    <div class="flex items-center gap-3 mb-5">
                                        <div class="p-2 bg-amber-200 rounded-lg">
                                            <i data-lucide="zap" class="w-5 h-5 text-amber-700"></i>
                                        </div>
                                        <h3 class="font-semibold text-amber-900 text-base">Análise Detalhada de Borras</h3>
                                    </div>
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                        <!-- Borra por Máquina -->
                                        <div class="bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-amber-100 hover:border-amber-300 transition">
                                            <h4 class="text-xs font-semibold text-amber-700 mb-3 flex items-center gap-2">
                                                <i data-lucide="cpu" class="w-3 h-3"></i>
                                                Borra por Máquina
                                            </h4>
                                            <div class="relative" style="height: 220px;">
                                                <canvas id="borra-by-machine-chart" class="w-full h-full"></canvas>
                                            </div>
                                        </div>
                                        <!-- Gráfico Mensal de Borra -->
                                        <div class="bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-amber-100 hover:border-amber-300 transition">
                                            <h4 class="text-xs font-semibold text-amber-700 mb-3 flex items-center gap-2">
                                                <i data-lucide="bar-chart-3" class="w-3 h-3"></i>
                                                Borra Mensal (kg) + Acumulado
                                            </h4>
                                            <div class="relative" style="height: 220px;">
                                                <canvas id="borra-monthly-chart" class="w-full h-full"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tabela Detalhada de Apontamentos de Borra -->
                                <div class="bg-white rounded-2xl shadow-sm border border-amber-200 p-5 hover:shadow-md transition mt-6">
                                    <div class="flex items-center justify-between mb-5">
                                        <div class="flex items-center gap-3">
                                            <div class="p-2 bg-amber-100 rounded-lg">
                                                <i data-lucide="clipboard-list" class="w-5 h-5 text-amber-700"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-amber-900 text-base">Apontamentos de Borra</h3>
                                                <p class="text-xs text-amber-600">Registro detalhado de todas as borras apontadas</p>
                                            </div>
                                        </div>
                                        <button onclick="exportBorraTable()" class="flex items-center gap-2 px-3 py-1.5 bg-amber-100 hover:bg-amber-200 text-amber-700 rounded-lg text-xs font-medium transition">
                                            <i data-lucide="download" class="w-3 h-3"></i>
                                            Exportar
                                        </button>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead>
                                                <tr class="bg-amber-50 text-amber-800">
                                                    <th class="px-4 py-3 text-left font-semibold rounded-l-lg">Data/Hora</th>
                                                    <th class="px-4 py-3 text-left font-semibold">Máquina</th>
                                                    <th class="px-4 py-3 text-center font-semibold">Quantidade (kg)</th>
                                                    <th class="px-4 py-3 text-left font-semibold rounded-r-lg">Turno</th>
                                                </tr>
                                            </thead>
                                            <tbody id="borra-apontamentos-table" class="divide-y divide-amber-100">
                                                <!-- Dados serão preenchidos via JavaScript -->
                                                <tr>
                                                    <td colspan="4" class="px-4 py-8 text-center text-gray-400">
                                                        <i data-lucide="loader" class="w-6 h-6 mx-auto mb-2 animate-spin"></i>
                                                        Carregando apontamentos...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- Paginação -->
                                    <div class="flex items-center justify-between mt-4 pt-4 border-t border-amber-100">
                                        <p class="text-xs text-amber-600">
                                            Mostrando <span id="borra-table-showing">0</span> de <span id="borra-table-total">0</span> registros
                                        </p>
                                        <div class="flex items-center gap-2">
                                            <button id="borra-table-prev" onclick="borraTablePrevPage()" class="px-3 py-1 bg-amber-100 hover:bg-amber-200 text-amber-700 rounded text-xs font-medium transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                                <i data-lucide="chevron-left" class="w-3 h-3"></i>
                                            </button>
                                            <span id="borra-table-page" class="text-xs text-amber-700 font-medium">Página 1</span>
                                            <button id="borra-table-next" onclick="borraTableNextPage()" class="px-3 py-1 bg-amber-100 hover:bg-amber-200 text-amber-700 rounded text-xs font-medium transition disabled:opacity-50 disabled:cursor-not-allowed">
                                                <i data-lucide="chevron-right" class="w-3 h-3"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- ========== SEÇÃO DE ANÁLISE DE SUCATA ========== -->
                                <div class="bg-gradient-to-br from-red-50 to-rose-50 rounded-2xl border border-red-200 p-5 hover:shadow-md transition mt-6">
                                    <div class="flex items-center gap-3 mb-5">
                                        <div class="p-2 bg-red-200 rounded-lg">
                                            <i data-lucide="trash-2" class="w-5 h-5 text-red-700"></i>
                                        </div>
                                        <h3 class="font-semibold text-red-900 text-base">Análise Detalhada de Sucata</h3>
                                    </div>
                                    
                                    <!-- KPIs de Sucata -->
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-5">
                                        <div class="bg-white/80 backdrop-blur-sm rounded-xl p-3 border border-red-100">
                                            <p class="text-xs font-medium text-red-700">Total Sucata</p>
                                            <p id="total-sucata" class="text-xl font-bold text-red-600">--- kg</p>
                                        </div>
                                        <div class="bg-white/80 backdrop-blur-sm rounded-xl p-3 border border-red-100">
                                            <p class="text-xs font-medium text-red-700">Galhos</p>
                                            <p id="total-sucata-galhos" class="text-xl font-bold text-red-600">--- kg</p>
                                        </div>
                                        <div class="bg-white/80 backdrop-blur-sm rounded-xl p-3 border border-red-100">
                                            <p class="text-xs font-medium text-red-700">Peças</p>
                                            <p id="total-sucata-pecas" class="text-xl font-bold text-red-600">--- kg</p>
                                        </div>
                                        <div class="bg-white/80 backdrop-blur-sm rounded-xl p-3 border border-red-100">
                                            <p class="text-xs font-medium text-red-700">Moído</p>
                                            <p id="total-sucata-moido" class="text-xl font-bold text-red-600">--- kg</p>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-red-100 hover:border-red-300 transition">
                                        <h4 class="text-xs font-semibold text-red-700 mb-3 flex items-center gap-2">
                                            <i data-lucide="pie-chart" class="w-3 h-3"></i>
                                            Sucata por Tipo
                                        </h4>
                                        <div class="relative" style="height: 280px;">
                                            <canvas id="sucata-by-type-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tabela de Apontamentos de Sucata -->
                                <div class="bg-white rounded-2xl shadow-sm border border-red-200 p-5 hover:shadow-md transition mt-6">
                                    <div class="flex items-center justify-between mb-5">
                                        <div class="flex items-center gap-3">
                                            <div class="p-2 bg-red-100 rounded-lg">
                                                <i data-lucide="clipboard-list" class="w-5 h-5 text-red-700"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-red-900 text-base">Apontamentos de Sucata</h3>
                                                <p class="text-xs text-red-600">Registro detalhado de todas as sucatas apontadas</p>
                                            </div>
                                        </div>
                                        <button onclick="exportSucataTable()" class="flex items-center gap-2 px-3 py-1.5 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg text-xs font-medium transition">
                                            <i data-lucide="download" class="w-3 h-3"></i>
                                            Exportar
                                        </button>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead>
                                                <tr class="bg-red-50 text-red-800">
                                                    <th class="px-4 py-3 text-left font-semibold rounded-l-lg">Data/Hora</th>
                                                    <th class="px-4 py-3 text-center font-semibold">Tipo</th>
                                                    <th class="px-4 py-3 text-center font-semibold">Quantidade (kg)</th>
                                                    <th class="px-4 py-3 text-left font-semibold rounded-r-lg">Turno</th>
                                                </tr>
                                            </thead>
                                            <tbody id="sucata-apontamentos-table" class="divide-y divide-red-100">
                                                <tr>
                                                    <td colspan="4" class="px-4 py-8 text-center text-gray-400">
                                                        Carregando apontamentos...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="flex items-center justify-between mt-4 pt-4 border-t border-red-100">
                                        <p class="text-xs text-red-600">
                                            Mostrando <span id="sucata-table-showing">0</span> de <span id="sucata-table-total">0</span> registros
                                        </p>
                                        <div class="flex items-center gap-2">
                                            <button id="sucata-table-prev" onclick="sucataTablePrevPage()" class="px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded text-xs font-medium transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>Anterior</button>
                                            <span id="sucata-table-page" class="text-xs text-red-700 font-medium">Página 1</span>
                                            <button id="sucata-table-next" onclick="sucataTableNextPage()" class="px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded text-xs font-medium transition disabled:opacity-50 disabled:cursor-not-allowed">Próxima</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tabela de Rastreabilidade Detalhada -->
                                <div id="losses-traceability-section" class="hidden mt-6">
                                    <div class="bg-white rounded-2xl shadow-sm border border-indigo-200 p-5 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-4">
                                            <div class="flex items-center gap-3">
                                                <div class="p-2 bg-indigo-100 rounded-lg">
                                                    <i data-lucide="search" class="w-5 h-5 text-indigo-700"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-semibold text-gray-800">Resultados da Filtragem</h3>
                                                    <p id="losses-filter-results-info" class="text-xs text-gray-500">0 registros encontrados</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <button onclick="exportFilteredLosses()" class="flex items-center gap-2 px-3 py-1.5 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded-lg text-xs font-medium transition">
                                                    <i data-lucide="download" class="w-3 h-3"></i>
                                                    Exportar CSV
                                                </button>
                                            </div>
                                        </div>
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm">
                                                <thead>
                                                    <tr class="bg-indigo-50 text-indigo-800">
                                                        <th class="px-3 py-2.5 text-left font-semibold rounded-l-lg text-xs">Data</th>
                                                        <th class="px-3 py-2.5 text-left font-semibold text-xs">Máquina</th>
                                                        <th class="px-3 py-2.5 text-left font-semibold text-xs">OP</th>
                                                        <th class="px-3 py-2.5 text-left font-semibold text-xs">Produto</th>
                                                        <th class="px-3 py-2.5 text-left font-semibold text-xs">Motivo</th>
                                                        <th class="px-3 py-2.5 text-center font-semibold text-xs">Qtd (pçs)</th>
                                                        <th class="px-3 py-2.5 text-center font-semibold text-xs">Peso (kg)</th>
                                                        <th class="px-3 py-2.5 text-center font-semibold rounded-r-lg text-xs">Turno</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="losses-traceability-tbody" class="divide-y divide-indigo-100">
                                                    <tr><td colspan="8" class="px-4 py-6 text-center text-gray-400 text-sm">Aplique filtros para ver resultados</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="flex items-center justify-between mt-4 pt-4 border-t border-indigo-100">
                                            <p class="text-xs text-indigo-600">
                                                Mostrando <span id="losses-trace-showing">0</span> de <span id="losses-trace-total">0</span> registros
                                            </p>
                                            <div class="flex items-center gap-2">
                                                <button id="losses-trace-prev" onclick="lossesTracePageChange(-1)" class="px-3 py-1 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded text-xs font-medium transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>Anterior</button>
                                                <span id="losses-trace-page" class="text-xs text-indigo-700 font-medium">Página 1</span>
                                                <button id="losses-trace-next" onclick="lossesTracePageChange(1)" class="px-3 py-1 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded text-xs font-medium transition disabled:opacity-50 disabled:cursor-not-allowed">Próxima</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- ========== ANLISE DE Paradas ========== -->
                            <div id="downtime-view" class="analysis-view hidden">
                                <!-- Header com Descrição -->
                                <div class="mb-6">
                                    <h2 class="text-lg font-semibold text-gray-800">Análise de Paradas</h2>
                                    <p class="text-sm text-gray-500">Acompanhe interrupções de Produção e impacto no OEE</p>
                                </div>

                                <!-- KPIs Principais - Grid Superior -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                    <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-2xl shadow-sm border border-red-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-red-700">Tempo Total Parado</p>
                                            <div class="p-1.5 bg-red-200 rounded">
                                                <i data-lucide="pause-circle" class="w-3 h-3 text-red-600"></i>
                                            </div>
                                        </div>
                                        <p id="total-downtime" class="text-2xl font-bold text-red-600">---</p>
                                        <p class="text-xs text-red-600 opacity-70 mt-1">horas</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl shadow-sm border border-orange-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-orange-700">Nº de Paradas</p>
                                            <div class="p-1.5 bg-orange-200 rounded">
                                                <i data-lucide="list" class="w-3 h-3 text-orange-600"></i>
                                            </div>
                                        </div>
                                        <p id="downtime-count" class="text-2xl font-bold text-orange-600">---</p>
                                        <p class="text-xs text-orange-600 opacity-70 mt-1">ocorrências</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl shadow-sm border border-amber-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-amber-700">Tempo Mdio</p>
                                            <div class="p-1.5 bg-amber-200 rounded">
                                                <i data-lucide="clock" class="w-3 h-3 text-amber-600"></i>
                                            </div>
                                        </div>
                                        <p id="avg-downtime" class="text-2xl font-bold text-amber-600">---</p>
                                        <p class="text-xs text-amber-600 opacity-70 mt-1">minutos/parada</p>
                                    </div>
                                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-sm border border-blue-200 p-4 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="text-xs font-medium text-blue-700">MTBF</p>
                                            <div class="p-1.5 bg-blue-200 rounded">
                                                <i data-lucide="activity" class="w-3 h-3 text-blue-600"></i>
                                            </div>
                                        </div>
                                        <p id="mtbf-value" class="text-2xl font-bold text-blue-600">---</p>
                                        <p class="text-xs text-blue-600 opacity-70 mt-1">horas</p>
                                    </div>
                                </div>

                                <!-- Gráficos Principais - Layout Duplo -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center justify-between mb-4">
                                            <div class="flex items-center gap-3">
                                                <div class="p-2 bg-red-100 rounded-lg">
                                                    <i data-lucide="alert-circle" class="w-4 h-4 text-red-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-semibold text-gray-800">Paradas por Motivo/Categoria</h3>
                                                    <p class="text-xs text-gray-500">Análise de causas raiz</p>
                                                </div>
                                            </div>
                                            <!-- Toggle Categoria/Motivo -->
                                            <div class="flex items-center bg-gray-100 rounded-lg p-1" id="downtime-chart-toggle">
                                                <button type="button" id="btn-chart-category" class="px-3 py-1.5 text-xs font-medium rounded-md bg-white text-gray-800 shadow-sm transition-all" title="Agrupar por Categoria">
                                                    <i data-lucide="folder" class="w-3.5 h-3.5 inline mr-1"></i>Categoria
                                                </button>
                                                <button type="button" id="btn-chart-reason" class="px-3 py-1.5 text-xs font-medium rounded-md text-gray-500 hover:text-gray-700 transition-all" title="Mostrar por Motivo">
                                                    <i data-lucide="list" class="w-3.5 h-3.5 inline mr-1"></i>Motivo
                                                </button>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 300px;">
                                            <canvas id="downtime-reasons-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="p-2 bg-orange-100 rounded-lg">
                                                <i data-lucide="cpu" class="w-4 h-4 text-orange-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Paradas por Máquina</h3>
                                                <p class="text-xs text-gray-500">Equipamentos mais afetados</p>
                                            </div>
                                        </div>
                                        <div class="relative" style="height: 300px;">
                                            <canvas id="downtime-by-machine-chart" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- ========== FILTRO POR MOTIVO DE PARADA ========== -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 mb-6 hover:shadow-md transition">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div class="p-2 bg-indigo-100 rounded-lg">
                                                <i data-lucide="filter" class="w-4 h-4 text-indigo-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">Detalhe por Motivo de Parada</h3>
                                                <p class="text-xs text-gray-500">Filtre para ver todas as ocorrências</p>
                                            </div>
                                        </div>
                                        <span id="downtime-reason-count" class="text-xs font-semibold text-indigo-700 bg-indigo-50 px-3 py-1.5 rounded-full">0 ocorrências</span>
                                    </div>
                                    
                                    <!-- Filtros de Motivo e Máquina -->
                                    <div class="mb-4 flex flex-col md:flex-row gap-4">
                                        <div class="flex-1">
                                            <label class="block text-xs font-medium text-gray-600 mb-1">Filtrar por Motivo</label>
                                            <select id="downtime-reason-filter" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all">
                                                <option value="">-- Todos os Motivos --</option>
                                            </select>
                                        </div>
                                        <div class="flex-1">
                                            <label class="block text-xs font-medium text-gray-600 mb-1">Filtrar por Máquina</label>
                                            <select id="downtime-machine-filter" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all">
                                                <option value="">-- Todas as Máquinas --</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <!-- Tabela de Ocorrências -->
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead>
                                                <tr class="bg-gray-50 border-b border-gray-200">
                                                    <th class="text-left py-2.5 px-3 font-semibold text-gray-700">Data</th>
                                                    <th class="text-left py-2.5 px-3 font-semibold text-gray-700">Hora Início</th>
                                                    <th class="text-left py-2.5 px-3 font-semibold text-gray-700">Hora Fim</th>
                                                    <th class="text-left py-2.5 px-3 font-semibold text-gray-700">Máquina</th>
                                                    <th class="text-left py-2.5 px-3 font-semibold text-gray-700">Categoria</th>
                                                    <th class="text-left py-2.5 px-3 font-semibold text-gray-700">Motivo</th>
                                                    <th class="text-center py-2.5 px-3 font-semibold text-gray-700">Duração</th>
                                                    <th class="text-left py-2.5 px-3 font-semibold text-gray-700">Operador</th>
                                                    <th class="text-left py-2.5 px-3 font-semibold text-gray-700">Observações</th>
                                                </tr>
                                            </thead>
                                            <tbody id="downtime-reason-table-body" class="divide-y divide-gray-100">
                                                <tr>
                                                    <td colspan="9" class="text-center py-8 text-gray-500">
                                                        <i data-lucide="search" class="w-6 h-6 mx-auto mb-2 text-gray-400"></i>
                                                        <p>Selecione um motivo para ver as ocorrências</p>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <!-- Paginação / Info -->
                                    <div id="downtime-reason-pagination" class="mt-4 flex items-center justify-between text-xs text-gray-500 hidden">
                                        <span id="downtime-showing-info">Mostrando 0 de 0 registros</span>
                                        <div class="flex gap-2">
                                            <button id="downtime-prev-page" class="px-3 py-1.5 bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>Anterior</button>
                                            <button id="downtime-next-page" class="px-3 py-1.5 bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>Próximo</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Timeline de Paradas -->
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 mb-6 hover:shadow-md transition">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="p-2 bg-purple-100 rounded-lg">
                                            <i data-lucide="calendar" class="w-4 h-4 text-purple-600"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-800">Timeline de Paradas</h3>
                                            <p class="text-xs text-gray-500">Evolução temporal das ocorrências</p>
                                        </div>
                                    </div>
                                    <div class="relative" style="height: 340px;">
                                        <canvas id="downtime-timeline-chart" class="w-full h-full"></canvas>
                                    </div>
                                </div>

                                <!-- Paradas Longas Programadas - Removida (Unificação 02/2026) -->
                            </div>

                            <!-- Subaba Relatórios removida - Otimização 02/2026 (viabilidade será analisada futuramente) -->

                            <!-- Analytics IA removido - Otimização 02/12/2025 -->
                        
                        </div><!-- Fim área de conteúdo p-4 md:p-6 -->

                        <!-- Loading e No Data States -->
                        <div id="analysis-loading" class="text-center py-20 hidden">
                            <i data-lucide="loader-2" class="w-12 h-12 animate-spin text-primary-blue mx-auto"></i>
                            <p class="mt-4 text-gray-600">Carregando dados de análise...</p>
                        </div>
                        
                        <div id="analysis-no-data" class="text-center py-20 hidden">
                            <i data-lucide="database" class="w-16 h-16 text-gray-400 mx-auto"></i>
                            <p class="mt-4 text-gray-600 text-lg">Nenhum dado encontrado para o período selecionado</p>
                            <p class="text-gray-500">Tente ajustar os filtros ou selecionar um período diferente</p>
                        </div>
                        
                    </div><!-- Fim bg-gradient-to-br container principal -->
                </div><!-- Fim analise-page -->
            </div>
        </main>
    </div>
    
    <!-- Overlay handled by first #sidebar-overlay element -->

    <!-- Modais -->
    
    <!-- Modal de Nova/Editar Ordem de Produção -->
    <div id="order-form-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white/20 rounded-lg">
                            <i data-lucide="plus-circle" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h3 id="order-form-title" class="text-xl font-bold text-white">Nova Ordem de Produção</h3>
                            <p class="text-blue-200 text-sm">Preencha os dados da OP</p>
                        </div>
                    </div>
                    <button onclick="closeOrderFormModal()" class="p-2 hover:bg-white/20 rounded-lg transition">
                        <i data-lucide="x" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
            </div>
            
            <!-- Body -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                <form id="order-form-modal-form" class="space-y-4">
                    <input type="hidden" id="order-form-id">
                    
                    <!-- Seção 1: Dados da OP -->
                    <div class="border border-blue-200 rounded-lg overflow-hidden">
                        <div class="bg-blue-50 px-3 py-2 border-b border-blue-200">
                            <h4 class="text-sm font-semibold text-blue-800 flex items-center gap-2">
                                <i data-lucide="file-text" class="w-4 h-4"></i>
                                Dados da Ordem
                            </h4>
                        </div>
                        <div class="p-3 space-y-3 bg-white">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <!-- Nº da OP -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nº da OP <span class="text-red-500">*</span></label>
                                    <input type="text" id="order-form-number" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: OP-2024-001" required>
                                </div>
                                
                                <!-- Código da Peça -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Código da Peça <span class="text-blue-500">(busca automática)</span></label>
                                    <div class="relative">
                                        <input type="text" id="order-form-part-code" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Digite o código e pressione Enter">
                                        <button type="button" onclick="onPartCodeChange(document.getElementById('order-form-part-code').value)" class="absolute right-2 top-1/2 -translate-y-1/2 p-1 bg-blue-100 hover:bg-blue-200 rounded text-blue-600">
                                            <i data-lucide="search" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção 2: Dados do Produto (preenchido automaticamente) -->
                    <div class="border border-emerald-200 rounded-lg overflow-hidden">
                        <div class="bg-emerald-50 px-3 py-2 border-b border-emerald-200">
                            <h4 class="text-sm font-semibold text-emerald-800 flex items-center gap-2">
                                <i data-lucide="package" class="w-4 h-4"></i>
                                Dados do Produto
                            </h4>
                        </div>
                        <div class="p-3 space-y-3 bg-white">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <!-- Produto -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Produto</label>
                                    <input type="text" id="order-form-product" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="Preenchido automaticamente" readonly>
                                </div>
                                
                                <!-- Cliente -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cliente</label>
                                    <input type="text" id="order-form-customer" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="Preenchido automaticamente" readonly>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <!-- Cavidades -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cavidades</label>
                                    <input type="number" id="order-form-cavities" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="-" readonly>
                                </div>
                                
                                <!-- Ciclo -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Ciclo (s)</label>
                                    <input type="number" step="0.01" id="order-form-cycle" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="-" readonly>
                                </div>
                                
                                <!-- Peso -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Peso (g)</label>
                                    <input type="number" step="0.01" id="order-form-weight" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="-" readonly>
                                </div>
                                
                                <!-- Meta peças/hora -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Meta pç/h</label>
                                    <input type="number" id="order-form-goal" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" placeholder="-" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção 3: Dados da Produção -->
                    <div class="border border-amber-200 rounded-lg overflow-hidden">
                        <div class="bg-amber-50 px-3 py-2 border-b border-amber-200">
                            <h4 class="text-sm font-semibold text-amber-800 flex items-center gap-2">
                                <i data-lucide="settings" class="w-4 h-4"></i>
                                Dados da Produção
                            </h4>
                        </div>
                        <div class="p-3 space-y-3 bg-white">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <!-- Tamanho do Lote -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tamanho do Lote <span class="text-red-500">*</span></label>
                                    <input type="number" id="order-form-lot-size" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: 10000" min="1" required>
                                </div>
                                
                                <!-- Nº do Lote -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nº do Lote</label>
                                    <input type="text" id="order-form-batch" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: L001">
                                </div>
                                
                                <!-- Embalagem -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Qtd. Embalagem</label>
                                    <input type="number" id="order-form-packaging" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: 500" min="0">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <!-- Máquina -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Máquina</label>
                                    <select id="order-form-machine" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione uma máquina</option>
                                    </select>
                                </div>
                                
                                <!-- Matéria-Prima -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Matéria-Prima (MP)</label>
                                    <select id="order-form-mp" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione a MP...</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botões -->
                    <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                        <button type="button" onclick="closeOrderFormModal()" class="px-5 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-lg transition">
                            Cancelar
                        </button>
                        <button type="button" onclick="saveOrderForm()" class="px-5 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold rounded-lg shadow-md transition flex items-center gap-2">
                            <i data-lucide="save" class="w-4 h-4"></i>
                            Salvar OP
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal de Importação de Ordens Excel -->
    <div id="import-orders-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white/20 rounded-lg">
                            <i data-lucide="file-spreadsheet" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Importar Ordens de Produção</h3>
                            <p class="text-indigo-200 text-sm">Importar arquivo Excel do ERP</p>
                        </div>
                    </div>
                    <button onclick="closeImportOrdersModal()" class="p-2 hover:bg-white/20 rounded-lg transition">
                        <i data-lucide="x" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
            </div>
            
            <!-- Body -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                <!-- Área de Upload -->
                <div id="import-upload-area" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-indigo-400 hover:bg-indigo-50/50 transition-all cursor-pointer mb-6" onclick="document.getElementById('import-file-input').click()">
                    <input type="file" id="import-file-input" accept=".xlsx,.xls" class="hidden" onchange="handleImportFileSelect(event)">
                    <div class="flex flex-col items-center gap-3">
                        <div class="p-4 bg-indigo-100 rounded-full">
                            <i data-lucide="upload-cloud" class="w-10 h-10 text-indigo-600"></i>
                        </div>
                        <div>
                            <p class="text-lg font-semibold text-gray-700">Arraste o arquivo Excel aqui</p>
                            <p class="text-sm text-gray-500">ou clique para selecionar</p>
                        </div>
                        <p class="text-xs text-gray-400">Formatos aceitos: .xlsx, .xls</p>
                    </div>
                </div>
                
                <!-- Arquivo Selecionado -->
                <div id="import-file-info" class="hidden mb-6">
                    <div class="flex items-center gap-3 p-4 bg-green-50 border border-green-200 rounded-xl">
                        <div class="p-2 bg-green-100 rounded-lg">
                            <i data-lucide="file-check" class="w-5 h-5 text-green-600"></i>
                        </div>
                        <div class="flex-1">
                            <p id="import-file-name" class="font-medium text-green-800">arquivo.xlsx</p>
                            <p id="import-file-size" class="text-sm text-green-600">0 KB</p>
                        </div>
                        <button onclick="clearImportFile()" class="p-2 hover:bg-green-100 rounded-lg transition">
                            <i data-lucide="x" class="w-4 h-4 text-green-600"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Configurações de Importação -->
                <div id="import-config" class="hidden mb-6">
                    <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                        Configurações de Importação
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">Máquina Padrão</label>
                            <select id="import-default-machine" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm">
                                <option value="">Usar do arquivo</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">Status Inicial</label>
                            <select id="import-default-status" class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm">
                                <option value="from_file">Usar do arquivo</option>
                                <option value="planejada">Planejada</option>
                                <option value="ativa">Ativa</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="import-skip-existing" checked class="w-4 h-4 text-indigo-600 rounded">
                            <span class="text-sm text-gray-700">Ignorar ordens já existentes (mesmo Nº OP)</span>
                        </label>
                    </div>
                </div>
                
                <!-- Preview dos Dados -->
                <div id="import-preview" class="hidden">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-semibold text-gray-800 flex items-center gap-2">
                            <i data-lucide="eye" class="w-4 h-4"></i>
                            Prvia dos Dados
                        </h4>
                        <span id="import-records-count" class="text-sm text-gray-500">0 registros encontrados</span>
                    </div>
                    <div class="overflow-x-auto border border-gray-200 rounded-xl">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">
                                        <input type="checkbox" id="import-select-all" checked class="w-4 h-4 text-indigo-600 rounded" onchange="toggleAllImportRows(this.checked)">
                                    </th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Nº OP</th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Produto</th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Descrição</th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Máquina</th>
                                    <th class="px-3 py-2 text-center font-semibold text-gray-600">Lote</th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Status</th>
                                    <th class="px-3 py-2 text-left font-semibold text-gray-600">Cliente</th>
                                </tr>
                            </thead>
                            <tbody id="import-preview-body" class="divide-y divide-gray-100">
                                <!-- Linhas serão inseridas via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Status de Importação -->
                <div id="import-status" class="hidden">
                    <div class="text-center py-8">
                        <div id="import-progress-container" class="mb-4">
                            <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                                <div id="import-progress-bar" class="bg-indigo-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p id="import-progress-text" class="text-sm text-gray-600">Importando...</p>
                        </div>
                        <div id="import-result" class="hidden">
                            <div id="import-result-icon" class="mb-3"></div>
                            <p id="import-result-text" class="text-lg font-semibold"></p>
                            <p id="import-result-details" class="text-sm text-gray-500 mt-1"></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="px-6 py-4 bg-gray-50 border-t flex justify-between items-center">
                <p class="text-xs text-gray-500">
                    <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
                    Formato compatível: Relatório de Ordens do ERP Sankhya
                </p>
                <div class="flex gap-3">
                    <button onclick="closeImportOrdersModal()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition">
                        Cancelar
                    </button>
                    <button id="import-execute-btn" onclick="executeImportOrders()" disabled class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition flex items-center gap-2">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        Importar Selecionados
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Cadastro de Novo Produto -->
    <div id="new-product-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-emerald-600 to-teal-600 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white/20 rounded-lg">
                            <i data-lucide="package-plus" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Cadastrar Novo Produto</h3>
                            <p class="text-emerald-200 text-sm">Adicionar produto ao banco de dados</p>
                        </div>
                    </div>
                    <button onclick="closeNewProductModal()" class="p-2 hover:bg-white/20 rounded-lg transition">
                        <i data-lucide="x" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
            </div>
            
            <!-- Body -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                <form id="new-product-form" class="space-y-4">
                    <!-- Código e Cliente -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1.5">
                                Código do Produto *
                            </label>
                            <input type="number" id="new-product-cod" required min="1"
                                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                placeholder="Ex: 6141">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1.5">
                                Cliente *
                            </label>
                            <select id="new-product-client" required
                                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                                <option value="">Selecione o cliente...</option>
                                <option value="APTAR">APTAR</option>
                                <option value="ÓRICA">ÓRICA</option>
                                <option value="CIMED">CIMED</option>
                                <option value="HYPERA">HYPERA</option>
                                <option value="OUTRO">OUTRO</option>
                            </select>
                        </div>
                    </div>

                    <!-- Nome do Produto -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1.5">
                            Nome do Produto *
                        </label>
                        <input type="text" id="new-product-name" required
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                            placeholder="Ex: TAMPA-EM-28,20-PP-PINK--SHNY-----TODODIA">
                    </div>

                    <!-- Parâmetros de Produção -->
                    <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
                        <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                            <i data-lucide="settings" class="w-4 h-4 text-gray-600"></i>
                            Parâmetros de Produção
                        </h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">
                                    Cavidades *
                                </label>
                                <input type="number" id="new-product-cavities" required min="1"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                    placeholder="Ex: 29">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">
                                    Ciclo (seg) *
                                </label>
                                <input type="number" id="new-product-cycle" required min="0.1" step="0.1"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                    placeholder="Ex: 12">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">
                                    Peso (g) *
                                </label>
                                <input type="number" id="new-product-weight" required min="0.01" step="0.01"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                    placeholder="Ex: 0.95">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">
                                    Peças/Hora *
                                </label>
                                <input type="number" id="new-product-pph" required min="1"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                    placeholder="Ex: 8700">
                            </div>
                        </div>
                    </div>

                    <!-- Matéria-Prima -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1.5">
                            Matéria-Prima (opcional)
                        </label>
                        <select id="new-product-mp"
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                            <option value="">Selecione (opcional)...</option>
                        </select>
                    </div>

                    <!-- Calculadora de Meta -->
                    <div class="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                        <h4 class="font-semibold text-emerald-800 mb-3 flex items-center gap-2">
                            <i data-lucide="calculator" class="w-4 h-4 text-emerald-600"></i>
                            Calculadora de Meta (Peças/Hora)
                        </h4>
                        <div class="flex items-center gap-4">
                            <button type="button" onclick="calcularMetaPPH()" 
                                class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-sm font-medium transition flex items-center gap-2">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                Calcular
                            </button>
                            <p class="text-sm text-emerald-700">
                                <span class="font-medium">Fórmula:</span> (3600 / ciclo) × cavidades
                            </p>
                            <p id="new-product-calc-result" class="text-sm font-bold text-emerald-800"></p>
                        </div>
                    </div>

                    <!-- Feedback -->
                    <div id="new-product-feedback" class="hidden rounded-lg p-3 text-sm"></div>
                </form>
            </div>
            
            <!-- Footer -->
            <div class="px-6 py-4 bg-gray-50 border-t flex justify-between items-center">
                <p class="text-xs text-gray-500">
                    <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
                    O produto será salvo no Firestore e ficará disponível para uso
                </p>
                <div class="flex gap-3">
                    <button type="button" onclick="closeNewProductModal()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition">
                        Cancelar
                    </button>
                    <button type="button" onclick="saveNewProduct()" class="px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-sm font-medium transition flex items-center gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        Salvar Produto
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="leader-entry-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-40 flex justify-center items-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg m-4">
            <div class="flex justify-between items-center border-b pb-3 mb-5">
                <h3 id="leader-modal-title" class="text-xl font-bold"></h3>
                <button id="leader-modal-close-btn" class="p-1 rounded-full hover:bg-gray-200"><i data-lucide="x"></i></button>
            </div>
            <form id="leader-entry-form"></form>
        </div>
    </div>

    <div id="production-entry-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-40 flex justify-center items-start p-4 overflow-y-auto">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-5xl m-4 mt-10">
        <div class="flex justify-between items-center border-b pb-3 mb-5">
            <h3 id="production-modal-title" class="text-xl font-bold"></h3>
            <button id="production-modal-close-btn" class="p-1 rounded-full hover:bg-gray-200">
                <i data-lucide="x"></i>
            </button>
        </div>
        <!-- Contexto Máquina/Produto -->
        <div class="modal-context bg-gray-50 border border-gray-200 rounded-md p-2 mb-4 text-xs text-gray-700">
            <div class="flex items-center justify-between gap-3">
                <span>Máquina: <b class="context-machine">-</b></span>
                <span>Produto: <b class="context-product">-</b></span>
            </div>
        </div>
        
        <!-- Informações do Produto -->
        <div class="bg-blue-50 p-3 rounded-lg mb-4">
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                    <span id="product-weight-info" class="font-semibold">Peso da peça: 0g</span>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="use-tara-box" class="mr-2">
                    <label for="use-tara-box" class="font-semibold">Usar Caixa de Tara</label>
                    <input type="number" id="tara-box-weight" step="0.01" value="0" 
                           class="ml-2 w-20 p-1 border rounded" readonly>
                    <span id="tara-box-info" class="ml-2 text-sm text-gray-600">caixa plastica</span>
                </div>
            </div>
        </div>

        <form id="production-entry-form" class="space-y-4">
            <input type="hidden" id="production-entry-plan-id" name="planId">
            <input type="hidden" id="production-entry-turno" name="turno">
            
            <!-- Cabeçalho da tabela de lançamentos por hora -->
            <div class="grid grid-cols-13 gap-2 font-semibold border-b pb-2 text-sm">
                <div class="col-span-2">Hora</div>
                <div class="col-span-3">Peso Bruto (kg)</div>
                <div class="col-span-2">Tara</div>
                <div class="col-span-2">Embalagem Fechada</div>
                <div class="col-span-3">Peças Calculadas</div>
                <div class="col-span-1">Ação</div>
            </div>
            
            <!-- Container para lançamentos por hora -->
            <div id="hourly-entries-container" class="max-h-96 overflow-y-auto border rounded-lg p-2">
                <!-- Os lançamentos serão inseridos aqui via JavaScript -->
            </div>
            
            <!-- Resumo Total -->
            <div class="bg-gray-50 p-4 rounded-lg mt-4">
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <div class="text-sm text-gray-600">Total Peso Líquido</div>
                        <div id="total-peso-liquido" class="text-lg font-bold">0 kg</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-600">Total de Peças</div>
                        <div id="total-pecas" class="text-lg font-bold">0</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-600">Produção Boa</div>
                        <input type="number" id="production-entry-produzido" name="produzido" 
                               min="0" value="0" step="1" inputmode="numeric" class="w-full p-2 border rounded text-center font-bold" onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                    </div>
                </div>
            </div>

            <!-- Campos de refugo -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                <div>
                    <label for="production-entry-refugo" class="block text-sm font-medium">Refugo (kg)</label>
                    <input type="number" id="production-entry-refugo" name="refugo" 
                           min="0" step="0.01" value="0" class="mt-1 w-full p-2 border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="production-entry-borras" class="block text-sm font-medium">Peso das Borras (kg)</label>
                    <input type="number" id="production-entry-borras" name="borras" 
                           min="0" step="0.01" value="0" class="mt-1 w-full p-2 border-gray-300 rounded-md">
                </div>
            </div>
            
            <div>
                <label for="production-entry-perdas" class="block text-sm font-medium">Motivo do Refugo</label>
                <select id="production-entry-perdas" name="perdas" class="mt-1 w-full p-2 border-gray-300 rounded-md"></select>
            </div>
            
            <div class="mt-6 flex justify-end gap-3 pt-4 border-t">
                <button type="button" id="production-modal-cancel-btn" 
                        class="bg-gray-200 hover:bg-gray-300 font-bold py-2 px-6 rounded-lg">
                    Cancelar
                </button>
                <button type="submit" id="production-modal-save-btn" 
                        class="bg-primary-blue hover:bg-blue-800 text-white font-bold py-2 px-6 rounded-lg">
                    Salvar Lançamentos
                </button>
            </div>
            <div id="production-modal-status" class="text-sm font-semibold h-5 text-center mt-2"></div>
        </form>
    </div>
</div>

    <!-- Modal de Lançamento de Produção -->
    <div id="quick-production-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-green-100 to-green-200 rounded-xl">
                        <i data-lucide="package-plus" class="w-5 h-5 text-green-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Lançar Produção</h3>
                </div>
                <button id="quick-production-close" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="quick-production-form" class="space-y-4">
                <!-- Seletor de OP para máquinas com múltiplos produtos (molde família) -->
                <div id="quick-production-plan-selector-container" class="hidden">
                    <label class="block text-xs font-semibold text-purple-600 uppercase tracking-wider mb-1.5">
                        <i data-lucide="layers" class="w-3 h-3 inline mr-1"></i>
                        Selecionar Produto/OP (Molde Multi-Produto)
                    </label>
                    <select id="quick-production-plan-selector" class="w-full bg-purple-50 border border-purple-300 rounded-lg py-2.5 px-3 text-sm font-semibold focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all">
                        <option value="">Selecione o produto para lançar...</option>
                    </select>
                    <p class="text-xs text-purple-600 mt-1">Esta máquina possui múltiplos produtos. Selecione qual OP deseja lançar.</p>
                </div>
                
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-3 mb-4">
                    <p class="text-sm text-blue-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Informe <strong>quantidade OU peso</strong> - o sistema irá validar e converter automaticamente.
                    </p>
                </div>
                
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Operador <span class="text-red-500">*</span></label>
                    <input type="number" id="quick-production-user" name="user" min="0" max="999" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all" placeholder="Digite seu código (ex: 42)" required inputmode="numeric">
                    <p class="text-xs text-gray-400 mt-1" id="quick-production-user-name">Digite o código para ver o nome</p>
                </div>
                
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Quantidade Produzida <span class="text-gray-400 normal-case">(opcional se informar peso)</span></label>
                    <input type="number" id="quick-production-qty" name="quantity" min="0" step="1" inputmode="numeric" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all" placeholder="Quantidade de peças (números inteiros)" onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                    <p id="quick-production-qty-feedback" class="text-xs text-gray-500 mt-1"></p>
                </div>
                
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Peso Bruto (g) <span class="text-gray-400 normal-case">(opcional se informar quantidade)</span></label>
                    <input type="number" step="1" id="quick-production-weight" name="weight" min="0" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all" placeholder="Peso em gramas (ex: 1500)">
                    <p id="quick-production-weight-feedback" class="text-xs text-gray-500 mt-1">Digite o peso em gramas (Ex: 1500g = 1,5kg)</p>
                    <p id="quick-production-weight-converted" class="text-xs text-blue-600 mt-1 font-semibold"></p>
                </div>
                
                <div class="rounded-xl border border-gray-200 bg-gradient-to-br from-gray-50 to-gray-100 p-3">
                    <div class="flex flex-col text-sm text-gray-700">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Peso de referência ativo</span>
                        <span id="quick-production-weight-source" class="text-gray-900 mt-1">-</span>
                        <span id="quick-production-weight-history" class="text-xs text-gray-500 hidden"></span>
                    </div>
                </div>
                
                <div>
                    <label class="flex items-center text-sm font-medium text-gray-700">
                        <input type="checkbox" id="quick-production-use-tare" class="mr-2 w-4 h-4 text-green-600 rounded border-gray-300 focus:ring-green-500">
                        Usar tara da caixa plástica
                    </label>
                    <div id="quick-production-tare-info" class="hidden text-sm text-blue-700 bg-gradient-to-br from-blue-50 to-blue-100 p-3 rounded-xl border border-blue-200 mt-2">
                        <strong>Tara cadastrada:</strong> <span id="quick-production-tare-weight">-</span>g
                        <p class="text-xs mt-2">Será descontada automaticamente do peso bruto</p>
                    </div>
                </div>
                
                <div id="quick-production-consistency-alert" class="hidden bg-gradient-to-br from-yellow-50 to-amber-50 border border-yellow-200 rounded-xl p-3">
                    <p class="text-sm text-yellow-800">
                        <i data-lucide="alert-triangle" class="w-4 h-4 inline mr-2"></i>
                        <span id="quick-production-consistency-message"></span>
                    </p>
                </div>
                
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="quick-production-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all" placeholder="Observações opcionais"></textarea>
                </div>
                
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="quick-production-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all" id="quick-production-submit">
                        Registrar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Registro de Perdas -->
    <div id="quick-losses-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-orange-100 to-orange-200 rounded-xl">
                        <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Registrar Perdas</h3>
                </div>
                <button id="quick-losses-close" class="p-2 rounded-full hover:bg-gray-100">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gray-50 border border-gray-200 rounded-md p-2 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="quick-losses-form" class="space-y-4">
                <div class="bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-xl p-3 mb-4">
                    <p class="text-sm text-orange-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Informe <strong>quantidade OU peso</strong> das perdas - apenas um dos campos  necessário.
                    </p>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Operador <span class="text-red-500">*</span></label>
                    <input type="number" id="quick-losses-user" name="user" min="0" max="999" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Digite seu código (ex: 42)" required inputmode="numeric">
                    <p class="text-xs text-gray-400 mt-1" id="quick-losses-user-name">Digite o código para ver o nome</p>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Quantidade de Perdas <span class="text-gray-400 normal-case">(opcional se informar peso)</span></label>
                    <input type="number" id="quick-losses-qty" name="quantity" min="0" step="1" inputmode="numeric" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Quantidade de peças perdidas" onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Peso das Perdas (g) <span class="text-gray-400 normal-case">(opcional se informar quantidade)</span></label>
                    <input type="number" step="1" id="quick-losses-weight" name="weight" min="0" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Peso em gramas (ex: 1500)" inputmode="numeric">
                    <div id="weight-feedback-helper" class="mt-2 text-sm"></div>
                    <p id="quick-losses-weight-converted" class="text-xs text-blue-600 mt-1 font-semibold"></p>
                </div>
                <div>
                    <label class="flex items-center text-sm font-medium text-gray-700">
                        <input type="checkbox" id="quick-losses-use-tare" class="mr-2 w-4 h-4 text-orange-600 rounded border-gray-300 focus:ring-orange-500">
                        Usar tara da caixa plástica
                    </label>
                    <div id="quick-losses-tare-info" class="hidden text-sm text-orange-700 bg-gradient-to-br from-orange-50 to-orange-100 p-3 rounded-xl border border-orange-200 mt-2">
                        Tara da caixa: <span id="quick-losses-tare-weight">-</span>g
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Perda</label>
                    <select id="quick-losses-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                        <option value="">Selecione o motivo...</option>
                        <optgroup label="PROCESSO">
                            <option value="FALHA DE INJEÇÃO">FALHA DE INJEÇÃO</option>
                            <option value="CONTAMINAÇÃO">CONTAMINAÇÃO</option>
                            <option value="PONTO ALTO DE INJEÇÃO / FIAPO">PONTO ALTO DE INJEÇÃO / FIAPO</option>
                            <option value="REBARBA">REBARBA</option>
                            <option value="FORA DE COR">FORA DE COR</option>
                            <option value="FORA DE DIMENSIONAL">FORA DE DIMENSIONAL</option>
                            <option value="REINICIO/INICIO">REINICIO/INICIO</option>
                            <option value="CHUPAGEM">CHUPAGEM</option>
                            <option value="BOLHA">BOLHA</option>
                            <option value="QUEIMA">QUEIMA</option>
                            <option value="MANCHAS">MANCHAS</option>
                            <option value="JUNÇÃO">JUNÇÃO</option>
                            <option value="EMPENAMENTO">EMPENAMENTO</option>
                            <option value="PEÇAS SCRAP">PEÇAS SCRAP</option>
                            <option value="PEÇAS DEFORMADAS">PEÇAS DEFORMADAS</option>
                        </optgroup>
                        <optgroup label="FERRAMENTARIA">
                            <option value="GALHO PRESO">GALHO PRESO</option>
                            <option value="MARCA D'AGUA">MARCA D'AGUA</option>
                            <option value="MARCA DE EXTRATOR">MARCA DE EXTRATOR</option>
                            <option value="RISCO">RISCO</option>
                            <option value="SUJIDADE MOLDE">SUJIDADE MOLDE</option>
                            <option value="LAMINA QUEBRADA">LAMINA QUEBRADA</option>
                            <option value="TRY OUT">TRY OUT</option>
                            <option value="LIMPEZA DE TIPS">LIMPEZA DE TIPS</option>
                            <option value="ABERTURA DE CAVIDADES">ABERTURA DE CAVIDADES</option>
                        </optgroup>
                        <optgroup label="MAQUINA">
                            <option value="QUEDA DE ENERGIA">QUEDA DE ENERGIA</option>
                            <option value="PARADA EMERGENCIAL">PARADA EMERGENCIAL</option>
                            <option value="VAZAMENTO DE OLEO">VAZAMENTO DE OLEO</option>
                            <option value="AUSENCIA DE PERIFERICOS">AUSENCIA DE PERIFERICOS</option>
                            <option value="SUJIDADE (GRAXA, AGUA, ETC)">SUJIDADE (GRAXA, AGUA, ETC)</option>
                        </optgroup>
                        <optgroup label="MATERIA PRIMA">
                            <option value="MATERIAL NÃO CONFORME">MATERIAL NÃO CONFORME</option>
                        </optgroup>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações <span class="text-red-500">*</span></label>
                    <textarea id="quick-losses-obs" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Descreva detalhes sobre a perda (OBRIGATÓRIO)" required></textarea>
                    <p class="text-xs text-gray-400 mt-1">Campo obrigatório para rastreabilidade</p>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="quick-losses-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="button" id="quick-losses-delete-btn" class="hidden py-2.5 px-4 border border-red-200 text-red-600 rounded-xl hover:bg-red-50 font-medium text-sm transition-colors">
                        Excluir
                    </button>
                    <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Registrar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Parada -->
    <div id="quick-downtime-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-red-100 to-red-200 rounded-xl">
                        <i data-lucide="pause-circle" class="w-5 h-5 text-red-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800" id="downtime-modal-title">Iniciar Parada - Informe o Motivo</h3>
                </div>
                <button id="quick-downtime-close" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="quick-downtime-form" class="space-y-4">
                <div class="bg-gradient-to-br from-yellow-50 to-amber-50 border border-yellow-200 rounded-xl p-3 mb-4">
                    <p class="text-sm text-yellow-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Selecione o motivo da parada que está iniciando.
                    </p>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Operador <span class="text-red-500">*</span></label>
                    <input type="number" id="quick-downtime-user" name="user" min="0" max="999" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" placeholder="Digite seu código (ex: 42)" required inputmode="numeric">
                    <p class="text-xs text-gray-400 mt-1" id="quick-downtime-user-name">Digite o código para ver o nome</p>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Parada</label>
                    <select id="quick-downtime-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" required>
                        <option value="">Selecione o motivo...</option>
                        <optgroup label="FERRAMENTARIA">
                            <option value="CORRETIVA DE MOLDE">CORRETIVA DE MOLDE</option>
                            <option value="PREVENTIVA DE MOLDE">PREVENTIVA DE MOLDE</option>
                            <option value="TROCA DE VERSÇO">TROCA DE VERSÇO</option>
                        </optgroup>
                        <optgroup label="PROCESSO">
                            <option value="ABERTURA DE CAVIDADE">ABERTURA DE CAVIDADE</option>
                            <option value="AJUSTE DE PROCESSO">AJUSTE DE PROCESSO</option>
                            <option value="TRY OUT">TRY OUT</option>
                        </optgroup>
                        <optgroup label="COMPRAS">
                            <option value="FALTA DE INSUMO PLANEJADA">FALTA DE INSUMO PLANEJADA</option>
                            <option value="FALTA DE INSUMO NÇO PLANEJADA">FALTA DE INSUMO NÇO PLANEJADA</option>
                        </optgroup>
                        <optgroup label="PREPARA¡ÇO">
                            <option value="AGUARDANDO PREPARA¡ÇO DE MATERIAL">AGUARDANDO PREPARA¡ÇO DE MATERIAL</option>
                        </optgroup>
                        <optgroup label="QUALIDADE">
                            <option value="AGUARDANDO CLIENTE/FORNECEDOR">AGUARDANDO CLIENTE/FORNECEDOR</option>
                            <option value="LIBERA¡ÇO">LIBERA¡ÇO</option>
                        </optgroup>
                        <optgroup label="MANUTEN¡ÇO">
                            <option value="MANUTEN¡ÇO CORRETIVA">MANUTEN¡ÇO CORRETIVA</option>
                            <option value="MANUTEN¡ÇO PREVENTIVA">MANUTEN¡ÇO PREVENTIVA</option>
                        </optgroup>
                        <optgroup label="PRODU¡ÇO">
                            <option value="FALTA DE OPERADOR">FALTA DE OPERADOR</option>
                            <option value="TROCA DE COR">TROCA DE COR</option>
                        </optgroup>
                        <optgroup label="SETUP">
                            <option value="INSTALA¡ÇO DE MOLDE">INSTALA¡ÇO DE MOLDE</option>
                            <option value="RETIRADA DE MOLDE">RETIRADA DE MOLDE</option>
                        </optgroup>
                        <optgroup label="ADMINISTRATIVO">
                            <option value="FALTA DE ENERGIA">FALTA DE ENERGIA</option>
                        </optgroup>
                        <optgroup label="PCP">
                            <option value="SEM PROGRAMA¡ÇO">SEM PROGRAMA¡ÇO</option>
                        </optgroup>
                        <optgroup label="COMERCIAL">
                            <option value="SEM PEDIDO">SEM PEDIDO</option>
                        </optgroup>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações <span class="text-red-500">*</span></label>
                    <textarea id="quick-downtime-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" placeholder="Descreva detalhes sobre a parada (OBRIGATÓRIO)" required></textarea>
                    <p class="text-xs text-gray-400 mt-1">Campo obrigatório para rastreabilidade</p>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="quick-downtime-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all" id="downtime-action-btn">
                        Iniciar Parada
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Lançamento Manual de Produção -->
    <div id="manual-production-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl">
                        <i data-lucide="history" class="w-5 h-5 text-blue-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Lançamento Manual de Produção</h3>
                </div>
                <button id="manual-production-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="manual-production-form" class="space-y-4">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-3">
                    <p class="text-sm text-blue-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Utilize este formulário para registrar produções anteriores ou corrigir apontamentos.
                    </p>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Operador <span class="text-red-500">*</span></label>
                    <input type="number" id="manual-production-user" name="user" min="0" max="999" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Digite seu código (ex: 42)" required inputmode="numeric">
                    <p class="text-xs text-gray-400 mt-1" id="manual-production-user-name">Digite o código para ver o nome</p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="manual-production-date" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data da Produção</label>
                        <input type="date" id="manual-production-date" name="date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required>
                    </div>
                    <div>
                        <label for="manual-production-hour" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Horário (opcional)</label>
                        <input type="time" id="manual-production-hour" name="hour" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="manual-production-shift" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                        <select id="manual-production-shift" name="shift" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            <option value="1">1º Turno</option>
                            <option value="2">2º Turno</option>
                            <option value="3">3º Turno</option>
                        </select>
                    </div>
                    <div>
                        <label for="manual-production-qty" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Qtd Produzida</label>
                        <input type="number" id="manual-production-qty" name="quantity" min="1" step="1" inputmode="numeric" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Peças produzidas" onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                    </div>
                </div>
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-3">
                    <p class="text-sm text-blue-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Informe <strong>quantidade OU peso</strong> - apenas um dos campos  necessário.
                    </p>
                </div>
                <div>
                    <label for="manual-production-weight" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Peso (kg) <span class="text-gray-400 normal-case">(opcional)</span></label>
                    <input type="number" step="0.01" id="manual-production-weight" name="weight" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Peso bruto em kg">
                </div>
                <div>
                    <label class="flex items-center text-sm font-medium text-gray-700">
                        <input type="checkbox" id="manual-production-use-tare" class="mr-2 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                        Usar tara da caixa plástica
                    </label>
                    <div id="manual-production-tare-info" class="hidden text-sm text-blue-700 bg-gradient-to-br from-blue-50 to-blue-100 p-3 rounded-xl border border-blue-200 mt-2">
                        Tara da caixa: <span id="manual-production-tare-weight">-</span>g
                    </div>
                </div>
                <div>
                    <label for="manual-production-obs" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="manual-production-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Detalhes adicionais (opcional)"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="manual-production-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">Cancelar</button>
                    <button type="submit" id="manual-production-submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">Registrar Produção</button>
                </div>
            </form>
        </div>
    </div>

        <!-- Modal de Lançamento Manual de Perdas -->
        <div id="manual-losses-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
            <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
                <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-gradient-to-br from-orange-100 to-orange-200 rounded-xl">
                            <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-600"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-800">Lançamento Manual de Perdas</h3>
                    </div>
                    <button id="manual-losses-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                    </button>
                </div>
                <!-- Contexto Máquina/Produto -->
                <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                    <div class="flex items-center justify-between gap-3">
                        <span>Máquina: <b class="context-machine">-</b></span>
                        <span>Produto: <b class="context-product">-</b></span>
                    </div>
                </div>
                <form id="manual-losses-form" class="space-y-4">
                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-xl p-3">
                        <p class="text-sm text-orange-800">
                            <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                            Informe pelo menos a quantidade de peças perdidas OU o peso em borras (kg). Não  necessário preencher ambos os campos.
                        </p>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Operador <span class="text-red-500">*</span></label>
                        <input type="number" id="manual-losses-user" name="user" min="0" max="999" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Digite seu código (ex: 42)" required inputmode="numeric">
                        <p class="text-xs text-gray-400 mt-1" id="manual-losses-user-name">Digite o código para ver o nome</p>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div>
                            <label for="manual-losses-date" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data da Perda</label>
                            <input type="date" id="manual-losses-date" name="date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                        </div>
                        <div>
                            <label for="manual-losses-hour" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Horário (opcional)</label>
                            <input type="time" id="manual-losses-hour" name="hour" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div>
                            <label for="manual-losses-shift" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                            <select id="manual-losses-shift" name="shift" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all">
                                <option value="1">1º Turno</option>
                                <option value="2">2º Turno</option>
                                <option value="3">3º Turno</option>
                            </select>
                        </div>
                        <div>
                            <label for="manual-losses-qty" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Qtd Perdida (peças)</label>
                            <input type="number" id="manual-losses-qty" name="quantity" min="0" step="1" inputmode="numeric" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Peças refugadas" onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                        </div>
                    </div>
                    <div>
                        <label for="manual-losses-weight" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Borras / Peso Perdido (g)</label>
                        <input type="number" step="1" id="manual-losses-weight" name="weight" min="0" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Peso em gramas (ex: 1500)">
                    </div>
                    <div>
                        <label for="manual-losses-reason" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Perda</label>
                        <select id="manual-losses-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                            <option value="">Selecione o motivo...</option>
                            <optgroup label="PROCESSO">
                                <option value="FALHA DE INJEÇÃO">FALHA DE INJEÇÃO</option>
                                <option value="CONTAMINAÇÃO">CONTAMINAÇÃO</option>
                                <option value="PONTO ALTO DE INJEÇÃO / FIAPO">PONTO ALTO DE INJEÇÃO / FIAPO</option>
                                <option value="REBARBA">REBARBA</option>
                                <option value="FORA DE COR">FORA DE COR</option>
                                <option value="FORA DE DIMENSIONAL">FORA DE DIMENSIONAL</option>
                                <option value="REINICIO/INICIO">REINICIO/INICIO</option>
                                <option value="CHUPAGEM">CHUPAGEM</option>
                                <option value="BOLHA">BOLHA</option>
                                <option value="QUEIMA">QUEIMA</option>
                                <option value="MANCHAS">MANCHAS</option>
                                <option value="JUNÇÃO">JUNÇÃO</option>
                                <option value="EMPENAMENTO">EMPENAMENTO</option>
                                <option value="PEÇAS SCRAP">PEÇAS SCRAP</option>
                                <option value="PEÇAS DEFORMADAS">PEÇAS DEFORMADAS</option>
                            </optgroup>
                            <optgroup label="FERRAMENTARIA">
                                <option value="GALHO PRESO">GALHO PRESO</option>
                                <option value="MARCA D'AGUA">MARCA D'AGUA</option>
                                <option value="MARCA DE EXTRATOR">MARCA DE EXTRATOR</option>
                                <option value="RISCO">RISCO</option>
                                <option value="SUJIDADE MOLDE">SUJIDADE MOLDE</option>
                                <option value="LAMINA QUEBRADA">LAMINA QUEBRADA</option>
                                <option value="TRY OUT">TRY OUT</option>
                                <option value="LIMPEZA DE TIPS">LIMPEZA DE TIPS</option>
                                <option value="ABERTURA DE CAVIDADES">ABERTURA DE CAVIDADES</option>
                            </optgroup>
                            <optgroup label="MAQUINA">
                                <option value="QUEDA DE ENERGIA">QUEDA DE ENERGIA</option>
                                <option value="PARADA EMERGENCIAL">PARADA EMERGENCIAL</option>
                                <option value="VAZAMENTO DE OLEO">VAZAMENTO DE OLEO</option>
                                <option value="AUSENCIA DE PERIFERICOS">AUSENCIA DE PERIFERICOS</option>
                                <option value="SUJIDADE (GRAXA, AGUA, ETC)">SUJIDADE (GRAXA, AGUA, ETC)</option>
                            </optgroup>
                            <optgroup label="MATERIA PRIMA">
                                <option value="MATERIAL NÃO CONFORME">MATERIAL NÃO CONFORME</option>
                            </optgroup>
                        </select>
                    </div>
                    <div>
                        <label for="manual-losses-obs" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                        <textarea id="manual-losses-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Detalhes adicionais (opcional)"></textarea>
                    </div>
                    <div>
                    <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                        <button type="button" id="manual-losses-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">Cancelar</button>
                        <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">Registrar Perda</button>
                    </div>
                </form>
            </div>
        </div>

    <!-- Modal de Lançamento de Borra -->
    <div id="manual-borra-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-yellow-100 to-amber-200 rounded-xl">
                        <i data-lucide="zap" class="w-5 h-5 text-yellow-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Registrar Borra de Produção</h3>
                </div>
                <button id="manual-borra-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="manual-borra-form" class="space-y-4">
                <div class="bg-gradient-to-br from-yellow-50 to-amber-50 border border-yellow-200 rounded-xl p-3">
                    <p class="text-sm text-yellow-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Registre a borra gerada durante o processo de Produção. Este material será contabilizado nas perdas.
                    </p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="manual-borra-date" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data da Geração</label>
                        <input type="date" id="manual-borra-date" name="date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" required>
                    </div>
                    <div>
                        <label for="manual-borra-hour" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Horário (opcional)</label>
                        <input type="time" id="manual-borra-hour" name="hour" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all">
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="manual-borra-shift" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                        <select id="manual-borra-shift" name="shift" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all">
                            <option value="1">1º Turno</option>
                            <option value="2">2º Turno</option>
                            <option value="3">3º Turno</option>
                        </select>
                    </div>
                    <div>
                        <label for="manual-borra-machine" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina</label>
                        <select id="manual-borra-machine" name="machine" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" required>
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label for="manual-borra-weight" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Peso da Borra (g) *</label>
                    <input type="number" step="1" id="manual-borra-weight" name="weight" min="1" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" placeholder="Peso em gramas (ex: 1500)" required>
                </div>
                <div>
                    <label for="manual-borra-mp-type" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Tipo de Matéria-Prima *</label>
                    <select id="manual-borra-mp-type" name="mp_type" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" required>
                        <option value="">Selecione o tipo de MP...</option>
                        <option value="PE-NATURAL">PE-NATURAL</option>
                        <option value="PE-PRETO">PE-PRETO</option>
                        <option value="PE-AZUL">PE-AZUL</option>
                        <option value="PE-VERMELHO">PE-VERMELHO</option>
                        <option value="PE-VERDE">PE-VERDE</option>
                        <option value="PE-AMARELO">PE-AMARELO</option>
                        <option value="PP-NATURAL">PP-NATURAL</option>
                        <option value="PP-PRETO">PP-PRETO</option>
                        <option value="PP-COLORIDO">PP-COLORIDO</option>
                        <option value="ABS-NATURAL">ABS-NATURAL</option>
                        <option value="ABS-PRETO">ABS-PRETO</option>
                        <option value="ABS-COLORIDO">ABS-COLORIDO</option>
                    </select>
                </div>
                <div>
                    <label for="manual-borra-reason" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Geração *</label>
                    <select id="manual-borra-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" required>
                        <option value="">Selecione o motivo...</option>
                    </select>
                </div>
                <div>
                    <label for="manual-borra-obs" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="manual-borra-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" placeholder="Detalhes adicionais sobre a geração da borra (opcional)"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="manual-borra-cancel" class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" id="manual-borra-save" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-yellow-500 to-amber-600 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Registrar Borra
                    </button>
                </div>
                <div id="manual-borra-status" class="text-sm font-semibold h-5 text-center mt-2"></div>
            </form>
        </div>
    </div>

    <!-- Modal de Lançamento de Sucata (PMP) -->
    <div id="manual-sucata-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-red-100 to-rose-200 rounded-xl">
                        <i data-lucide="trash-2" class="w-5 h-5 text-red-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Registrar Sucata de Produção</h3>
                </div>
                <button id="manual-sucata-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="manual-sucata-form" class="space-y-4">
                <div class="bg-gradient-to-br from-red-50 to-rose-50 border border-red-200 rounded-xl p-3">
                    <p class="text-sm text-red-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Registre a sucata gerada durante o processo de Produção. Material será contabilizado nas perdas.
                    </p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="manual-sucata-date" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data da Geração</label>
                        <input type="date" id="manual-sucata-date" name="date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" required>
                    </div>
                    <div>
                        <label for="manual-sucata-hour" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Horário (opcional)</label>
                        <input type="time" id="manual-sucata-hour" name="hour" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                    </div>
                </div>
                <div>
                    <label for="manual-sucata-shift" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno</label>
                    <select id="manual-sucata-shift" name="shift" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                        <option value="1">1º Turno</option>
                        <option value="2">2º Turno</option>
                        <option value="3">3º Turno</option>
                    </select>
                </div>
                <!-- Código do Operador -->
                <div>
                    <label for="manual-sucata-operador" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Operador <span class="text-red-500">*</span></label>
                    <input type="number" id="manual-sucata-operador" name="operador_cod" min="1" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" placeholder="Digite o código do operador" required>
                    <div id="manual-sucata-operador-info" class="mt-2 p-2 bg-gray-100 rounded-lg hidden">
                        <p class="text-xs text-gray-600"><span class="font-semibold">Operador:</span> <span id="manual-sucata-operador-name">-</span></p>
                    </div>
                    <p id="manual-sucata-operador-error" class="text-xs text-red-500 mt-1 hidden">Operador não encontrado no banco de dados</p>
                </div>
                <div>
                    <label for="manual-sucata-type" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Tipo de Sucata *</label>
                    <select id="manual-sucata-type" name="sucata_type" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" required>
                        <option value="">Selecione o tipo...</option>
                        <option value="galhos">Galhos</option>
                        <option value="pecas">Peças Defeituosas</option>
                        <option value="moido">Moído</option>
                    </select>
                </div>
                <div>
                    <label for="manual-sucata-weight" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Peso da Sucata (kg) *</label>
                    <input type="number" step="0.01" id="manual-sucata-weight" name="weight" min="0.01" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" placeholder="Peso em kg (ex: 1.5)" required>
                </div>

                <div>
                    <label for="manual-sucata-obs" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="manual-sucata-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" placeholder="Detalhes adicionais sobre a geração da sucata (opcional)"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="manual-sucata-cancel" class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" id="manual-sucata-save" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Registrar Sucata
                    </button>
                </div>
                <div id="manual-sucata-status" class="text-sm font-semibold h-5 text-center mt-2"></div>
            </form>
        </div>
    </div>

    <!-- Modal de Lançamento de Moído (PMP) -->
    <div id="moido-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-lg border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-teal-100 to-emerald-200 rounded-xl">
                        <i data-lucide="scissors" class="w-5 h-5 text-teal-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Lançamento de Moído</h3>
                </div>
                <button id="moido-modal-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            
            <form id="moido-form" class="space-y-4">
                <div class="bg-gradient-to-br from-teal-50 to-emerald-50 border border-teal-200 rounded-xl p-3">
                    <p class="text-sm text-teal-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Registre a quantidade de material moído derivado das perdas de produção.
                    </p>
                </div>

                <!-- Data e Hora -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="moido-date" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data <span class="text-red-500">*</span></label>
                        <input type="date" id="moido-date" name="date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all" required>
                    </div>
                    <div>
                        <label for="moido-hour" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Hora <span class="text-red-500">*</span></label>
                        <input type="time" id="moido-hour" name="hour" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all" required>
                    </div>
                </div>

                <!-- Código do Produto -->
                <div>
                    <label for="moido-product-code" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Produto <span class="text-red-500">*</span></label>
                    <input type="number" id="moido-product-code" name="product_code" min="1" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all" placeholder="Digite o código do produto" required>
                    <div id="moido-product-info" class="mt-2 p-2 bg-gray-100 rounded-lg hidden">
                        <p class="text-xs text-gray-600"><span class="font-semibold">Produto:</span> <span id="moido-product-name">-</span></p>
                        <p class="text-xs text-gray-600"><span class="font-semibold">Cliente:</span> <span id="moido-product-client">-</span></p>
                    </div>
                    <p id="moido-product-error" class="text-xs text-red-500 mt-1 hidden">Produto não encontrado no banco de dados</p>
                </div>

                <!-- Código da Matéria Prima -->
                <div>
                    <label for="moido-mp-code" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código da Matéria Prima <span class="text-red-500">*</span></label>
                    <input type="number" id="moido-mp-code" name="mp_code" min="1" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all" placeholder="Digite o código da matéria prima" required>
                    <div id="moido-mp-info" class="mt-2 p-2 bg-gray-100 rounded-lg hidden">
                        <p class="text-xs text-gray-600"><span class="font-semibold">Matéria Prima:</span> <span id="moido-mp-name">-</span></p>
                    </div>
                    <p id="moido-mp-error" class="text-xs text-red-500 mt-1 hidden">Matéria prima não encontrada no banco de dados</p>
                </div>

                <!-- Quantidade -->
                <div>
                    <label for="moido-quantity" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Quantidade (Kg) <span class="text-red-500">*</span></label>
                    <input type="number" step="0.001" id="moido-quantity" name="quantity" min="0.001" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all" placeholder="Ex: 5.500" required>
                </div>

                <!-- Observações -->
                <div>
                    <label for="moido-obs" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="moido-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all" placeholder="Observações adicionais (opcional)"></textarea>
                </div>

                <!-- Botões -->
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="moido-cancel" class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" id="moido-save" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-teal-500 to-emerald-600 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Registrar Moído
                    </button>
                </div>
                <div id="moido-status" class="text-sm font-semibold h-5 text-center mt-2"></div>
            </form>
        </div>
    </div>

    <!-- Modal de Lançamento de Borra (PMP) -->
    <div id="pmp-borra-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-lg border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-yellow-100 to-amber-200 rounded-xl">
                        <i data-lucide="droplet" class="w-5 h-5 text-amber-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Lançamento de Borra</h3>
                </div>
                <button id="pmp-borra-modal-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            
            <form id="pmp-borra-form" class="space-y-4">
                <div class="bg-gradient-to-br from-yellow-50 to-amber-50 border border-amber-200 rounded-xl p-3">
                    <p class="text-sm text-amber-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Registre as borras e perdas de material do processo produtivo.
                    </p>
                </div>

                <!-- Data e Hora -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label for="pmp-borra-date" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data <span class="text-red-500">*</span></label>
                        <input type="date" id="pmp-borra-date" name="date" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all" required>
                    </div>
                    <div>
                        <label for="pmp-borra-hour" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Hora <span class="text-red-500">*</span></label>
                        <input type="time" id="pmp-borra-hour" name="hour" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all" required>
                    </div>
                </div>

                <!-- Turno -->
                <div>
                    <label for="pmp-borra-shift" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno <span class="text-red-500">*</span></label>
                    <select id="pmp-borra-shift" name="shift" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all" required>
                        <option value="">Selecione um turno...</option>
                        <option value="1º Turno">1º Turno (Manhã)</option>
                        <option value="2º Turno">2º Turno (Tarde)</option>
                        <option value="3º Turno">3º Turno (Noite)</option>
                    </select>
                </div>

                <!-- Código do Operador -->
                <div>
                    <label for="pmp-borra-operador" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Operador <span class="text-red-500">*</span></label>
                    <input type="number" id="pmp-borra-operador" name="operador_cod" min="1" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all" placeholder="Digite o código do operador" required>
                    <div id="pmp-borra-operador-info" class="mt-2 p-2 bg-gray-100 rounded-lg hidden">
                        <p class="text-xs text-gray-600"><span class="font-semibold">Operador:</span> <span id="pmp-borra-operador-name">-</span></p>
                    </div>
                    <p id="pmp-borra-operador-error" class="text-xs text-red-500 mt-1 hidden">Operador não encontrado no banco de dados</p>
                </div>

                <!-- Máquina -->
                <div>
                    <label for="pmp-borra-machine" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina <span class="text-red-500">*</span></label>
                    <select id="pmp-borra-machine" name="machine" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all" required>
                        <option value="">Selecione uma máquina...</option>
                        <!-- Opções serão preenchidas via JavaScript -->
                    </select>
                </div>

                <!-- Quantidade em Kg -->
                <div>
                    <label for="pmp-borra-quantity" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Quantidade (Kg) <span class="text-red-500">*</span></label>
                    <input type="number" step="0.001" id="pmp-borra-quantity" name="quantity" min="0.001" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all" placeholder="Ex: 2.500" required>
                </div>

                <!-- Observações -->
                <div>
                    <label for="pmp-borra-obs" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="pmp-borra-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all" placeholder="Observações adicionais (opcional)"></textarea>
                </div>

                <!-- Botões -->
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="pmp-borra-cancel" class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" id="pmp-borra-save" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-yellow-500 to-amber-600 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Registrar Borra
                    </button>
                </div>
                <div id="pmp-borra-status" class="text-sm font-semibold h-5 text-center mt-2"></div>
            </form>
        </div>
    </div>

    <!-- Modal de Ajuste de Quantidade Executada (Planejamento) -->
    <div id="adjust-executed-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-emerald-100 to-green-200 rounded-xl">
                        <i data-lucide="edit-3" class="w-5 h-5 text-emerald-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Ajustar Quantidade Executada</h3>
                </div>
                <button id="adjust-executed-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <form id="adjust-executed-form" class="space-y-4">
                <div class="bg-gradient-to-br from-emerald-50 to-green-50 border border-emerald-200 rounded-xl p-3">
                    <p class="text-sm text-emerald-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Ajuste a quantidade executada para corrigir divergências com o físico. Esta alteração será registrada para auditoria.
                    </p>
                </div>
                
                <!-- Informações do Planejamento -->
                <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-3 space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Máquina:</span>
                        <span id="adjust-exec-machine" class="text-sm font-bold text-gray-800">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Produto:</span>
                        <span id="adjust-exec-product" class="text-sm text-gray-800 truncate max-w-[180px]">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Quantidade Planejada:</span>
                        <span id="adjust-exec-planned" class="text-sm font-bold text-blue-600">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Executado Atual:</span>
                        <span id="adjust-exec-current" class="text-sm font-bold text-emerald-600">-</span>
                    </div>
                </div>

                <!-- Nova Quantidade -->
                <div>
                    <label for="adjust-exec-new-qty" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                        Nova Quantidade Executada *
                    </label>
                    <input type="number" 
                           id="adjust-exec-new-qty" 
                           name="new_qty" 
                           min="0"
                           step="1"
                           class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all" 
                           placeholder="Digite a quantidade correta" 
                           required>
                    <div id="adjust-exec-diff" class="mt-1 text-xs text-gray-500"></div>
                </div>

                <!-- Motivo -->
                <div>
                    <label for="adjust-exec-reason" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                        Motivo do Ajuste *
                    </label>
                    <select id="adjust-exec-reason" 
                            name="reason" 
                            class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all" 
                            required>
                        <option value="">Selecione o motivo...</option>
                        <option value="DIVERGENCIA_CONTAGEM">Divergência na Contagem</option>
                        <option value="AJUSTE_INVENTARIO">Ajuste de Inventário</option>
                        <option value="ERRO_LANCAMENTO">Erro de Lançamento Anterior</option>
                        <option value="CORRECAO_SISTEMA">Correção do Sistema</option>
                        <option value="RECONTAGEM_FISICA">Recontagem Física</option>
                        <option value="TRANSFERENCIA_TURNO">Transferência de Turno</option>
                        <option value="PRODUCAO_ENCONTRADA">Produção Encontrada</option>
                        <option value="PRODUCAO_NAO_REGISTRADA">Produção Não Registrada</option>
                        <option value="OUTROS">Outros</option>
                    </select>
                </div>

                <!-- Observações -->
                <div>
                    <label for="adjust-exec-obs" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                        Observações
                    </label>
                    <textarea id="adjust-exec-obs" 
                              name="observations" 
                              rows="2" 
                              class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all" 
                              placeholder="Detalhes adicionais sobre o ajuste (opcional)"></textarea>
                </div>

                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="adjust-executed-cancel" class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" id="adjust-executed-save" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-emerald-500 to-green-600 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Aplicar Ajuste
                    </button>
                </div>
                <div id="adjust-executed-status" class="text-sm font-semibold h-5 text-center mt-2"></div>
            </form>
        </div>
    </div>

    <!-- Modal de Ajuste de Quantidade da OP -->
    <div id="adjust-quantity-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-yellow-100 to-amber-200 rounded-xl">
                        <i data-lucide="edit-3" class="w-5 h-5 text-yellow-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Ajustar Quantidade da OP</h3>
                </div>
                <button id="adjust-quantity-close" type="button" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <form id="adjust-quantity-form" class="space-y-4">
                <div class="bg-gradient-to-br from-yellow-50 to-amber-50 border border-yellow-200 rounded-xl p-3">
                    <p class="text-sm text-yellow-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Ajuste a quantidade da OP conforme necessário. Use valores positivos para aumentar ou negativos para reduzir. O ajuste será registrado para controle.
                    </p>
                </div>
                
                <!-- Informações da OP -->
                <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-3 space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Ordem de Produção:</span>
                        <span id="adjust-op-number" class="text-sm font-bold text-gray-800">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Produto:</span>
                        <span id="adjust-op-product" class="text-sm text-gray-800">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Quantidade Original:</span>
                        <span id="adjust-op-original-qty" class="text-sm font-bold text-blue-600">-</span>
                    </div>
                </div>

                <!-- Ajuste -->
                <div>
                    <label for="adjust-reduction-qty" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                        Valor do Ajuste *
                    </label>
                    <input type="number" 
                           id="adjust-reduction-qty" 
                           name="reduction_qty" 
                           step="1"
                           class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" 
                           placeholder="Ex: +100 ou -50" 
                           required>
                    <div class="mt-1 text-xs text-gray-500">
                        Valor positivo para aumentar, negativo para reduzir (ex: +100, -50)
                    </div>
                </div>

                <!-- Motivo -->
                <div>
                    <label for="adjust-reason" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                        Motivo do Ajuste *
                    </label>
                    <select id="adjust-reason" 
                            name="reason" 
                            class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" 
                            required>
                        <option value="">Selecione o motivo...</option>
                        <option value="AUMENTO_PEDIDO">Aumento de Pedido</option>
                        <option value="REDUCAO_PEDIDO">Redução de Pedido</option>
                        <option value="PERDA_QUALIDADE">Perda por Qualidade</option>
                        <option value="RETRABALHO">Retrabalho Identificado</option>
                        <option value="REFUGO_PROCESSO">Refugo no Processo</option>
                        <option value="AJUSTE_SETUP">Ajuste de Setup</option>
                        <option value="MATERIAL_DEFEITUOSO">Material Defeituoso</option>
                        <option value="ERRO_LANCAMENTO">Erro de Lançamento Anterior</option>
                        <option value="CORRECAO_QUANTIDADE">Correção de Quantidade</option>
                        <option value="OUTROS">Outros</option>
                    </select>
                </div>

                <!-- Observações -->
                <div>
                    <label for="adjust-observations" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">
                        Observações
                    </label>
                    <textarea id="adjust-observations" 
                              name="observations" 
                              rows="2" 
                              class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-all" 
                              placeholder="Detalhes adicionais sobre o ajuste (opcional)"></textarea>
                </div>

                <!-- Visualização do Ajuste -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-medium text-blue-700">Nova Quantidade:</span>
                        <span id="adjust-final-qty" class="text-lg font-bold text-blue-800">-</span>
                    </div>
                    <div class="mt-1 text-xs text-blue-600">
                        Quantidade após aplicar o ajuste
                    </div>
                </div>

                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="adjust-quantity-cancel" class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" id="adjust-quantity-save" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-yellow-500 to-amber-600 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Aplicar Ajuste
                    </button>
                </div>
                <div id="adjust-quantity-status" class="text-sm font-semibold h-5 text-center mt-2"></div>
            </form>
        </div>
    </div>

    <!-- Modal de Lançamento Manual de Parada Passada -->
    <div id="manual-downtime-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-orange-100 to-orange-200 rounded-xl">
                        <i data-lucide="clock" class="w-5 h-5 text-orange-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Lançamento Manual de Parada</h3>
                </div>
                <button id="manual-downtime-close" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="manual-downtime-form" class="space-y-4">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-3 mb-4">
                    <p class="text-sm text-blue-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Use este formulário para registrar Paradas que não foram apontadas no momento.
                    </p>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Operador <span class="text-red-500">*</span></label>
                    <input type="number" id="manual-downtime-user" name="user" min="0" max="999" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Digite seu código (ex: 42)" required inputmode="numeric">
                    <p class="text-xs text-gray-400 mt-1" id="manual-downtime-user-name">Digite o código para ver o nome</p>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data de Início</label>
                        <input type="date" id="manual-downtime-date-start" name="dateStart" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data de Fim</label>
                        <input type="date" id="manual-downtime-date-end" name="dateEnd" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Horário de Início</label>
                        <input type="time" id="manual-downtime-start" name="startTime" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Horário de Fim</label>
                        <input type="time" id="manual-downtime-end" name="endTime" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Parada</label>
                    <select id="manual-downtime-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" required>
                        <option value="">Selecione o motivo...</option>
                        <optgroup label="FERRAMENTARIA">
                            <option value="CORRETIVA DE MOLDE">CORRETIVA DE MOLDE</option>
                            <option value="PREVENTIVA DE MOLDE">PREVENTIVA DE MOLDE</option>
                            <option value="TROCA DE VERSÇO">TROCA DE VERSÇO</option>
                        </optgroup>
                        <optgroup label="PROCESSO">
                            <option value="ABERTURA DE CAVIDADE">ABERTURA DE CAVIDADE</option>
                            <option value="AJUSTE DE PROCESSO">AJUSTE DE PROCESSO</option>
                            <option value="TRY OUT">TRY OUT</option>
                        </optgroup>
                        <optgroup label="COMPRAS">
                            <option value="FALTA DE INSUMO PLANEJADA">FALTA DE INSUMO PLANEJADA</option>
                            <option value="FALTA DE INSUMO NÇO PLANEJADA">FALTA DE INSUMO NÇO PLANEJADA</option>
                        </optgroup>
                        <optgroup label="PREPARA¡ÇO">
                            <option value="AGUARDANDO PREPARA¡ÇO DE MATERIAL">AGUARDANDO PREPARA¡ÇO DE MATERIAL</option>
                        </optgroup>
                        <optgroup label="QUALIDADE">
                            <option value="AGUARDANDO CLIENTE/FORNECEDOR">AGUARDANDO CLIENTE/FORNECEDOR</option>
                            <option value="LIBERA¡ÇO">LIBERA¡ÇO</option>
                        </optgroup>
                        <optgroup label="MANUTEN¡ÇO">
                            <option value="MANUTEN¡ÇO CORRETIVA">MANUTEN¡ÇO CORRETIVA</option>
                            <option value="MANUTEN¡ÇO PREVENTIVA">MANUTEN¡ÇO PREVENTIVA</option>
                        </optgroup>
                        <optgroup label="PRODU¡ÇO">
                            <option value="FALTA DE OPERADOR">FALTA DE OPERADOR</option>
                            <option value="TROCA DE COR">TROCA DE COR</option>
                        </optgroup>
                        <optgroup label="SETUP">
                            <option value="INSTALA¡ÇO DE MOLDE">INSTALA¡ÇO DE MOLDE</option>
                            <option value="RETIRADA DE MOLDE">RETIRADA DE MOLDE</option>
                        </optgroup>
                        <optgroup label="ADMINISTRATIVO">
                            <option value="FALTA DE ENERGIA">FALTA DE ENERGIA</option>
                        </optgroup>
                        <optgroup label="PCP">
                            <option value="SEM PROGRAMA¡ÇO">SEM PROGRAMA¡ÇO</option>
                        </optgroup>
                        <optgroup label="COMERCIAL">
                            <option value="SEM PEDIDO">SEM PEDIDO</option>
                        </optgroup>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="manual-downtime-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Observações sobre a parada"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="manual-downtime-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Registrar Parada
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Parada Avulsa (Sem OP) - Grid Start/Stop -->
    <div id="standalone-downtime-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl border border-gray-100 max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Header -->
            <div class="flex justify-between items-center border-b border-gray-100 px-6 py-4 shrink-0">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-orange-100 to-orange-200 rounded-xl">
                        <i data-lucide="alert-circle" class="w-5 h-5 text-orange-600"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Parada de Máquinas (Sem OP)</h3>
                        <p class="text-xs text-gray-500">Clique na máquina para iniciar ou finalizar uma parada</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="openBatchDowntimeModal()" class="flex items-center gap-1.5 px-3 py-1.5 bg-gradient-to-r from-amber-500 to-orange-500 text-white text-xs font-semibold rounded-lg shadow-sm hover:shadow-md transition-all" title="Parada em Lote (ex: Queda de Energia)">
                        <i data-lucide="zap" class="w-4 h-4"></i> Parada em Lote
                    </button>
                    <button onclick="closeStandaloneModal()" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                    </button>
                </div>
            </div>
            <!-- Legenda -->
            <div class="px-6 py-2 bg-gray-50 border-b border-gray-100 flex items-center gap-4 text-xs shrink-0">
                <span class="flex items-center gap-1.5"><span class="w-3 h-3 bg-slate-200 rounded-sm border border-slate-300"></span> Disponível</span>
                <span class="flex items-center gap-1.5"><span class="w-3 h-3 bg-red-500 rounded-sm"></span> Parada Ativa</span>
                <span class="flex items-center gap-1.5"><span class="w-3 h-3 bg-emerald-500 rounded-sm"></span> Com OP (bloqueado)</span>
            </div>
            <!-- Grid de Máquinas -->
            <div class="p-6 overflow-y-auto flex-1">
                <div id="standalone-machine-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2">
                    <!-- Populado via JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Sub-Modal: Motivo da Parada (Sem OP) -->
    <div id="standalone-reason-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-[60] flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-4">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-red-100 to-red-200 rounded-xl">
                        <i data-lucide="pause-circle" class="w-5 h-5 text-red-600"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Iniciar Parada</h3>
                        <p class="text-sm text-gray-500" id="standalone-reason-machine-label">Máquina: -</p>
                    </div>
                </div>
                <button onclick="closeModal('standalone-reason-modal')" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <form id="standalone-reason-form" class="space-y-4">
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Operador <span class="text-red-500">*</span></label>
                    <input type="number" id="standalone-downtime-user" name="user" min="0" max="999" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" placeholder="Digite seu código (ex: 42)" required inputmode="numeric">
                    <p class="text-xs text-gray-400 mt-1" id="standalone-downtime-user-name">Digite o código para ver o nome</p>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Parada <span class="text-red-500">*</span></label>
                    <select id="standalone-downtime-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" required>
                        <option value="">Selecione o motivo...</option>
                        <!-- Populado dinamicamente via groupedDowntimeReasons -->
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="standalone-downtime-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" placeholder="Detalhes sobre a parada"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" onclick="closeModal('standalone-reason-modal')" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        <i data-lucide="pause-circle" class="w-4 h-4 inline mr-1"></i> Iniciar Parada
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Finalização de Parada (Clique no Card) -->
    <div id="card-finish-downtime-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md border border-gray-100 overflow-hidden animate-fade-in">
            <!-- Header -->
            <div class="flex justify-between items-center border-b border-gray-100 px-6 py-4 bg-gradient-to-r from-red-50 to-orange-50">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-red-400 to-red-600 rounded-xl shadow-md">
                        <i data-lucide="octagon" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-800">Finalizar Parada</h3>
                        <p id="card-finish-downtime-machine" class="text-sm text-red-600 font-medium">H00</p>
                    </div>
                </div>
                <button type="button" onclick="closeCardFinishDowntimeModal()" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <!-- Body -->
            <div class="p-6">
                <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-4">
                    <div class="flex items-center gap-3 mb-2">
                        <i data-lucide="alert-circle" class="w-5 h-5 text-red-600 animate-pulse"></i>
                        <span class="text-sm font-bold text-red-700">PARADA ATIVA</span>
                    </div>
                    <div class="pl-8 space-y-1">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Motivo:</span>
                            <span id="card-finish-downtime-reason" class="font-semibold text-red-700">-</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Início:</span>
                            <span id="card-finish-downtime-start" class="font-medium text-gray-800">-</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Duração:</span>
                            <span id="card-finish-downtime-duration" class="font-bold text-red-600">-</span>
                        </div>
                    </div>
                </div>
                <p class="text-sm text-gray-600 text-center mb-4">
                    Deseja finalizar esta parada agora?
                </p>
            </div>
            <!-- Footer -->
            <div class="flex gap-3 px-6 pb-6">
                <button type="button" onclick="closeCardFinishDowntimeModal()" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-semibold text-sm hover:bg-gray-200 transition-colors">
                    Cancelar
                </button>
                <button type="button" id="card-finish-downtime-confirm-btn" onclick="confirmCardFinishDowntime()" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-emerald-500 to-green-600 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                    <i data-lucide="check-circle" class="w-4 h-4 inline mr-1"></i>
                    Finalizar Parada
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Parada em Lote (Todas as Máquinas) -->
    <div id="batch-downtime-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-[60] flex justify-center items-center p-2 sm:p-4">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-4xl border border-gray-100 max-h-[95vh] sm:max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Header -->
            <div class="flex justify-between items-center border-b border-gray-100 px-4 sm:px-6 py-3 sm:py-4 shrink-0 bg-gradient-to-r from-amber-50 to-orange-50">
                <div class="flex items-center gap-2 sm:gap-3">
                    <div class="p-1.5 sm:p-2 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl">
                        <i data-lucide="zap" class="w-4 h-4 sm:w-5 sm:h-5 text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-base sm:text-lg font-semibold text-gray-800">Parada em Lote</h3>
                        <p class="text-[10px] sm:text-xs text-gray-500 hidden sm:block">Registrar parada em múltiplas máquinas simultaneamente</p>
                    </div>
                </div>
                <button onclick="closeBatchDowntimeModal()" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Form -->
            <form id="batch-downtime-form" class="flex flex-col flex-1 overflow-hidden">
                <!-- Campos fixos -->
                <div class="p-3 sm:p-4 space-y-3 sm:space-y-4 border-b border-gray-100 shrink-0">
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Operador <span class="text-red-500">*</span></label>
                            <input type="number" id="batch-downtime-user" name="user" min="0" max="999" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2 sm:py-2.5 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all" placeholder="Digite seu código (ex: 42)" required inputmode="numeric">
                            <p class="text-xs text-gray-400 mt-1" id="batch-downtime-user-name">Digite o código para ver o nome</p>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo da Parada <span class="text-red-500">*</span></label>
                            <select id="batch-downtime-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2 sm:py-2.5 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all" required>
                                <option value="">Selecione o motivo...</option>
                                <!-- Populado dinamicamente -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                            <input type="text" id="batch-downtime-obs" name="observations" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2 sm:py-2.5 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all" placeholder="Ex: Queda de energia">
                        </div>
                    </div>
                </div>
                <!-- Seleção de Máquinas -->
                <div class="px-3 sm:px-4 py-2 sm:py-3 bg-gray-50 border-b border-gray-100 shrink-0 flex flex-col gap-1.5 sm:gap-2">
                    <div class="flex flex-wrap items-center justify-between gap-2">
                        <span class="text-xs sm:text-sm font-semibold text-gray-700">Selecionar Máquinas:</span>
                        <div class="flex items-center gap-2 sm:gap-3">
                            <span class="text-[10px] sm:text-xs text-gray-500"><span id="batch-selected-count">0</span> selecionadas</span>
                            <button type="button" onclick="batchSelectAllMachines()" class="text-[10px] sm:text-xs text-amber-600 hover:text-amber-700 font-semibold">Selecionar Todas</button>
                            <button type="button" onclick="batchDeselectAllMachines()" class="text-[10px] sm:text-xs text-gray-500 hover:text-gray-700">Limpar</button>
                        </div>
                    </div>
                    <div class="flex flex-wrap items-center gap-2 sm:gap-4 text-[9px] sm:text-[10px] text-gray-500">
                        <span class="flex items-center gap-1"><span class="w-2 h-2 sm:w-2.5 sm:h-2.5 bg-emerald-400 rounded-sm"></span> Com OP</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 sm:w-2.5 sm:h-2.5 bg-gray-300 rounded-sm"></span> Sem OP</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 sm:w-2.5 sm:h-2.5 bg-amber-400 rounded-sm"></span> Selecionada</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 sm:w-2.5 sm:h-2.5 bg-red-400 rounded-sm"></span> Parada Ativa</span>
                    </div>
                </div>
                <!-- Grid de Máquinas com Checkbox -->
                <div class="p-2 sm:p-4 overflow-y-auto flex-1 min-h-[200px]">
                    <div id="batch-machine-grid" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-1.5 sm:gap-2">
                        <!-- Populado via JS -->
                    </div>
                </div>
                <!-- Footer/Botões -->
                <div class="flex gap-2 sm:gap-3 p-3 sm:p-4 border-t border-gray-100 bg-gray-50 shrink-0">
                    <button type="button" onclick="closeBatchDowntimeModal()" class="flex-1 py-2 sm:py-2.5 px-3 sm:px-4 bg-gray-200 text-gray-700 rounded-xl font-medium text-xs sm:text-sm hover:bg-gray-300 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" id="batch-downtime-submit-btn" class="flex-1 py-2 sm:py-2.5 px-3 sm:px-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-semibold text-xs sm:text-sm shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i data-lucide="zap" class="w-3 h-3 sm:w-4 sm:h-4 inline mr-1"></i> Iniciar Paradas
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
         <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-sm m-4 text-center border border-gray-100">
             <div class="flex justify-center mb-4">
                 <div class="p-3 bg-gradient-to-br from-red-100 to-red-200 rounded-2xl">
                     <i data-lucide="alert-triangle" class="w-8 h-8 text-red-600"></i>
                 </div>
             </div>
             <h3 class="text-lg font-semibold text-gray-800">Confirmar Exclusão</h3>
             <p id="confirm-modal-text" class="text-sm text-gray-500 my-3">Tem a certeza de que deseja excluir este item? Esta ação não pode ser desfeita.</p>
             <div class="mt-6 flex justify-center gap-3">
                 <button id="confirm-modal-cancel-btn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2.5 px-4 rounded-xl text-sm transition-colors">Cancelar</button>
                 <button id="confirm-modal-ok-btn" class="bg-gradient-to-r from-red-600 to-red-700 hover:shadow-lg text-white font-semibold py-2.5 px-4 rounded-xl text-sm shadow-md transition-all">Excluir</button>
             </div>
         </div>
    </div>

    <!-- Modal de Retrabalho -->
    <div id="quick-rework-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md border border-gray-100">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl">
                        <i data-lucide="wrench" class="w-5 h-5 text-purple-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">Registrar Retrabalho</h3>
                </div>
                <button id="quick-rework-close" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <!-- Contexto Máquina/Produto -->
            <div class="modal-context bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-3 mb-4 text-xs text-gray-700">
                <div class="flex items-center justify-between gap-3">
                    <span>Máquina: <b class="context-machine">-</b></span>
                    <span>Produto: <b class="context-product">-</b></span>
                </div>
            </div>
            <form id="quick-rework-form" class="space-y-4">
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-xl p-3 mb-4">
                    <p class="text-sm text-purple-800">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Registre peças que necessitaram de retrabalho/reprocessamento.
                    </p>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Quantidade de Peças para Retrabalho</label>
                    <input type="number" id="quick-rework-qty" name="quantity" min="1" step="1" inputmode="numeric" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" placeholder="Número de peças" required onkeypress="return /[0-9]/.test(String.fromCharCode(event.which))">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Peso (kg, opcional)</label>
                    <input type="number" step="0.01" id="quick-rework-weight" name="weight" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" placeholder="Peso em kg">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Motivo do Retrabalho</label>
                    <select id="quick-rework-reason" name="reason" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" required>
                        <option value="">Selecione o motivo...</option>
                        <optgroup label="PROCESSO">
                            <option value="FALHA DE INJEÇÃO">FALHA DE INJEÇÃO</option>
                            <option value="CONTAMINAÇÃO">CONTAMINAÇÃO</option>
                            <option value="PONTO ALTO DE INJEÇÃO / FIAPO">PONTO ALTO DE INJEÇÃO / FIAPO</option>
                            <option value="REBARBA">REBARBA</option>
                            <option value="FORA DE COR">FORA DE COR</option>
                            <option value="FORA DE DIMENSIONAL">FORA DE DIMENSIONAL</option>
                            <option value="REINICIO/INICIO">REINICIO/INICIO</option>
                            <option value="CHUPAGEM">CHUPAGEM</option>
                            <option value="BOLHA">BOLHA</option>
                            <option value="QUEIMA">QUEIMA</option>
                            <option value="MANCHAS">MANCHAS</option>
                            <option value="JUNÇÃO">JUNÇÃO</option>
                            <option value="EMPENAMENTO">EMPENAMENTO</option>
                            <option value="PEÇAS SCRAP">PEÇAS SCRAP</option>
                            <option value="PEÇAS DEFORMADAS">PEÇAS DEFORMADAS</option>
                        </optgroup>
                        <optgroup label="FERRAMENTARIA">
                            <option value="GALHO PRESO">GALHO PRESO</option>
                            <option value="MARCA D'AGUA">MARCA D'AGUA</option>
                            <option value="MARCA DE EXTRATOR">MARCA DE EXTRATOR</option>
                            <option value="RISCO">RISCO</option>
                            <option value="SUJIDADE MOLDE">SUJIDADE MOLDE</option>
                            <option value="LAMINA QUEBRADA">LAMINA QUEBRADA</option>
                            <option value="TRY OUT">TRY OUT</option>
                            <option value="LIMPEZA DE TIPS">LIMPEZA DE TIPS</option>
                            <option value="ABERTURA DE CAVIDADES">ABERTURA DE CAVIDADES</option>
                        </optgroup>
                        <optgroup label="MAQUINA">
                            <option value="QUEDA DE ENERGIA">QUEDA DE ENERGIA</option>
                            <option value="PARADA EMERGENCIAL">PARADA EMERGENCIAL</option>
                            <option value="VAZAMENTO DE OLEO">VAZAMENTO DE OLEO</option>
                            <option value="AUSENCIA DE PERIFERICOS">AUSENCIA DE PERIFERICOS</option>
                            <option value="SUJIDADE (GRAXA, AGUA, ETC)">SUJIDADE (GRAXA, AGUA, ETC)</option>
                        </optgroup>
                        <optgroup label="MATERIA PRIMA">
                            <option value="MATERIAL NÃO CONFORME">MATERIAL NÃO CONFORME</option>
                        </optgroup>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                    <textarea id="quick-rework-obs" name="observations" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" placeholder="Detalhes do retrabalho (opcional)"></textarea>
                </div>
                <div class="flex gap-3 pt-4 border-t border-gray-100 mt-4">
                    <button type="button" id="quick-rework-cancel" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-200 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                        Registrar Retrabalho
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Nova Escala de Operador -->
    <div id="nova-escala-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-violet-600 to-purple-700 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white/20 rounded-lg">
                            <i data-lucide="user-plus" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Nova Escala de Operador</h3>
                            <p class="text-purple-200 text-sm">Atribua máquinas aos operadores</p>
                        </div>
                    </div>
                    <button id="nova-escala-close" class="p-2 hover:bg-white/20 rounded-lg transition">
                        <i data-lucide="x" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                <form id="nova-escala-form" class="space-y-4">
                    <!-- Seção 1: Data e Turno -->
                    <div class="border border-violet-200 rounded-lg overflow-hidden">
                        <div class="bg-violet-50 px-3 py-2 border-b border-violet-200">
                            <h4 class="text-sm font-semibold text-violet-800 flex items-center gap-2">
                                <i data-lucide="calendar" class="w-4 h-4"></i>
                                Data e Turno
                            </h4>
                        </div>
                        <div class="p-3 bg-white grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data *</label>
                                <input type="date" id="nova-escala-data" required class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-violet-500 focus:border-violet-500 transition-all">
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Turno *</label>
                                <select id="nova-escala-turno" required class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-violet-500 focus:border-violet-500 transition-all">
                                    <option value="">Selecione o turno</option>
                                    <option value="1">1º Turno</option>
                                    <option value="2">2º Turno</option>
                                    <option value="3">3º Turno</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Seção 2: Operador -->
                    <div class="border border-blue-200 rounded-lg overflow-hidden">
                        <div class="bg-blue-50 px-3 py-2 border-b border-blue-200">
                            <h4 class="text-sm font-semibold text-blue-800 flex items-center gap-2">
                                <i data-lucide="user" class="w-4 h-4"></i>
                                Operador
                            </h4>
                        </div>
                        <div class="p-3 bg-white">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Código do Operador *</label>
                                    <input type="number" id="nova-escala-cod-operador" required min="0" placeholder="Digite o código" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Nome do Operador</label>
                                    <input type="text" id="nova-escala-nome-operador" readonly class="w-full bg-gray-100 border border-gray-200 rounded-lg py-2.5 px-3 text-sm text-gray-600" placeholder="Será preenchido automaticamente">
                                </div>
                            </div>
                            <div id="nova-escala-operador-info" class="mt-2 text-xs hidden">
                                <span class="text-green-600 font-semibold">✓ Operador encontrado</span>
                            </div>
                            <div id="nova-escala-operador-erro" class="mt-2 text-xs text-red-600 hidden">
                                <span>✗ Operador não encontrado no sistema</span>
                            </div>
                        </div>
                    </div>

                    <!-- Seção 3: Máquinas -->
                    <div class="border border-green-200 rounded-lg overflow-hidden">
                        <div class="bg-green-50 px-3 py-2 border-b border-green-200">
                            <h4 class="text-sm font-semibold text-green-800 flex items-center gap-2">
                                <i data-lucide="cpu" class="w-4 h-4"></i>
                                Máquinas Atribuídas
                            </h4>
                        </div>
                        <div class="p-3 bg-white">
                            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Selecione as máquinas *</label>
                            <div id="nova-escala-maquinas-grid" class="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2 max-h-48 overflow-y-auto p-2 bg-gray-50 rounded-lg border border-gray-200">
                                <!-- Checkboxes de máquinas serão gerados aqui -->
                            </div>
                            <div class="mt-3 flex items-center gap-4">
                                <button type="button" id="nova-escala-select-all" class="text-xs text-blue-600 hover:text-blue-800 font-medium">Selecionar todas</button>
                                <button type="button" id="nova-escala-clear-all" class="text-xs text-gray-600 hover:text-gray-800 font-medium">Limpar seleção</button>
                                <span id="nova-escala-count" class="text-xs text-gray-500 ml-auto">0 máquinas selecionadas</span>
                            </div>
                        </div>
                    </div>

                    <!-- Seção 4: Observações -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-gray-50 px-3 py-2 border-b border-gray-200">
                            <h4 class="text-sm font-semibold text-gray-700 flex items-center gap-2">
                                <i data-lucide="file-text" class="w-4 h-4"></i>
                                Observações
                            </h4>
                        </div>
                        <div class="p-3 bg-white">
                            <textarea id="nova-escala-obs" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-violet-500 focus:border-violet-500 transition-all" placeholder="Observações adicionais (opcional)"></textarea>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
                <!-- Contador de escalas adicionadas na sessão -->
                <div id="nova-escala-sessao-info" class="hidden mb-3 p-2 bg-green-50 border border-green-200 rounded-lg">
                    <div class="flex items-center gap-2 text-green-700 text-sm">
                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                        <span><strong id="nova-escala-contador">0</strong> escala(s) adicionada(s) nesta sessão</span>
                    </div>
                </div>
                <div class="flex justify-between items-center">
                    <button type="button" id="nova-escala-cancel" class="px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium text-sm transition-colors">
                        Fechar
                    </button>
                    <div class="flex gap-2">
                        <button type="button" id="nova-escala-save-continue" class="px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold text-sm shadow-md transition-all flex items-center gap-2">
                            <i data-lucide="plus-circle" class="w-4 h-4"></i>
                            Salvar e Adicionar Mais
                        </button>
                        <button type="button" id="nova-escala-save" class="px-4 py-2.5 bg-gradient-to-r from-violet-600 to-purple-700 hover:shadow-lg text-white rounded-lg font-semibold text-sm shadow-md transition-all flex items-center gap-2">
                            <i data-lucide="save" class="w-4 h-4"></i>
                            Salvar e Fechar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Novo Setup -->
    <div id="novo-setup-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-orange-600 to-amber-600 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white/20 rounded-lg">
                            <i data-lucide="wrench" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h3 id="setup-modal-titulo" class="text-xl font-bold text-white">Novo Registro de Setup</h3>
                            <p class="text-orange-100 text-sm">Registre as atividades de troca de molde</p>
                        </div>
                    </div>
                    <button id="novo-setup-close" class="p-2 hover:bg-white/20 rounded-lg transition">
                        <i data-lucide="x" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                <form id="novo-setup-form" class="space-y-4">
                    <!-- Seção 1: Data e Máquina -->
                    <div class="border border-orange-200 rounded-lg overflow-hidden">
                        <div class="bg-orange-50 px-3 py-2 border-b border-orange-200">
                            <h4 class="text-sm font-semibold text-orange-800 flex items-center gap-2">
                                <i data-lucide="calendar" class="w-4 h-4"></i>
                                Data e Máquina
                            </h4>
                        </div>
                        <div class="p-3 bg-white grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data *</label>
                                <input type="date" id="novo-setup-data" required class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all">
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Máquina *</label>
                                <select id="novo-setup-maquina" required class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all">
                                    <option value="">Selecione a máquina</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Seção 2: Molde e Tipo -->
                    <div class="border border-amber-200 rounded-lg overflow-hidden">
                        <div class="bg-amber-50 px-3 py-2 border-b border-amber-200">
                            <h4 class="text-sm font-semibold text-amber-800 flex items-center gap-2">
                                <i data-lucide="package" class="w-4 h-4"></i>
                                Molde e Classificação
                            </h4>
                        </div>
                        <div class="p-3 bg-white grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div class="md:col-span-2">
                                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Descrição do Molde *</label>
                                <input type="text" id="novo-setup-molde" required placeholder="Ex: Molde XYZ-123" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Tipo *</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="relative flex items-center justify-center p-3 bg-gray-50 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-300 transition-all setup-tipo-option">
                                        <input type="radio" name="setup-tipo" value="planejado" required class="sr-only peer">
                                        <div class="text-center peer-checked:[&_svg]:text-green-600 peer-checked:[&_span]:text-green-700">
                                            <i data-lucide="calendar-check" class="w-6 h-6 mx-auto mb-1 text-gray-400"></i>
                                            <span class="text-sm font-semibold text-gray-600">Planejado</span>
                                        </div>
                                        <div class="absolute inset-0 rounded-lg border-2 border-transparent peer-checked:border-green-500 peer-checked:bg-green-50 -z-10"></div>
                                    </label>
                                    <label class="relative flex items-center justify-center p-3 bg-gray-50 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-red-300 transition-all setup-tipo-option">
                                        <input type="radio" name="setup-tipo" value="nao_planejado" required class="sr-only peer">
                                        <div class="text-center peer-checked:[&_svg]:text-red-600 peer-checked:[&_span]:text-red-700">
                                            <i data-lucide="alert-triangle" class="w-6 h-6 mx-auto mb-1 text-gray-400"></i>
                                            <span class="text-sm font-semibold text-gray-600">Não Planejado</span>
                                        </div>
                                        <div class="absolute inset-0 rounded-lg border-2 border-transparent peer-checked:border-red-500 peer-checked:bg-red-50 -z-10"></div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Seção 3: Horários -->
                    <div class="border border-blue-200 rounded-lg overflow-hidden">
                        <div class="bg-blue-50 px-3 py-2 border-b border-blue-200">
                            <h4 class="text-sm font-semibold text-blue-800 flex items-center gap-2">
                                <i data-lucide="clock" class="w-4 h-4"></i>
                                Horários
                            </h4>
                        </div>
                        <div class="p-3 bg-white grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Hora Início *</label>
                                <input type="time" id="novo-setup-hora-inicio" required class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Hora Fim *</label>
                                <input type="time" id="novo-setup-hora-fim" required class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                            <div class="col-span-2 text-center">
                                <span id="novo-setup-duracao" class="text-sm font-semibold text-blue-600"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Seção 4: Observações -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-gray-50 px-3 py-2 border-b border-gray-200">
                            <h4 class="text-sm font-semibold text-gray-700 flex items-center gap-2">
                                <i data-lucide="file-text" class="w-4 h-4"></i>
                                Observações
                            </h4>
                        </div>
                        <div class="p-3 bg-white">
                            <textarea id="novo-setup-obs" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" placeholder="Observações adicionais (opcional)"></textarea>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="bg-gray-50 px-6 py-4 border-t border-gray-200 flex justify-end gap-3">
                <button type="button" id="novo-setup-cancel" class="px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium text-sm transition-colors">
                    Cancelar
                </button>
                <button type="button" id="novo-setup-save" class="px-4 py-2.5 bg-gradient-to-r from-orange-600 to-amber-600 hover:shadow-lg text-white rounded-lg font-semibold text-sm shadow-md transition-all flex items-center gap-2">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    Salvar Setup
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Registrar Manutenção de Molde -->
    <div id="manutencao-molde-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-green-600 to-emerald-600 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white/20 rounded-lg">
                            <i data-lucide="check-circle" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Registrar Manutenção</h3>
                            <p class="text-green-100 text-sm">Zerar contador de batidas do molde</p>
                        </div>
                    </div>
                    <button id="manutencao-molde-close" class="p-2 hover:bg-white/20 rounded-lg transition">
                        <i data-lucide="x" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                <form id="manutencao-molde-form" class="space-y-4">
                    <input type="hidden" id="manutencao-molde-id">
                    
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Molde *</label>
                        <select id="manutencao-molde-select" required class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                            <option value="">Selecione o molde</option>
                        </select>
                    </div>

                    <div id="manutencao-info-molde" class="hidden bg-slate-50 rounded-lg p-4 border border-slate-200">
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div>
                                <span class="text-gray-500">Cliente:</span>
                                <span id="manutencao-info-cliente" class="font-semibold text-gray-800 ml-1">-</span>
                            </div>
                            <div>
                                <span class="text-gray-500">Batidas Atuais:</span>
                                <span id="manutencao-info-batidas" class="font-semibold text-gray-800 ml-1">-</span>
                            </div>
                            <div>
                                <span class="text-gray-500">Limite Preventiva:</span>
                                <span id="manutencao-info-limite" class="font-semibold text-gray-800 ml-1">-</span>
                            </div>
                            <div>
                                <span class="text-gray-500">Progresso:</span>
                                <span id="manutencao-info-progresso" class="font-semibold ml-1">-</span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Data da Manutenção *</label>
                        <input type="date" id="manutencao-data" required class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                    </div>

                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Tipo de Manutenção *</label>
                        <select id="manutencao-tipo" required class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                            <option value="preventiva">Preventiva</option>
                            <option value="corretiva">Corretiva</option>
                            <option value="reforma">Reforma</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Responsável *</label>
                        <input type="text" id="manutencao-responsavel" required placeholder="Nome do responsável pela manutenção" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                    </div>

                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Observações</label>
                        <textarea id="manutencao-obs" rows="2" placeholder="Serviços realizados, peças trocadas, etc." class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all"></textarea>
                    </div>

                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                        <div class="flex items-start gap-2">
                            <i data-lucide="alert-circle" class="w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"></i>
                            <p class="text-sm text-yellow-800">
                                <strong>Atenção:</strong> Ao registrar esta manutenção, o contador de batidas do molde será zerado.
                            </p>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="bg-gray-50 px-6 py-4 border-t border-gray-200 flex justify-end gap-3">
                <button type="button" id="manutencao-molde-cancel" class="px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium text-sm transition-colors">
                    Cancelar
                </button>
                <button type="button" id="manutencao-molde-save" class="px-4 py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 hover:shadow-lg text-white rounded-lg font-semibold text-sm shadow-md transition-all flex items-center gap-2">
                    <i data-lucide="check" class="w-4 h-4"></i>
                    Confirmar Manutenção
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Novo Molde -->
    <div id="novo-molde-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-slate-700 to-zinc-800 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white/20 rounded-lg">
                            <i data-lucide="plus-circle" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h3 id="novo-molde-titulo" class="text-xl font-bold text-white">Cadastrar Novo Molde</h3>
                            <p class="text-slate-300 text-sm">Adicione um molde ao controle de ferramentaria</p>
                        </div>
                    </div>
                    <button id="novo-molde-close" class="p-2 hover:bg-white/20 rounded-lg transition">
                        <i data-lucide="x" class="w-5 h-5 text-white"></i>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                <form id="novo-molde-form" class="space-y-4">
                    <input type="hidden" id="edit-molde-id">
                    
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Cliente *</label>
                        <input type="text" id="novo-molde-cliente" required placeholder="Nome do cliente" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-all">
                    </div>

                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Nome do Molde *</label>
                        <input type="text" id="novo-molde-nome" required placeholder="Ex: Tampa MKIV MD STD" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-all">
                    </div>

                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Limite de Batidas para Preventiva *</label>
                        <input type="number" id="novo-molde-batidas-limite" required min="1000" step="1000" placeholder="Ex: 100000" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-all">
                        <p class="text-xs text-gray-400 mt-1">Quantidade de batidas até a próxima manutenção preventiva</p>
                    </div>

                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">Batidas Atuais</label>
                        <input type="number" id="novo-molde-batidas-atuais" min="0" value="0" class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2.5 px-3 text-sm focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-all">
                        <p class="text-xs text-gray-400 mt-1">Deixe 0 para moldes novos ou recém-reformados</p>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="bg-gray-50 px-6 py-4 border-t border-gray-200 flex justify-end gap-3">
                <button type="button" id="novo-molde-cancel" class="px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium text-sm transition-colors">
                    Cancelar
                </button>
                <button type="button" id="novo-molde-save" class="px-4 py-2.5 bg-gradient-to-r from-slate-700 to-zinc-800 hover:shadow-lg text-white rounded-lg font-semibold text-sm shadow-md transition-all flex items-center gap-2">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    Salvar Molde
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Seleção de OP para Finalização (Multi-Produto) -->
    <div id="finalize-order-selector-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-lg border border-gray-100 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-emerald-100 to-green-200 rounded-xl">
                        <i data-lucide="check-circle" class="w-5 h-5 text-emerald-600"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Finalizar Ordem de Produção</h3>
                        <p class="text-xs text-gray-500">Selecione qual OP deseja finalizar nesta máquina</p>
                    </div>
                </div>
                <button type="button" id="finalize-order-selector-close" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            
            <!-- Info box -->
            <div class="bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-xl p-3 mb-4">
                <p class="text-sm text-purple-800">
                    <i data-lucide="layers" class="w-4 h-4 inline mr-1"></i>
                    <strong>Molde Multi-Produto:</strong> Esta máquina possui múltiplas OPs ativas. Selecione abaixo qual ordem você deseja finalizar.
                </p>
            </div>

            <!-- Lista de OPs para seleção -->
            <div id="finalize-order-list" class="space-y-3 mb-6">
                <!-- Populado dinamicamente -->
            </div>

            <!-- Botões -->
            <div class="flex gap-3 pt-4 border-t border-gray-100">
                <button type="button" id="finalize-order-selector-cancel" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2.5 px-4 rounded-lg transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <script src="materia-prima-database.js"></script>
    <script src="database.js"></script>
    <script src="traceability-system.js"></script>
    <!-- MÓDULOS DESATIVADOS - Fase 2 Otimização Firebase (02/12/2025) -->
    <!-- Modal de Customização por Turno -->
    <div id="shift-customize-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-2xl border border-gray-100 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center border-b border-gray-100 pb-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-indigo-100 to-purple-200 rounded-xl">
                        <i data-lucide="sliders" class="w-5 h-5 text-indigo-600"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Customizar Distribuição por Turno</h3>
                        <p class="text-xs text-gray-500">Ajuste ciclo e cavidades individualmente por turno</p>
                    </div>
                </div>
                <button type="button" id="shift-customize-close" class="p-1.5 rounded-lg hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            
            <!-- Info box -->
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-3 mb-6">
                <p class="text-sm text-blue-800">
                    <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                    Personalize o ciclo e cavidades para cada turno. Isso permite considerar diferentes condições de produção, como troca de moldes ou variações no processo.
                </p>
            </div>

            <!-- Grid de Turnos -->
            <div class="space-y-4">
                <!-- Turno 1 -->
                <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                            <h4 class="font-bold text-blue-800">1º TURNO</h4>
                        </div>
                        <span class="text-xs bg-blue-200 text-blue-700 px-2 py-1 rounded-full">06:30 - 15:00 (~8.5h)</span>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <div>
                            <label class="block text-[10px] font-semibold text-blue-600 uppercase mb-1">Ciclo (seg)</label>
                            <input type="number" step="0.1" id="custom-cycle-t1" class="w-full bg-white border border-blue-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-semibold text-blue-600 uppercase mb-1">Cavidades</label>
                            <input type="number" id="custom-cavities-t1" class="w-full bg-white border border-blue-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-semibold text-blue-600 uppercase mb-1">Quantidade</label>
                            <input type="number" id="custom-qty-t1" class="w-full bg-blue-200 border border-blue-300 rounded-lg py-2 px-3 text-sm font-bold text-blue-800" readonly>
                        </div>
                    </div>
                    <button type="button" onclick="recalculateShiftQty('t1')" class="mt-2 text-xs bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition-all flex items-center gap-1">
                        <i data-lucide="calculator" class="w-3 h-3"></i>
                        Recalcular T1
                    </button>
                </div>

                <!-- Turno 2 -->
                <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-xl p-4 border border-amber-200">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-amber-500"></div>
                            <h4 class="font-bold text-amber-800">2º TURNO</h4>
                        </div>
                        <span class="text-xs bg-amber-200 text-amber-700 px-2 py-1 rounded-full">15:00 - 23:20 (~8.3h)</span>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <div>
                            <label class="block text-[10px] font-semibold text-amber-600 uppercase mb-1">Ciclo (seg)</label>
                            <input type="number" step="0.1" id="custom-cycle-t2" class="w-full bg-white border border-amber-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-semibold text-amber-600 uppercase mb-1">Cavidades</label>
                            <input type="number" id="custom-cavities-t2" class="w-full bg-white border border-amber-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-semibold text-amber-600 uppercase mb-1">Quantidade</label>
                            <input type="number" id="custom-qty-t2" class="w-full bg-amber-200 border border-amber-300 rounded-lg py-2 px-3 text-sm font-bold text-amber-800" readonly>
                        </div>
                    </div>
                    <button type="button" onclick="recalculateShiftQty('t2')" class="mt-2 text-xs bg-amber-500 hover:bg-amber-600 text-white px-3 py-1.5 rounded-lg transition-all flex items-center gap-1">
                        <i data-lucide="calculator" class="w-3 h-3"></i>
                        Recalcular T2
                    </button>
                </div>

                <!-- Turno 3 -->
                <div class="bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-purple-500"></div>
                            <h4 class="font-bold text-purple-800">3º TURNO</h4>
                        </div>
                        <span class="text-xs bg-purple-200 text-purple-700 px-2 py-1 rounded-full">23:20 - 06:29 (~7.2h)</span>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <div>
                            <label class="block text-[10px] font-semibold text-purple-600 uppercase mb-1">Ciclo (seg)</label>
                            <input type="number" step="0.1" id="custom-cycle-t3" class="w-full bg-white border border-purple-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-semibold text-purple-600 uppercase mb-1">Cavidades</label>
                            <input type="number" id="custom-cavities-t3" class="w-full bg-white border border-purple-300 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-semibold text-purple-600 uppercase mb-1">Quantidade</label>
                            <input type="number" id="custom-qty-t3" class="w-full bg-purple-200 border border-purple-300 rounded-lg py-2 px-3 text-sm font-bold text-purple-800" readonly>
                        </div>
                    </div>
                    <button type="button" onclick="recalculateShiftQty('t3')" class="mt-2 text-xs bg-purple-500 hover:bg-purple-600 text-white px-3 py-1.5 rounded-lg transition-all flex items-center gap-1">
                        <i data-lucide="calculator" class="w-3 h-3"></i>
                        Recalcular T3
                    </button>
                </div>
            </div>

            <!-- Resumo -->
            <div class="bg-gray-100 rounded-xl p-4 mt-6 border border-gray-200">
                <div class="flex items-center justify-between">
                    <span class="font-semibold text-gray-700">Total Planejado:</span>
                    <span id="shift-total-qty" class="text-xl font-bold text-indigo-700">0</span>
                </div>
                <div class="flex gap-2 mt-2 text-xs text-gray-500">
                    <span>T1: <span id="shift-summary-t1">0</span></span>
                    <span>+</span>
                    <span>T2: <span id="shift-summary-t2">0</span></span>
                    <span>+</span>
                    <span>T3: <span id="shift-summary-t3">0</span></span>
                </div>
            </div>

            <!-- Botões -->
            <div class="flex gap-3 mt-6 pt-4 border-t border-gray-100">
                <button type="button" id="shift-reset-btn" class="flex-1 py-2.5 px-4 bg-gray-100 text-gray-700 rounded-xl font-semibold text-sm hover:bg-gray-200 transition-colors flex items-center justify-center gap-2">
                    <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                    Restaurar Padrão
                </button>
                <button type="button" id="shift-apply-btn" class="flex-1 py-2.5 px-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2">
                    <i data-lucide="check" class="w-4 h-4"></i>
                    Aplicar Distribuição
                </button>
            </div>
        </div>
    </div>

    <script src="advanced-kpis.js"></script>
    <script src="auto-pareto-analysis.js"></script>
    <script src="machine-queue.js?v=20260206"></script>
    <script src="script.js?v=20260217-phase10"></script>
    <script src="erp-import.js?v=20260217"></script>
    <script src="machine-schedule.js?v=20260217"></script>
    
    <!-- Módulos ES6 (Fase 1: roda em paralelo, sem alterar o legado) -->
    <script type="module" src="src/index.js"></script>
    
    <!-- Script de inicialização -->
    <script>
    (function() {
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[INIT] Sistema carregado!');
        });
    })();

    // FUNÇÃO DE DIAGNÓSTICO E LIMPEZA - disponível globalmente no console
    // Limpa parada fantasma de qualquer máquina
    window.forceStopDowntime = async function(machineId) {
        if (!machineId) { console.error('Uso: forceStopDowntime("H06")'); return; }
        var waitDb = function() {
            return new Promise(function(resolve) {
                var check = setInterval(function() {
                    if (window.db) { clearInterval(check); resolve(); }
                }, 500);
                setTimeout(function() { clearInterval(check); resolve(); }, 10000);
            });
        };
        if (!window.db) { console.log('Aguardando banco de dados...'); await waitDb(); }
        if (!window.db) { console.error('Banco de dados não disponível.'); return; }
        var mid = machineId.toUpperCase().trim();
        console.log('Forçando limpeza de paradas para:', mid);
        var count = 0;
        try {
            // 1. active_downtimes
            var d1 = await window.db.collection('active_downtimes').doc(mid).get();
            if (d1.exists) {
                await window.db.collection('active_downtimes').doc(mid).delete();
                console.log('Removido de active_downtimes:', mid); count++;
            } else { console.log('Nao encontrado em active_downtimes:', mid); }
            // 2. extended_downtime_logs
            var snap = await window.db.collection('extended_downtime_logs').where('status', '==', 'active').get();
            for (var i = 0; i < snap.docs.length; i++) {
                var doc = snap.docs[i]; var data = doc.data();
                var dm = (data.machine_id || data.machine || '').toUpperCase().trim();
                if (dm === mid) {
                    await doc.ref.update({ status: 'inactive', end_date: new Date().toISOString().split('T')[0], end_time: new Date().toTimeString().substring(0,5), force_stopped: true });
                    console.log('Finalizado em extended_downtime_logs:', doc.id); count++;
                }
            }
            // 3. Invalidar caches
            if (window.invalidateDowntimeCache) window.invalidateDowntimeCache(mid);
            if (window.DataStore) window.DataStore.invalidate('activeDowntimes');
            if (window._downtimeStatusCache) { delete window._downtimeStatusCache[mid]; window._downtimeStatusCacheTimestamp = 0; }
            console.log('Limpeza concluida!', count, 'registro(s). Recarregue (F5).');
        } catch (e) { console.error('Erro:', e); }
    };
    console.log('[INIT] forceStopDowntime() disponivel. Use: forceStopDowntime("H06")');
    </script>
</body>
</html>

