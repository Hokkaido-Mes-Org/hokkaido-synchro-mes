<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNCHRO - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .gradient-bg {
            background-image: linear-gradient(135deg, rgba(102, 126, 234, 0.55) 0%, rgba(118, 75, 162, 0.55) 100%), url('https://i.postimg.cc/zfgWtdm8/Preservacao-do-planeta-3-1-1024x576-1.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-blend-mode: multiply;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <!-- Card de Login -->
        <div class="glass-effect rounded-2xl shadow-2xl p-8">
            <!-- Header com Logos -->
            <div class="text-center mb-8">
                <div class="flex justify-center items-center gap-4 mb-6">
                    <!-- Logo Hokkaido -->
                    <img src="https://i.postimg.cc/5jdHwhF9/hokkaido-logo-110.png" alt="Logo Hokkaido Plastics" class="h-16 md:h-20 w-auto object-contain" loading="lazy">
                    <!-- Separador -->
                    <div class="w-8 h-0.5 bg-gray-300"></div>
                    <!-- Logo Synchro -->
                    <img src="https://i.postimg.cc/h47TKP4d/logosynchro.png" alt="Logo Synchro" class="h-16 md:h-20 w-auto object-contain" loading="lazy">
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">SYNCHRO</h1>
                <p class="text-gray-600 text-sm">Sistema de Controle de Produ√ß√£o</p>
            </div>

            <!-- Formul√°rio de Login -->
            <form id="login-form" class="space-y-6">
                <!-- Campo Usu√°rio -->
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="w-4 h-4 inline mr-2" data-lucide="user"></i>
                        Usu√°rio
                    </label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                        placeholder="Digite seu usu√°rio"
                        autocomplete="username">
                </div>

                <!-- Campo Senha -->
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="w-4 h-4 inline mr-2" data-lucide="lock"></i>
                        Senha
                    </label>
                    <div class="relative">
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 pr-12"
                            placeholder="Digite sua senha"
                            autocomplete="current-password">
                        <button 
                            type="button" 
                            id="toggle-password"
                            class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors">
                            <i class="w-5 h-5" data-lucide="eye"></i>
                        </button>
                    </div>
                </div>

                <!-- Lembrar Login -->
                <div class="flex items-center">
                    <input 
                        type="checkbox" 
                        id="remember-me" 
                        name="remember"
                        class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                    <label for="remember-me" class="ml-2 text-sm text-gray-700">
                        Lembrar meu login
                    </label>
                </div>

                <!-- Bot√£o Login -->
                <button 
                    type="submit" 
                    id="login-btn"
                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-3 px-4 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 transform hover:scale-105 flex items-center justify-center gap-2">
                    <i class="w-5 h-5" data-lucide="log-in"></i>
                    <span>Entrar no Sistema</span>
                </button>

                <!-- Loading State -->
                <div id="login-loading" class="hidden w-full bg-gray-400 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2">
                    <i class="w-5 h-5 animate-spin" data-lucide="loader-2"></i>
                    <span>Verificando credenciais...</span>
                </div>
            </form>

            <!-- Mensagem de Erro -->
            <div id="login-error" class="hidden mt-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg text-sm">
                <i class="w-4 h-4 inline mr-2" data-lucide="alert-circle"></i>
                <span id="error-message">Usu√°rio ou senha incorretos</span>
            </div>

            <!-- Footer -->
            <div class="mt-8 text-center text-xs text-gray-500">
                <p>¬© 2025 Hokkaido & Synchro</p>
                <p class="mt-1">Sistema de Monitoramento Industrial</p>
            </div>
        </div>

    </div>

    <script>
        // Inicializar √≠cones Lucide
        lucide.createIcons();

        // Alternar visibilidade da senha
        document.getElementById('toggle-password').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const eyeIcon = this.querySelector('[data-lucide]');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.setAttribute('data-lucide', 'eye-off');
            } else {
                passwordInput.type = 'password';
                eyeIcon.setAttribute('data-lucide', 'eye');
            }
            lucide.createIcons();
        });

        // Base de usu√°rios (em produ√ß√£o, usar Firebase Auth ou API)
        // Todos os usu√°rios com perfil GESTOR e acesso total (AUTENTICA√á√ÉO PILOTO)
        const users = {
            // USU√ÅRIOS PADR√ÉO
            'admin': {
                password: 'admin123',
                role: 'gestor',
                name: 'Administrador',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'gestor': {
                password: 'gestor123',
                role: 'gestor', 
                name: 'Gestor de Produ√ß√£o',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'operador': {
                password: 'op123',
                role: 'gestor',
                name: 'Operador de Produ√ß√£o',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'supervisor': {
                password: 'sup123',
                role: 'gestor',
                name: 'Supervisor',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            
            // USU√ÅRIOS DO PILOTO
            'leandro.camargo': {
                password: 'Leandro2025!',
                role: 'gestor',
                name: 'Leandro Camargo',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'tiago.oliveira': {
                password: 'Tiago2025!',
                role: 'gestor',
                name: 'Tiago Oliveira',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'werigue': {
                password: 'Werigue2025!',
                role: 'gestor',
                name: 'Werigue',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'daniella.braganca': {
                password: 'Daniella2025!',
                role: 'gestor',
                name: 'Daniella Bragan√ßa',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'michelle.benjamin': {
                password: 'Michelle2025!',
                role: 'gestor',
                name: 'Michelle Benjamin',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'luciano': {
                password: 'Luciano2025!',
                role: 'gestor',
                name: 'Luciano',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            
            // NOVOS USU√ÅRIOS SOLICITADOS
            'marilise.katia': {
                password: 'Marilise2025!',
                role: 'gestor',
                name: 'Marilise Katia',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'daniel.rocha': {
                password: 'Daniel2025!',
                role: 'gestor',
                name: 'Daniel Rocha',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'leonardo.doria': {
                password: 'Leonardo2025!',
                role: 'gestor',
                name: 'Leonardo D√≥ria',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'davi.batista': {
                password: 'Davi2025!',
                role: 'gestor',
                name: 'Davi Batista',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'thiago.alberigi': {
                password: 'Thiago2025!',
                role: 'gestor',
                name: 'Thiago Alberigi',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'vania': {
                password: 'Vania2025!',
                role: 'gestor',
                name: 'V√¢nia',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'silvio.piazera': {
                password: 'Silvio2025!',
                role: 'gestor',
                name: 'S√≠lvio Piazera',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'cleidiana': {
                password: 'Cleidiana2025!',
                role: 'gestor',
                name: 'Cleidiana',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            'diego.goto': {
                password: 'Diego2025!',
                role: 'gestor',
                name: 'Diego Goto',
                permissions: ['planejamento', 'lancamento', 'analise']
            },
            
            
            // EXEMPLO: Novo usu√°rio adicionado manualmente
            'joao.silva': {
                password: 'Joao2025!',
                role: 'gestor',
                name: 'Jo√£o Silva',
                permissions: ['planejamento', 'lancamento', 'analise']
            }
        };

        // Utilidades de normaliza√ß√£o e busca tolerante de usu√°rio
        function normalizeStr(str) {
            return String(str || '')
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '') // remove acentos
                .toLowerCase()
                .trim()
                .replace(/\s+/g, ' ');
        }

        function findUserKeyFlexible(input) {
            const raw = String(input || '').trim();
            const norm = normalizeStr(raw);

            console.log('üîç [FLEX] Input:', raw, '‚Üí Normalizado:', norm);

            // 1) Match direto por chave (case-insensitive)
            if (users[norm]) {
                console.log('‚úÖ [FLEX] Match m√©todo 1 (chave direta):', norm);
                return { key: norm, userData: users[norm] };
            }

            // 2) Tentar substituir espa√ßo por ponto (ex.: "thiago alberigui" -> "thiago.alberigui")
            const dotVariant = norm.replace(/\s+/g, '.');
            if (users[dotVariant]) {
                console.log('‚úÖ [FLEX] Match m√©todo 2 (espa√ßo‚Üíponto):', dotVariant);
                return { key: dotVariant, userData: users[dotVariant] };
            }

            // 3) Tentar remover pontos do input e comparar com chaves sem ponto
            const noDotNorm = norm.replaceAll('.', '');
            for (const key of Object.keys(users)) {
                const keyNoDot = key.replaceAll('.', '');
                if (keyNoDot === noDotNorm) {
                    console.log('‚úÖ [FLEX] Match m√©todo 3 (sem pontos):', key);
                    return { key, userData: users[key] };
                }
            }

            // 4) Match por NOME completo normalizado (exato)
            for (const [key, userData] of Object.entries(users)) {
                const nameNorm = normalizeStr(userData?.name || '');
                if (nameNorm && nameNorm === norm) {
                    console.log('‚úÖ [FLEX] Match m√©todo 4 (nome completo):', key, nameNorm);
                    return { key, userData };
                }
            }

            // 5) Match por tokens do nome (todos os tokens presentes)
            const tokens = norm.split(' ').filter(Boolean);
            if (tokens.length) {
                let best = null;
                for (const [key, userData] of Object.entries(users)) {
                    const nameNorm = normalizeStr(userData?.name || '');
                    if (!nameNorm) continue;
                    const hasAll = tokens.every(t => nameNorm.includes(t));
                    if (hasAll) {
                        console.log('‚úÖ [FLEX] Match m√©todo 5 (tokens):', key, 'tokens:', tokens);
                        best = best || { key, userData };
                    }
                }
                if (best) return best;
            }

            console.log('‚ùå [FLEX] Nenhum usu√°rio encontrado para:', raw);
            return { key: null, userData: null };
        }

        // Fun√ß√£o de login
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            
            console.log('üîç [DEBUG] === TENTATIVA DE LOGIN ===');
            console.log('üîç [DEBUG] Username digitado:', username);
            console.log('üîç [DEBUG] Senha digitada:', password);
            console.log('üîç [DEBUG] Lembrar login:', rememberMe);
            console.log('üîç [DEBUG] Usu√°rios dispon√≠veis:', Object.keys(users));
            
            // Mostrar loading
            showLoading(true);
            hideError();
            
            // Simular delay de verifica√ß√£o
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Verificar credenciais com busca flex√≠vel (username, nome completo, varia√ß√µes)
            console.log('üîç [DEBUG] Iniciando busca flex√≠vel...');
            const found = findUserKeyFlexible(username);
            let user = found.userData;
            let usernameUsed = found.key || username.toLowerCase();
            
            console.log('üîç [DEBUG] Resultado da busca flex√≠vel:', { 
                usuarioEncontrado: !!user, 
                chaveUsada: usernameUsed,
                dados: user ? { name: user.name, role: user.role } : null
            });
            
            if (user) {
                console.log('üîç [DEBUG] Comparando senha...');
                console.log('üîç [DEBUG] Senha esperada:', user.password);
                console.log('üîç [DEBUG] Senha fornecida:', password);
                console.log('üîç [DEBUG] Senhas conferem?:', user.password === password);
            }
            
            if (user && user.password === password) {
                // Login bem-sucedido
                const userSession = {
                    username: usernameUsed,
                    name: user.name,
                    role: user.role,
                    permissions: user.permissions,
                    loginTime: new Date().toISOString()
                };
                
                console.log('‚úÖ [DEBUG] === LOGIN BEM-SUCEDIDO ===');
                console.log('‚úÖ [DEBUG] Sess√£o:', userSession);
                
                // Salvar sess√£o
                if (rememberMe) {
                    localStorage.setItem('synchro_user', JSON.stringify(userSession));
                    console.log('‚úÖ [DEBUG] Salvo em localStorage');
                } else {
                    sessionStorage.setItem('synchro_user', JSON.stringify(userSession));
                    console.log('‚úÖ [DEBUG] Salvo em sessionStorage');
                }
                
                // Redirecionar para o sistema principal
                console.log('‚úÖ [DEBUG] Redirecionando para index.html...');
                window.location.href = 'index.html';
                
            } else {
                // Login falhou
                console.error('‚ùå [DEBUG] === LOGIN FALHOU ===');
                if (!user) {
                    console.error('‚ùå [DEBUG] Motivo: Usu√°rio n√£o encontrado');
                } else {
                    console.error('‚ùå [DEBUG] Motivo: Senha incorreta');
                }
                showError('Usu√°rio ou senha incorretos');
                showLoading(false);
            }
        });

        function showLoading(show) {
            const loginBtn = document.getElementById('login-btn');
            const loadingDiv = document.getElementById('login-loading');
            
            if (show) {
                loginBtn.classList.add('hidden');
                loadingDiv.classList.remove('hidden');
            } else {
                loginBtn.classList.remove('hidden');
                loadingDiv.classList.add('hidden');
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('login-error');
            const errorMessage = document.getElementById('error-message');
            
            errorMessage.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideError() {
            const errorDiv = document.getElementById('login-error');
            errorDiv.classList.add('hidden');
        }

        // Verificar se j√° est√° logado
        window.addEventListener('load', function() {
            const savedUser = localStorage.getItem('synchro_user') || sessionStorage.getItem('synchro_user');
            if (savedUser) {
                // Usu√°rio j√° logado, redirecionar com delay para garantir leitura correta
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 200);
            }
        });

        // Auto-focus no campo usu√°rio
        document.getElementById('username').focus();
    </script>
</body>
</html>
