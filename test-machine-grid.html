<!DOCTYPE html>
<html>
<head>
    <title>Test Machine Status Grid</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0f172a;
            font-family: 'Roboto', sans-serif;
            color: #fff;
        }

        .test-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .test-section {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-section h2 {
            margin-top: 0;
            color: #60a5fa;
        }

        /* Footer styles - copied from dashboard-tv.html */
        .industrial-footer {
            grid-column: 1 / -1;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            min-height: 130px;
            max-height: 180px;
            overflow-y: auto;
        }

        .footer-label {
            background: linear-gradient(90deg, #3b82f6, #1e40af);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .footer-label span {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 1.5px;
            text-transform: uppercase;
        }

        .machine-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 8px;
            padding: 12px 16px;
            flex: 1;
            overflow-y: auto;
        }

        .machine-status-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 70px;
            padding: 10px 14px;
            border-radius: 6px;
            font-family: 'Roboto Mono', monospace;
            font-weight: 700;
            font-size: 16px;
            text-transform: uppercase;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .machine-status-card .machine-number {
            font-size: 18px;
            font-weight: 900;
        }

        .machine-status-card .machine-label {
            font-size: 8px;
            font-weight: 500;
            letter-spacing: 0.5px;
            margin-top: 2px;
        }

        .machine-status-card.produzindo {
            background: rgba(0, 230, 118, 0.2);
            border-color: #00e676;
            color: #00e676;
        }

        .machine-status-card.manutencao {
            background: rgba(255, 171, 0, 0.2);
            border-color: #ffab00;
            color: #ffab00;
        }

        .machine-status-card.ferramentaria {
            background: rgba(255, 171, 0, 0.2);
            border-color: #ffab00;
            color: #ffab00;
        }

        .machine-status-card.comercial-pcp {
            background: rgba(30, 30, 30, 0.8);
            border-color: #333;
            color: #999;
        }

        .machine-status-card.setup {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3B82F6;
            color: #3B82F6;
        }

        .machine-status-card.parada {
            background: rgba(255, 23, 68, 0.2);
            border-color: #ff1744;
            color: #ff1744;
            animation: card-pulse 2s infinite;
        }

        .machine-status-card.outros {
            background: rgba(120, 144, 156, 0.2);
            border-color: #78909c;
            color: #78909c;
        }

        @keyframes card-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .status-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            border: 2px solid;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-section">
            <h2>✅ Machine Status Grid Test</h2>
            <p>Este é um teste visual do grid de status de máquinas.</p>

            <div class="industrial-footer">
                <div class="footer-label">
                    <span>Status Máquinas</span>
                </div>
                <div class="machine-status-grid" id="machineStatusGrid">
                    <!-- Will be populated by JS -->
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Legenda de Cores</h2>
            <div class="status-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(0, 230, 118, 0.2); border-color: #00e676;"></div>
                    <span>Produzindo (OK)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(255, 171, 0, 0.2); border-color: #ffab00;"></div>
                    <span>Manutenção (MNT)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(255, 171, 0, 0.2); border-color: #ffab00;"></div>
                    <span>Ferramentaria (FER)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(30, 30, 30, 0.8); border-color: #333;"></div>
                    <span>PCP (PCP)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(59, 130, 246, 0.2); border-color: #3B82F6;"></div>
                    <span>Setup (SET)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(255, 23, 68, 0.2); border-color: #ff1744;"></div>
                    <span>Parada (PAR)</span>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Status da Simulação</h2>
            <p id="statusMessage">Carregando...</p>
        </div>
    </div>

    <script>
        // Simulated data
        const allMachineIds = ['H01', 'H02', 'H04', 'H05', 'H06', 'H07', 'H08', 'H10', 'H11', 'H12', 
                               'H14', 'H17', 'H18', 'H19', 'H20', 'H21', 'H22', 'H23', 'H24', 'H26', 
                               'H27', 'H28', 'H29', 'H30', 'H31', 'H32', 'H33', 'H34', 'H35', 'H37', 
                               'H39', 'H40', 'H41'];

        // Simulated downtime data
        const cachedDowntimes = [
            { machine_id: 'H01', reason: 'Manutenção preventiva' },
            { machine_id: 'H02', reason: 'Ferramentaria - troca de molde' },
            { machine_id: 'H05', reason: 'Setup nova ordem' },
        ];

        // Simulated planning data
        const cachedPlanning = [
            { machine: 'H04' },
            { machine: 'H06' },
            { machine: 'H07' },
            { machine: 'H08' },
            { machine: 'H10' },
            { machine: 'H11' },
            { machine: 'H12' },
        ];

        function getStatusClass(machineId) {
            const downtimes = cachedDowntimes.filter(dt => dt.machine_id === machineId);
            if (downtimes.length > 0) {
                const reason = downtimes[0].reason.toLowerCase();
                if (reason.includes('manutenção') || reason.includes('manutencao')) return 'manutencao';
                if (reason.includes('ferramentaria')) return 'ferramentaria';
                if (reason.includes('setup')) return 'setup';
                return 'parada';
            }

            const hasPlanning = cachedPlanning.some(p => p.machine === machineId);
            if (hasPlanning) return 'produzindo';
            return 'outros';
        }

        function getStatusLabel(statusClass) {
            const labels = {
                'produzindo': 'OK',
                'manutencao': 'MNT',
                'ferramentaria': 'FER',
                'comercial-pcp': 'PCP',
                'setup': 'SET',
                'parada': 'PAR',
                'outros': '---'
            };
            return labels[statusClass] || '---';
        }

        function renderGrid() {
            const gridEl = document.getElementById('machineStatusGrid');
            
            gridEl.innerHTML = allMachineIds.map(machineId => {
                const statusClass = getStatusClass(machineId);
                const statusLabel = getStatusLabel(statusClass);

                return `
                    <div class="machine-status-card ${statusClass}" title="Status: ${statusLabel}">
                        <span class="machine-number">${machineId}</span>
                        <span class="machine-label">${statusLabel}</span>
                    </div>
                `;
            }).join('');

            // Status message
            const statusEl = document.getElementById('statusMessage');
            const totalCount = allMachineIds.length;
            const produzindoCount = allMachineIds.filter(m => getStatusClass(m) === 'produzindo').length;
            const paradas = allMachineIds.filter(m => getStatusClass(m).includes('parada') || 
                                                       getStatusClass(m) === 'manutencao' ||
                                                       getStatusClass(m) === 'ferramentaria' ||
                                                       getStatusClass(m) === 'setup');
            
            statusEl.innerHTML = `
                <strong>✅ Grid renderizado com sucesso!</strong><br>
                Total de máquinas: ${totalCount}<br>
                Em produção: ${produzindoCount}<br>
                Com paradas/manutenção: ${paradas.length}<br>
                Sem status: ${totalCount - produzindoCount - paradas.length}
            `;
        }

        // Render on load
        document.addEventListener('DOMContentLoaded', renderGrid);
    </script>
</body>
</html>
